import { __decorate } from "tslib";
import { Component, Input, ViewChild, Output, EventEmitter } from '@angular/core';
import { ModelService } from '../services/model.service';
import { MouseService } from '../services/mouse.service';
import { MenuService } from '../menu/menu.service';
var DropDownListComponent = /** @class */ (function () {
    function DropDownListComponent(model, mouseService, menuService) {
        var _this = this;
        this.model = model;
        this.mouseService = mouseService;
        this.menuService = menuService;
        this.showImage = false;
        this.action = new EventEmitter();
        this.over = false;
        this._readOnly = false;
        this._enabled = true;
        this.mouseService.getDocumentMouseUp().subscribe(function () {
            _this.hideListMenu();
        });
    }
    DropDownListComponent.prototype.ngOnInit = function () { };
    Object.defineProperty(DropDownListComponent.prototype, "readOnly", {
        get: function () {
            return this._readOnly;
        },
        set: function (value) {
            var _this = this;
            this._readOnly = value;
            setTimeout(function () {
                try {
                    _this.input.nativeElement.setAttribute('unselectable', value ? 'on' : 'off');
                    _this.input.nativeElement.setAttribute('onselectstart', value ? 'return false' : '');
                    _this.input.nativeElement.readOnly = value;
                }
                catch (e) { }
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownListComponent.prototype, "enabled", {
        get: function () {
            return this._enabled;
        },
        set: function (value) {
            if (!value) {
                this.over = false;
            }
            this._enabled = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownListComponent.prototype, "key", {
        get: function () {
            return this._key;
        },
        set: function (key) {
            if (this.items != null) {
                this.items.forEach(function (i) { return i.selected = i.key === key; });
            }
            this._key = key;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownListComponent.prototype, "inputValue", {
        get: function () {
            var _this = this;
            var _a;
            if (this.items != null) {
                return ((_a = this.items.find(function (i) { return i.key === _this._key; })) === null || _a === void 0 ? void 0 : _a.caption) || '';
            }
            return '';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownListComponent.prototype, "selected", {
        get: function () {
            var _a, _b;
            var vm = this.menuService.getVerticalMenu();
            return ((_a = vm) === null || _a === void 0 ? void 0 : _a.state) === 'expanded' && ((_b = vm) === null || _b === void 0 ? void 0 : _b.parent) === this.element;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DropDownListComponent.prototype, "className", {
        get: function () {
            return this.selected ? 'stiJsViewerDropDownListOver' : (this.enabled ? (this.over ? 'stiJsViewerDropDownListOver' : 'stiJsViewerDropDownList') : 'stiJsViewerDropDownListDisabled');
        },
        enumerable: true,
        configurable: true
    });
    DropDownListComponent.prototype.mouseover = function () {
        if (!this.enabled) {
            return;
        }
        this.over = true;
    };
    DropDownListComponent.prototype.mouseout = function () {
        if (!this.enabled) {
            return;
        }
        this.over = false;
    };
    DropDownListComponent.prototype.inputClick = function () {
        if (this.readOnly) {
            this.showListMenu();
        }
    };
    DropDownListComponent.prototype.showListMenu = function () {
        var _this = this;
        this.menuService.addMenu({
            type: this.menuService.VERTICAL_MENU_NAME, name: this.menuService.VERTICAL_MENU_NAME, items: [], parent: this.element,
            verticalItems: this.items, itemStyleName: 'stiJsViewerMenuStandartItem', menuStyleName: 'stiJsViewerDropdownMenu',
            action: this.action, width: this.element.nativeElement.offsetWidth
        });
        setTimeout(function () {
            _this.menuService.showMenu(_this.menuService.VERTICAL_MENU_NAME);
        });
    };
    DropDownListComponent.prototype.hideListMenu = function () {
        if (this.menuService.getVerticalMenu()) {
            this.menuService.getVerticalMenu().state = 'initialDown';
        }
    };
    DropDownListComponent.ctorParameters = function () { return [
        { type: ModelService },
        { type: MouseService },
        { type: MenuService }
    ]; };
    __decorate([
        ViewChild('input')
    ], DropDownListComponent.prototype, "input", void 0);
    __decorate([
        ViewChild('element')
    ], DropDownListComponent.prototype, "element", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "toolTip", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "showImage", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "width", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "margin", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "items", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "styleDisplay", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "verticalAlign", void 0);
    __decorate([
        Output()
    ], DropDownListComponent.prototype, "action", void 0);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "readOnly", null);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "enabled", null);
    __decorate([
        Input()
    ], DropDownListComponent.prototype, "key", null);
    DropDownListComponent = __decorate([
        Component({
            selector: 'sti-drop-down-list',
            template: "\n        <table #element [class]=\"className\" cellpadding=\"0\" cellspacing=\"0\"\n              [style.fontFamily]=\"model.options.toolbar.fontFamily\"\n              [style.color]=\"model.options.toolbar.fontColor\"\n              [style.margin]=\"margin\"\n              [style.verticalAlign]=\"verticalAlign\"\n              [style.display]=\"styleDisplay\"\n              [attr.title]=\"toolTip\"\n              (mouseover)=\"mouseover()\"\n              (mouseout)=\"mouseout()\">\n          <tbody>\n            <tr class=\"stiJsViewerClearAllStyles\">\n              <td class=\"stiJsViewerClearAllStyles\">\n                <input #input\n                [style.width.px]=\"width - (model.options.isTouchDevice ? 23 : 15) - (showImage ? 38 : 0)\"\n                [style.border]=\"0\"\n                [style.cursor]=\"readOnly ? 'default' : 'text'\"\n                [style.fontFamily]=\"model.options.toolbar.fontFamily\"\n                [style.color]=\"model.options.toolbar.fontColor\"\n                [style.height]=\"model.options.isTouchDevice ? '23px' : '18px'\"\n                [style.lineHeight]=\"model.options.isTouchDevice ? '23px' : '18px'\"\n                [style.visibility]=\"enabled ? 'visible' : 'hidden'\"\n                [value]=\"inputValue\"\n                (click)=\"inputClick()\"\n                class=\"stiJsViewerDropDownList_TextBox\">\n              </td>\n\n              <td class=\"stiJsViewerClearAllStyles\">\n                  <sti-button [imageName]=\"'Arrows.' + (model.options.isTouchDevice ? 'Big' : 'Small') + 'ArrowDown.png'\"\n                     [styleName]=\"'stiJsViewerDropDownListButton'\"\n                     [imageSizesWidth]=\"model.options.isTouchDevice ? 16 : 8\"\n                     [imageSizesHeight]=\"model.options.isTouchDevice ? 16 : 8\"\n                     [height]=\"model.options.isTouchDevice ? '26px' : '21px'\"\n                     [enabled]=\"enabled\"\n                     [selected]=\"selected\"\n                     [margin]=\"'0'\"\n                     (action)=\"showListMenu()\">\n                  </sti-button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n\n  "
        })
    ], DropDownListComponent);
    return DropDownListComponent;
}());
export { DropDownListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcC1kb3duLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb250cm9scy9kcm9wLWRvd24tbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBYyxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBa0RuRDtJQW9CRSwrQkFBbUIsS0FBbUIsRUFBUyxZQUEwQixFQUFTLFdBQXdCO1FBQTFHLGlCQUlDO1FBSmtCLFVBQUssR0FBTCxLQUFLLENBQWM7UUFBUyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBZGpHLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFPakIsV0FBTSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXpELFNBQUksR0FBRyxLQUFLLENBQUM7UUFDTCxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFJdEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUMvQyxLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsd0NBQVEsR0FBUixjQUFhLENBQUM7SUFFZCxzQkFBSSwyQ0FBUTthQVdIO1lBQ1AsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUM7YUFiRCxVQUFhLEtBQWM7WUFBM0IsaUJBU0M7WUFSQyxJ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SyxFQUFFOzREQUFtQjtJQUNsQjtRQUFSLEtBQUssRUFBRTt3REFBZTtJQUNkO1FBQVIsS0FBSyxFQUFFO3lEQUFnQjtJQUNmO1FBQVIsS0FBSyxFQUFFO3dEQUFlO0lBQ2Q7UUFBUixLQUFLLEVBQUU7K0RBQXNCO0lBQ3JCO1FBQVIsS0FBSyxFQUFFO2dFQUF1QjtJQUVyQjtRQUFULE1BQU0sRUFBRTt5REFBZ0Q7SUEwQmhEO1FBQVIsS0FBSyxFQUFFO3lEQUVQO0lBRVE7UUFBUixLQUFLLEVBQUU7d0RBRVA7SUFTUTtRQUFSLEtBQUssRUFBRTtvREFFUDtJQXhEVSxxQkFBcUI7UUFoRGpDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxvQkFBb0I7WUFDOUIsUUFBUSxFQUFFLHVwRUEyQ1Q7U0FDRixDQUFDO09BRVcscUJBQXFCLENBdUhqQztJQUFELDRCQUFDO0NBQUEsQUF2SEQsSUF1SEM7U0F2SFkscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJdGVtIH0gZnJvbSAnLi4vc2VydmljZXMvb2JqZWN0cyc7XHJcbmltcG9ydCB7IE1vdXNlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vdXNlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZW51U2VydmljZSB9IGZyb20gJy4uL21lbnUvbWVudS5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc3RpLWRyb3AtZG93bi1saXN0JyxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDx0YWJsZSAjZWxlbWVudCBbY2xhc3NdPVwiY2xhc3NOYW1lXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCJcclxuICAgICAgICAgICAgICBbc3R5bGUuZm9udEZhbWlseV09XCJtb2RlbC5vcHRpb25zLnRvb2xiYXIuZm9udEZhbWlseVwiXHJcbiAgICAgICAgICAgICAgW3N0eWxlLmNvbG9yXT1cIm1vZGVsLm9wdGlvbnMudG9vbGJhci5mb250Q29sb3JcIlxyXG4gICAgICAgICAgICAgIFtzdHlsZS5tYXJnaW5dPVwibWFyZ2luXCJcclxuICAgICAgICAgICAgICBbc3R5bGUudmVydGljYWxBbGlnbl09XCJ2ZXJ0aWNhbEFsaWduXCJcclxuICAgICAgICAgICAgICBbc3R5bGUuZGlzcGxheV09XCJzdHlsZURpc3BsYXlcIlxyXG4gICAgICAgICAgICAgIFthdHRyLnRpdGxlXT1cInRvb2xUaXBcIlxyXG4gICAgICAgICAgICAgIChtb3VzZW92ZXIpPVwibW91c2VvdmVyKClcIlxyXG4gICAgICAgICAgICAgIChtb3VzZW91dCk9XCJtb3VzZW91dCgpXCI+XHJcbiAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgIDx0ciBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIj5cclxuICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICA8aW5wdXQgI2lucHV0XHJcbiAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGgucHhdPVwid2lkdGggLSAobW9kZWwub3B0aW9ucy5pc1RvdWNoRGV2aWNlID8gMjMgOiAxNSkgLSAoc2hvd0ltYWdlID8gMzggOiAwKVwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuYm9yZGVyXT1cIjBcIlxyXG4gICAgICAgICAgICAgICAgW3N0eWxlLmN1cnNvcl09XCJyZWFkT25seSA/ICdkZWZhdWx0JyA6ICd0ZXh0J1wiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuZm9udEZhbWlseV09XCJtb2RlbC5vcHRpb25zLnRvb2xiYXIuZm9udEZhbWlseVwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuY29sb3JdPVwibW9kZWwub3B0aW9ucy50b29sYmFyLmZvbnRDb2xvclwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuaGVpZ2h0XT1cIm1vZGVsLm9wdGlvbnMuaXNUb3VjaERldmljZSA/ICcyM3B4JyA6ICcxOHB4J1wiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUubGluZUhlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAnMjNweCcgOiAnMThweCdcIlxyXG4gICAgICAgICAgICAgICAgW3N0eWxlLnZpc2liaWxpdHldPVwiZW5hYmxlZCA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJpbnB1dFZhbHVlXCJcclxuICAgICAgICAgICAgICAgIChjbGljayk9XCJpbnB1dENsaWNrKClcIlxyXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJzdGlKc1ZpZXdlckRyb3BEb3duTGlzdF9UZXh0Qm94XCI+XHJcbiAgICAgICAgICAgICAgPC90ZD5cclxuXHJcbiAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgICA8c3RpLWJ1dHRvbiBbaW1hZ2VOYW1lXT1cIidBcnJvd3MuJyArIChtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAnQmlnJyA6ICdTbWFsbCcpICsgJ0Fycm93RG93bi5wbmcnXCJcclxuICAgICAgICAgICAgICAgICAgICAgW3N0eWxlTmFtZV09XCInc3RpSnNWaWV3ZXJEcm9wRG93bkxpc3RCdXR0b24nXCJcclxuICAgICAgICAgICAgICAgICAgICAgW2ltYWdlU2l6ZXNXaWR0aF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAxNiA6IDhcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbaW1hZ2VTaXplc0hlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAxNiA6IDhcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbaGVpZ2h0XT1cIm1vZGVsLm9wdGlvbnMuaXNUb3VjaERldmljZSA/ICcyNnB4JyA6ICcyMXB4J1wiXHJcbiAgICAgICAgICAgICAgICAgICAgIFtlbmFibGVkXT1cImVuYWJsZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbc2VsZWN0ZWRdPVwic2VsZWN0ZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbbWFyZ2luXT1cIicwJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgIChhY3Rpb24pPVwic2hvd0xpc3RNZW51KClcIj5cclxuICAgICAgICAgICAgICAgICAgPC9zdGktYnV0dG9uPlxyXG4gICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcblxyXG4gIGBcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBEcm9wRG93bkxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcpIGlucHV0OiBFbGVtZW50UmVmO1xyXG4gIEBWaWV3Q2hpbGQoJ2VsZW1lbnQnKSBlbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICBASW5wdXQoKSB0b29sVGlwOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgc2hvd0ltYWdlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgd2lkdGg6IG51bWJlcjtcclxuICBASW5wdXQoKSBtYXJnaW46IHN0cmluZztcclxuICBASW5wdXQoKSBpdGVtczogSXRlbVtdO1xyXG4gIEBJbnB1dCgpIHN0eWxlRGlzcGxheTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHZlcnRpY2FsQWxpZ246IHN0cmluZztcclxuXHJcbiAgQE91dHB1dCgpIGFjdGlvbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIG92ZXIgPSBmYWxzZTtcclxuICBwcml2YXRlIF9yZWFkT25seSA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2VuYWJsZWQgPSB0cnVlO1xyXG4gIHByaXZhdGUgX2tleTogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIG1vdXNlU2VydmljZTogTW91c2VTZXJ2aWNlLCBwdWJsaWMgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLm1vdXNlU2VydmljZS5nZXREb2N1bWVudE1vdXNlVXAoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmhpZGVMaXN0TWVudSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHsgfVxyXG5cclxuICBzZXQgcmVhZE9ubHkodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX3JlYWRPbmx5ID0gdmFsdWU7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICB0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCd1bnNlbGVjdGFibGUnLCB2YWx1ZSA/ICdvbicgOiAnb2ZmJyk7XHJcbiAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnNldEF0dHJpYnV0ZSgnb25zZWxlY3RzdGFydCcsIHZhbHVlID8gJ3JldHVybiBmYWxzZScgOiAnJyk7XHJcbiAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnJlYWRPbmx5ID0gdmFsdWU7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQgcmVhZE9ubHkoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVhZE9ubHk7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQgZW5hYmxlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9lbmFibGVkO1xyXG4gIH1cclxuXHJcbiAgc2V0IGVuYWJsZWQodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgdGhpcy5vdmVyID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9lbmFibGVkID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQga2V5KCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5fa2V5O1xyXG4gIH1cclxuXHJcbiAgc2V0IGtleShrZXk6IGFueSkge1xyXG4gICAgaWYgKHRoaXMuaXRlbXMgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaSA9PiBpLnNlbGVjdGVkID0gaS5rZXkgPT09IGtleSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgfVxyXG5cclxuICBnZXQgaW5wdXRWYWx1ZSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuaXRlbXMgIT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5pdGVtcy5maW5kKGkgPT4gaS5rZXkgPT09IHRoaXMuX2tleSk/LmNhcHRpb24gfHwgJyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICBnZXQgc2VsZWN0ZWQoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB2bSA9IHRoaXMubWVudVNlcnZpY2UuZ2V0VmVydGljYWxNZW51KCk7XHJcbiAgICByZXR1cm4gdm0/LnN0YXRlID09PSAnZXhwYW5kZWQnICYmIHZtPy5wYXJlbnQgPT09IHRoaXMuZWxlbWVudDtcclxuICB9XHJcblxyXG4gIGdldCBjbGFzc05hbWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkID8gJ3N0aUpzVmlld2VyRHJvcERvd25MaXN0T3ZlcicgOiAodGhpcy5lbmFibGVkID8gKHRoaXMub3ZlciA/ICdzdGlKc1ZpZXdlckRyb3BEb3duTGlzdE92ZXInIDogJ3N0aUpzVmlld2VyRHJvcERvd25MaXN0JykgOiAnc3RpSnNWaWV3ZXJEcm9wRG93bkxpc3REaXNhYmxlZCcpO1xyXG4gIH1cclxuXHJcbiAgbW91c2VvdmVyKCkge1xyXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vdmVyID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG1vdXNlb3V0KCkge1xyXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vdmVyID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpbnB1dENsaWNrKCkge1xyXG4gICAgaWYgKHRoaXMucmVhZE9ubHkpIHtcclxuICAgICAgdGhpcy5zaG93TGlzdE1lbnUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNob3dMaXN0TWVudSgpIHtcclxuICAgIHRoaXMubWVudVNlcnZpY2UuYWRkTWVudSh7XHJcbiAgICAgIHR5cGU6IHRoaXMubWVudVNlcnZpY2UuVkVSVElDQUxfTUVOVV9OQU1FLCBuYW1lOiB0aGlzLm1lbnVTZXJ2aWNlLlZFUlRJQ0FMX01FTlVfTkFNRSwgaXRlbXM6IFtdLCBwYXJlbnQ6IHRoaXMuZWxlbWVudCxcclxuICAgICAgdmVydGljYWxJdGVtczogdGhpcy5pdGVtcywgaXRlbVN0eWxlTmFtZTogJ3N0aUpzVmlld2VyTWVudVN0YW5kYXJ0SXRlbScsIG1lbnVTdHlsZU5hbWU6ICdzdGlKc1ZpZXdlckRyb3Bkb3duTWVudScsXHJcbiAgICAgIGFjdGlvbjogdGhpcy5hY3Rpb24sIHdpZHRoOiB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aFxyXG4gICAgfSk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMubWVudVNlcnZpY2Uuc2hvd01lbnUodGhpcy5tZW51U2VydmljZS5WRVJUSUNBTF9NRU5VX05BTUUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBoaWRlTGlzdE1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5tZW51U2VydmljZS5nZXRWZXJ0aWNhbE1lbnUoKSkge1xyXG4gICAgICB0aGlzLm1lbnVTZXJ2aWNlLmdldFZlcnRpY2FsTWVudSgpLnN0YXRlID0gJ2luaXRpYWxEb3duJztcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==