import { __decorate, __values } from "tslib";
import { Injectable } from '@angular/core';
import { ModelService } from './model.service';
import { Md5Service } from './md5.service';
import { HelperService } from './helper.service';
import { ControllerService } from './controller.service';
import { DrillDownService } from './drill-down.service';
var InteractionsService = /** @class */ (function () {
    function InteractionsService(model, md5, controller, helper, drillDownService) {
        var _this = this;
        this.model = model;
        this.md5 = md5;
        this.controller = controller;
        this.helper = helper;
        this.drillDownService = drillDownService;
        controller.getMessage().subscribe(function (message) {
            if (message.action === 'InitVars') {
                _this.showParametersPanel(message.data);
            }
        });
        controller.getActionMessage().subscribe(function (message) {
            switch (message.action) {
                case 'Variables':
                    _this.postInteraction({ action: 'Variables', variables: _this.getParametersValues() });
                    break;
                case 'Reset':
                    _this.showParametersPanel(_this.model.options.paramsVariables);
                    break;
                default:
                    break;
            }
        });
    }
    InteractionsService.prototype.postInteraction = function (params) {
        this.drillDownService.saveState();
        // Add new drill-down parameters to drill-down queue and calc guid
        if (params.action !== 'InitVars' && (params.action === 'DrillDown' || params.action === 'DashboardDrillDown')) {
            if (this.model.options.drillDownInProgress) {
                return;
            }
            if (params.action === 'DashboardDrillDown' && params.drillDownParameters) {
                params.drillDownParameters.isDashboardDrillDown = true; // add dbs flag
            }
            var drillDownParameters = this.model.reportParams.drillDownParameters || [];
            params.drillDownParameters = params.drillDownParameters ? drillDownParameters.concat(params.drillDownParameters) : drillDownParameters;
            if (params.action === 'DrillDown') {
                params.drillDownGuid = this.md5.hex_md5(JSON.stringify(this.sortPropsInDrillDownParameters(params.drillDownParameters)));
            }
            else {
                params.dashboardDrillDownGuid = this.md5.hex_md5(JSON.stringify(this.sortPropsInDrillDownParameters(params.drillDownParameters)));
            }
            this.model.options.drillDownInProgress = true;
        }
        this.controller.post(params.action, this.model.options.actions.interaction, params);
    };
    InteractionsService.prototype.showParametersPanel = function (data) {
        if (!data) {
            return;
        }
        if (this.controller.showError(data)) {
            data = null;
        }
        this.model.options.isParametersReceived = true;
        this.model.options.paramsVariables = typeof data === 'string' ? JSON.parse(data) : data;
        this.model.controls.parametersPanel.visible = !this.model.options.isMobileDevice;
        // if (this.model.reportParams.type === 'Dashboard') jsObject.postAction('GetPages');
        var paramsVariables = this.helper.copyObject(this.model.options.paramsVariables);
        var countParameters = this.helper.getCountObjects(paramsVariables);
        var countColumns = (countParameters <= this.model.options.minParametersCountForMultiColumns)
            ? 1 : this.model.options.appearance.parametersPanelColumnsCount;
        var countInColumn = Math.trunc(countParameters / countColumns);
        if (countInColumn * countColumns < countParameters) {
            countInColumn++;
        }
        // setup lists
        for (var i = 0; i < countParameters; i++) {
            var variable = paramsVariables[i];
            if (variable.items) {
                variable.items.forEach(function (v) {
                    v.isChecked = true;
                    v.visible = true;
                });
            }
            variable.isNull = (variable.type === 'DateTime' && variable.value === null && variable.basicType === 'NullableValue');
        }
        this.model.interactions = { paramsVariables: paramsVariables, countColumns: new Array(countColumns), countInColumn: new Array(countInColumn) };
    };
    InteractionsService.prototype.sortPropsInDrillDownParameters = function (inArray) {
        if (!inArray || !inArray.length) {
            return inArray;
        }
        var outArray = [];
        var _loop_1 = function (i) {
            var propNames = [];
            var el = inArray[i];
            var copyEl = {};
            Object.keys(el).forEach(function (p) {
                if (el.hasOwnProperty(p)) {
                    propNames.push(p);
                }
            });
            propNames.sort();
            propNames.forEach(function (propName) { return copyEl[propName] = el[propName]; });
            outArray[i] = copyEl;
        };
        for (var i = 0; i < inArray.length; i++) {
            _loop_1(i);
        }
        return outArray;
    };
    InteractionsService.prototype.getParametersValues = function () {
        var _this = this;
        var parametersValues = {};
        Object.keys(this.model.interactions.paramsVariables).forEach(function (i) {
            var parameter = _this.model.interactions.paramsVariables[i];
            parametersValues[parameter.name] = _this.getVariableValue(parameter);
        });
        return parametersValues;
    };
    InteractionsService.prototype.getVariableValue = function (parameter) {
        var _this = this;
        if (parameter.isNull) {
            return null;
        }
        switch (parameter.basicType) {
            case 'Value':
            case 'NullableValue':
                return this.val(parameter.key, parameter, parameter.allowUserValues ? parameter.value : parameter.key);
            case 'Range':
                return { from: this.val(parameter.key, parameter), to: this.val(parameter.keyTo, parameter) };
            case 'List':
                var value_1 = [];
                if (parameter.items) {
                    parameter.items.filter(function (i) { return parameter.allowUserValues || i.isChecked; }).forEach(function (item) { return value_1.push(_this.val(item.key, parameter)); });
                }
                return value_1;
        }
    };
    InteractionsService.prototype.val = function (key, parameter, value) {
        return parameter.type === 'DateTime' ? this.helper.getStringDateTime(key, parameter.dateTimeType) : (value === undefined ? key : value);
    };
    InteractionsService.prototype.initializeInteractions = function (page) {
        var e_1, _a;
        var _this = this;
        if (!page) {
            return;
        }
        var elems = page.querySelectorAll ? page.querySelectorAll('td,div,span,rect,path,ellipse') : page.getElementsByTagName('td');
        var collapsedHash = [];
        var _loop_2 = function (elem) {
            if (elem.getAttribute('interaction') && (elem.getAttribute('pageguid') ||
                elem.getAttribute('reportfile') ||
                elem.getAttribute('collapsed') ||
                elem.getAttribute('databandsort'))) {
                elem.style.cursor = 'pointer';
                var sort = elem.getAttribute('sort');
                if (sort) {
                    this_1.paintSortingArrow(elem, sort);
                }
                var collapsed = elem.getAttribute('collapsed');
                if (collapsed) {
                    var compId = elem.getAttribute('compindex') + '|' + elem.getAttribute('interaction');
                    if (collapsedHash.indexOf(compId) < 0) {
                        this_1.paintCollapsingIcon(elem, collapsed === 'true');
                        collapsedHash.push(compId);
                    }
                }
                elem.onclick = function (e) {
                    if (elem.getAttribute('pageguid') || elem.getAttribute('reportfile')) {
                        _this.postInteractionDrillDown(elem);
                    }
                    else if (elem.getAttribute('collapsed')) {
                        _this.postInteractionCollapsing(elem);
                    }
                    else {
                        _this.postInteractionSorting(elem, e.ctrlKey);
                    }
                };
                if (elem.getAttribute('pageguid') || elem.getAttribute('reportfile')) {
                    elem.onmouseover = function () { return elem.style.opacity = 0.75; };
                    elem.onmouseout = function () { return elem.style.opacity = 1; };
                }
            }
        };
        var this_1 = this;
        try {
            for (var elems_1 = __values(elems), elems_1_1 = elems_1.next(); !elems_1_1.done; elems_1_1 = elems_1.next()) {
                var elem = elems_1_1.value;
                _loop_2(elem);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (elems_1_1 && !elems_1_1.done && (_a = elems_1.return)) _a.call(elems_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    InteractionsService.prototype.getComponentOffset = function (component) {
        var offsetX = 0;
        var offsetY = 0;
        var startComponent = component;
        while (component && !isNaN(component.offsetLeft) && !isNaN(component.offsetTop)
            && (component === startComponent || component.style.position === '' || component.style.position === 'static')) {
            offsetX += component.offsetLeft - component.scrollLeft;
            offsetY += component.offsetTop - component.scrollTop;
            component = component.offsetParent;
        }
        return { top: offsetY, left: offsetX };
    };
    InteractionsService.prototype.paintSortingArrow = function (component, sort) {
        if (component.arrowImg) {
            return;
        }
        var arrowImg = document.createElement("div");
        var sortUpSrc = "<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12'><path d='M1 9l5-4 5 4z' fill='#eeeeee' stroke='#666'/></svg>";
        var sortDownSrc = "<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12'><path d='M1 5l5 4 5-4z' fill='#eeeeee' stroke='#666'/></svg>";
        arrowImg.innerHTML = sort == "asc" ? sortDownSrc : sortUpSrc;
        var arrowWidth = (this.model.reportParams.zoom / 100) * 16;
        var arrowHeight = (this.model.reportParams.zoom / 100) * 16;
        arrowImg.style.position = 'absolute';
        arrowImg.style.width = arrowWidth + 'px';
        arrowImg.style.height = arrowHeight + 'px';
        component.appendChild(arrowImg);
        component.arrowImg = arrowImg;
        var oldPosition = component.style.position;
        var oldClassName = component.className;
        component.style.position = 'relative';
        if (!oldClassName) {
            component.className = 'stiSortingParentElement';
        }
        var arrowLeftPos = this.helper.findPosX(arrowImg, component.className);
        var arrowTopPos = this.helper.findPosY(arrowImg, component.className);
        arrowImg.style.marginLeft = (component.offsetWidth - arrowLeftPos - arrowWidth - ((this.model.reportParams.zoom / 100) * 3)) + 'px';
        arrowImg.style.marginTop = (component.offsetHeight / 2 - arrowHeight / 2 - arrowTopPos) + 'px';
        if (oldPosition)
            component.style.position = oldPosition;
        component.className = oldClassName;
    };
    InteractionsService.prototype.paintCollapsingIcon = function (component, collapsed) {
        if (component.collapsImg) {
            return;
        }
        var collapsImg = document.createElement('img');
        collapsImg.src = collapsed ? this.model.img('CollapsingPlus.png') : this.model.img('CollapsingMinus.png');
        collapsImg.style.position = 'absolute';
        var collapsWidth = (this.model.reportParams.zoom / 100) * 10;
        var collapsHeight = (this.model.reportParams.zoom / 100) * 10;
        collapsImg.style.width = collapsWidth + 'px';
        collapsImg.style.height = collapsHeight + 'px';
        component.appendChild(collapsImg);
        component.collapsImg = collapsImg;
        var componentOffset = this.getComponentOffset(component);
        var collapsOffset = this.getComponentOffset(collapsImg);
        collapsImg.style.marginLeft = (componentOffset.left - collapsOffset.left + collapsWidth / 3) + 'px';
        collapsImg.style.marginTop = (componentOffset.top - collapsOffset.top + collapsWidth / 3) + 'px';
    };
    InteractionsService.prototype.postInteractionSorting = function (component, isCtrl) {
        var params = {
            action: 'Sorting',
            sortingParameters: {
                ComponentName: component.getAttribute('interaction') + ';' + isCtrl.toString(),
                DataBand: component.getAttribute('databandsort')
            }
        };
        if (this.model.options.isParametersReceived) {
            params.variables = this.getParametersValues();
        }
        this.postInteraction(params);
    };
    InteractionsService.prototype.postInteractionDrillDown = function (component) {
        var params = {
            action: 'DrillDown',
            drillDownParameters: {
                ComponentIndex: component.getAttribute('compindex'),
                ElementIndex: component.getAttribute('elementindex'),
                PageIndex: component.getAttribute('pageindex'),
                PageGuid: component.getAttribute('pageguid'),
                ReportFile: component.getAttribute('reportfile')
            }
        };
        this.postInteraction(params);
    };
    InteractionsService.prototype.postInteractionCollapsing = function (component) {
        var componentName = component.getAttribute('interaction');
        var collapsingIndex = component.getAttribute('compindex');
        var collapsed = component.getAttribute('collapsed') === 'true' ? false : true;
        if (!this.model.reportParams.collapsingStates) {
            this.model.reportParams.collapsingStates = {};
        }
        if (!this.model.reportParams.collapsingStates[componentName]) {
            this.model.reportParams.collapsingStates[componentName] = {};
        }
        this.model.reportParams.collapsingStates[componentName][collapsingIndex] = collapsed;
        var params = {
            action: 'Collapsing',
            collapsingParameters: {
                ComponentName: componentName,
                CollapsingStates: this.model.reportParams.collapsingStates
            }
        };
        if (this.model.options.isParametersReceived) {
            params.variables = this.getParametersValues();
        }
        this.postInteraction(params);
    };
    InteractionsService.prototype.updateAllHyperLinks = function () {
        var _this = this;
        var pointers = this.model.reportParams.tableOfContentsPointers;
        //var bookmarksPanel = this.controls.bookmarksPanel;
        if (this.model.reportParams.bookmarksContent != null || (pointers && pointers.length > 0)) {
            this.model.pages.forEach(function (p) {
                var e_2, _a;
                var page = p.page;
                var aHyperlinks = page.getElementsByTagName('a');
                var _loop_3 = function (aHyperlink) {
                    aHyperlink.hrefContent = aHyperlink.getAttribute('href');
                    if (aHyperlink.hrefContent) {
                        if (aHyperlink.hrefContent.indexOf("#") == 0) {
                            var anchorParams = aHyperlink.hrefContent.substring(1).split("#GUID#");
                            aHyperlink.anchorName = anchorParams[0];
                            aHyperlink.componentGuid = anchorParams.length > 1 ? anchorParams[1] : "";
                            aHyperlink.onclick = function () {
                                var currAnchorName = aHyperlink.anchorName;
                                var cuurCompGuid = aHyperlink.componentGuid;
                                try {
                                    currAnchorName = decodeURI(aHyperlink.anchorName);
                                }
                                catch (e) {
                                    currAnchorName = aHyperlink.anchorName;
                                }
                                if (pointers.length > 0) {
                                    var pageIndex = 1;
                                    for (var i = 0; i < pointers.length; i++) {
                                        if (cuurCompGuid) {
                                            if (pointers[i].componentGuid == cuurCompGuid) {
                                                pageIndex = pointers[i].pageIndex;
                                                break;
                                            }
                                        }
                                        else if (currAnchorName) {
                                            var pointerAnchor = pointers[i].anchor.indexOf("#") == 0 ? pointers[i].anchor.substring(1) : pointers[i].anchor;
                                            if (pointerAnchor == currAnchorName) {
                                                pageIndex = pointers[i].pageIndex;
                                                break;
                                            }
                                        }
                                    }
                                    var anchorName = "";
                                    if (currAnchorName)
                                        anchorName += currAnchorName;
                                    if (cuurCompGuid)
                                        anchorName += ("#GUID#" + cuurCompGuid);
                                    if (anchorName) {
                                        _this.controller.action({ name: 'BookmarkAction', bookmarkPage: Math.max(pageIndex - 1, 0), bookmarkAnchor: anchorName, componentGuid: aHyperlink.compunentGuid });
                                        return false;
                                    }
                                }
                                if (_this.model.reportParams.bookmarksContent != null) {
                                    var node = _this.model.nodes.find(function (n) { return n.name === currAnchorName; });
                                    if (node) {
                                        _this.model.navigateNode = node;
                                    }
                                    else {
                                        for (var k = 0; k < document.anchors.length; k++) {
                                            if (document.anchors[k].name == currAnchorName) {
                                                //jsObject.scrollToAnchor(currAnchorName);
                                                _this.helper.scrollToAnchor(currAnchorName);
                                                return;
                                            }
                                        }
                                    }
                                    _this.controller.post('BookmarkAction', null, 0);
                                    /*let aBookmarks = bookmarksPanel.getElementsByTagName("a");
                                    for (let k = 0; k < aBookmarks.length; k++) {
                                      let clickFunc = aBookmarks[k].getAttribute("onclick");
                                      if (clickFunc && clickFunc.indexOf("'" + currAnchorName + "'") >= 0) {
                                        try {
                                          eval(clickFunc);
                                          return false;
                                        }
                                        catch (e) { }
                                      }
                                    }
                  
                                    this.controller.post('BookmarkAction', null, 0);*/
                                    return false;
                                }
                                //=================================
                                /*let pageIndex = 1;
                                for (let i = 0; i < pointers.length; i++) {
                                  if (aHyperlink.componentGuid) {
                                    if (pointers[i].componentGuid == aHyperlink.componentGuid) {
                                      pageIndex = pointers[i].pageIndex;
                                      break;
                                    }
                                  }
                                  else if (aHyperlink.bookmarkAnchor) {
                                    if (pointers[i].anchor == decodeURI(aHyperlink.bookmarkAnchor)) {
                                      pageIndex = pointers[i].pageIndex;
                                      break;
                                    }
                                  }
                                }
                                this.controller.action({ name: 'BookmarkAction', bookmarkPage: pageIndex - 1, bookmarkAnchor: decodeURI(aHyperlink.bookmarkAnchor), componentGuid: aHyperlink.compunentGuid });
                                return false;
                                };
                                } else if (this.model.reportParams.bookmarksContent != null) {
                                aHyperlink.anchorName = aHyperlink.hrefContent.replace('#', '');
                
                                aHyperlink.onclick = () => {
                                const node = this.model.nodes.find(n => n.url.replace(/\\\'/g, '\'').substr(1) === aHyperlink.anchorName);
                                if (node) {
                                  this.model.navigateNode = node;
                                } else if (aHyperlink.hrefContent.indexOf('#') === 0) {
                                  for (let i = 0; i < document.anchors.length; i++) {
                                    const anchor = document.anchors[i];
                                    if (anchor.name === aHyperlink.anchorName) {
                                      this.helper.scrollToAnchor(aHyperlink.anchorName);
                                      return;
                                    }
                                  }
                                  this.controller.post('BookmarkAction', null, 0);
                                }
                                return false;
                                };*/
                            };
                        }
                    }
                };
                try {
                    for (var aHyperlinks_1 = __values(aHyperlinks), aHyperlinks_1_1 = aHyperlinks_1.next(); !aHyperlinks_1_1.done; aHyperlinks_1_1 = aHyperlinks_1.next()) {
                        var aHyperlink = aHyperlinks_1_1.value;
                        _loop_3(aHyperlink);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (aHyperlinks_1_1 && !aHyperlinks_1_1.done && (_a = aHyperlinks_1.return)) _a.call(aHyperlinks_1);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            });
        }
    };
    InteractionsService.ctorParameters = function () { return [
        { type: ModelService },
        { type: Md5Service },
        { type: ControllerService },
        { type: HelperService },
        { type: DrillDownService }
    ]; };
    InteractionsService = __decorate([
        Injectable()
    ], InteractionsService);
    return InteractionsService;
}());
export { InteractionsService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW50ZXJhY3Rpb25zLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zdGltdWxzb2Z0LXZpZXdlci1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2ludGVyYWN0aW9ucy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUd4RDtJQUVFLDZCQUFtQixLQUFtQixFQUFTLEdBQWUsRUFBUyxVQUE2QixFQUFTLE1BQXFCLEVBQ3pILGdCQUFrQztRQUQzQyxpQkF1QkM7UUF2QmtCLFVBQUssR0FBTCxLQUFLLENBQWM7UUFBUyxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVMsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3pILHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFFekMsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQWdCO1lBQ2pELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxVQUFVLEVBQUU7Z0JBQ2pDLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDeEM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQWdCO1lBQ3ZELFFBQVEsT0FBTyxDQUFDLE1BQU0sRUFBRTtn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O29DQUNsRCxPQUFPLEtBQUssQ0FBQztpQ0FDZDtnQ0FFRCxtQ0FBbUM7Z0NBQ25DOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0NBb0NJOzRCQUNOLENBQUMsQ0FBQTt5QkFDRjtxQkFDRjs7O29CQXpISCxLQUF5QixJQUFBLGdCQUFBLFNBQUEsV0FBVyxDQUFBLHdDQUFBO3dCQUEvQixJQUFNLFVBQVUsd0JBQUE7Z0NBQVYsVUFBVTtxQkEwSHBCOzs7Ozs7Ozs7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUVKO0lBQ0gsQ0FBQzs7Z0JBamN5QixZQUFZO2dCQUFjLFVBQVU7Z0JBQXFCLGlCQUFpQjtnQkFBaUIsYUFBYTtnQkFDdkcsZ0JBQWdCOztJQUhoQyxtQkFBbUI7UUFEL0IsVUFBVSxFQUFFO09BQ0EsbUJBQW1CLENBcWMvQjtJQUFELDBCQUFDO0NBQUEsQUFyY0QsSUFxY0M7U0FyY1ksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZDVTZXJ2aWNlIH0gZnJvbSAnLi9tZDUuc2VydmljZSc7XHJcbmltcG9ydCB7IEludGVyYWN0aW9uUGFyYW1zLCBJbnRlcmFjdGlvbk9iamVjdCwgVmFyaWFibGUsIE1lc3NhZ2UgfSBmcm9tICcuL29iamVjdHMnO1xyXG5pbXBvcnQgeyBIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnLi9oZWxwZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb250cm9sbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEcmlsbERvd25TZXJ2aWNlIH0gZnJvbSAnLi9kcmlsbC1kb3duLnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgSW50ZXJhY3Rpb25zU2VydmljZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtb2RlbDogTW9kZWxTZXJ2aWNlLCBwdWJsaWMgbWQ1OiBNZDVTZXJ2aWNlLCBwdWJsaWMgY29udHJvbGxlcjogQ29udHJvbGxlclNlcnZpY2UsIHB1YmxpYyBoZWxwZXI6IEhlbHBlclNlcnZpY2UsXHJcbiAgICBwdWJsaWMgZHJpbGxEb3duU2VydmljZTogRHJpbGxEb3duU2VydmljZSkge1xyXG5cclxuICAgIGNvbnRyb2xsZXIuZ2V0TWVzc2FnZSgpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdJbml0VmFycycpIHtcclxuICAgICAgICB0aGlzLnNob3dQYXJhbWV0ZXJzUGFuZWwobWVzc2FnZS5kYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29udHJvbGxlci5nZXRBY3Rpb25NZXNzYWdlKCkuc3Vic2NyaWJlKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAobWVzc2FnZS5hY3Rpb24pIHtcclxuICAgICAgICBjYXNlICdWYXJpYWJsZXMnOlxyXG4gICAgICAgICAgdGhpcy5wb3N0SW50ZXJhY3Rpb24oeyBhY3Rpb246ICdWYXJpYWJsZXMnLCB2YXJpYWJsZXM6IHRoaXMuZ2V0UGFyYW1ldGVyc1ZhbHVlcygpIH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ1Jlc2V0JzpcclxuICAgICAgICAgIHRoaXMuc2hvd1BhcmFtZXRlcnNQYW5lbCh0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RJbnRlcmFjdGlvbihwYXJhbXM6IEludGVyYWN0aW9uUGFyYW1zKSB7XHJcbiAgICB0aGlzLmRyaWxsRG93blNlcnZpY2Uuc2F2ZVN0YXRlKCk7XHJcbiAgICAvLyBBZGQgbmV3IGRyaWxsLWRvd24gcGFyYW1ldGVycyB0byBkcmlsbC1kb3duIHF1ZXVlIGFuZCBjYWxjIGd1aWRcclxuICAgIGlmIChwYXJhbXMuYWN0aW9uICE9PSAnSW5pdFZhcnMnICYmIChwYXJhbXMuYWN0aW9uID09PSAnRHJpbGxEb3duJyB8fCBwYXJhbXMuYWN0aW9uID09PSAnRGFzaGJvYXJkRHJpbGxEb3duJykpIHtcclxuICAgICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5kcmlsbERvd25JblByb2dyZXNzKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocGFyYW1zLmFjdGlvbiA9PT0gJ0Rhc2hib2FyZERyaWxsRG93bicgJiYgcGFyYW1zLmRyaWxsRG93blBhcmFtZXRlcnMpIHtcclxuICAgICAgICBwYXJhbXMuZHJpbGxEb3duUGFyYW1ldGVycy5pc0Rhc2hib2FyZERyaWxsRG93biA9IHRydWU7IC8vIGFkZCBkYnMgZmxhZ1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGRyaWxsRG93blBhcmFtZXRlcnMgPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5kcmlsbERvd25QYXJhbWV0ZXJzIHx8IFtdO1xyXG4gICAgICBwYXJhbXMuZHJpbGxEb3duUGFyYW1ldGVycyA9IHBhcmFtcy5kcmlsbERvd25QYXJhbWV0ZXJzID8gZHJpbGxEb3duUGFyYW1ldGVycy5jb25jYXQocGFyYW1zLmRyaWxsRG93blBhcmFtZXRlcnMpIDogZHJpbGxEb3duUGFyYW1ldGVycztcclxuXHJcbiAgICAgIGlmIChwYXJhbXMuYWN0aW9uID09PSAnRHJpbGxEb3duJykge1xyXG4gICAgICAgIHBhcmFtcy5kcmlsbERvd25HdWlkID0gdGhpcy5tZDUuaGV4X21kNShKU09OLnN0cmluZ2lmeSh0aGlzLnNvcnRQcm9wc0luRHJpbGxEb3duUGFyYW1ldGVycyhwYXJhbXMuZHJpbGxEb3duUGFyYW1ldGVycykpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwYXJhbXMuZGFzaGJvYXJkRHJpbGxEb3duR3VpZCA9IHRoaXMubWQ1LmhleF9tZDUoSlNPTi5zdHJpbmdpZnkodGhpcy5zb3J0UHJvcHNJbkRyaWxsRG93blBhcmFtZXRlcnMocGFyYW1zLmRyaWxsRG93blBhcmFtZXRlcnMpKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5kcmlsbERvd25JblByb2dyZXNzID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbnRyb2xsZXIucG9zdChwYXJhbXMuYWN0aW9uLCB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy5pbnRlcmFjdGlvbiwgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHNob3dQYXJhbWV0ZXJzUGFuZWwoZGF0YTogYW55KSB7XHJcbiAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbnRyb2xsZXIuc2hvd0Vycm9yKGRhdGEpKSB7XHJcbiAgICAgIGRhdGEgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubW9kZWwub3B0aW9ucy5pc1BhcmFtZXRlcnNSZWNlaXZlZCA9IHRydWU7XHJcbiAgICB0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzID0gdHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShkYXRhKSA6IGRhdGE7XHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnBhcmFtZXRlcnNQYW5lbC52aXNpYmxlID0gIXRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZTtcclxuXHJcbiAgICAvLyBpZiAodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudHlwZSA9PT0gJ0Rhc2hib2FyZCcpIGpzT2JqZWN0LnBvc3RBY3Rpb24oJ0dldFBhZ2VzJyk7XHJcblxyXG4gICAgY29uc3QgcGFyYW1zVmFyaWFibGVzID0gdGhpcy5oZWxwZXIuY29weU9iamVjdCh0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzKTtcclxuICAgIGNvbnN0IGNvdW50UGFyYW1ldGVyczogbnVtYmVyID0gdGhpcy5oZWxwZXIuZ2V0Q291bnRPYmplY3RzKHBhcmFtc1ZhcmlhYmxlcyk7XHJcbiAgICBjb25zdCBjb3VudENvbHVtbnM6IG51bWJlciA9IChjb3VudFBhcmFtZXRlcnMgPD0gdGhpcy5tb2RlbC5vcHRpb25zLm1pblBhcmFtZXRlcnNDb3VudEZvck11bHRpQ29sdW1ucylcclxuICAgICAgPyAxIDogdGhpcy5tb2RlbC5vcHRpb25zLmFwcGVhcmFuY2UucGFyYW1ldGVyc1BhbmVsQ29sdW1uc0NvdW50O1xyXG5cclxuICAgIGxldCBjb3VudEluQ29sdW1uID0gTWF0aC50cnVuYyhjb3VudFBhcmFtZXRlcnMgLyBjb3VudENvbHVtbnMpO1xyXG4gICAgaWYgKGNvdW50SW5Db2x1bW4gKiBjb3VudENvbHVtbnMgPCBjb3VudFBhcmFtZXRlcnMpIHtcclxuICAgICAgY291bnRJbkNvbHVtbisrO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHNldHVwIGxpc3RzXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50UGFyYW1ldGVyczsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHZhcmlhYmxlID0gcGFyYW1zVmFyaWFibGVzW2ldIGFzIFZhcmlhYmxlO1xyXG4gICAgICBpZiAodmFyaWFibGUuaXRlbXMpIHtcclxuICAgICAgICB2YXJpYWJsZS5pdGVtcy5mb3JFYWNoKCh2KSA9PiB7XHJcbiAgICAgICAgICB2LmlzQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICB2LnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXJpYWJsZS5pc051bGwgPSAodmFyaWFibGUudHlwZSA9PT0gJ0RhdGVUaW1lJyAmJiB2YXJpYWJsZS52YWx1ZSA9PT0gbnVsbCAmJiB2YXJpYWJsZS5iYXNpY1R5cGUgPT09ICdOdWxsYWJsZVZhbHVlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tb2RlbC5pbnRlcmFjdGlvbnMgPSB7IHBhcmFtc1ZhcmlhYmxlcywgY291bnRDb2x1bW5zOiBuZXcgQXJyYXkoY291bnRDb2x1bW5zKSwgY291bnRJbkNvbHVtbjogbmV3IEFycmF5KGNvdW50SW5Db2x1bW4pIH07XHJcbiAgfVxyXG5cclxuICBzb3J0UHJvcHNJbkRyaWxsRG93blBhcmFtZXRlcnMoaW5BcnJheTogW10pOiBhbnlbXSB7XHJcbiAgICBpZiAoIWluQXJyYXkgfHwgIWluQXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBpbkFycmF5O1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb3V0QXJyYXk6IGFueVtdID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgcHJvcE5hbWVzID0gW107XHJcbiAgICAgIGNvbnN0IGVsOiBhbnkgPSBpbkFycmF5W2ldO1xyXG4gICAgICBjb25zdCBjb3B5RWwgPSB7fTtcclxuICAgICAgT2JqZWN0LmtleXMoZWwpLmZvckVhY2gocCA9PiB7XHJcbiAgICAgICAgaWYgKGVsLmhhc093blByb3BlcnR5KHApKSB7XHJcbiAgICAgICAgICBwcm9wTmFtZXMucHVzaChwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcHJvcE5hbWVzLnNvcnQoKTtcclxuICAgICAgcHJvcE5hbWVzLmZvckVhY2gocHJvcE5hbWUgPT4gY29weUVsW3Byb3BOYW1lXSA9IGVsW3Byb3BOYW1lXSk7XHJcbiAgICAgIG91dEFycmF5W2ldID0gY29weUVsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dEFycmF5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFBhcmFtZXRlcnNWYWx1ZXMoKTogYW55IHtcclxuICAgIGNvbnN0IHBhcmFtZXRlcnNWYWx1ZXMgPSB7fTtcclxuICAgIE9iamVjdC5rZXlzKHRoaXMubW9kZWwuaW50ZXJhY3Rpb25zLnBhcmFtc1ZhcmlhYmxlcykuZm9yRWFjaChpID0+IHtcclxuICAgICAgY29uc3QgcGFyYW1ldGVyOiBWYXJpYWJsZSA9IHRoaXMubW9kZWwuaW50ZXJhY3Rpb25zLnBhcmFtc1ZhcmlhYmxlc1tpXTtcclxuICAgICAgcGFyYW1ldGVyc1ZhbHVlc1twYXJhbWV0ZXIubmFtZV0gPSB0aGlzLmdldFZhcmlhYmxlVmFsdWUocGFyYW1ldGVyKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHBhcmFtZXRlcnNWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBnZXRWYXJpYWJsZVZhbHVlKHBhcmFtZXRlcjogVmFyaWFibGUpOiBhbnkge1xyXG4gICAgaWYgKHBhcmFtZXRlci5pc051bGwpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgc3dpdGNoIChwYXJhbWV0ZXIuYmFzaWNUeXBlKSB7XHJcbiAgICAgIGNhc2UgJ1ZhbHVlJzpcclxuICAgICAgY2FzZSAnTnVsbGFibGVWYWx1ZSc6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsKHBhcmFtZXRlci5rZXksIHBhcmFtZXRlciwgcGFyYW1ldGVyLmFsbG93VXNlclZhbHVlcyA/IHBhcmFtZXRlci52YWx1ZSA6IHBhcmFtZXRlci5rZXkpO1xyXG5cclxuICAgICAgY2FzZSAnUmFuZ2UnOlxyXG4gICAgICAgIHJldHVybiB7IGZyb206IHRoaXMudmFsKHBhcmFtZXRlci5rZXksIHBhcmFtZXRlciksIHRvOiB0aGlzLnZhbChwYXJhbWV0ZXIua2V5VG8sIHBhcmFtZXRlcikgfTtcclxuXHJcbiAgICAgIGNhc2UgJ0xpc3QnOlxyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gW107XHJcbiAgICAgICAgaWYgKHBhcmFtZXRlci5pdGVtcykge1xyXG4gICAgICAgICAgcGFyYW1ldGVyLml0ZW1zLmZpbHRlcihpID0+IHBhcmFtZXRlci5hbGxvd1VzZXJWYWx1ZXMgfHwgaS5pc0NoZWNrZWQpLmZvckVhY2goaXRlbSA9PiB2YWx1ZS5wdXNoKHRoaXMudmFsKGl0ZW0ua2V5LCBwYXJhbWV0ZXIpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHZhbChrZXk6IGFueSwgcGFyYW1ldGVyOiBWYXJpYWJsZSwgdmFsdWU/OiBhbnkpOiBhbnkge1xyXG4gICAgcmV0dXJuIHBhcmFtZXRlci50eXBlID09PSAnRGF0ZVRpbWUnID8gdGhpcy5oZWxwZXIuZ2V0U3RyaW5nRGF0ZVRpbWUoa2V5LCBwYXJhbWV0ZXIuZGF0ZVRpbWVUeXBlKSA6ICh2YWx1ZSA9PT0gdW5kZWZpbmVkID8ga2V5IDogdmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXRpYWxpemVJbnRlcmFjdGlvbnMocGFnZTogYW55KSB7XHJcbiAgICBpZiAoIXBhZ2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZWxlbXMgPSBwYWdlLnF1ZXJ5U2VsZWN0b3JBbGwgPyBwYWdlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkLGRpdixzcGFuLHJlY3QscGF0aCxlbGxpcHNlJykgOiBwYWdlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0ZCcpO1xyXG4gICAgY29uc3QgY29sbGFwc2VkSGFzaCA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGVsZW1zKSB7XHJcbiAgICAgIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgnaW50ZXJhY3Rpb24nKSAmJiAoXHJcbiAgICAgICAgZWxlbS5nZXRBdHRyaWJ1dGUoJ3BhZ2VndWlkJykgfHxcclxuICAgICAgICBlbGVtLmdldEF0dHJpYnV0ZSgncmVwb3J0ZmlsZScpIHx8XHJcbiAgICAgICAgZWxlbS5nZXRBdHRyaWJ1dGUoJ2NvbGxhcHNlZCcpIHx8XHJcbiAgICAgICAgZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGFiYW5kc29ydCcpKSkge1xyXG5cclxuICAgICAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJztcclxuXHJcbiAgICAgICAgY29uc3Qgc29ydCA9IGVsZW0uZ2V0QXR0cmlidXRlKCdzb3J0Jyk7XHJcbiAgICAgICAgaWYgKHNvcnQpIHtcclxuICAgICAgICAgIHRoaXMucGFpbnRTb3J0aW5nQXJyb3coZWxlbSwgc29ydCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb2xsYXBzZWQgPSBlbGVtLmdldEF0dHJpYnV0ZSgnY29sbGFwc2VkJyk7XHJcbiAgICAgICAgaWYgKGNvbGxhcHNlZCkge1xyXG4gICAgICAgICAgY29uc3QgY29tcElkID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2NvbXBpbmRleCcpICsgJ3wnICsgZWxlbS5nZXRBdHRyaWJ1dGUoJ2ludGVyYWN0aW9uJyk7XHJcbiAgICAgICAgICBpZiAoY29sbGFwc2VkSGFzaC5pbmRleE9mKGNvbXBJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFpbnRDb2xsYXBzaW5nSWNvbihlbGVtLCBjb2xsYXBzZWQgPT09ICd0cnVlJyk7XHJcbiAgICAgICAgICAgIGNvbGxhcHNlZEhhc2gucHVzaChjb21wSWQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWxlbS5vbmNsaWNrID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCdwYWdlZ3VpZCcpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCdyZXBvcnRmaWxlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5wb3N0SW50ZXJhY3Rpb25EcmlsbERvd24oZWxlbSk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCdjb2xsYXBzZWQnKSkge1xyXG4gICAgICAgICAgICB0aGlzLnBvc3RJbnRlcmFjdGlvbkNvbGxhcHNpbmcoZWxlbSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBvc3RJbnRlcmFjdGlvblNvcnRpbmcoZWxlbSwgZS5jdHJsS2V5KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoZWxlbS5nZXRBdHRyaWJ1dGUoJ3BhZ2VndWlkJykgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoJ3JlcG9ydGZpbGUnKSkge1xyXG4gICAgICAgICAgZWxlbS5vbm1vdXNlb3ZlciA9ICgpID0+IGVsZW0uc3R5bGUub3BhY2l0eSA9IDAuNzU7XHJcbiAgICAgICAgICBlbGVtLm9ubW91c2VvdXQgPSAoKSA9PiBlbGVtLnN0eWxlLm9wYWNpdHkgPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb21wb25lbnRPZmZzZXQoY29tcG9uZW50OiBhbnkpIHtcclxuICAgIGxldCBvZmZzZXRYID0gMDtcclxuICAgIGxldCBvZmZzZXRZID0gMDtcclxuICAgIGNvbnN0IHN0YXJ0Q29tcG9uZW50ID0gY29tcG9uZW50O1xyXG4gICAgd2hpbGUgKGNvbXBvbmVudCAmJiAhaXNOYU4oY29tcG9uZW50Lm9mZnNldExlZnQpICYmICFpc05hTihjb21wb25lbnQub2Zmc2V0VG9wKVxyXG4gICAgICAmJiAoY29tcG9uZW50ID09PSBzdGFydENvbXBvbmVudCB8fCBjb21wb25lbnQuc3R5bGUucG9zaXRpb24gPT09ICcnIHx8IGNvbXBvbmVudC5zdHlsZS5wb3NpdGlvbiA9PT0gJ3N0YXRpYycpKSB7XHJcbiAgICAgIG9mZnNldFggKz0gY29tcG9uZW50Lm9mZnNldExlZnQgLSBjb21wb25lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgb2Zmc2V0WSArPSBjb21wb25lbnQub2Zmc2V0VG9wIC0gY29tcG9uZW50LnNjcm9sbFRvcDtcclxuICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50Lm9mZnNldFBhcmVudDtcclxuICAgIH1cclxuICAgIHJldHVybiB7IHRvcDogb2Zmc2V0WSwgbGVmdDogb2Zmc2V0WCB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBhaW50U29ydGluZ0Fycm93KGNvbXBvbmVudDogYW55LCBzb3J0OiBzdHJpbmcpIHtcclxuICAgIGlmIChjb21wb25lbnQuYXJyb3dJbWcpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgY29uc3QgYXJyb3dJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgbGV0IHNvcnRVcFNyYyA9IFwiPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMicgaGVpZ2h0PScxMic+PHBhdGggZD0nTTEgOWw1LTQgNSA0eicgZmlsbD0nI2VlZWVlZScgc3Ryb2tlPScjNjY2Jy8+PC9zdmc+XCI7XHJcbiAgICBsZXQgc29ydERvd25TcmMgPSBcIjxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB3aWR0aD0nMTInIGhlaWdodD0nMTInPjxwYXRoIGQ9J00xIDVsNSA0IDUtNHonIGZpbGw9JyNlZWVlZWUnIHN0cm9rZT0nIzY2NicvPjwvc3ZnPlwiO1xyXG4gICAgYXJyb3dJbWcuaW5uZXJIVE1MID0gc29ydCA9PSBcImFzY1wiID8gc29ydERvd25TcmMgOiBzb3J0VXBTcmM7XHJcblxyXG4gICAgY29uc3QgYXJyb3dXaWR0aCA9ICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tIC8gMTAwKSAqIDE2O1xyXG4gICAgY29uc3QgYXJyb3dIZWlnaHQgPSAodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSAvIDEwMCkgKiAxNjtcclxuXHJcbiAgICBhcnJvd0ltZy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICBhcnJvd0ltZy5zdHlsZS53aWR0aCA9IGFycm93V2lkdGggKyAncHgnO1xyXG4gICAgYXJyb3dJbWcuc3R5bGUuaGVpZ2h0ID0gYXJyb3dIZWlnaHQgKyAncHgnO1xyXG4gICAgY29tcG9uZW50LmFwcGVuZENoaWxkKGFycm93SW1nKTtcclxuICAgIGNvbXBvbmVudC5hcnJvd0ltZyA9IGFycm93SW1nO1xyXG5cclxuICAgIGNvbnN0IG9sZFBvc2l0aW9uID0gY29tcG9uZW50LnN0eWxlLnBvc2l0aW9uO1xyXG4gICAgY29uc3Qgb2xkQ2xhc3NOYW1lID0gY29tcG9uZW50LmNsYXNzTmFtZTtcclxuICAgIGNvbXBvbmVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcbiAgICBpZiAoIW9sZENsYXNzTmFtZSkgeyBjb21wb25lbnQuY2xhc3NOYW1lID0gJ3N0aVNvcnRpbmdQYXJlbnRFbGVtZW50JzsgfVxyXG5cclxuICAgIGNvbnN0IGFycm93TGVmdFBvcyA9IHRoaXMuaGVscGVyLmZpbmRQb3NYKGFycm93SW1nLCBjb21wb25lbnQuY2xhc3NOYW1lKTtcclxuICAgIGNvbnN0IGFycm93VG9wUG9zID0gdGhpcy5oZWxwZXIuZmluZFBvc1koYXJyb3dJbWcsIGNvbXBvbmVudC5jbGFzc05hbWUpO1xyXG5cclxuICAgIGFycm93SW1nLnN0eWxlLm1hcmdpbkxlZnQgPSAoY29tcG9uZW50Lm9mZnNldFdpZHRoIC0gYXJyb3dMZWZ0UG9zIC0gYXJyb3dXaWR0aCAtICgodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSAvIDEwMCkgKiAzKSkgKyAncHgnO1xyXG4gICAgYXJyb3dJbWcuc3R5bGUubWFyZ2luVG9wID0gKGNvbXBvbmVudC5vZmZzZXRIZWlnaHQgLyAyIC0gYXJyb3dIZWlnaHQgLyAyIC0gYXJyb3dUb3BQb3MpICsgJ3B4JztcclxuICAgIGlmIChvbGRQb3NpdGlvbikgY29tcG9uZW50LnN0eWxlLnBvc2l0aW9uID0gb2xkUG9zaXRpb247XHJcbiAgICBjb21wb25lbnQuY2xhc3NOYW1lID0gb2xkQ2xhc3NOYW1lO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBhaW50Q29sbGFwc2luZ0ljb24oY29tcG9uZW50OiBhbnksIGNvbGxhcHNlZDogYm9vbGVhbikge1xyXG4gICAgaWYgKGNvbXBvbmVudC5jb2xsYXBzSW1nKSB7IHJldHVybjsgfVxyXG4gICAgY29uc3QgY29sbGFwc0ltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgY29sbGFwc0ltZy5zcmMgPSBjb2xsYXBzZWQgPyB0aGlzLm1vZGVsLmltZygnQ29sbGFwc2luZ1BsdXMucG5nJykgOiB0aGlzLm1vZGVsLmltZygnQ29sbGFwc2luZ01pbnVzLnBuZycpO1xyXG4gICAgY29sbGFwc0ltZy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICBjb25zdCBjb2xsYXBzV2lkdGggPSAodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSAvIDEwMCkgKiAxMDtcclxuICAgIGNvbnN0IGNvbGxhcHNIZWlnaHQgPSAodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSAvIDEwMCkgKiAxMDtcclxuICAgIGNvbGxhcHNJbWcuc3R5bGUud2lkdGggPSBjb2xsYXBzV2lkdGggKyAncHgnO1xyXG4gICAgY29sbGFwc0ltZy5zdHlsZS5oZWlnaHQgPSBjb2xsYXBzSGVpZ2h0ICsgJ3B4JztcclxuICAgIGNvbXBvbmVudC5hcHBlbmRDaGlsZChjb2xsYXBzSW1nKTtcclxuICAgIGNvbXBvbmVudC5jb2xsYXBzSW1nID0gY29sbGFwc0ltZztcclxuXHJcbiAgICBjb25zdCBjb21wb25lbnRPZmZzZXQgPSB0aGlzLmdldENvbXBvbmVudE9mZnNldChjb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29sbGFwc09mZnNldCA9IHRoaXMuZ2V0Q29tcG9uZW50T2Zmc2V0KGNvbGxhcHNJbWcpO1xyXG4gICAgY29sbGFwc0ltZy5zdHlsZS5tYXJnaW5MZWZ0ID0gKGNvbXBvbmVudE9mZnNldC5sZWZ0IC0gY29sbGFwc09mZnNldC5sZWZ0ICsgY29sbGFwc1dpZHRoIC8gMykgKyAncHgnO1xyXG4gICAgY29sbGFwc0ltZy5zdHlsZS5tYXJnaW5Ub3AgPSAoY29tcG9uZW50T2Zmc2V0LnRvcCAtIGNvbGxhcHNPZmZzZXQudG9wICsgY29sbGFwc1dpZHRoIC8gMykgKyAncHgnO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RJbnRlcmFjdGlvblNvcnRpbmcoY29tcG9uZW50OiBhbnksIGlzQ3RybDogYm9vbGVhbikge1xyXG4gICAgY29uc3QgcGFyYW1zOiBJbnRlcmFjdGlvblBhcmFtcyA9IHtcclxuICAgICAgYWN0aW9uOiAnU29ydGluZycsXHJcbiAgICAgIHNvcnRpbmdQYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgQ29tcG9uZW50TmFtZTogY29tcG9uZW50LmdldEF0dHJpYnV0ZSgnaW50ZXJhY3Rpb24nKSArICc7JyArIGlzQ3RybC50b1N0cmluZygpLFxyXG4gICAgICAgIERhdGFCYW5kOiBjb21wb25lbnQuZ2V0QXR0cmlidXRlKCdkYXRhYmFuZHNvcnQnKVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuaXNQYXJhbWV0ZXJzUmVjZWl2ZWQpIHtcclxuICAgICAgcGFyYW1zLnZhcmlhYmxlcyA9IHRoaXMuZ2V0UGFyYW1ldGVyc1ZhbHVlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucG9zdEludGVyYWN0aW9uKHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcG9zdEludGVyYWN0aW9uRHJpbGxEb3duKGNvbXBvbmVudDogYW55KSB7XHJcbiAgICBjb25zdCBwYXJhbXM6IEludGVyYWN0aW9uUGFyYW1zID0ge1xyXG4gICAgICBhY3Rpb246ICdEcmlsbERvd24nLFxyXG4gICAgICBkcmlsbERvd25QYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgQ29tcG9uZW50SW5kZXg6IGNvbXBvbmVudC5nZXRBdHRyaWJ1dGUoJ2NvbXBpbmRleCcpLFxyXG4gICAgICAgIEVsZW1lbnRJbmRleDogY29tcG9uZW50LmdldEF0dHJpYnV0ZSgnZWxlbWVudGluZGV4JyksXHJcbiAgICAgICAgUGFnZUluZGV4OiBjb21wb25lbnQuZ2V0QXR0cmlidXRlKCdwYWdlaW5kZXgnKSxcclxuICAgICAgICBQYWdlR3VpZDogY29tcG9uZW50LmdldEF0dHJpYnV0ZSgncGFnZWd1aWQnKSxcclxuICAgICAgICBSZXBvcnRGaWxlOiBjb21wb25lbnQuZ2V0QXR0cmlidXRlKCdyZXBvcnRmaWxlJylcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnBvc3RJbnRlcmFjdGlvbihwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RJbnRlcmFjdGlvbkNvbGxhcHNpbmcoY29tcG9uZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnQuZ2V0QXR0cmlidXRlKCdpbnRlcmFjdGlvbicpO1xyXG4gICAgY29uc3QgY29sbGFwc2luZ0luZGV4ID0gY29tcG9uZW50LmdldEF0dHJpYnV0ZSgnY29tcGluZGV4Jyk7XHJcbiAgICBjb25zdCBjb2xsYXBzZWQgPSBjb21wb25lbnQuZ2V0QXR0cmlidXRlKCdjb2xsYXBzZWQnKSA9PT0gJ3RydWUnID8gZmFsc2UgOiB0cnVlO1xyXG5cclxuICAgIGlmICghdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuY29sbGFwc2luZ1N0YXRlcykgeyB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5jb2xsYXBzaW5nU3RhdGVzID0ge307IH1cclxuICAgIGlmICghdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuY29sbGFwc2luZ1N0YXRlc1tjb21wb25lbnROYW1lXSkgeyB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5jb2xsYXBzaW5nU3RhdGVzW2NvbXBvbmVudE5hbWVdID0ge307IH1cclxuICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLmNvbGxhcHNpbmdTdGF0ZXNbY29tcG9uZW50TmFtZV1bY29sbGFwc2luZ0luZGV4XSA9IGNvbGxhcHNlZDtcclxuXHJcbiAgICBjb25zdCBwYXJhbXM6IEludGVyYWN0aW9uUGFyYW1zID0ge1xyXG4gICAgICBhY3Rpb246ICdDb2xsYXBzaW5nJyxcclxuICAgICAgY29sbGFwc2luZ1BhcmFtZXRlcnM6IHtcclxuICAgICAgICBDb21wb25lbnROYW1lOiBjb21wb25lbnROYW1lLFxyXG4gICAgICAgIENvbGxhcHNpbmdTdGF0ZXM6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLmNvbGxhcHNpbmdTdGF0ZXNcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmlzUGFyYW1ldGVyc1JlY2VpdmVkKSB7XHJcbiAgICAgIHBhcmFtcy52YXJpYWJsZXMgPSB0aGlzLmdldFBhcmFtZXRlcnNWYWx1ZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnBvc3RJbnRlcmFjdGlvbihwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZUFsbEh5cGVyTGlua3MoKSB7XHJcbiAgICBsZXQgcG9pbnRlcnMgPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy50YWJsZU9mQ29udGVudHNQb2ludGVycztcclxuICAgIC8vdmFyIGJvb2ttYXJrc1BhbmVsID0gdGhpcy5jb250cm9scy5ib29rbWFya3NQYW5lbDtcclxuICAgIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5ib29rbWFya3NDb250ZW50ICE9IG51bGwgfHwgKHBvaW50ZXJzICYmIHBvaW50ZXJzLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIHRoaXMubW9kZWwucGFnZXMuZm9yRWFjaChwID0+IHtcclxuICAgICAgICBjb25zdCBwYWdlID0gcC5wYWdlO1xyXG5cclxuICAgICAgICBjb25zdCBhSHlwZXJsaW5rcyA9IHBhZ2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBhSHlwZXJsaW5rIG9mIGFIeXBlcmxpbmtzKSB7XHJcbiAgICAgICAgICBhSHlwZXJsaW5rLmhyZWZDb250ZW50ID0gYUh5cGVybGluay5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcclxuXHJcbiAgICAgICAgICBpZiAoYUh5cGVybGluay5ocmVmQ29udGVudCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKGFIeXBlcmxpbmsuaHJlZkNvbnRlbnQuaW5kZXhPZihcIiNcIikgPT0gMCkge1xyXG4gICAgICAgICAgICAgIGxldCBhbmNob3JQYXJhbXMgPSBhSHlwZXJsaW5rLmhyZWZDb250ZW50LnN1YnN0cmluZygxKS5zcGxpdChcIiNHVUlEI1wiKTtcclxuICAgICAgICAgICAgICBhSHlwZXJsaW5rLmFuY2hvck5hbWUgPSBhbmNob3JQYXJhbXNbMF07XHJcbiAgICAgICAgICAgICAgYUh5cGVybGluay5jb21wb25lbnRHdWlkID0gYW5jaG9yUGFyYW1zLmxlbmd0aCA+IDEgPyBhbmNob3JQYXJhbXNbMV0gOiBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICBhSHlwZXJsaW5rLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3VyckFuY2hvck5hbWUgPSBhSHlwZXJsaW5rLmFuY2hvck5hbWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3V1ckNvbXBHdWlkID0gYUh5cGVybGluay5jb21wb25lbnRHdWlkO1xyXG5cclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgIGN1cnJBbmNob3JOYW1lID0gZGVjb2RlVVJJKGFIeXBlcmxpbmsuYW5jaG9yTmFtZSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgIGN1cnJBbmNob3JOYW1lID0gYUh5cGVybGluay5hbmNob3JOYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwb2ludGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIGxldCBwYWdlSW5kZXggPSAxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXVyQ29tcEd1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChwb2ludGVyc1tpXS5jb21wb25lbnRHdWlkID09IGN1dXJDb21wR3VpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXggPSBwb2ludGVyc1tpXS5wYWdlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyQW5jaG9yTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgbGV0IHBvaW50ZXJBbmNob3IgPSBwb2ludGVyc1tpXS5hbmNob3IuaW5kZXhPZihcIiNcIikgPT0gMCA/IHBvaW50ZXJzW2ldLmFuY2hvci5zdWJzdHJpbmcoMSkgOiBwb2ludGVyc1tpXS5hbmNob3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpZiAocG9pbnRlckFuY2hvciA9PSBjdXJyQW5jaG9yTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXggPSBwb2ludGVyc1tpXS5wYWdlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgbGV0IGFuY2hvck5hbWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoY3VyckFuY2hvck5hbWUpIGFuY2hvck5hbWUgKz0gY3VyckFuY2hvck5hbWU7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChjdXVyQ29tcEd1aWQpIGFuY2hvck5hbWUgKz0gKFwiI0dVSUQjXCIgKyBjdXVyQ29tcEd1aWQpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoYW5jaG9yTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5hY3Rpb24oeyBuYW1lOiAnQm9va21hcmtBY3Rpb24nLCBib29rbWFya1BhZ2U6IE1hdGgubWF4KHBhZ2VJbmRleCAtIDEsIDApLCBib29rbWFya0FuY2hvcjogYW5jaG9yTmFtZSwgY29tcG9uZW50R3VpZDogYUh5cGVybGluay5jb21wdW5lbnRHdWlkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5ib29rbWFya3NDb250ZW50ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMubW9kZWwubm9kZXMuZmluZChuID0+IG4ubmFtZSA9PT0gY3VyckFuY2hvck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubmF2aWdhdGVOb2RlID0gbm9kZTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGRvY3VtZW50LmFuY2hvcnMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5hbmNob3JzW2tdLm5hbWUgPT0gY3VyckFuY2hvck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9qc09iamVjdC5zY3JvbGxUb0FuY2hvcihjdXJyQW5jaG9yTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyLnNjcm9sbFRvQW5jaG9yKGN1cnJBbmNob3JOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIucG9zdCgnQm9va21hcmtBY3Rpb24nLCBudWxsLCAwKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAvKmxldCBhQm9va21hcmtzID0gYm9va21hcmtzUGFuZWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJhXCIpO1xyXG4gICAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGFCb29rbWFya3MubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY2xpY2tGdW5jID0gYUJvb2ttYXJrc1trXS5nZXRBdHRyaWJ1dGUoXCJvbmNsaWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbGlja0Z1bmMgJiYgY2xpY2tGdW5jLmluZGV4T2YoXCInXCIgKyBjdXJyQW5jaG9yTmFtZSArIFwiJ1wiKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmFsKGNsaWNrRnVuYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5wb3N0KCdCb29rbWFya0FjdGlvbicsIG51bGwsIDApOyovXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgICAgICAgICAgICAgLypsZXQgcGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcG9pbnRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKGFIeXBlcmxpbmsuY29tcG9uZW50R3VpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwb2ludGVyc1tpXS5jb21wb25lbnRHdWlkID09IGFIeXBlcmxpbmsuY29tcG9uZW50R3VpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4ID0gcG9pbnRlcnNbaV0ucGFnZUluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFIeXBlcmxpbmsuYm9va21hcmtBbmNob3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocG9pbnRlcnNbaV0uYW5jaG9yID09IGRlY29kZVVSSShhSHlwZXJsaW5rLmJvb2ttYXJrQW5jaG9yKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4ID0gcG9pbnRlcnNbaV0ucGFnZUluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWN0aW9uKHsgbmFtZTogJ0Jvb2ttYXJrQWN0aW9uJywgYm9va21hcmtQYWdlOiBwYWdlSW5kZXggLSAxLCBib29rbWFya0FuY2hvcjogZGVjb2RlVVJJKGFIeXBlcmxpbmsuYm9va21hcmtBbmNob3IpLCBjb21wb25lbnRHdWlkOiBhSHlwZXJsaW5rLmNvbXB1bmVudEd1aWQgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5ib29rbWFya3NDb250ZW50ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGFIeXBlcmxpbmsuYW5jaG9yTmFtZSA9IGFIeXBlcmxpbmsuaHJlZkNvbnRlbnQucmVwbGFjZSgnIycsICcnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBhSHlwZXJsaW5rLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBub2RlID0gdGhpcy5tb2RlbC5ub2Rlcy5maW5kKG4gPT4gbi51cmwucmVwbGFjZSgvXFxcXFxcJy9nLCAnXFwnJykuc3Vic3RyKDEpID09PSBhSHlwZXJsaW5rLmFuY2hvck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5uYXZpZ2F0ZU5vZGUgPSBub2RlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhSHlwZXJsaW5rLmhyZWZDb250ZW50LmluZGV4T2YoJyMnKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRvY3VtZW50LmFuY2hvcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmNob3IgPSBkb2N1bWVudC5hbmNob3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmNob3IubmFtZSA9PT0gYUh5cGVybGluay5hbmNob3JOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlbHBlci5zY3JvbGxUb0FuY2hvcihhSHlwZXJsaW5rLmFuY2hvck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIucG9zdCgnQm9va21hcmtBY3Rpb24nLCBudWxsLCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH07Ki9cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==