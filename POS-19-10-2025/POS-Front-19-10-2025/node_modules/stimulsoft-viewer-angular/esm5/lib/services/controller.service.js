import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { StiHttpClientService } from './http-client.service';
import { Subject } from 'rxjs';
import { ModelService } from './model.service';
import { StylesService } from './styles.service';
import { PageService } from './page.service';
import { HelperService } from './helper.service';
import { FormService } from '../forms/form.service';
import { FullScreenService } from './full-screen.service';
import { MenuService, Menu } from '../menu/menu.service';
var ControllerService = /** @class */ (function () {
    function ControllerService(httpClient, model, stylesService, pageService, helper, formService, fullScreenService, menuService, styleService) {
        var _this = this;
        this.httpClient = httpClient;
        this.model = model;
        this.stylesService = stylesService;
        this.pageService = pageService;
        this.helper = helper;
        this.formService = formService;
        this.fullScreenService = fullScreenService;
        this.menuService = menuService;
        this.styleService = styleService;
        this.subject = new Subject();
        this.actionSubject = new Subject();
        setInterval(function () {
            var _a, _b;
            if (_this.model.httpError) {
                if ((_a = _this.model.httpError.error) === null || _a === void 0 ? void 0 : _a.text) {
                    _this.showError((_b = _this.model.httpError.error) === null || _b === void 0 ? void 0 : _b.text);
                }
                else if (_this.model.httpError.message) {
                    _this.showError(null, _this.model.httpError.message);
                }
                else if (_this.model.httpError.error instanceof ErrorEvent) {
                    _this.showError(_this.model.httpError.error.message);
                }
                _this.model.httpError = null;
            }
            if (_this.model.navigateNode) {
                _this.postBookmarkNodeAction(_this.model.navigateNode);
                _this.model.navigateNode = null;
            }
        }, 250);
        this.setupHandlers();
    }
    ControllerService.prototype.setupHandlers = function () {
        var _this = this;
        this.getMessage().subscribe(function (message) {
            switch (message.action) {
                case 'GetReport':
                case 'OpenReport':
                    setTimeout(function () {
                        var _a, _b;
                        _this.styleService.addCustomFontStyles((_a = message.data) === null || _a === void 0 ? void 0 : _a.customFonts);
                        if (_this.model.options.appearance.fullScreenMode) {
                            _this.fullScreenService.changeFullScreenMode(true);
                        }
                        if (((_b = message.data) === null || _b === void 0 ? void 0 : _b.stimulsoftFontContent) && !_this.model.options.stimulsoftFontContent) {
                            _this.model.options.stimulsoftFontContent = message.data.stimulsoftFontContent;
                            _this.styleService.addCustomFontStyles([{
                                    contentForCss: message.data.stimulsoftFontContent,
                                    originalFontFamily: 'Stimulsoft'
                                }]);
                        }
                    });
                    break;
            }
        });
        this.model.controls.bookmarksPanel.getVisibility().subscribe(function (value) {
            if (value && _this.model.options.isMobileDevice) {
                _this.model.controls.parametersPanel.visible = false;
            }
            if (value) {
                _this.hideToolbar();
            }
            else {
                _this.showToolbar();
            }
        });
        this.model.controls.parametersPanel.getVisibility().subscribe(function (value) {
            if (value && _this.model.options.isMobileDevice) {
                _this.model.controls.bookmarksPanel.visible = false;
            }
            if (value) {
                _this.hideToolbar();
            }
            else {
                _this.showToolbar();
            }
        });
        this.menuService.getVisibility().subscribe(function (menu) {
            _this.hideToolbar();
        });
    };
    ControllerService.prototype.hideToolbar = function () {
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            this.model.controls.toolbar.visible = false;
            this.model.controls.navigatePanel.visible = false;
        }
    };
    ControllerService.prototype.showToolbar = function () {
        var _this = this;
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            this.model.controls.toolbar.visible = true;
            this.model.controls.navigatePanel.visible = true;
            setTimeout(function () {
                _this.keepToolbar();
            }, 300);
        }
    };
    ControllerService.prototype.keepToolbar = function () {
        var _this = this;
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            clearTimeout(this.model.toolbarHideTimer);
            this.model.toolbarHideTimer = setTimeout(function () {
                _this.hideToolbar();
            }, 4000);
        }
    };
    ControllerService.prototype.getMessage = function () {
        return this.subject.asObservable();
    };
    ControllerService.prototype.getActionMessage = function () {
        return this.actionSubject.asObservable();
    };
    ControllerService.prototype.post = function (action, cAction, postData, responseType, subAction) {
        var _this = this;
        if (responseType === void 0) { responseType = 'json'; }
        this.model.controls.navigatePanel.enabled = false;
        this.model.controls.toolbar.enabled = false;
        var url;
        if (!cAction) {
            url = this.model.requestUrl.replace('{action}', action === 'GetReport' || this.model.options.server.cacheMode === 'None' ? this.model.options.actions.getReport : this.model.options.actions.viewerEvent);
        }
        else {
            url = this.model.requestUrl.replace('{action}', cAction);
        }
        if (postData) {
            postData.action = action;
        }
        else {
            postData = { action: action };
        }
        this.httpClient.post(url, this.model.createPostParameters(postData), responseType).subscribe(function (data) {
            var _a;
            _this.model.showProgress = false;
            _this.model.controls.navigatePanel.enabled = true;
            _this.model.controls.toolbar.enabled = true;
            if (data === 'ServerError:The report is not specified.' && ((_a = _this.model.options) === null || _a === void 0 ? void 0 : _a.isReportRecieved)) {
                _this.model.options.isReportRecieved = false;
                _this.model.reportParams.prevPageNumber = _this.model.reportParams.pageNumber;
                _this.post('GetReport');
                return;
            }
            if (data) {
                _this.model.reportParams = data;
                _this.startRefreshReportTimer(data.refreshTime);
            }
            _this.subject.next({ action: action, data: data, subAction: subAction });
        });
    };
    ControllerService.prototype.loadViewer = function () {
        var _this = this;
        var url = this.model.requestUrl.replace('{action}', this.model.action);
        this.httpClient.post(url, this.model.createPostParameters({ action: 'AngularViewerData' }, true, false), 'json').subscribe(function (data) {
            _this.model.clear();
            _this.stylesService.setupStyle(atob(data['styles']), 'viewer');
            _this.model.options = data;
            _this.checkTrExp();
            _this.initAutoUpdateCache();
            _this.subject.next({ action: 'viewer_loaded' });
            _this.getReport();
        });
    };
    ControllerService.prototype.getReport = function () {
        this.model.options.paramsVariablesStartValues = null;
        this.post('GetReport');
    };
    ControllerService.prototype.getPages = function () {
        this.post('GetPages');
    };
    ControllerService.prototype.postExport = function (format, settings, elementName, isDashboardExport) {
        if (isDashboardExport === void 0) { isDashboardExport = false; }
        var data = {
            action: isDashboardExport ? 'ExportDashboard' : 'ExportReport',
            exportFormat: format,
            exportSettings: settings,
            elementName: elementName
        };
        var doc = settings && settings.OpenAfterExport && this.model.options.appearance.openExportedReportWindow === '_blank' ? this.helper.openNewWindow('about:blank', '_blank').document : null;
        var url = this.model.requestUrl;
        this.httpClient.postForm(url.replace('{action}', this.model.options.actions.exportReport), data, doc);
        this.actionSubject.next({ action: 'ExportReport', data: data });
    };
    ControllerService.prototype.loadFile = function (fileName, content) {
        if (typeof content !== 'string' || content === '') {
            return;
        }
        if (content.indexOf('<?xml') === 0 || content.indexOf('{') === 0) {
            content = btoa(content);
        }
        var data = {
            action: 'OpenReport',
            openingFileName: fileName || 'Report.mdc',
            base64Data: content.indexOf('base64,') > 0 ? content.substr(content.indexOf('base64,') + 7) : content
        };
        if (fileName && (fileName.toLowerCase().indexOf('.mdx') >= 0 || fileName.toLowerCase().indexOf('.mrx') >= 0)) {
            this.formService.showForm('passwordForm', data);
        }
        else {
            this.postOpen(data);
        }
    };
    ControllerService.prototype.postOpen = function (data) {
        this.model.clearViewerState();
        this.model.reportParams.reportFileName = data.openingFileName;
        this.post('OpenReport', this.model.options.actions.openReport, data);
    };
    ControllerService.prototype.action = function (event) {
        var _this = this;
        switch (event.name) {
            case 'Find':
                this.model.controls.findPanel.visible = !this.model.controls.findPanel.visible;
                return;
            case 'Bookmarks':
                this.model.controls.bookmarksPanel.visible = !this.model.controls.bookmarksPanel.visible;
                return;
            case 'Parameters':
                this.model.controls.parametersPanel.visible = !this.model.controls.parametersPanel.visible;
                return;
            case 'BookmarkAction':
                if (this.model.reportParams.pageNumber === event.bookmarkPage || this.model.reportParams.viewMode !== 'SinglePage') {
                    this.helper.scrollToAnchor(event.bookmarkAnchor, event.componentGuid);
                    return;
                }
                else {
                    this.model.reportParams.pageNumber = event.bookmarkPage;
                    this.model.options.bookmarkAnchor = event.bookmarkAnchor;
                    this.model.options.componentGuid = event.componentGuid;
                }
                break;
            case 'GoToPage':
                this.model.reportParams.pageNumber = event.value;
                break;
            case 'FirstPage':
                this.model.reportParams.pageNumber = 0;
                break;
            case 'PrevPage':
                this.model.reportParams.pageNumber = Math.max(0, this.model.reportParams.pageNumber - 1);
                break;
            case 'NextPage':
                this.model.reportParams.pageNumber = Math.min(this.model.reportParams.pagesCount - 1, this.model.reportParams.pageNumber + 1);
                break;
            case 'LastPage':
                this.model.reportParams.pageNumber = this.model.reportParams.pagesCount - 1;
                break;
            case 'ViewModeSinglePage':
                this.model.reportParams.viewMode = 'SinglePage';
                break;
            case 'ViewModeContinuous':
                this.model.reportParams.viewMode = 'Continuous';
                break;
            case 'ViewModeMultiplePages':
                this.model.reportParams.viewMode = 'MultiplePages';
                break;
            case 'Zoom25':
                this.model.reportParams.zoom = 25;
                break;
            case 'Zoom50':
                this.model.reportParams.zoom = 50;
                break;
            case 'Zoom75':
                this.model.reportParams.zoom = 75;
                break;
            case 'Zoom100':
                this.model.reportParams.zoom = 100;
                break;
            case 'Zoom150':
                this.model.reportParams.zoom = 150;
                break;
            case 'Zoom200':
                this.model.reportParams.zoom = 200;
                break;
            case 'ZoomOnePage':
            case 'ZoomPageWidth':
                this.model.reportParams.zoom = event.name === 'ZoomPageWidth' ? this.pageService.getZoomByPageWidth() : this.pageService.getZoomByPageHeight();
                break;
            case 'Submit':
                this.model.reportParams.editableParameters = null;
                if (this.model.reportParams.type === 'Report') {
                    this.model.reportParams.pageNumber = 0;
                }
                if (this.model.options.isMobileDevice) {
                    this.model.controls.parametersPanel.visible = false;
                }
                this.actionSubject.next({ action: 'Variables' });
                return;
            case 'Reset':
                if (this.model.options.paramsVariablesStartValues) {
                    this.model.options.paramsVariables = this.model.options.paramsVariablesStartValues;
                }
                this.actionSubject.next({ action: 'Reset' });
                return;
            case 'Editor':
                this.actionSubject.next({ action: 'Editor', data: {} });
                return;
            case 'Resources':
                this.model.controls.resourcesPanel.visible = !this.model.controls.resourcesPanel.visible;
                return;
            case 'PrintPdf':
            case 'PrintWithPreview':
            case 'PrintWithoutPreview':
                this.actionSubject.next({ action: 'Print', data: { format: event.name } });
                return;
            case 'Print':
                var format = 'PrintPdf';
                switch (this.model.options.toolbar.printDestination) {
                    case 'Pdf':
                        format = 'PrintPdf';
                        break;
                    case 'Direct':
                        format = 'PrintWithoutPreview';
                        break;
                    case 'WithPreview':
                        format = 'PrintWithPreview';
                        break;
                }
                this.actionSubject.next({ action: 'Print', data: { format: format } });
                return;
            case 'Open':
                this.model.openDialogFileMask = null;
                setTimeout(function () {
                    _this.model.openDialogFileMask = '.mdc,.mdz,.mdx,.mrt,.mrz,.mrx';
                });
                return;
            case 'ResourceView':
                this.postReportResource(event.value.name, 'View');
                return;
            case 'ResourceSaveFile':
                this.postReportResource(event.value.name, 'SaveFile');
                return;
            case 'FullScreen':
                this.fullScreenService.changeFullScreenMode(!this.model.options.appearance.fullScreenMode);
                return;
            case 'About':
                this.actionSubject.next({ action: 'About' });
                return;
            case 'Pin':
                this.model.options.toolbar.autoHide = !this.model.options.toolbar.autoHide;
                this.pageService.calculateLayout();
                if (this.model.options.toolbar.autoHide) {
                    setTimeout(function () {
                        _this.hideToolbar();
                    }, 200);
                }
                return;
            case 'Design':
                this.actionSubject.next({ action: 'Design' });
                break;
            default:
                if (event.name.indexOf('saveMenu') === 0) {
                    this.actionSubject.next({ action: 'Export', data: { format: event.name.substr(8) } });
                    return;
                }
                else if (event.name.indexOf('sendEmailMenu') === 0) {
                    this.actionSubject.next({ action: 'SendEmail', data: { format: event.name.substr(13) } });
                    return;
                }
        }
        this.getPages();
    };
    ControllerService.prototype.showError = function (message, messageText) {
        var type = 'Error';
        // Check for error in 'ServerError:' string format
        if (message != null && typeof (message) === 'string' && message.substr(0, 12) === 'ServerError:') {
            if (message.length <= 13) {
                messageText = 'An unknown error occurred (the server returned an empty value).';
            }
            else {
                messageText = message.substr(12);
            }
        }
        // Check for error in JSON format
        if (message != null && message.success === false && message.type && message.text) {
            type = message.type;
            messageText = message.text;
        }
        this.model.errorMessage = { error: 'Unknown error', type: type };
        if (messageText != null) {
            if (messageText === 'The report is not specified.' && !this.model.options.appearance.showReportIsNotSpecifiedMessage) {
                return true;
            }
            this.model.errorMessage = { error: messageText.replace('\n', '<br>'), type: type };
            if (this.model.images) {
                this.formService.showForm('errorMessageForm');
            }
            else {
                alert(messageText);
            }
            this.actionSubject.next({ action: 'Error' });
            return true;
        }
        return false;
    };
    ControllerService.prototype.postReportResource = function (resourceName, viewType) {
        var data = {
            action: 'ReportResource',
            reportResourceParams: {
                resourceName: resourceName,
                viewType: viewType
            }
        };
        var doc = viewType === 'View' ? this.helper.openNewWindow('about:blank', '_blank').document : null;
        var url = this.model.requestUrl;
        this.httpClient.postForm(url.replace('{action}', this.model.options.actions.viewerEvent), data, doc);
    };
    ControllerService.prototype.postBookmarkNodeAction = function (node) {
        node.selected = true;
        this.action({ name: 'BookmarkAction', bookmarkPage: node.page, bookmarkAnchor: node.url.replace(/\\\'/g, '\'').substr(1), componentGuid: node.compunentGuid });
    };
    ControllerService.prototype.viewerResized = function () {
        this.menuService.closeAllMenus();
    };
    ControllerService.prototype.initAutoUpdateCache = function () {
        var _this = this;
        if (this.model.options.server.allowAutoUpdateCache) {
            if (this.model.timerAutoUpdateCache) {
                clearInterval(this.model.timerAutoUpdateCache);
            }
            this.model.timerAutoUpdateCache = setInterval(function () { return _this.post('UpdateCache'); }, this.model.options.server.timeoutAutoUpdateCache);
        }
    };
    ControllerService.prototype.startRefreshReportTimer = function (timeout) {
        var _this = this;
        if (this.model.refreshReportTimer != null) {
            clearInterval(this.model.refreshReportTimer);
            this.model.refreshReportTimer = null;
        }
        if (timeout && timeout > 0) {
            this.model.refreshReportTimer = setInterval(function () {
                if (!_this.model.showProgress) {
                    _this.post('Refresh');
                }
            }, timeout * 1000);
        }
    };
    ControllerService.prototype.checkTrExp = function () {
        var _this = this;
        if (!this.model.options.cloudMode && !this.model.options.serverMode && !this.model.options.standaloneJsMode && !this.model.options.reportDesignerMode && !this.model.options.alternateValid) {
            var buildDate = new Date();
            try {
                /*if (this.model.options.jsMode && typeof Stimulsoft != 'undefined') {
                  let innerDate = Stimulsoft.StiVersion.created.innerDate;
                  if (innerDate['getFullYear'] && innerDate.getFullYear() > 2017)
                    buildDate = Stimulsoft.StiVersion.created.innerDate;
                }
                else*/ if (this.model.options.buildDate) {
                    buildDate = new Date(this.model.options.buildDate);
                }
            }
            catch (e) {
                buildDate = new Date();
            }
            var trDays_1 = Math.floor(((new Date()).getTime() - buildDate.getTime()) / 1000 / 60 / 60 / 24);
            if (trDays_1 > 60) {
                setTimeout(function () {
                    var message = trDays_1 > 120 ? _this.model.loc('NoticesYourTrialHasExpired') : _this.model.loc('NoticesYouUsingTrialVersion');
                    var image = 'Notifications.Warning.png';
                    var buttonCaption = _this.model.loc('ButtonOk');
                    var cancelAction;
                    var action;
                    if (trDays_1 > 120) {
                        action = cancelAction = function () { window.location.href = 'https://www.stimulsoft.com/en/online-store'; };
                    }
                    _this.model.notificationFormOptions = { message: message, image: image, buttonCaption: buttonCaption, cancelAction: cancelAction, action: action };
                    _this.formService.showForm('notificationForm');
                }, 3000);
            }
        }
    };
    ControllerService.ctorParameters = function () { return [
        { type: StiHttpClientService },
        { type: ModelService },
        { type: StylesService },
        { type: PageService },
        { type: HelperService },
        { type: FormService },
        { type: FullScreenService },
        { type: MenuService },
        { type: StylesService }
    ]; };
    ControllerService = __decorate([
        Injectable()
    ], ControllerService);
    return ControllerService;
}());
export { ControllerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9jb250cm9sbGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0QsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWpELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHekQ7SUFLRSwyQkFBb0IsVUFBZ0MsRUFBVSxLQUFtQixFQUN2RSxhQUE0QixFQUFVLFdBQXdCLEVBQVUsTUFBcUIsRUFDN0YsV0FBd0IsRUFBVSxpQkFBb0MsRUFBVSxXQUF3QixFQUN4RyxZQUEyQjtRQUhyQyxpQkF1QkM7UUF2Qm1CLGVBQVUsR0FBVixVQUFVLENBQXNCO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUN2RSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFVLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUM3RixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFVLHNCQUFp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QztvQkFDNUgsSUFBTSxLQUFLLEdBQUcsMkJBQTJCLENBQUM7b0JBQzFDLElBQU0sYUFBYSxHQUFHLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUNqRCxJQUFJLFlBQWlCLENBQUM7b0JBQ3RCLElBQUksTUFBVyxDQUFDO29CQUVoQixJQUFJLFFBQU0sR0FBRyxHQUFHLEVBQUU7d0JBQ2hCLE1BQU0sR0FBRyxZQUFZLEdBQUcsY0FBUSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyw0Q0FBNEMsQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDeEc7b0JBRUQsS0FBSSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLE9BQU8sU0FBQSxFQUFFLEtBQUssT0FBQSxFQUFFLGFBQWEsZUFBQSxFQUFFLFlBQVksY0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7b0JBQzdGLEtBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ2hELENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQzthQUNWO1NBQ0Y7SUFDSCxDQUFDOztnQkF0ZStCLG9CQUFvQjtnQkFBaUIsWUFBWTtnQkFDeEQsYUFBYTtnQkFBdUIsV0FBVztnQkFBa0IsYUFBYTtnQkFDaEYsV0FBVztnQkFBNkIsaUJBQWlCO2dCQUF1QixXQUFXO2dCQUMxRixhQUFhOztJQVIxQixpQkFBaUI7UUFEN0IsVUFBVSxFQUFFO09BQ0EsaUJBQWlCLENBNGU3QjtJQUFELHdCQUFDO0NBQUEsQUE1ZUQsSUE0ZUM7U0E1ZVksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdGlIdHRwQ2xpZW50U2VydmljZSB9IGZyb20gJy4vaHR0cC1jbGllbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi9tb2RlbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU3R5bGVzU2VydmljZSB9IGZyb20gJy4vc3R5bGVzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBWaWV3ZXJFdmVudCwgQm9va21hcmtOb2RlLCBNZXNzYWdlIH0gZnJvbSAnLi9vYmplY3RzJztcclxuaW1wb3J0IHsgUGFnZVNlcnZpY2UgfSBmcm9tICcuL3BhZ2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IEhlbHBlclNlcnZpY2UgfSBmcm9tICcuL2hlbHBlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybVNlcnZpY2UgfSBmcm9tICcuLi9mb3Jtcy9mb3JtLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGdWxsU2NyZWVuU2VydmljZSB9IGZyb20gJy4vZnVsbC1zY3JlZW4uc2VydmljZSc7XHJcbmltcG9ydCB7IE1lbnVTZXJ2aWNlLCBNZW51IH0gZnJvbSAnLi4vbWVudS9tZW51LnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQ29udHJvbGxlclNlcnZpY2Uge1xyXG5cclxuICBwcml2YXRlIHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgcHVibGljIGFjdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdDxNZXNzYWdlPigpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IFN0aUh0dHBDbGllbnRTZXJ2aWNlLCBwcml2YXRlIG1vZGVsOiBNb2RlbFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHN0eWxlc1NlcnZpY2U6IFN0eWxlc1NlcnZpY2UsIHByaXZhdGUgcGFnZVNlcnZpY2U6IFBhZ2VTZXJ2aWNlLCBwcml2YXRlIGhlbHBlcjogSGVscGVyU2VydmljZSxcclxuICAgIHByaXZhdGUgZm9ybVNlcnZpY2U6IEZvcm1TZXJ2aWNlLCBwcml2YXRlIGZ1bGxTY3JlZW5TZXJ2aWNlOiBGdWxsU2NyZWVuU2VydmljZSwgcHJpdmF0ZSBtZW51U2VydmljZTogTWVudVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHN0eWxlU2VydmljZTogU3R5bGVzU2VydmljZSkge1xyXG5cclxuICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMubW9kZWwuaHR0cEVycm9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuaHR0cEVycm9yLmVycm9yPy50ZXh0KSB7XHJcbiAgICAgICAgICB0aGlzLnNob3dFcnJvcih0aGlzLm1vZGVsLmh0dHBFcnJvci5lcnJvcj8udGV4dCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGVsLmh0dHBFcnJvci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICB0aGlzLnNob3dFcnJvcihudWxsLCB0aGlzLm1vZGVsLmh0dHBFcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubW9kZWwuaHR0cEVycm9yLmVycm9yIGluc3RhbmNlb2YgRXJyb3JFdmVudCkge1xyXG4gICAgICAgICAgdGhpcy5zaG93RXJyb3IodGhpcy5tb2RlbC5odHRwRXJyb3IuZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubW9kZWwuaHR0cEVycm9yID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5tb2RlbC5uYXZpZ2F0ZU5vZGUpIHtcclxuICAgICAgICB0aGlzLnBvc3RCb29rbWFya05vZGVBY3Rpb24odGhpcy5tb2RlbC5uYXZpZ2F0ZU5vZGUpO1xyXG4gICAgICAgIHRoaXMubW9kZWwubmF2aWdhdGVOb2RlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSwgMjUwKTtcclxuXHJcbiAgICB0aGlzLnNldHVwSGFuZGxlcnMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXR1cEhhbmRsZXJzKCkge1xyXG4gICAgdGhpcy5nZXRNZXNzYWdlKCkuc3Vic2NyaWJlKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAobWVzc2FnZS5hY3Rpb24pIHtcclxuICAgICAgICBjYXNlICdHZXRSZXBvcnQnOlxyXG4gICAgICAgIGNhc2UgJ09wZW5SZXBvcnQnOlxyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGVTZXJ2aWNlLmFkZEN1c3RvbUZvbnRTdHlsZXMobWVzc2FnZS5kYXRhPy5jdXN0b21Gb250cyk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmFwcGVhcmFuY2UuZnVsbFNjcmVlbk1vZGUpIHtcclxuICAgICAgICAgICAgICB0aGlzLmZ1bGxTY3JlZW5TZXJ2aWNlLmNoYW5nZUZ1bGxTY3JlZW5Nb2RlKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhPy5zdGltdWxzb2Z0Rm9udENvbnRlbnQgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5zdGltdWxzb2Z0Rm9udENvbnRlbnQpIHtcclxuICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMuc3RpbXVsc29mdEZvbnRDb250ZW50ID0gbWVzc2FnZS5kYXRhLnN0aW11bHNvZnRGb250Q29udGVudDtcclxuICAgICAgICAgICAgICB0aGlzLnN0eWxlU2VydmljZS5hZGRDdXN0b21Gb250U3R5bGVzKFt7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50Rm9yQ3NzOiBtZXNzYWdlLmRhdGEuc3RpbXVsc29mdEZvbnRDb250ZW50LFxyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxGb250RmFtaWx5OiAnU3RpbXVsc29mdCdcclxuICAgICAgICAgICAgICB9XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMuYm9va21hcmtzUGFuZWwuZ2V0VmlzaWJpbGl0eSgpLnN1YnNjcmliZSgodmFsdWUpID0+IHtcclxuICAgICAgaWYgKHZhbHVlICYmIHRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSkge1xyXG4gICAgICAgIHRoaXMubW9kZWwuY29udHJvbHMucGFyYW1ldGVyc1BhbmVsLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLmhpZGVUb29sYmFyKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zaG93VG9vbGJhcigpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnBhcmFtZXRlcnNQYW5lbC5nZXRWaXNpYmlsaXR5KCkuc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICBpZiAodmFsdWUgJiYgdGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5ib29rbWFya3NQYW5lbC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5oaWRlVG9vbGJhcigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuc2hvd1Rvb2xiYXIoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5tZW51U2VydmljZS5nZXRWaXNpYmlsaXR5KCkuc3Vic2NyaWJlKChtZW51OiBNZW51KSA9PiB7XHJcbiAgICAgIHRoaXMuaGlkZVRvb2xiYXIoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGhpZGVUb29sYmFyKCkge1xyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSAmJiB0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSkge1xyXG4gICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnRvb2xiYXIudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dUb29sYmFyKCkge1xyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSAmJiB0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSkge1xyXG4gICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnRvb2xiYXIudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5rZWVwVG9vbGJhcigpO1xyXG4gICAgICB9LCAzMDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGtlZXBUb29sYmFyKCkge1xyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSAmJiB0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSkge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5tb2RlbC50b29sYmFySGlkZVRpbWVyKTtcclxuICAgICAgdGhpcy5tb2RlbC50b29sYmFySGlkZVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5oaWRlVG9vbGJhcigpO1xyXG4gICAgICB9LCA0MDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRNZXNzYWdlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEFjdGlvbk1lc3NhZ2UoKTogT2JzZXJ2YWJsZTxNZXNzYWdlPiB7XHJcbiAgICByZXR1cm4gdGhpcy5hY3Rpb25TdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3QoYWN0aW9uOiBzdHJpbmcsIGNBY3Rpb24/OiBzdHJpbmcsIHBvc3REYXRhPzogYW55LCByZXNwb25zZVR5cGU6IHN0cmluZyA9ICdqc29uJywgc3ViQWN0aW9uPzogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy50b29sYmFyLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgIGxldCB1cmw6IHN0cmluZztcclxuICAgIGlmICghY0FjdGlvbikge1xyXG4gICAgICB1cmwgPSB0aGlzLm1vZGVsLnJlcXVlc3RVcmwucmVwbGFjZSgne2FjdGlvbn0nLCBhY3Rpb24gPT09ICdHZXRSZXBvcnQnIHx8IHRoaXMubW9kZWwub3B0aW9ucy5zZXJ2ZXIuY2FjaGVNb2RlID09PSAnTm9uZScgPyB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy5nZXRSZXBvcnQgOiB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy52aWV3ZXJFdmVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1cmwgPSB0aGlzLm1vZGVsLnJlcXVlc3RVcmwucmVwbGFjZSgne2FjdGlvbn0nLCBjQWN0aW9uKTtcclxuICAgIH1cclxuICAgIGlmIChwb3N0RGF0YSkge1xyXG4gICAgICBwb3N0RGF0YS5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwb3N0RGF0YSA9IHsgYWN0aW9uIH07XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCB0aGlzLm1vZGVsLmNyZWF0ZVBvc3RQYXJhbWV0ZXJzKHBvc3REYXRhKSwgcmVzcG9uc2VUeXBlKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgIHRoaXMubW9kZWwuc2hvd1Byb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgdGhpcy5tb2RlbC5jb250cm9scy50b29sYmFyLmVuYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgICAgaWYgKGRhdGEgPT09ICdTZXJ2ZXJFcnJvcjpUaGUgcmVwb3J0IGlzIG5vdCBzcGVjaWZpZWQuJyAmJiB0aGlzLm1vZGVsLm9wdGlvbnM/LmlzUmVwb3J0UmVjaWV2ZWQpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMuaXNSZXBvcnRSZWNpZXZlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnByZXZQYWdlTnVtYmVyID0gdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlcjtcclxuICAgICAgICB0aGlzLnBvc3QoJ0dldFJlcG9ydCcpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcyA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5zdGFydFJlZnJlc2hSZXBvcnRUaW1lcihkYXRhLnJlZnJlc2hUaW1lKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN1YmplY3QubmV4dCh7IGFjdGlvbiwgZGF0YSwgc3ViQWN0aW9uIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZFZpZXdlcigpOiB2b2lkIHtcclxuICAgIGNvbnN0IHVybCA9IHRoaXMubW9kZWwucmVxdWVzdFVybC5yZXBsYWNlKCd7YWN0aW9ufScsIHRoaXMubW9kZWwuYWN0aW9uKTtcclxuICAgIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgdGhpcy5tb2RlbC5jcmVhdGVQb3N0UGFyYW1ldGVycyh7IGFjdGlvbjogJ0FuZ3VsYXJWaWV3ZXJEYXRhJyB9LCB0cnVlLCBmYWxzZSksICdqc29uJywpLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgdGhpcy5tb2RlbC5jbGVhcigpO1xyXG4gICAgICB0aGlzLnN0eWxlc1NlcnZpY2Uuc2V0dXBTdHlsZShhdG9iKGRhdGFbJ3N0eWxlcyddKSwgJ3ZpZXdlcicpO1xyXG4gICAgICB0aGlzLm1vZGVsLm9wdGlvbnMgPSBkYXRhO1xyXG4gICAgICB0aGlzLmNoZWNrVHJFeHAoKTtcclxuICAgICAgdGhpcy5pbml0QXV0b1VwZGF0ZUNhY2hlKCk7XHJcbiAgICAgIHRoaXMuc3ViamVjdC5uZXh0KHsgYWN0aW9uOiAndmlld2VyX2xvYWRlZCcgfSk7XHJcbiAgICAgIHRoaXMuZ2V0UmVwb3J0KCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRSZXBvcnQoKTogdm9pZCB7XHJcbiAgICB0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzU3RhcnRWYWx1ZXMgPSBudWxsO1xyXG4gICAgdGhpcy5wb3N0KCdHZXRSZXBvcnQnKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRQYWdlcygpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdCgnR2V0UGFnZXMnKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwb3N0RXhwb3J0KGZvcm1hdDogc3RyaW5nLCBzZXR0aW5nczogYW55LCBlbGVtZW50TmFtZT86IHN0cmluZywgaXNEYXNoYm9hcmRFeHBvcnQ6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgYWN0aW9uOiBpc0Rhc2hib2FyZEV4cG9ydCA/ICdFeHBvcnREYXNoYm9hcmQnIDogJ0V4cG9ydFJlcG9ydCcsXHJcbiAgICAgIGV4cG9ydEZvcm1hdDogZm9ybWF0LFxyXG4gICAgICBleHBvcnRTZXR0aW5nczogc2V0dGluZ3MsXHJcbiAgICAgIGVsZW1lbnROYW1lXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGRvYyA9IHNldHRpbmdzICYmIHNldHRpbmdzLk9wZW5BZnRlckV4cG9ydCAmJiB0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5vcGVuRXhwb3J0ZWRSZXBvcnRXaW5kb3cgPT09ICdfYmxhbmsnID8gdGhpcy5oZWxwZXIub3Blbk5ld1dpbmRvdygnYWJvdXQ6YmxhbmsnLCAnX2JsYW5rJykuZG9jdW1lbnQgOiBudWxsO1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5tb2RlbC5yZXF1ZXN0VXJsO1xyXG4gICAgdGhpcy5odHRwQ2xpZW50LnBvc3RGb3JtKHVybC5yZXBsYWNlKCd7YWN0aW9ufScsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLmV4cG9ydFJlcG9ydCksIGRhdGEsIGRvYyk7XHJcbiAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ0V4cG9ydFJlcG9ydCcsIGRhdGEgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZEZpbGUoZmlsZU5hbWU6IHN0cmluZywgY29udGVudDogYW55KSB7XHJcbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnIHx8IGNvbnRlbnQgPT09ICcnKSB7IHJldHVybjsgfVxyXG5cclxuICAgIGlmIChjb250ZW50LmluZGV4T2YoJzw/eG1sJykgPT09IDAgfHwgY29udGVudC5pbmRleE9mKCd7JykgPT09IDApIHsgY29udGVudCA9IGJ0b2EoY29udGVudCk7IH1cclxuXHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICBhY3Rpb246ICdPcGVuUmVwb3J0JyxcclxuICAgICAgb3BlbmluZ0ZpbGVOYW1lOiBmaWxlTmFtZSB8fCAnUmVwb3J0Lm1kYycsXHJcbiAgICAgIGJhc2U2NERhdGE6IGNvbnRlbnQuaW5kZXhPZignYmFzZTY0LCcpID4gMCA/IGNvbnRlbnQuc3Vic3RyKGNvbnRlbnQuaW5kZXhPZignYmFzZTY0LCcpICsgNykgOiBjb250ZW50XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChmaWxlTmFtZSAmJiAoZmlsZU5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCcubWR4JykgPj0gMCB8fCBmaWxlTmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJy5tcngnKSA+PSAwKSkge1xyXG4gICAgICB0aGlzLmZvcm1TZXJ2aWNlLnNob3dGb3JtKCdwYXNzd29yZEZvcm0nLCBkYXRhKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucG9zdE9wZW4oZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcG9zdE9wZW4oZGF0YTogYW55KSB7XHJcbiAgICB0aGlzLm1vZGVsLmNsZWFyVmlld2VyU3RhdGUoKTtcclxuICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnJlcG9ydEZpbGVOYW1lID0gZGF0YS5vcGVuaW5nRmlsZU5hbWU7XHJcbiAgICB0aGlzLnBvc3QoJ09wZW5SZXBvcnQnLCB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy5vcGVuUmVwb3J0LCBkYXRhKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhY3Rpb24oZXZlbnQ6IFZpZXdlckV2ZW50KTogdm9pZCB7XHJcbiAgICBzd2l0Y2ggKGV2ZW50Lm5hbWUpIHtcclxuICAgICAgY2FzZSAnRmluZCc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5maW5kUGFuZWwudmlzaWJsZSA9ICF0aGlzLm1vZGVsLmNvbnRyb2xzLmZpbmRQYW5lbC52aXNpYmxlO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ0Jvb2ttYXJrcyc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5ib29rbWFya3NQYW5lbC52aXNpYmxlID0gIXRoaXMubW9kZWwuY29udHJvbHMuYm9va21hcmtzUGFuZWwudmlzaWJsZTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdQYXJhbWV0ZXJzJzpcclxuICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnBhcmFtZXRlcnNQYW5lbC52aXNpYmxlID0gIXRoaXMubW9kZWwuY29udHJvbHMucGFyYW1ldGVyc1BhbmVsLnZpc2libGU7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnQm9va21hcmtBY3Rpb24nOlxyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID09PSBldmVudC5ib29rbWFya1BhZ2UgfHwgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudmlld01vZGUgIT09ICdTaW5nbGVQYWdlJykge1xyXG4gICAgICAgICAgdGhpcy5oZWxwZXIuc2Nyb2xsVG9BbmNob3IoZXZlbnQuYm9va21hcmtBbmNob3IsIGV2ZW50LmNvbXBvbmVudEd1aWQpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gZXZlbnQuYm9va21hcmtQYWdlO1xyXG4gICAgICAgICAgdGhpcy5tb2RlbC5vcHRpb25zLmJvb2ttYXJrQW5jaG9yID0gZXZlbnQuYm9va21hcmtBbmNob3I7XHJcbiAgICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMuY29tcG9uZW50R3VpZCA9IGV2ZW50LmNvbXBvbmVudEd1aWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnR29Ub1BhZ2UnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSBldmVudC52YWx1ZTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ0ZpcnN0UGFnZSc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA9IDA7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdQcmV2UGFnZSc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA9IE1hdGgubWF4KDAsIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgLSAxKTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ05leHRQYWdlJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gTWF0aC5taW4odGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZXNDb3VudCAtIDEsIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgKyAxKTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ0xhc3RQYWdlJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZXNDb3VudCAtIDE7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdWaWV3TW9kZVNpbmdsZVBhZ2UnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnZpZXdNb2RlID0gJ1NpbmdsZVBhZ2UnO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnVmlld01vZGVDb250aW51b3VzJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSA9ICdDb250aW51b3VzJztcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ1ZpZXdNb2RlTXVsdGlwbGVQYWdlcyc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudmlld01vZGUgPSAnTXVsdGlwbGVQYWdlcyc7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdab29tMjUnOiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gMjU7IGJyZWFrO1xyXG4gICAgICBjYXNlICdab29tNTAnOiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gNTA7IGJyZWFrO1xyXG4gICAgICBjYXNlICdab29tNzUnOiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gNzU7IGJyZWFrO1xyXG4gICAgICBjYXNlICdab29tMTAwJzogdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSA9IDEwMDsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1pvb20xNTAnOiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gMTUwOyBicmVhaztcclxuICAgICAgY2FzZSAnWm9vbTIwMCc6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSAyMDA7IGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnWm9vbU9uZVBhZ2UnOlxyXG4gICAgICBjYXNlICdab29tUGFnZVdpZHRoJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gZXZlbnQubmFtZSA9PT0gJ1pvb21QYWdlV2lkdGgnID8gdGhpcy5wYWdlU2VydmljZS5nZXRab29tQnlQYWdlV2lkdGgoKSA6IHRoaXMucGFnZVNlcnZpY2UuZ2V0Wm9vbUJ5UGFnZUhlaWdodCgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnU3VibWl0JzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5lZGl0YWJsZVBhcmFtZXRlcnMgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy50eXBlID09PSAnUmVwb3J0JykgeyB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gMDsgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UpIHsgdGhpcy5tb2RlbC5jb250cm9scy5wYXJhbWV0ZXJzUGFuZWwudmlzaWJsZSA9IGZhbHNlOyB9XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdWYXJpYWJsZXMnIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1Jlc2V0JzpcclxuICAgICAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLnBhcmFtc1ZhcmlhYmxlc1N0YXJ0VmFsdWVzKSB7XHJcbiAgICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzID0gdGhpcy5tb2RlbC5vcHRpb25zLnBhcmFtc1ZhcmlhYmxlc1N0YXJ0VmFsdWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ1Jlc2V0JyB9KTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdFZGl0b3InOlxyXG4gICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnRWRpdG9yJywgZGF0YToge30gfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUmVzb3VyY2VzJzpcclxuICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnJlc291cmNlc1BhbmVsLnZpc2libGUgPSAhdGhpcy5tb2RlbC5jb250cm9scy5yZXNvdXJjZXNQYW5lbC52aXNpYmxlO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1ByaW50UGRmJzpcclxuICAgICAgY2FzZSAnUHJpbnRXaXRoUHJldmlldyc6XHJcbiAgICAgIGNhc2UgJ1ByaW50V2l0aG91dFByZXZpZXcnOlxyXG4gICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnUHJpbnQnLCBkYXRhOiB7IGZvcm1hdDogZXZlbnQubmFtZSB9IH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1ByaW50JzpcclxuICAgICAgICBsZXQgZm9ybWF0ID0gJ1ByaW50UGRmJztcclxuICAgICAgICBzd2l0Y2ggKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnByaW50RGVzdGluYXRpb24pIHtcclxuICAgICAgICAgIGNhc2UgJ1BkZic6XHJcbiAgICAgICAgICAgIGZvcm1hdCA9ICdQcmludFBkZic7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnRGlyZWN0JzpcclxuICAgICAgICAgICAgZm9ybWF0ID0gJ1ByaW50V2l0aG91dFByZXZpZXcnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1dpdGhQcmV2aWV3JzpcclxuICAgICAgICAgICAgZm9ybWF0ID0gJ1ByaW50V2l0aFByZXZpZXcnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdQcmludCcsIGRhdGE6IHsgZm9ybWF0IH0gfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnT3Blbic6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5vcGVuRGlhbG9nRmlsZU1hc2sgPSBudWxsO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5tb2RlbC5vcGVuRGlhbG9nRmlsZU1hc2sgPSAnLm1kYywubWR6LC5tZHgsLm1ydCwubXJ6LC5tcngnO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1Jlc291cmNlVmlldyc6XHJcbiAgICAgICAgdGhpcy5wb3N0UmVwb3J0UmVzb3VyY2UoZXZlbnQudmFsdWUubmFtZSwgJ1ZpZXcnKTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdSZXNvdXJjZVNhdmVGaWxlJzpcclxuICAgICAgICB0aGlzLnBvc3RSZXBvcnRSZXNvdXJjZShldmVudC52YWx1ZS5uYW1lLCAnU2F2ZUZpbGUnKTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdGdWxsU2NyZWVuJzpcclxuICAgICAgICB0aGlzLmZ1bGxTY3JlZW5TZXJ2aWNlLmNoYW5nZUZ1bGxTY3JlZW5Nb2RlKCF0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5mdWxsU2NyZWVuTW9kZSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnQWJvdXQnOlxyXG4gICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnQWJvdXQnIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1Bpbic6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuYXV0b0hpZGUgPSAhdGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuYXV0b0hpZGU7XHJcbiAgICAgICAgdGhpcy5wYWdlU2VydmljZS5jYWxjdWxhdGVMYXlvdXQoKTtcclxuICAgICAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuYXV0b0hpZGUpIHtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGVUb29sYmFyKCk7XHJcbiAgICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdEZXNpZ24nOlxyXG4gICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnRGVzaWduJyB9KTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgaWYgKGV2ZW50Lm5hbWUuaW5kZXhPZignc2F2ZU1lbnUnKSA9PT0gMCkge1xyXG4gICAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdFeHBvcnQnLCBkYXRhOiB7IGZvcm1hdDogZXZlbnQubmFtZS5zdWJzdHIoOCkgfSB9KTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50Lm5hbWUuaW5kZXhPZignc2VuZEVtYWlsTWVudScpID09PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ1NlbmRFbWFpbCcsIGRhdGE6IHsgZm9ybWF0OiBldmVudC5uYW1lLnN1YnN0cigxMykgfSB9KTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5nZXRQYWdlcygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dFcnJvcihtZXNzYWdlOiBhbnksIG1lc3NhZ2VUZXh0Pzogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgdHlwZSA9ICdFcnJvcic7XHJcblxyXG4gICAgLy8gQ2hlY2sgZm9yIGVycm9yIGluICdTZXJ2ZXJFcnJvcjonIHN0cmluZyBmb3JtYXRcclxuICAgIGlmIChtZXNzYWdlICE9IG51bGwgJiYgdHlwZW9mIChtZXNzYWdlKSA9PT0gJ3N0cmluZycgJiYgbWVzc2FnZS5zdWJzdHIoMCwgMTIpID09PSAnU2VydmVyRXJyb3I6Jykge1xyXG4gICAgICBpZiAobWVzc2FnZS5sZW5ndGggPD0gMTMpIHtcclxuICAgICAgICBtZXNzYWdlVGV4dCA9ICdBbiB1bmtub3duIGVycm9yIG9jY3VycmVkICh0aGUgc2VydmVyIHJldHVybmVkIGFuIGVtcHR5IHZhbHVlKS4nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1lc3NhZ2VUZXh0ID0gbWVzc2FnZS5zdWJzdHIoMTIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgZm9yIGVycm9yIGluIEpTT04gZm9ybWF0XHJcbiAgICBpZiAobWVzc2FnZSAhPSBudWxsICYmIG1lc3NhZ2Uuc3VjY2VzcyA9PT0gZmFsc2UgJiYgbWVzc2FnZS50eXBlICYmIG1lc3NhZ2UudGV4dCkge1xyXG4gICAgICB0eXBlID0gbWVzc2FnZS50eXBlO1xyXG4gICAgICBtZXNzYWdlVGV4dCA9IG1lc3NhZ2UudGV4dDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm1vZGVsLmVycm9yTWVzc2FnZSA9IHsgZXJyb3I6ICdVbmtub3duIGVycm9yJywgdHlwZSB9O1xyXG5cclxuICAgIGlmIChtZXNzYWdlVGV4dCAhPSBudWxsKSB7XHJcbiAgICAgIGlmIChtZXNzYWdlVGV4dCA9PT0gJ1RoZSByZXBvcnQgaXMgbm90IHNwZWNpZmllZC4nICYmICF0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5zaG93UmVwb3J0SXNOb3RTcGVjaWZpZWRNZXNzYWdlKSB7IHJldHVybiB0cnVlOyB9XHJcblxyXG4gICAgICB0aGlzLm1vZGVsLmVycm9yTWVzc2FnZSA9IHsgZXJyb3I6IG1lc3NhZ2VUZXh0LnJlcGxhY2UoJ1xcbicsICc8YnI+JyksIHR5cGUgfTtcclxuXHJcbiAgICAgIGlmICh0aGlzLm1vZGVsLmltYWdlcykge1xyXG4gICAgICAgIHRoaXMuZm9ybVNlcnZpY2Uuc2hvd0Zvcm0oJ2Vycm9yTWVzc2FnZUZvcm0nKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhbGVydChtZXNzYWdlVGV4dCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdFcnJvcicgfSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwb3N0UmVwb3J0UmVzb3VyY2UocmVzb3VyY2VOYW1lOiBzdHJpbmcsIHZpZXdUeXBlOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGFjdGlvbjogJ1JlcG9ydFJlc291cmNlJyxcclxuICAgICAgcmVwb3J0UmVzb3VyY2VQYXJhbXM6IHtcclxuICAgICAgICByZXNvdXJjZU5hbWUsXHJcbiAgICAgICAgdmlld1R5cGVcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkb2MgPSB2aWV3VHlwZSA9PT0gJ1ZpZXcnID8gdGhpcy5oZWxwZXIub3Blbk5ld1dpbmRvdygnYWJvdXQ6YmxhbmsnLCAnX2JsYW5rJykuZG9jdW1lbnQgOiBudWxsO1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5tb2RlbC5yZXF1ZXN0VXJsO1xyXG4gICAgdGhpcy5odHRwQ2xpZW50LnBvc3RGb3JtKHVybC5yZXBsYWNlKCd7YWN0aW9ufScsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLnZpZXdlckV2ZW50KSwgZGF0YSwgZG9jKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwb3N0Qm9va21hcmtOb2RlQWN0aW9uKG5vZGU6IEJvb2ttYXJrTm9kZSkge1xyXG4gICAgbm9kZS5zZWxlY3RlZCA9IHRydWU7XHJcbiAgICB0aGlzLmFjdGlvbih7IG5hbWU6ICdCb29rbWFya0FjdGlvbicsIGJvb2ttYXJrUGFnZTogbm9kZS5wYWdlLCBib29rbWFya0FuY2hvcjogbm9kZS51cmwucmVwbGFjZSgvXFxcXFxcJy9nLCAnXFwnJykuc3Vic3RyKDEpLCBjb21wb25lbnRHdWlkOiBub2RlLmNvbXB1bmVudEd1aWQgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdmlld2VyUmVzaXplZCgpIHtcclxuICAgIHRoaXMubWVudVNlcnZpY2UuY2xvc2VBbGxNZW51cygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXRBdXRvVXBkYXRlQ2FjaGUoKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLnNlcnZlci5hbGxvd0F1dG9VcGRhdGVDYWNoZSkge1xyXG4gICAgICBpZiAodGhpcy5tb2RlbC50aW1lckF1dG9VcGRhdGVDYWNoZSkge1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb2RlbC50aW1lckF1dG9VcGRhdGVDYWNoZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5tb2RlbC50aW1lckF1dG9VcGRhdGVDYWNoZSA9IHNldEludGVydmFsKCgpID0+IHRoaXMucG9zdCgnVXBkYXRlQ2FjaGUnKSwgdGhpcy5tb2RlbC5vcHRpb25zLnNlcnZlci50aW1lb3V0QXV0b1VwZGF0ZUNhY2hlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGFydFJlZnJlc2hSZXBvcnRUaW1lcih0aW1lb3V0OiBudW1iZXIpIHtcclxuICAgIGlmICh0aGlzLm1vZGVsLnJlZnJlc2hSZXBvcnRUaW1lciAhPSBudWxsKSB7XHJcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb2RlbC5yZWZyZXNoUmVwb3J0VGltZXIpO1xyXG4gICAgICB0aGlzLm1vZGVsLnJlZnJlc2hSZXBvcnRUaW1lciA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRpbWVvdXQgJiYgdGltZW91dCA+IDApIHtcclxuICAgICAgdGhpcy5tb2RlbC5yZWZyZXNoUmVwb3J0VGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm1vZGVsLnNob3dQcm9ncmVzcykge1xyXG4gICAgICAgICAgdGhpcy5wb3N0KCdSZWZyZXNoJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCB0aW1lb3V0ICogMTAwMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2hlY2tUckV4cCgpIHtcclxuICAgIGlmICghdGhpcy5tb2RlbC5vcHRpb25zLmNsb3VkTW9kZSAmJiAhdGhpcy5tb2RlbC5vcHRpb25zLnNlcnZlck1vZGUgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5zdGFuZGFsb25lSnNNb2RlICYmICF0aGlzLm1vZGVsLm9wdGlvbnMucmVwb3J0RGVzaWduZXJNb2RlICYmICF0aGlzLm1vZGVsLm9wdGlvbnMuYWx0ZXJuYXRlVmFsaWQpIHtcclxuICAgICAgbGV0IGJ1aWxkRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLyppZiAodGhpcy5tb2RlbC5vcHRpb25zLmpzTW9kZSAmJiB0eXBlb2YgU3RpbXVsc29mdCAhPSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgbGV0IGlubmVyRGF0ZSA9IFN0aW11bHNvZnQuU3RpVmVyc2lvbi5jcmVhdGVkLmlubmVyRGF0ZTtcclxuICAgICAgICAgIGlmIChpbm5lckRhdGVbJ2dldEZ1bGxZZWFyJ10gJiYgaW5uZXJEYXRlLmdldEZ1bGxZZWFyKCkgPiAyMDE3KVxyXG4gICAgICAgICAgICBidWlsZERhdGUgPSBTdGltdWxzb2Z0LlN0aVZlcnNpb24uY3JlYXRlZC5pbm5lckRhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UqLyBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmJ1aWxkRGF0ZSkge1xyXG4gICAgICAgICAgYnVpbGREYXRlID0gbmV3IERhdGUodGhpcy5tb2RlbC5vcHRpb25zLmJ1aWxkRGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgYnVpbGREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdHJEYXlzID0gTWF0aC5mbG9vcigoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIGJ1aWxkRGF0ZS5nZXRUaW1lKCkpIC8gMTAwMCAvIDYwIC8gNjAgLyAyNCk7XHJcbiAgICAgIGlmICh0ckRheXMgPiA2MCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRyRGF5cyA+IDEyMCA/IHRoaXMubW9kZWwubG9jKCdOb3RpY2VzWW91clRyaWFsSGFzRXhwaXJlZCcpIDogdGhpcy5tb2RlbC5sb2MoJ05vdGljZXNZb3VVc2luZ1RyaWFsVmVyc2lvbicpO1xyXG4gICAgICAgICAgY29uc3QgaW1hZ2UgPSAnTm90aWZpY2F0aW9ucy5XYXJuaW5nLnBuZyc7XHJcbiAgICAgICAgICBjb25zdCBidXR0b25DYXB0aW9uID0gdGhpcy5tb2RlbC5sb2MoJ0J1dHRvbk9rJyk7XHJcbiAgICAgICAgICBsZXQgY2FuY2VsQWN0aW9uOiBhbnk7XHJcbiAgICAgICAgICBsZXQgYWN0aW9uOiBhbnk7XHJcblxyXG4gICAgICAgICAgaWYgKHRyRGF5cyA+IDEyMCkge1xyXG4gICAgICAgICAgICBhY3Rpb24gPSBjYW5jZWxBY3Rpb24gPSAoKSA9PiB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHBzOi8vd3d3LnN0aW11bHNvZnQuY29tL2VuL29ubGluZS1zdG9yZSc7IH07XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdGhpcy5tb2RlbC5ub3RpZmljYXRpb25Gb3JtT3B0aW9ucyA9IHsgbWVzc2FnZSwgaW1hZ2UsIGJ1dHRvbkNhcHRpb24sIGNhbmNlbEFjdGlvbiwgYWN0aW9uIH07XHJcbiAgICAgICAgICB0aGlzLmZvcm1TZXJ2aWNlLnNob3dGb3JtKCdub3RpZmljYXRpb25Gb3JtJyk7XHJcbiAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19