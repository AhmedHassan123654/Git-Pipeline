import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ModelService } from './model.service';
import { ExportService } from './export.service';
import { HelperService } from './helper.service';
import { StiHttpClientService } from './http-client.service';
import { ControllerService } from './controller.service';
var PrintService = /** @class */ (function () {
    function PrintService(model, exportService, helper, httpClient, controller) {
        var _this = this;
        this.model = model;
        this.exportService = exportService;
        this.helper = helper;
        this.httpClient = httpClient;
        this.controller = controller;
        controller.getActionMessage().subscribe(function (message) {
            if (message.action === 'Print') {
                _this.postPrint(message.data.format);
            }
        });
        controller.getMessage().subscribe(function (message) {
            if (message.action === 'PrintReport') {
                switch (message.subAction) {
                    case 'PrintWithPreview':
                        _this.printAsPopup(message.data);
                        break;
                    case 'PrintWithoutPreview':
                        _this.printAsHtml(message.data);
                        break;
                }
            }
        });
    }
    PrintService.prototype.postPrint = function (printAction) {
        if (printAction === 'PrintPdf' && /iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent) && this.helper.isTouchDevice()) {
            var settings = this.exportService.getDefaultExportSettings('Pdf');
            settings.OpenAfterExport = true;
            this.postExport('Pdf', settings);
            return;
        }
        var data = {
            action: 'PrintReport',
            printAction: printAction,
            bookmarksPrint: this.model.options.appearance.bookmarksPrint
        };
        var url = ''; // this.model.options.requestUrl.replace('{action}', this.model.options.actions.printReport);
        switch (printAction) {
            case 'PrintPdf':
                if (this.model.options.appearance.printToPdfMode === 'Popup' || this.helper.getNavigatorName() == 'Safari' || this.helper.getNavigatorName() == 'iPad') {
                    this.printAsPdfPopup(data);
                }
                else {
                    this.printAsPdf(url, data);
                }
                break;
            default:
                this.controller.post('PrintReport', this.model.options.actions.printReport, data, 'text', printAction);
                break;
        }
    };
    PrintService.prototype.postExport = function (format, settings, elementName, isDashboardExport) {
        var data = {
            action: isDashboardExport ? 'ExportDashboard' : 'ExportReport',
            exportFormat: format,
            exportSettings: settings,
            elementName: elementName
        };
        var doc = settings && settings.OpenAfterExport && this.model.options.appearance.openExportedReportWindow === '_blank' ? this.helper.openNewWindow('about:blank', '_blank').document : null;
        var url = this.model.requestUrl;
        this.httpClient.postForm(url.replace('{action}', this.model.options.actions.exportReport), data, doc);
    };
    PrintService.prototype.printAsPdfPopup = function (data) {
        var url = this.model.requestUrl.replace('{action}', this.model.options.actions.printReport);
        var win = this.helper.openNewWindow('about:blank', '_blank');
        if (win != null) {
            this.httpClient.postForm(url, data, win.document);
        }
    };
    PrintService.prototype.printAsPdf = function (url, data) {
        data.responseType = 'blob';
        var viewer = this.model.controls.viewer.el.nativeElement;
        var printFrameId = this.model.options.viewerId + '_PdfPrintFrame';
        var printFrame = document.getElementById(printFrameId);
        if (printFrame) {
            viewer.removeChild(printFrame);
        }
        printFrame = document.createElement('iframe');
        printFrame.id = printFrameId;
        printFrame.name = printFrameId;
        printFrame.width = '0';
        printFrame.height = '0';
        printFrame.style.position = 'absolute';
        printFrame.style.border = 'none';
        // Firefox does not load the invisible content of the iframe
        if (this.helper.getNavigatorName() === 'Mozilla') {
            printFrame.width = '100px';
            printFrame.height = '100px';
            printFrame.style.visibility = 'hidden';
            printFrame.style.zIndex = '-100';
            printFrame.style.pointerEvents = 'none';
        }
        viewer.insertBefore(printFrame, viewer.firstChild);
        // Manual printing in browsers that do not support automatic PDF printing
        if (this.helper.getNavigatorName() !== 'Mozilla') {
            printFrame.onload = function () {
                printFrame.contentWindow.focus();
                printFrame.contentWindow.print();
            };
        }
        var form = document.createElement('FORM');
        form.setAttribute('id', 'printForm');
        form.setAttribute('method', 'POST');
        form.setAttribute('action', this.model.requestUrl.replace('{action}', this.model.options.actions.printReport));
        form.setAttribute('target', this.model.options.viewerId + '_PdfPrintFrame');
        var params = this.model.createPostParameters(data, true);
        Object.keys(params).forEach(function (key) {
            var paramsField = document.createElement('INPUT');
            paramsField.setAttribute('type', 'hidden');
            paramsField.setAttribute('name', key);
            paramsField.setAttribute('value', params[key]);
            form.appendChild(paramsField);
        });
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
    };
    PrintService.prototype.printAsPopup = function (text) {
        var width = this.model.reportParams.pagesWidth || 790;
        var win = this.helper.openNewWindow('about:blank', 'PrintReport', 'height=900,width=' + width + ',toolbar=no,menubar=yes,scrollbars=yes,resizable=yes,location=no,directories=no,status=no');
        if (win != null) {
            win.document.open();
            win.document.write(text);
            win.document.close();
        }
    };
    PrintService.prototype.printAsHtml = function (text) {
        if (this.controller.showError(text)) {
            return;
        }
        var viewer = this.model.controls.viewer.el.nativeElement;
        // Remove '_PdfPrintFrame', this should fix IE strange error
        var printFrameId = this.model.options.viewerId + '_PdfPrintFrame';
        var printFrame = document.getElementById(printFrameId);
        if (printFrame) {
            viewer.removeChild(printFrame);
        }
        printFrameId = this.model.options.viewerId + '_HtmlPrintFrame';
        printFrame = document.getElementById(printFrameId);
        if (printFrame) {
            viewer.removeChild(printFrame);
        }
        printFrame = document.createElement('iframe');
        printFrame.id = printFrameId;
        printFrame.name = printFrameId;
        printFrame.width = '0';
        printFrame.height = '0';
        printFrame.style.position = 'absolute';
        printFrame.style.border = 'none';
        viewer.insertBefore(printFrame, viewer.firstChild);
        printFrame.contentWindow.document.open();
        printFrame.contentWindow.document.write(text);
        printFrame.contentWindow.document.close();
        setTimeout(function () {
            printFrame.contentWindow.focus();
            printFrame.contentWindow.print();
        });
    };
    PrintService.ctorParameters = function () { return [
        { type: ModelService },
        { type: ExportService },
        { type: HelperService },
        { type: StiHttpClientService },
        { type: ControllerService }
    ]; };
    PrintService = __decorate([
        Injectable()
    ], PrintService);
    return PrintService;
}());
export { PrintService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3N0aW11bHNvZnQtdmlld2VyLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcHJpbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUl6RDtJQUVFLHNCQUFtQixLQUFtQixFQUFTLGFBQTRCLEVBQVMsTUFBcUIsRUFDaEcsVUFBZ0MsRUFBUyxVQUE2QjtRQUQvRSxpQkFzQkM7UUF0QmtCLFVBQUssR0FBTCxLQUFLLENBQWM7UUFBUyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFTLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDaEcsZUFBVSxHQUFWLFVBQVUsQ0FBc0I7UUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFtQjtRQUU3RSxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBQyxPQUFnQjtZQUN2RCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO2dCQUM5QixLQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDckM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBQyxPQUFnQjtZQUNqRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssYUFBYSxFQUFF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VSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7UUFDL0IsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7UUFDdkIsVUFBVSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7UUFDeEIsVUFBVSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO1FBQ3ZDLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNqQyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFbkQsVUFBVSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDekMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLFVBQVUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzFDLFVBQVUsQ0FBQztZQUNULFVBQVUsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDakMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7O2dCQXhLeUIsWUFBWTtnQkFBd0IsYUFBYTtnQkFBaUIsYUFBYTtnQkFDcEYsb0JBQW9CO2dCQUFxQixpQkFBaUI7O0lBSHBFLFlBQVk7UUFEeEIsVUFBVSxFQUFFO09BQ0EsWUFBWSxDQTJLeEI7SUFBRCxtQkFBQztDQUFBLEFBM0tELElBMktDO1NBM0tZLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gJy4vbW9kZWwuc2VydmljZSc7XHJcbmltcG9ydCB7IEV4cG9ydFNlcnZpY2UgfSBmcm9tICcuL2V4cG9ydC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4vaGVscGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTdGlIdHRwQ2xpZW50U2VydmljZSB9IGZyb20gJy4vaHR0cC1jbGllbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb250cm9sbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAnLi9vYmplY3RzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFByaW50U2VydmljZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtb2RlbDogTW9kZWxTZXJ2aWNlLCBwdWJsaWMgZXhwb3J0U2VydmljZTogRXhwb3J0U2VydmljZSwgcHVibGljIGhlbHBlcjogSGVscGVyU2VydmljZSxcclxuICAgIHB1YmxpYyBodHRwQ2xpZW50OiBTdGlIdHRwQ2xpZW50U2VydmljZSwgcHVibGljIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlKSB7XHJcblxyXG4gICAgY29udHJvbGxlci5nZXRBY3Rpb25NZXNzYWdlKCkuc3Vic2NyaWJlKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ1ByaW50Jykge1xyXG4gICAgICAgIHRoaXMucG9zdFByaW50KG1lc3NhZ2UuZGF0YS5mb3JtYXQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb250cm9sbGVyLmdldE1lc3NhZ2UoKS5zdWJzY3JpYmUoKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcclxuICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnUHJpbnRSZXBvcnQnKSB7XHJcbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLnN1YkFjdGlvbikge1xyXG4gICAgICAgICAgY2FzZSAnUHJpbnRXaXRoUHJldmlldyc6XHJcbiAgICAgICAgICAgIHRoaXMucHJpbnRBc1BvcHVwKG1lc3NhZ2UuZGF0YSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgJ1ByaW50V2l0aG91dFByZXZpZXcnOlxyXG4gICAgICAgICAgICB0aGlzLnByaW50QXNIdG1sKG1lc3NhZ2UuZGF0YSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwb3N0UHJpbnQocHJpbnRBY3Rpb246IHN0cmluZykge1xyXG4gICAgaWYgKHByaW50QWN0aW9uID09PSAnUHJpbnRQZGYnICYmIC9pUGhvbmV8aVBhZHxpUG9kfE1hY2ludG9zaC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgdGhpcy5oZWxwZXIuaXNUb3VjaERldmljZSgpKSB7XHJcbiAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5leHBvcnRTZXJ2aWNlLmdldERlZmF1bHRFeHBvcnRTZXR0aW5ncygnUGRmJyk7XHJcbiAgICAgIHNldHRpbmdzLk9wZW5BZnRlckV4cG9ydCA9IHRydWU7XHJcbiAgICAgIHRoaXMucG9zdEV4cG9ydCgnUGRmJywgc2V0dGluZ3MpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgYWN0aW9uOiAnUHJpbnRSZXBvcnQnLFxyXG4gICAgICBwcmludEFjdGlvbixcclxuICAgICAgYm9va21hcmtzUHJpbnQ6IHRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLmJvb2ttYXJrc1ByaW50XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHVybCA9ICcnOyAvLyB0aGlzLm1vZGVsLm9wdGlvbnMucmVxdWVzdFVybC5yZXBsYWNlKCd7YWN0aW9ufScsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLnByaW50UmVwb3J0KTtcclxuICAgIHN3aXRjaCAocHJpbnRBY3Rpb24pIHtcclxuICAgICAgY2FzZSAnUHJpbnRQZGYnOlxyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5wcmludFRvUGRmTW9kZSA9PT0gJ1BvcHVwJyB8fCB0aGlzLmhlbHBlci5nZXROYXZpZ2F0b3JOYW1lKCkgPT0gJ1NhZmFyaScgfHwgdGhpcy5oZWxwZXIuZ2V0TmF2aWdhdG9yTmFtZSgpID09ICdpUGFkJykge1xyXG4gICAgICAgICAgdGhpcy5wcmludEFzUGRmUG9wdXAoZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucHJpbnRBc1BkZih1cmwsIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLnBvc3QoJ1ByaW50UmVwb3J0JywgdGhpcy5tb2RlbC5vcHRpb25zLmFjdGlvbnMucHJpbnRSZXBvcnQsIGRhdGEsICd0ZXh0JywgcHJpbnRBY3Rpb24pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RFeHBvcnQoZm9ybWF0OiBzdHJpbmcsIHNldHRpbmdzOiBhbnksIGVsZW1lbnROYW1lPzogc3RyaW5nLCBpc0Rhc2hib2FyZEV4cG9ydD86IGJvb2xlYW4pIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGFjdGlvbjogaXNEYXNoYm9hcmRFeHBvcnQgPyAnRXhwb3J0RGFzaGJvYXJkJyA6ICdFeHBvcnRSZXBvcnQnLFxyXG4gICAgICBleHBvcnRGb3JtYXQ6IGZvcm1hdCxcclxuICAgICAgZXhwb3J0U2V0dGluZ3M6IHNldHRpbmdzLFxyXG4gICAgICBlbGVtZW50TmFtZVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkb2MgPSBzZXR0aW5ncyAmJiBzZXR0aW5ncy5PcGVuQWZ0ZXJFeHBvcnQgJiYgdGhpcy5tb2RlbC5vcHRpb25zLmFwcGVhcmFuY2Uub3BlbkV4cG9ydGVkUmVwb3J0V2luZG93ID09PSAnX2JsYW5rJyA/IHRoaXMuaGVscGVyLm9wZW5OZXdXaW5kb3coJ2Fib3V0OmJsYW5rJywgJ19ibGFuaycpLmRvY3VtZW50IDogbnVsbDtcclxuICAgIGNvbnN0IHVybCA9IHRoaXMubW9kZWwucmVxdWVzdFVybDtcclxuICAgIHRoaXMuaHR0cENsaWVudC5wb3N0Rm9ybSh1cmwucmVwbGFjZSgne2FjdGlvbn0nLCB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy5leHBvcnRSZXBvcnQpLCBkYXRhLCBkb2MpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHByaW50QXNQZGZQb3B1cChkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IHVybCA9IHRoaXMubW9kZWwucmVxdWVzdFVybC5yZXBsYWNlKCd7YWN0aW9ufScsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLnByaW50UmVwb3J0KTtcclxuICAgIGNvbnN0IHdpbiA9IHRoaXMuaGVscGVyLm9wZW5OZXdXaW5kb3coJ2Fib3V0OmJsYW5rJywgJ19ibGFuaycpO1xyXG4gICAgaWYgKHdpbiAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuaHR0cENsaWVudC5wb3N0Rm9ybSh1cmwsIGRhdGEsIHdpbi5kb2N1bWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcHJpbnRBc1BkZih1cmw6IHN0cmluZywgZGF0YTogYW55KSB7XHJcbiAgICBkYXRhLnJlc3BvbnNlVHlwZSA9ICdibG9iJztcclxuICAgIGNvbnN0IHZpZXdlciA9IHRoaXMubW9kZWwuY29udHJvbHMudmlld2VyLmVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICBjb25zdCBwcmludEZyYW1lSWQgPSB0aGlzLm1vZGVsLm9wdGlvbnMudmlld2VySWQgKyAnX1BkZlByaW50RnJhbWUnO1xyXG4gICAgbGV0IHByaW50RnJhbWU6IGFueSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByaW50RnJhbWVJZCk7XHJcbiAgICBpZiAocHJpbnRGcmFtZSkgeyB2aWV3ZXIucmVtb3ZlQ2hpbGQocHJpbnRGcmFtZSk7IH1cclxuXHJcbiAgICBwcmludEZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XHJcbiAgICBwcmludEZyYW1lLmlkID0gcHJpbnRGcmFtZUlkO1xyXG4gICAgcHJpbnRGcmFtZS5uYW1lID0gcHJpbnRGcmFtZUlkO1xyXG4gICAgcHJpbnRGcmFtZS53aWR0aCA9ICcwJztcclxuICAgIHByaW50RnJhbWUuaGVpZ2h0ID0gJzAnO1xyXG4gICAgcHJpbnRGcmFtZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICBwcmludEZyYW1lLnN0eWxlLmJvcmRlciA9ICdub25lJztcclxuXHJcbiAgICAvLyBGaXJlZm94IGRvZXMgbm90IGxvYWQgdGhlIGludmlzaWJsZSBjb250ZW50IG9mIHRoZSBpZnJhbWVcclxuICAgIGlmICh0aGlzLmhlbHBlci5nZXROYXZpZ2F0b3JOYW1lKCkgPT09ICdNb3ppbGxhJykge1xyXG4gICAgICBwcmludEZyYW1lLndpZHRoID0gJzEwMHB4JztcclxuICAgICAgcHJpbnRGcmFtZS5oZWlnaHQgPSAnMTAwcHgnO1xyXG4gICAgICBwcmludEZyYW1lLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgcHJpbnRGcmFtZS5zdHlsZS56SW5kZXggPSAnLTEwMCc7XHJcbiAgICAgIHByaW50RnJhbWUuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcclxuICAgIH1cclxuXHJcbiAgICB2aWV3ZXIuaW5zZXJ0QmVmb3JlKHByaW50RnJhbWUsIHZpZXdlci5maXJzdENoaWxkKTtcclxuXHJcbiAgICAvLyBNYW51YWwgcHJpbnRpbmcgaW4gYnJvd3NlcnMgdGhhdCBkbyBub3Qgc3VwcG9ydCBhdXRvbWF0aWMgUERGIHByaW50aW5nXHJcbiAgICBpZiAodGhpcy5oZWxwZXIuZ2V0TmF2aWdhdG9yTmFtZSgpICE9PSAnTW96aWxsYScpIHtcclxuICAgICAgcHJpbnRGcmFtZS5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgcHJpbnRGcmFtZS5jb250ZW50V2luZG93LmZvY3VzKCk7XHJcbiAgICAgICAgcHJpbnRGcmFtZS5jb250ZW50V2luZG93LnByaW50KCk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZm9ybTogYW55ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRk9STScpO1xyXG4gICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3ByaW50Rm9ybScpO1xyXG4gICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ21ldGhvZCcsICdQT1NUJyk7XHJcbiAgICBmb3JtLnNldEF0dHJpYnV0ZSgnYWN0aW9uJywgdGhpcy5tb2RlbC5yZXF1ZXN0VXJsLnJlcGxhY2UoJ3thY3Rpb259JywgdGhpcy5tb2RlbC5vcHRpb25zLmFjdGlvbnMucHJpbnRSZXBvcnQpKTtcclxuICAgIGZvcm0uc2V0QXR0cmlidXRlKCd0YXJnZXQnLCB0aGlzLm1vZGVsLm9wdGlvbnMudmlld2VySWQgKyAnX1BkZlByaW50RnJhbWUnKTtcclxuXHJcbiAgICBjb25zdCBwYXJhbXMgPSB0aGlzLm1vZGVsLmNyZWF0ZVBvc3RQYXJhbWV0ZXJzKGRhdGEsIHRydWUpO1xyXG4gICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmFtc0ZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnSU5QVVQnKTtcclxuICAgICAgcGFyYW1zRmllbGQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpO1xyXG4gICAgICBwYXJhbXNGaWVsZC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCBrZXkpO1xyXG4gICAgICBwYXJhbXNGaWVsZC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgcGFyYW1zW2tleV0pO1xyXG4gICAgICBmb3JtLmFwcGVuZENoaWxkKHBhcmFtc0ZpZWxkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZm9ybSk7XHJcbiAgICBmb3JtLnN1Ym1pdCgpO1xyXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmb3JtKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwcmludEFzUG9wdXAodGV4dDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VzV2lkdGggfHwgNzkwO1xyXG4gICAgY29uc3Qgd2luID0gdGhpcy5oZWxwZXIub3Blbk5ld1dpbmRvdygnYWJvdXQ6YmxhbmsnLCAnUHJpbnRSZXBvcnQnLCAnaGVpZ2h0PTkwMCx3aWR0aD0nICsgd2lkdGggKyAnLHRvb2xiYXI9bm8sbWVudWJhcj15ZXMsc2Nyb2xsYmFycz15ZXMscmVzaXphYmxlPXllcyxsb2NhdGlvbj1ubyxkaXJlY3Rvcmllcz1ubyxzdGF0dXM9bm8nKTtcclxuICAgIGlmICh3aW4gIT0gbnVsbCkge1xyXG4gICAgICB3aW4uZG9jdW1lbnQub3BlbigpO1xyXG4gICAgICB3aW4uZG9jdW1lbnQud3JpdGUodGV4dCk7XHJcbiAgICAgIHdpbi5kb2N1bWVudC5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHByaW50QXNIdG1sKHRleHQ6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuY29udHJvbGxlci5zaG93RXJyb3IodGV4dCkpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgY29uc3Qgdmlld2VyID0gdGhpcy5tb2RlbC5jb250cm9scy52aWV3ZXIuZWwubmF0aXZlRWxlbWVudDtcclxuICAgIC8vIFJlbW92ZSAnX1BkZlByaW50RnJhbWUnLCB0aGlzIHNob3VsZCBmaXggSUUgc3RyYW5nZSBlcnJvclxyXG4gICAgbGV0IHByaW50RnJhbWVJZCA9IHRoaXMubW9kZWwub3B0aW9ucy52aWV3ZXJJZCArICdfUGRmUHJpbnRGcmFtZSc7XHJcbiAgICBsZXQgcHJpbnRGcmFtZTogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJpbnRGcmFtZUlkKTtcclxuICAgIGlmIChwcmludEZyYW1lKSB7IHZpZXdlci5yZW1vdmVDaGlsZChwcmludEZyYW1lKTsgfVxyXG5cclxuICAgIHByaW50RnJhbWVJZCA9IHRoaXMubW9kZWwub3B0aW9ucy52aWV3ZXJJZCArICdfSHRtbFByaW50RnJhbWUnO1xyXG4gICAgcHJpbnRGcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByaW50RnJhbWVJZCk7XHJcbiAgICBpZiAocHJpbnRGcmFtZSkgeyB2aWV3ZXIucmVtb3ZlQ2hpbGQocHJpbnRGcmFtZSk7IH1cclxuXHJcbiAgICBwcmludEZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XHJcbiAgICBwcmludEZyYW1lLmlkID0gcHJpbnRGcmFtZUlkO1xyXG4gICAgcHJpbnRGcmFtZS5uYW1lID0gcHJpbnRGcmFtZUlkO1xyXG4gICAgcHJpbnRGcmFtZS53aWR0aCA9ICcwJztcclxuICAgIHByaW50RnJhbWUuaGVpZ2h0ID0gJzAnO1xyXG4gICAgcHJpbnRGcmFtZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICBwcmludEZyYW1lLnN0eWxlLmJvcmRlciA9ICdub25lJztcclxuICAgIHZpZXdlci5pbnNlcnRCZWZvcmUocHJpbnRGcmFtZSwgdmlld2VyLmZpcnN0Q2hpbGQpO1xyXG5cclxuICAgIHByaW50RnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudC5vcGVuKCk7XHJcbiAgICBwcmludEZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQud3JpdGUodGV4dCk7XHJcbiAgICBwcmludEZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuY2xvc2UoKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBwcmludEZyYW1lLmNvbnRlbnRXaW5kb3cuZm9jdXMoKTtcclxuICAgICAgcHJpbnRGcmFtZS5jb250ZW50V2luZG93LnByaW50KCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19