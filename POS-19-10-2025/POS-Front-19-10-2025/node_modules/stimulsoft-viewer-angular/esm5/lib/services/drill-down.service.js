import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ControllerService } from './controller.service';
import { ModelService } from './model.service';
import { HelperService } from './helper.service';
var DrillDownService = /** @class */ (function () {
    function DrillDownService(controller, model, helper) {
        var _this = this;
        this.controller = controller;
        this.model = model;
        this.helper = helper;
        controller.getMessage().subscribe(function (message) {
            if (message.action !== 'InitVars' && message.action !== 'viewer_loaded') {
                _this.model.options.drillDownInProgress = false;
                var parameters = message.data;
                if (_this.model.drillDownButtons.length === 0) {
                    _this.addButton(parameters.reportFileName, {});
                }
                if (message.action === 'DrillDown') {
                    var useDbsDrillDownPanel = false; // jsObject.controls.dashboardsPanel && jsObject.controls.dashboardsPanel.visible && jsObject.controls.dashboardsPanel.selectedButton;
                    if (useDbsDrillDownPanel) {
                        // jsObject.controls.dashboardsPanel.addDrillDownButton(null, parameters.drillDownGuid, parameters.drillDownParameters, parameters.previewSettings, parameters.reportFileName);
                    }
                    _this.showDrillDownPage(parameters.reportFileName, parameters.drillDownGuid, parameters.drillDownParameters, useDbsDrillDownPanel);
                }
            }
        });
    }
    DrillDownService.prototype.showDrillDownPage = function (reportFileName, drillDownGuid, drillDownParameters, useDbsDrillDownPanel) {
        var _this = this;
        if (useDbsDrillDownPanel) {
            return;
        }
        var buttonExist = false;
        this.model.drillDownButtons.forEach(function (b) {
            if (b.reportParams.drillDownGuid === drillDownGuid) {
                _this.model.drillDownButtons.forEach(function (bt) { return bt.selected = false; });
                buttonExist = b.selected = b.visible = true;
            }
        });
        if (!buttonExist) {
            this.addButton(reportFileName);
            this.model.reportParams.drillDownParameters = drillDownParameters;
            this.model.reportParams.pageNumber = 0;
            this.model.reportParams.pagesWidth = 0;
            this.model.reportParams.pagesHeight = 0;
        }
    };
    DrillDownService.prototype.addButton = function (caption, reportParams) {
        if (reportParams === void 0) { reportParams = {}; }
        this.model.drillDownButtons.forEach(function (b) { return b.selected = false; });
        this.model.drillDownButtons.push({ caption: caption, selected: true, reportParams: reportParams, visible: true });
        this.updateVisibility();
    };
    DrillDownService.prototype.updateVisibility = function () {
        this.model.controls.drillDownPanel.visible = this.model.drillDownButtons.length > 1;
    };
    DrillDownService.prototype.saveState = function () {
        var sButton = this.model.drillDownButtons.find(function (b) { return b.selected; });
        if (sButton) {
            sButton.reportParams = this.model.getReportParams();
        }
    };
    DrillDownService.ctorParameters = function () { return [
        { type: ControllerService },
        { type: ModelService },
        { type: HelperService }
    ]; };
    DrillDownService = __decorate([
        Injectable()
    ], DrillDownService);
    return DrillDownService;
}());
export { DrillDownService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJpbGwtZG93bi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9kcmlsbC1kb3duLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUdqRDtJQUVFLDBCQUFtQixVQUE2QixFQUFTLEtBQW1CLEVBQVMsTUFBcUI7UUFBMUcsaUJBb0JDO1FBcEJrQixlQUFVLEdBQVYsVUFBVSxDQUFtQjtRQUFTLFVBQUssR0FBTCxLQUFLLENBQWM7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3hHLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBQyxPQUFnQjtZQUNqRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssVUFBVSxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssZUFBZSxFQUFFO2dCQUN2RSxLQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7Z0JBQy9DLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBRWhDLElBQUksS0FBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO29CQUM1QyxLQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQy9DO2dCQUVELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxXQUFXLEVBQUU7b0JBQ2xDLElBQU0sb0JBQW9CLEdBQUcsS0FBSyxD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LHVCQUFDO0NBQUEsQUE3REQsSUE2REM7U0E3RFksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEcmlsbERvd24sIE1lc3NhZ2UgfSBmcm9tICcuL29iamVjdHMnO1xyXG5pbXBvcnQgeyBDb250cm9sbGVyU2VydmljZSB9IGZyb20gJy4vY29udHJvbGxlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi9tb2RlbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4vaGVscGVyLnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRHJpbGxEb3duU2VydmljZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb250cm9sbGVyOiBDb250cm9sbGVyU2VydmljZSwgcHVibGljIG1vZGVsOiBNb2RlbFNlcnZpY2UsIHB1YmxpYyBoZWxwZXI6IEhlbHBlclNlcnZpY2UpIHtcclxuICAgIGNvbnRyb2xsZXIuZ2V0TWVzc2FnZSgpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZS5hY3Rpb24gIT09ICdJbml0VmFycycgJiYgbWVzc2FnZS5hY3Rpb24gIT09ICd2aWV3ZXJfbG9hZGVkJykge1xyXG4gICAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5kcmlsbERvd25JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG1lc3NhZ2UuZGF0YTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuYWRkQnV0dG9uKHBhcmFtZXRlcnMucmVwb3J0RmlsZU5hbWUsIHt9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ0RyaWxsRG93bicpIHtcclxuICAgICAgICAgIGNvbnN0IHVzZURic0RyaWxsRG93blBhbmVsID0gZmFsc2U7IC8vIGpzT2JqZWN0LmNvbnRyb2xzLmRhc2hib2FyZHNQYW5lbCAmJiBqc09iamVjdC5jb250cm9scy5kYXNoYm9hcmRzUGFuZWwudmlzaWJsZSAmJiBqc09iamVjdC5jb250cm9scy5kYXNoYm9hcmRzUGFuZWwuc2VsZWN0ZWRCdXR0b247XHJcbiAgICAgICAgICBpZiAodXNlRGJzRHJpbGxEb3duUGFuZWwpIHtcclxuICAgICAgICAgICAgLy8ganNPYmplY3QuY29udHJvbHMuZGFzaGJvYXJkc1BhbmVsLmFkZERyaWxsRG93bkJ1dHRvbihudWxsLCBwYXJhbWV0ZXJzLmRyaWxsRG93bkd1aWQsIHBhcmFtZXRlcnMuZHJpbGxEb3duUGFyYW1ldGVycywgcGFyYW1ldGVycy5wcmV2aWV3U2V0dGluZ3MsIHBhcmFtZXRlcnMucmVwb3J0RmlsZU5hbWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5zaG93RHJpbGxEb3duUGFnZShwYXJhbWV0ZXJzLnJlcG9ydEZpbGVOYW1lLCBwYXJhbWV0ZXJzLmRyaWxsRG93bkd1aWQsIHBhcmFtZXRlcnMuZHJpbGxEb3duUGFyYW1ldGVycywgdXNlRGJzRHJpbGxEb3duUGFuZWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG93RHJpbGxEb3duUGFnZShyZXBvcnRGaWxlTmFtZTogc3RyaW5nLCBkcmlsbERvd25HdWlkOiBzdHJpbmcsIGRyaWxsRG93blBhcmFtZXRlcnM6IGFueSwgdXNlRGJzRHJpbGxEb3duUGFuZWw6IGJvb2xlYW4pIHtcclxuICAgIGlmICh1c2VEYnNEcmlsbERvd25QYW5lbCkgeyByZXR1cm47IH1cclxuXHJcbiAgICBsZXQgYnV0dG9uRXhpc3QgPSBmYWxzZTtcclxuICAgIHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5mb3JFYWNoKChiOiBEcmlsbERvd24pID0+IHtcclxuICAgICAgaWYgKGIucmVwb3J0UGFyYW1zLmRyaWxsRG93bkd1aWQgPT09IGRyaWxsRG93bkd1aWQpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLmRyaWxsRG93bkJ1dHRvbnMuZm9yRWFjaChidCA9PiBidC5zZWxlY3RlZCA9IGZhbHNlKTtcclxuICAgICAgICBidXR0b25FeGlzdCA9IGIuc2VsZWN0ZWQgPSBiLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIWJ1dHRvbkV4aXN0KSB7XHJcbiAgICAgIHRoaXMuYWRkQnV0dG9uKHJlcG9ydEZpbGVOYW1lKTtcclxuICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuZHJpbGxEb3duUGFyYW1ldGVycyA9IGRyaWxsRG93blBhcmFtZXRlcnM7XHJcbiAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSAwO1xyXG4gICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc1dpZHRoID0gMDtcclxuICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZXNIZWlnaHQgPSAwO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZEJ1dHRvbihjYXB0aW9uOiBzdHJpbmcsIHJlcG9ydFBhcmFtczogYW55ID0ge30pIHtcclxuICAgIHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5mb3JFYWNoKGIgPT4gYi5zZWxlY3RlZCA9IGZhbHNlKTtcclxuICAgIHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5wdXNoKHsgY2FwdGlvbiwgc2VsZWN0ZWQ6IHRydWUsIHJlcG9ydFBhcmFtcywgdmlzaWJsZTogdHJ1ZSB9KTtcclxuICAgIHRoaXMudXBkYXRlVmlzaWJpbGl0eSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZVZpc2liaWxpdHkoKSB7XHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLmRyaWxsRG93blBhbmVsLnZpc2libGUgPSB0aGlzLm1vZGVsLmRyaWxsRG93bkJ1dHRvbnMubGVuZ3RoID4gMTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzYXZlU3RhdGUoKSB7XHJcbiAgICBjb25zdCBzQnV0dG9uID0gdGhpcy5tb2RlbC5kcmlsbERvd25CdXR0b25zLmZpbmQoYiA9PiBiLnNlbGVjdGVkKTtcclxuICAgIGlmIChzQnV0dG9uKSB7XHJcbiAgICAgIHNCdXR0b24ucmVwb3J0UGFyYW1zID0gdGhpcy5tb2RlbC5nZXRSZXBvcnRQYXJhbXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==