import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ModelService } from './model.service';
import { ExportService } from './export.service';
import { FormService } from '../forms/form.service';
import { ControllerService } from './controller.service';
var MailService = /** @class */ (function () {
    function MailService(model, exportService, formService, controller) {
        var _this = this;
        this.model = model;
        this.exportService = exportService;
        this.formService = formService;
        this.controller = controller;
        exportService.getMessage().subscribe(function (event) {
            if (event === 'postMail') {
                _this.postMail();
            }
        });
    }
    MailService.prototype.postMail = function () {
        this.fillDefaults();
        if (this.model.options.email.showEmailDialog) {
            this.formService.showForm('sendEmailForm');
        }
        else {
            this.sendMail();
        }
    };
    MailService.prototype.sendMail = function () {
        var data = {
            exportFormat: this.exportService.format,
            exportSettings: this.exportService.exportSettings
        };
        this.formService.closeForm('sendEmailForm');
        this.controller.post('EmailReport', this.model.options.actions.emailReport, data);
        this.controller.actionSubject.next({ action: 'Email', data: data });
    };
    MailService.prototype.fillDefaults = function () {
        this.exportService.exportSettings.Email = this.model.options.email.defaultEmailAddress;
        this.exportService.exportSettings.Message = this.model.options.email.defaultEmailMessage;
        this.exportService.exportSettings.Subject = this.model.options.email.defaultEmailSubject;
        var ext = this.exportService.format.toLowerCase().replace('image', '');
        switch (ext) {
            case 'excel':
                ext = 'xls';
                break;
            case 'excel2007':
                ext = 'xlsx';
                break;
            case 'excelxml':
                ext = 'xls';
                break;
            case 'html5':
                ext = 'html';
                break;
            case 'jpeg':
                ext = 'jpg';
                break;
            case 'ppt2007':
                ext = 'ppt';
                break;
            case 'text':
                ext = 'txt';
                break;
            case 'word2007':
                ext = 'docx';
                break;
        }
        this.exportService.exportSettings.Attachment = this.model.reportParams.reportFileName + '.' + ext;
    };
    MailService.ctorParameters = function () { return [
        { type: ModelService },
        { type: ExportService },
        { type: FormService },
        { type: ControllerService }
    ]; };
    MailService = __decorate([
        Injectable()
    ], MailService);
    return MailService;
}());
export { MailService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9tYWlsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHekQ7SUFFRSxxQkFBbUIsS0FBbUIsRUFBUyxhQUE0QixFQUFTLFdBQXdCLEVBQVMsVUFBNkI7UUFBbEosaUJBTUM7UUFOa0IsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUFTLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVMsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFtQjtRQUNoSixhQUFhLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQUEsS0FBSztZQUN4QyxJQUFJLEtBQUssS0FBSyxVQUFVLEVBQUU7Z0JBQ3hCLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNqQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLDhCQUFRLEdBQWY7UUFDRSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFcEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFO1lBQzVDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQzVDO2FBQU07WUFDTCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDakI7SUFDSCxDQUFDO0lBRU0sOEJBQVEsR0FBZjtRQUNFLElBQU0sSUFBSSxHQUFHO1lBQ1gsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTTtZQUN2QyxjQUFjLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjO1NBQ2xELENBQUM7UUFFRixJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksTUFBQSxFQUFFLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRU0sa0NBQVksR0FBbkI7UUFDRSxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDO1FBQ3ZGLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7UUFDekYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQztRQUV6RixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPO2dCQUFFLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQUMsTUFBTTtZQUNqQyxLQUFLLFdBQVc7Z0JBQUUsR0FBRyxHQUFHLE1BQU0sQ0FBQztnQkFBQyxNQUFNO1lBQ3RDLEtBQUssVUFBVTtnQkFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDO2dCQUFDLE1BQU07WUFDcEMsS0FBSyxPQUFPO2dCQUFFLEdBQUcsR0FBRyxNQUFNLENBQUM7Z0JBQUMsTUFBTTtZQUNsQyxLQUFLLE1BQU07Z0JBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQztnQkFBQyxNQUFNO1lBQ2hDLEtBQUssU0FBUztnQkFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDO2dCQUFDLE1BQU07WUFDbkMsS0FBSyxNQUFNO2dCQUFFLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQUMsTUFBTTtZQUNoQyxLQUFLLFVBQVU7Z0JBQUUsR0FBRyxHQUFHLE1BQU0sQ0FBQztnQkFBQyxNQUFNO1NBQ3RDO1FBRUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLGNBQWMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ3BHLENBQUM7O2dCQS9DeUIsWUFBWTtnQkFBd0IsYUFBYTtnQkFBc0IsV0FBVztnQkFBcUIsaUJBQWlCOztJQUZ2SSxXQUFXO1FBRHZCLFVBQVUsRUFBRTtPQUNBLFdBQVcsQ0FtRHZCO0lBQUQsa0JBQUM7Q0FBQSxBQW5ERCxJQW1EQztTQW5EWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBFeHBvcnRTZXJ2aWNlIH0gZnJvbSAnLi9leHBvcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IEZvcm1TZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybXMvZm9ybS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29udHJvbGxlclNlcnZpY2UgfSBmcm9tICcuL2NvbnRyb2xsZXIuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBNYWlsU2VydmljZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtb2RlbDogTW9kZWxTZXJ2aWNlLCBwdWJsaWMgZXhwb3J0U2VydmljZTogRXhwb3J0U2VydmljZSwgcHVibGljIGZvcm1TZXJ2aWNlOiBGb3JtU2VydmljZSwgcHVibGljIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlKSB7XHJcbiAgICBleHBvcnRTZXJ2aWNlLmdldE1lc3NhZ2UoKS5zdWJzY3JpYmUoZXZlbnQgPT4ge1xyXG4gICAgICBpZiAoZXZlbnQgPT09ICdwb3N0TWFpbCcpIHtcclxuICAgICAgICB0aGlzLnBvc3RNYWlsKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RNYWlsKCkge1xyXG4gICAgdGhpcy5maWxsRGVmYXVsdHMoKTtcclxuXHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmVtYWlsLnNob3dFbWFpbERpYWxvZykge1xyXG4gICAgICB0aGlzLmZvcm1TZXJ2aWNlLnNob3dGb3JtKCdzZW5kRW1haWxGb3JtJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNlbmRNYWlsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VuZE1haWwoKSB7XHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICBleHBvcnRGb3JtYXQ6IHRoaXMuZXhwb3J0U2VydmljZS5mb3JtYXQsXHJcbiAgICAgIGV4cG9ydFNldHRpbmdzOiB0aGlzLmV4cG9ydFNlcnZpY2UuZXhwb3J0U2V0dGluZ3NcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5mb3JtU2VydmljZS5jbG9zZUZvcm0oJ3NlbmRFbWFpbEZvcm0nKTtcclxuICAgIHRoaXMuY29udHJvbGxlci5wb3N0KCdFbWFpbFJlcG9ydCcsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLmVtYWlsUmVwb3J0LCBkYXRhKTtcclxuICAgIHRoaXMuY29udHJvbGxlci5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdFbWFpbCcsIGRhdGEgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmlsbERlZmF1bHRzKCkge1xyXG4gICAgdGhpcy5leHBvcnRTZXJ2aWNlLmV4cG9ydFNldHRpbmdzLkVtYWlsID0gdGhpcy5tb2RlbC5vcHRpb25zLmVtYWlsLmRlZmF1bHRFbWFpbEFkZHJlc3M7XHJcbiAgICB0aGlzLmV4cG9ydFNlcnZpY2UuZXhwb3J0U2V0dGluZ3MuTWVzc2FnZSA9IHRoaXMubW9kZWwub3B0aW9ucy5lbWFpbC5kZWZhdWx0RW1haWxNZXNzYWdlO1xyXG4gICAgdGhpcy5leHBvcnRTZXJ2aWNlLmV4cG9ydFNldHRpbmdzLlN1YmplY3QgPSB0aGlzLm1vZGVsLm9wdGlvbnMuZW1haWwuZGVmYXVsdEVtYWlsU3ViamVjdDtcclxuXHJcbiAgICBsZXQgZXh0ID0gdGhpcy5leHBvcnRTZXJ2aWNlLmZvcm1hdC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ2ltYWdlJywgJycpO1xyXG4gICAgc3dpdGNoIChleHQpIHtcclxuICAgICAgY2FzZSAnZXhjZWwnOiBleHQgPSAneGxzJzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2V4Y2VsMjAwNyc6IGV4dCA9ICd4bHN4JzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2V4Y2VseG1sJzogZXh0ID0gJ3hscyc7IGJyZWFrO1xyXG4gICAgICBjYXNlICdodG1sNSc6IGV4dCA9ICdodG1sJzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2pwZWcnOiBleHQgPSAnanBnJzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3BwdDIwMDcnOiBleHQgPSAncHB0JzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3RleHQnOiBleHQgPSAndHh0JzsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3dvcmQyMDA3JzogZXh0ID0gJ2RvY3gnOyBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmV4cG9ydFNlcnZpY2UuZXhwb3J0U2V0dGluZ3MuQXR0YWNobWVudCA9IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnJlcG9ydEZpbGVOYW1lICsgJy4nICsgZXh0O1xyXG4gIH1cclxuXHJcbn1cclxuIl19