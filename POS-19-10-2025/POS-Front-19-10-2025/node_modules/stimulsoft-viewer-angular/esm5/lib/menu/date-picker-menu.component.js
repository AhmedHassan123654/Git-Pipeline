import { __decorate } from "tslib";
import { Component, Input } from '@angular/core';
import { ModelService } from '../services/model.service';
import { HelperService } from '../services/helper.service';
var DatePickerMenuComponent = /** @class */ (function () {
    function DatePickerMenuComponent(model, helper) {
        var _this = this;
        this.model = model;
        this.helper = helper;
        this.keyTo = false;
        this.closeOnAction = true;
        this.monthesForDatePickerItems = [];
        this.cols = [0, 1, 2, 3, 4, 5, 6];
        this.rows = [0, 1, 2, 3, 4, 5];
        this.model.months.forEach(function (m, i) { return _this.monthesForDatePickerItems.push({ name: 'Month' + i, caption: _this.model.loc('Month' + m), key: i }); });
        var firstLetters = {};
        this.model.dayOfWeek.forEach(function (d) {
            var dayName = _this.model.loc('Day' + d);
            firstLetters[dayName.toString().substring(0, 1).toUpperCase()] = true;
        });
        this.countLetters = Object.keys(firstLetters).length < 5 ? 2 : 1;
    }
    DatePickerMenuComponent.prototype.ngOnInit = function () { };
    DatePickerMenuComponent.prototype.getButtonSelected = function (col, row) {
        var firstDay = this.getFirstDay();
        var curDay = row * 7 + col;
        var day = curDay - firstDay + 1;
        return day === this.key.day;
    };
    DatePickerMenuComponent.prototype.getButtonCaption = function (col, row) {
        var firstDay = this.getFirstDay();
        var daysInMonth = this.helper.getCountDaysOfMonth(this.key.year, this.key.month - 1);
        var curDay = row * 7 + col;
        var day = curDay - firstDay + 1;
        if (curDay >= firstDay && day <= daysInMonth) {
            return day.toString();
        }
        return '';
    };
    DatePickerMenuComponent.prototype.getTime = function () {
        return this.helper.formatDate(this.helper.getDate(this.key), 'H:mm:ss');
    };
    DatePickerMenuComponent.prototype.getFirstDay = function () {
        var firstDay = new Date(this.key.year, this.key.month - 1, 1).getDay();
        if (firstDay === 0) {
            firstDay = 7;
        }
        if (this.model.options.appearance.datePickerFirstDayOfWeek !== 'Sunday') {
            firstDay--;
        }
        return firstDay;
    };
    Object.defineProperty(DatePickerMenuComponent.prototype, "showTime", {
        get: function () {
            var _a, _b;
            return ((_b = (_a = this.menu) === null || _a === void 0 ? void 0 : _a.params) === null || _b === void 0 ? void 0 : _b.dateTimeType) !== 'Date';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatePickerMenuComponent.prototype, "key", {
        get: function () {
            return this.keyTo ? this.menu.params.keyTo : this.menu.params.key;
        },
        enumerable: true,
        configurable: true
    });
    DatePickerMenuComponent.prototype.yearAction = function (input) {
        try {
            this.key.year = parseInt(input.value, 10);
        }
        catch (_a) { }
    };
    DatePickerMenuComponent.prototype.timeAction = function (input) {
        var time = this.helper.stringToTime(input.value);
        this.key.seconds = time.seconds;
        this.key.minutes = time.minutes;
        this.key.hours = time.hours;
    };
    DatePickerMenuComponent.prototype.getShortDayName = function (index) {
        var dayName = this.model.loc('Day' + this.model.dayOfWeek[index]);
        if (dayName) {
            return dayName.toString().substring(0, this.countLetters <= dayName.length ? this.countLetters : 1).toUpperCase();
        }
        return '';
    };
    DatePickerMenuComponent.prototype.getShortDayColor = function (index) {
        if (index === (this.model.options.appearance.datePickerFirstDayOfWeek === 'Sunday' ? 6 : 5)) {
            return '#0000ff';
        }
        if (index === (this.model.options.appearance.datePickerFirstDayOfWeek === 'Sunday' ? 0 : 6)) {
            return '#ff0000';
        }
        return '';
    };
    DatePickerMenuComponent.prototype.prevMonthButtonAction = function () {
        var month = this.key.month;
        var year = this.key.year;
        month--;
        if (month === 0) {
            month = 12;
            year--;
        }
        var countDaysInMonth = this.helper.getCountDaysOfMonth(year, month - 1);
        if (countDaysInMonth < this.key.day) {
            this.key.day = countDaysInMonth;
        }
        this.key.month = month;
        this.key.year = year;
    };
    DatePickerMenuComponent.prototype.nextMonthButtonAction = function () {
        var month = this.key.month;
        var year = this.key.year;
        month++;
        if (month === 13) {
            month = 1;
            year++;
        }
        var countDaysInMonth = this.helper.getCountDaysOfMonth(year, month - 1);
        if (countDaysInMonth < this.key.day) {
            this.key.day = countDaysInMonth;
        }
        this.key.month = month;
        this.key.year = year;
    };
    DatePickerMenuComponent.ctorParameters = function () { return [
        { type: ModelService },
        { type: HelperService }
    ]; };
    __decorate([
        Input()
    ], DatePickerMenuComponent.prototype, "menu", void 0);
    __decorate([
        Input()
    ], DatePickerMenuComponent.prototype, "keyTo", void 0);
    __decorate([
        Input()
    ], DatePickerMenuComponent.prototype, "closeOnAction", void 0);
    DatePickerMenuComponent = __decorate([
        Component({
            selector: 'sti-date-picker-menu',
            template: "\n        <table class=\"stiJsViewerClearAllStyles\" cellpadding=\"0\" cellspacing=\"0\">\n          <tbody>\n            <tr class=\"stiJsViewerClearAllStyles\">\n              <td class=\"stiJsViewerClearAllStyles\">\n                <sti-button [imageName]=\"'Arrows.BigArrowLeft.png'\" [margin]=\"'1px 2px 0 1px'\" (action)=\"prevMonthButtonAction()\">\n                </sti-button>\n              </td>\n\n              <td class=\"stiJsViewerClearAllStyles\">\n                <sti-drop-down-list\n                  [width]=\"model.options.isTouchDevice ? 79 : 81\"\n                  [readOnly]=\"true\"\n                  [margin]=\"'1px 2px 0 0'\"\n                  [items]=\"monthesForDatePickerItems\"\n                  [key]=\"key.month - 1\"\n                  (action)=\"key.month = $event.key + 1\">\n                </sti-drop-down-list>\n              </td>\n\n              <td class=\"stiJsViewerClearAllStyles\">\n                <sti-text-box [width]=\"40\" [margin]=\"'1px 2px 0 0'\" [value]=\"key.year\" (action)=\"yearAction($event)\">\n                </sti-text-box>\n              </td>\n\n              <td class=\"stiJsViewerClearAllStyles\">\n                <sti-button [imageName]=\"'Arrows.BigArrowRight.png'\" [margin]=\"'1px 1px 0 0'\" (action)=\"nextMonthButtonAction()\">\n                </sti-button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n        <div class=\"stiJsViewerDatePickerSeparator\" style=\"margin: 2px 0px;\"></div>\n\n        <table class=\"stiJsViewerClearAllStyles\" cellpadding=\"0\" cellspacing=\"0\">\n          <tbody>\n            <tr class=\"stiJsViewerClearAllStyles\">\n              <td *ngFor=\"let item of model.dayOfWeek; let i = index\" class=\"stiJsViewerDatePickerDayOfWeekCell\"\n                  [style.fontSize]=\"countLetters == 2 ? '11px' : ''\"\n                  [style.color]=\"getShortDayColor(i)\">\n                  {{getShortDayName(i)}}\n              </td>\n            </tr>\n            <tr *ngFor=\"let row of rows\" class=\"stiJsViewerClearAllStyles\">\n                <td *ngFor=\"let col of cols\" class=\"stiJsViewerClearAllStyles\">\n                  <sti-date-picker-day-button\n                      [col]=\"col\"\n                      [row]=\"row\"\n                      [date]=\"key\"\n                      [selected]=\"getButtonSelected(col, row)\"\n                      [caption]=\"getButtonCaption(col, row)\"\n                      [enabled]=\"getButtonCaption(col, row) != ''\">\n                      [closeOnAction]=\"closeOnAction\"\n                  </sti-date-picker-day-button>\n                </td>\n            </tr>\n          </tbody>\n        </table>\n\n        <div *ngIf=\"showTime\" class=\"stiJsViewerDatePickerSeparator\" style=\"margin: 2px 0px;\"></div>\n        <table *ngIf=\"showTime\" class=\"stiJsViewerClearAllStyles\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:100%\">\n          <tbody>\n            <tr class=\"stiJsViewerClearAllStyles\">\n              <td class=\"stiJsViewerClearAllStyles\" style=\"padding: 0 4px 0 4px; white-space: nowrap;\">\n                {{this.model.loc('Time') + ':'}}\n              </td>\n\n              <td class=\"stiJsViewerClearAllStyles\" style=\"text-align: right;\">\n                <sti-text-box [width]=\"90\"\n                    [margin]=\"'1px 2px 2px 2px'\"\n                    [value]=\"getTime()\"\n                    (action)=\"timeAction($event)\">\n                </sti-text-box>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n  "
        })
    ], DatePickerMenuComponent);
    return DatePickerMenuComponent;
}());
export { DatePickerMenuComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXItbWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zdGltdWxzb2Z0LXZpZXdlci1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL21lbnUvZGF0ZS1waWNrZXItbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFxRjNEO0lBV0UsaUNBQW1CLEtBQW1CLEVBQVMsTUFBcUI7UUFBcEUsaUJBU0M7UUFUa0IsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUFTLFdBQU0sR0FBTixNQUFNLENBQWU7UUFSM0QsVUFBSyxHQUFHLEtBQUssQ0FBQztRQUNkLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBRXZCLDhCQUF5QixHQUFXLEVBQUUsQ0FBQztRQUV2QyxTQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3QixTQUFJLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRy9CLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxLQUFJLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sR0FBRyxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBeEcsQ0FBd0csQ0FBQyxDQUFDO1FBRTlJLElBQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFDO1lBQzdCLElBQU0sT0FBTyxHQUFHLEtBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQyxZQUFZLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDeEUsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUVELDBDQUFRLEdBQVIsY0FBYSxDQUFDO0lBRWQsbURBQWlCLEdBQWpCLFVBQWtCLEdBQVcsRUFBRSxHQUFXO1FBQ3hDLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxJQUFNLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUM3QixJQUFNLEdBQUcsR0FBRyxNQUFNLEdBQUcsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUVsQyxPQUFPLEdBQUcsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUM5QixDQUFDO0lBRUQsa0RBQWdCLEdBQWhCLFVBQWlCLEdBQVcsRUFBRSxHQUFXO1FBQ3ZDLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLElBQU0sTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQzdCLElBQU0sR0FBRyxHQUFHLE1BQU0sR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLElBQUksTUFBTSxJQUFJLFFBQVEsSUFBSSxHQUFHLElBQUksV0FBVyxFQUFFO1lBQzVDLE9BQU8sR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3ZCO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBR0QseUNBQU8sR0FBUDtRQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFRCw2Q0FBVyxHQUFYO1FBQ0UsSUFBSSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3ZFLElBQUksUUFBUSxLQUFLLENBQUMsRUFBRTtZQUNsQixRQUFRLEdBQUcsQ0FBQyxDQUFDO1NBQ2Q7UUFDRCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyx3QkFBd0IsS0FBSyxRQUFRLEVBQUU7WUFDdkUsUUFBUSxFQUFFLENBQUM7U0FDWjtRQUNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxzQkFBSSw2Q0FBUTthQUFaOztZQUNFLE9BQU8sYUFBQSxJQUFJLENBQUMsSUFBSSwwQ0FBRSxNQUFNLDBDQUFFLFlBQVksTUFBSyxNQUFNLENBQUM7UUFDcEQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSx3Q0FBRzthQUFQO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUNwRSxDQUFDOzs7T0FBQTtJQUVELDRDQUFVLEdBQVYsVUFBVyxLQUFVO1FBQ25CLElBQUk7WUFDRixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztTQUMzQztRQUFDLFdBQU0sR0FBRztJQUNiLENBQUM7SUFFRCw0Q0FBVSxHQUFWLFVBQVcsS0FBVTtRQUNuQixJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUNoQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDOUIsQ0FBQztJQUVELGlEQUFlLEdBQWYsVUFBZ0IsS0FBYTtRQUMzQixJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNwRSxJQUFJLE9BQU8sRUFBRTtZQUNYLE9BQU8sT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNuSDtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVELGtEQUFnQixHQUFoQixVQUFpQixLQUFhO1FBQzVCLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLHdCQUF3QixLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUMzRixPQUFPLFNBQVMsQ0FBQztTQUNsQjtRQUVELElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLHdCQUF3QixLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUMzRixPQUFPLFNBQVMsQ0FBQztTQUNsQjtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVELHVEQUFxQixHQUFyQjtRQUNFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQzNCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ3pCLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxLQUFLLEtBQUssQ0FBQyxFQUFFO1lBQ2YsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNYLElBQUksRUFBRSxDQUFDO1NBQ1I7UUFDRCxJQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ25DLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLGdCQUFnQixDQUFDO1NBQ2pDO1FBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUN2QixDQUFDO0lBRUQsdURBQXFCLEdBQXJCO1FBQ0UsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7UUFDM0IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDekIsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLEtBQUssS0FBSyxFQUFFLEVBQUU7WUFDaEIsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNWLElBQUksRUFBRSxDQUFDO1NBQ1I7UUFDRCxJQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ25DLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLGdCQUFnQixDQUFDO1NBQ2pDO1FBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUN2QixDQUFDOztnQkF0SHlCLFlBQVk7Z0JBQWlCLGFBQWE7O0lBVDNEO1FBQVIsS0FBSyxFQUFFO3lEQUFZO0lBQ1g7UUFBUixLQUFLLEVBQUU7MERBQWU7SUFDZDtRQUFSLEtBQUssRUFBRTtrRUFBc0I7SUFKbkIsdUJBQXVCO1FBbEZuQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsc0JBQXNCO1lBQ2hDLFFBQVEsRUFBRSxzaEhBNkVUO1NBQ0YsQ0FBQztPQUVXLHVCQUF1QixDQW9JbkM7SUFBRCw4QkFBQztDQUFBLEFBcElELElBb0lDO1NBcElZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9tb2RlbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTWVudSB9IGZyb20gJy4vbWVudS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2hlbHBlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSXRlbSwgRGF0ZVRpbWVPYmplY3QgfSBmcm9tICcuLi9zZXJ2aWNlcy9vYmplY3RzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc3RpLWRhdGUtcGlja2VyLW1lbnUnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgPHRhYmxlIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiIGNlbGxwYWRkaW5nPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiPlxyXG4gICAgICAgICAgPHRib2R5PlxyXG4gICAgICAgICAgICA8dHIgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgPHN0aS1idXR0b24gW2ltYWdlTmFtZV09XCInQXJyb3dzLkJpZ0Fycm93TGVmdC5wbmcnXCIgW21hcmdpbl09XCInMXB4IDJweCAwIDFweCdcIiAoYWN0aW9uKT1cInByZXZNb250aEJ1dHRvbkFjdGlvbigpXCI+XHJcbiAgICAgICAgICAgICAgICA8L3N0aS1idXR0b24+XHJcbiAgICAgICAgICAgICAgPC90ZD5cclxuXHJcbiAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgPHN0aS1kcm9wLWRvd24tbGlzdFxyXG4gICAgICAgICAgICAgICAgICBbd2lkdGhdPVwibW9kZWwub3B0aW9ucy5pc1RvdWNoRGV2aWNlID8gNzkgOiA4MVwiXHJcbiAgICAgICAgICAgICAgICAgIFtyZWFkT25seV09XCJ0cnVlXCJcclxuICAgICAgICAgICAgICAgICAgW21hcmdpbl09XCInMXB4IDJweCAwIDAnXCJcclxuICAgICAgICAgICAgICAgICAgW2l0ZW1zXT1cIm1vbnRoZXNGb3JEYXRlUGlja2VySXRlbXNcIlxyXG4gICAgICAgICAgICAgICAgICBba2V5XT1cImtleS5tb250aCAtIDFcIlxyXG4gICAgICAgICAgICAgICAgICAoYWN0aW9uKT1cImtleS5tb250aCA9ICRldmVudC5rZXkgKyAxXCI+XHJcbiAgICAgICAgICAgICAgICA8L3N0aS1kcm9wLWRvd24tbGlzdD5cclxuICAgICAgICAgICAgICA8L3RkPlxyXG5cclxuICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICA8c3RpLXRleHQtYm94IFt3aWR0aF09XCI0MFwiIFttYXJnaW5dPVwiJzFweCAycHggMCAwJ1wiIFt2YWx1ZV09XCJrZXkueWVhclwiIChhY3Rpb24pPVwieWVhckFjdGlvbigkZXZlbnQpXCI+XHJcbiAgICAgICAgICAgICAgICA8L3N0aS10ZXh0LWJveD5cclxuICAgICAgICAgICAgICA8L3RkPlxyXG5cclxuICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICA8c3RpLWJ1dHRvbiBbaW1hZ2VOYW1lXT1cIidBcnJvd3MuQmlnQXJyb3dSaWdodC5wbmcnXCIgW21hcmdpbl09XCInMXB4IDFweCAwIDAnXCIgKGFjdGlvbik9XCJuZXh0TW9udGhCdXR0b25BY3Rpb24oKVwiPlxyXG4gICAgICAgICAgICAgICAgPC9zdGktYnV0dG9uPlxyXG4gICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInN0aUpzVmlld2VyRGF0ZVBpY2tlclNlcGFyYXRvclwiIHN0eWxlPVwibWFyZ2luOiAycHggMHB4O1wiPjwvZGl2PlxyXG5cclxuICAgICAgICA8dGFibGUgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCI+XHJcbiAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgIDx0ciBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIj5cclxuICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGl0ZW0gb2YgbW9kZWwuZGF5T2ZXZWVrOyBsZXQgaSA9IGluZGV4XCIgY2xhc3M9XCJzdGlKc1ZpZXdlckRhdGVQaWNrZXJEYXlPZldlZWtDZWxsXCJcclxuICAgICAgICAgICAgICAgICAgW3N0eWxlLmZvbnRTaXplXT1cImNvdW50TGV0dGVycyA9PSAyID8gJzExcHgnIDogJydcIlxyXG4gICAgICAgICAgICAgICAgICBbc3R5bGUuY29sb3JdPVwiZ2V0U2hvcnREYXlDb2xvcihpKVwiPlxyXG4gICAgICAgICAgICAgICAgICB7e2dldFNob3J0RGF5TmFtZShpKX19XHJcbiAgICAgICAgICAgICAgPC90ZD5cclxuICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgPHRyICpuZ0Zvcj1cImxldCByb3cgb2Ygcm93c1wiIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgPHRkICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sc1wiIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgICA8c3RpLWRhdGUtcGlja2VyLWRheS1idXR0b25cclxuICAgICAgICAgICAgICAgICAgICAgIFtjb2xdPVwiY29sXCJcclxuICAgICAgICAgICAgICAgICAgICAgIFtyb3ddPVwicm93XCJcclxuICAgICAgICAgICAgICAgICAgICAgIFtkYXRlXT1cImtleVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICBbc2VsZWN0ZWRdPVwiZ2V0QnV0dG9uU2VsZWN0ZWQoY29sLCByb3cpXCJcclxuICAgICAgICAgICAgICAgICAgICAgIFtjYXB0aW9uXT1cImdldEJ1dHRvbkNhcHRpb24oY29sLCByb3cpXCJcclxuICAgICAgICAgICAgICAgICAgICAgIFtlbmFibGVkXT1cImdldEJ1dHRvbkNhcHRpb24oY29sLCByb3cpICE9ICcnXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICBbY2xvc2VPbkFjdGlvbl09XCJjbG9zZU9uQWN0aW9uXCJcclxuICAgICAgICAgICAgICAgICAgPC9zdGktZGF0ZS1waWNrZXItZGF5LWJ1dHRvbj5cclxuICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcblxyXG4gICAgICAgIDxkaXYgKm5nSWY9XCJzaG93VGltZVwiIGNsYXNzPVwic3RpSnNWaWV3ZXJEYXRlUGlja2VyU2VwYXJhdG9yXCIgc3R5bGU9XCJtYXJnaW46IDJweCAwcHg7XCI+PC9kaXY+XHJcbiAgICAgICAgPHRhYmxlICpuZ0lmPVwic2hvd1RpbWVcIiBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIiBjZWxscGFkZGluZz1cIjBcIiBjZWxsc3BhY2luZz1cIjBcIiBzdHlsZT1cIndpZHRoOjEwMCVcIj5cclxuICAgICAgICAgIDx0Ym9keT5cclxuICAgICAgICAgICAgPHRyIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgIDx0ZCBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIiBzdHlsZT1cInBhZGRpbmc6IDAgNHB4IDAgNHB4OyB3aGl0ZS1zcGFjZTogbm93cmFwO1wiPlxyXG4gICAgICAgICAgICAgICAge3t0aGlzLm1vZGVsLmxvYygnVGltZScpICsgJzonfX1cclxuICAgICAgICAgICAgICA8L3RkPlxyXG5cclxuICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCIgc3R5bGU9XCJ0ZXh0LWFsaWduOiByaWdodDtcIj5cclxuICAgICAgICAgICAgICAgIDxzdGktdGV4dC1ib3ggW3dpZHRoXT1cIjkwXCJcclxuICAgICAgICAgICAgICAgICAgICBbbWFyZ2luXT1cIicxcHggMnB4IDJweCAycHgnXCJcclxuICAgICAgICAgICAgICAgICAgICBbdmFsdWVdPVwiZ2V0VGltZSgpXCJcclxuICAgICAgICAgICAgICAgICAgICAoYWN0aW9uKT1cInRpbWVBY3Rpb24oJGV2ZW50KVwiPlxyXG4gICAgICAgICAgICAgICAgPC9zdGktdGV4dC1ib3g+XHJcbiAgICAgICAgICAgICAgPC90ZD5cclxuICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgPC90YWJsZT5cclxuICBgXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlck1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBASW5wdXQoKSBtZW51OiBNZW51O1xyXG4gIEBJbnB1dCgpIGtleVRvID0gZmFsc2U7XHJcbiAgQElucHV0KCkgY2xvc2VPbkFjdGlvbiA9IHRydWU7XHJcblxyXG4gIHB1YmxpYyBtb250aGVzRm9yRGF0ZVBpY2tlckl0ZW1zOiBJdGVtW10gPSBbXTtcclxuICBwdWJsaWMgY291bnRMZXR0ZXJzOiBudW1iZXI7XHJcbiAgcHVibGljIGNvbHMgPSBbMCwgMSwgMiwgMywgNCwgNSwgNl07XHJcbiAgcHVibGljIHJvd3MgPSBbMCwgMSwgMiwgMywgNCwgNV07XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtb2RlbDogTW9kZWxTZXJ2aWNlLCBwdWJsaWMgaGVscGVyOiBIZWxwZXJTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLm1vZGVsLm1vbnRocy5mb3JFYWNoKChtLCBpKSA9PiB0aGlzLm1vbnRoZXNGb3JEYXRlUGlja2VySXRlbXMucHVzaCh7IG5hbWU6ICdNb250aCcgKyBpLCBjYXB0aW9uOiB0aGlzLm1vZGVsLmxvYygnTW9udGgnICsgbSksIGtleTogaSB9KSk7XHJcblxyXG4gICAgY29uc3QgZmlyc3RMZXR0ZXJzID0ge307XHJcbiAgICB0aGlzLm1vZGVsLmRheU9mV2Vlay5mb3JFYWNoKChkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRheU5hbWUgPSB0aGlzLm1vZGVsLmxvYygnRGF5JyArIGQpO1xyXG4gICAgICBmaXJzdExldHRlcnNbZGF5TmFtZS50b1N0cmluZygpLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpXSA9IHRydWU7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuY291bnRMZXR0ZXJzID0gT2JqZWN0LmtleXMoZmlyc3RMZXR0ZXJzKS5sZW5ndGggPCA1ID8gMiA6IDE7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHsgfVxyXG5cclxuICBnZXRCdXR0b25TZWxlY3RlZChjb2w6IG51bWJlciwgcm93OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGZpcnN0RGF5ID0gdGhpcy5nZXRGaXJzdERheSgpO1xyXG4gICAgY29uc3QgY3VyRGF5ID0gcm93ICogNyArIGNvbDtcclxuICAgIGNvbnN0IGRheSA9IGN1ckRheSAtIGZpcnN0RGF5ICsgMTtcclxuXHJcbiAgICByZXR1cm4gZGF5ID09PSB0aGlzLmtleS5kYXk7XHJcbiAgfVxyXG5cclxuICBnZXRCdXR0b25DYXB0aW9uKGNvbDogbnVtYmVyLCByb3c6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICBjb25zdCBmaXJzdERheSA9IHRoaXMuZ2V0Rmlyc3REYXkoKTtcclxuICAgIGNvbnN0IGRheXNJbk1vbnRoID0gdGhpcy5oZWxwZXIuZ2V0Q291bnREYXlzT2ZNb250aCh0aGlzLmtleS55ZWFyLCB0aGlzLmtleS5tb250aCAtIDEpO1xyXG4gICAgY29uc3QgY3VyRGF5ID0gcm93ICogNyArIGNvbDtcclxuICAgIGNvbnN0IGRheSA9IGN1ckRheSAtIGZpcnN0RGF5ICsgMTtcclxuICAgIGlmIChjdXJEYXkgPj0gZmlyc3REYXkgJiYgZGF5IDw9IGRheXNJbk1vbnRoKSB7XHJcbiAgICAgIHJldHVybiBkYXkudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG5cclxuICBnZXRUaW1lKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5oZWxwZXIuZm9ybWF0RGF0ZSh0aGlzLmhlbHBlci5nZXREYXRlKHRoaXMua2V5KSwgJ0g6bW06c3MnKTtcclxuICB9XHJcblxyXG4gIGdldEZpcnN0RGF5KCk6IG51bWJlciB7XHJcbiAgICBsZXQgZmlyc3REYXkgPSBuZXcgRGF0ZSh0aGlzLmtleS55ZWFyLCB0aGlzLmtleS5tb250aCAtIDEsIDEpLmdldERheSgpO1xyXG4gICAgaWYgKGZpcnN0RGF5ID09PSAwKSB7XHJcbiAgICAgIGZpcnN0RGF5ID0gNztcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5kYXRlUGlja2VyRmlyc3REYXlPZldlZWsgIT09ICdTdW5kYXknKSB7XHJcbiAgICAgIGZpcnN0RGF5LS07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmlyc3REYXk7XHJcbiAgfVxyXG5cclxuICBnZXQgc2hvd1RpbWUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5tZW51Py5wYXJhbXM/LmRhdGVUaW1lVHlwZSAhPT0gJ0RhdGUnO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGtleSgpOiBEYXRlVGltZU9iamVjdCB7XHJcbiAgICByZXR1cm4gdGhpcy5rZXlUbyA/IHRoaXMubWVudS5wYXJhbXMua2V5VG8gOiB0aGlzLm1lbnUucGFyYW1zLmtleTtcclxuICB9XHJcblxyXG4gIHllYXJBY3Rpb24oaW5wdXQ6IGFueSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5rZXkueWVhciA9IHBhcnNlSW50KGlucHV0LnZhbHVlLCAxMCk7XHJcbiAgICB9IGNhdGNoIHsgfVxyXG4gIH1cclxuXHJcbiAgdGltZUFjdGlvbihpbnB1dDogYW55KSB7XHJcbiAgICBjb25zdCB0aW1lID0gdGhpcy5oZWxwZXIuc3RyaW5nVG9UaW1lKGlucHV0LnZhbHVlKTtcclxuICAgIHRoaXMua2V5LnNlY29uZHMgPSB0aW1lLnNlY29uZHM7XHJcbiAgICB0aGlzLmtleS5taW51dGVzID0gdGltZS5taW51dGVzO1xyXG4gICAgdGhpcy5rZXkuaG91cnMgPSB0aW1lLmhvdXJzO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2hvcnREYXlOYW1lKGluZGV4OiBudW1iZXIpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgZGF5TmFtZSA9IHRoaXMubW9kZWwubG9jKCdEYXknICsgdGhpcy5tb2RlbC5kYXlPZldlZWtbaW5kZXhdKTtcclxuICAgIGlmIChkYXlOYW1lKSB7XHJcbiAgICAgIHJldHVybiBkYXlOYW1lLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDAsIHRoaXMuY291bnRMZXR0ZXJzIDw9IGRheU5hbWUubGVuZ3RoID8gdGhpcy5jb3VudExldHRlcnMgOiAxKS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2hvcnREYXlDb2xvcihpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIGlmIChpbmRleCA9PT0gKHRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLmRhdGVQaWNrZXJGaXJzdERheU9mV2VlayA9PT0gJ1N1bmRheScgPyA2IDogNSkpIHtcclxuICAgICAgcmV0dXJuICcjMDAwMGZmJztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaW5kZXggPT09ICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5kYXRlUGlja2VyRmlyc3REYXlPZldlZWsgPT09ICdTdW5kYXknID8gMCA6IDYpKSB7XHJcbiAgICAgIHJldHVybiAnI2ZmMDAwMCc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICBwcmV2TW9udGhCdXR0b25BY3Rpb24oKSB7XHJcbiAgICBsZXQgbW9udGggPSB0aGlzLmtleS5tb250aDtcclxuICAgIGxldCB5ZWFyID0gdGhpcy5rZXkueWVhcjtcclxuICAgIG1vbnRoLS07XHJcbiAgICBpZiAobW9udGggPT09IDApIHtcclxuICAgICAgbW9udGggPSAxMjtcclxuICAgICAgeWVhci0tO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY291bnREYXlzSW5Nb250aCA9IHRoaXMuaGVscGVyLmdldENvdW50RGF5c09mTW9udGgoeWVhciwgbW9udGggLSAxKTtcclxuICAgIGlmIChjb3VudERheXNJbk1vbnRoIDwgdGhpcy5rZXkuZGF5KSB7XHJcbiAgICAgIHRoaXMua2V5LmRheSA9IGNvdW50RGF5c0luTW9udGg7XHJcbiAgICB9XHJcbiAgICB0aGlzLmtleS5tb250aCA9IG1vbnRoO1xyXG4gICAgdGhpcy5rZXkueWVhciA9IHllYXI7XHJcbiAgfVxyXG5cclxuICBuZXh0TW9udGhCdXR0b25BY3Rpb24oKSB7XHJcbiAgICBsZXQgbW9udGggPSB0aGlzLmtleS5tb250aDtcclxuICAgIGxldCB5ZWFyID0gdGhpcy5rZXkueWVhcjtcclxuICAgIG1vbnRoKys7XHJcbiAgICBpZiAobW9udGggPT09IDEzKSB7XHJcbiAgICAgIG1vbnRoID0gMTtcclxuICAgICAgeWVhcisrO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY291bnREYXlzSW5Nb250aCA9IHRoaXMuaGVscGVyLmdldENvdW50RGF5c09mTW9udGgoeWVhciwgbW9udGggLSAxKTtcclxuICAgIGlmIChjb3VudERheXNJbk1vbnRoIDwgdGhpcy5rZXkuZGF5KSB7XHJcbiAgICAgIHRoaXMua2V5LmRheSA9IGNvdW50RGF5c0luTW9udGg7XHJcbiAgICB9XHJcbiAgICB0aGlzLmtleS5tb250aCA9IG1vbnRoO1xyXG4gICAgdGhpcy5rZXkueWVhciA9IHllYXI7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuIl19