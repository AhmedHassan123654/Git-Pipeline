import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { HelperService } from '../services/helper.service';
import { ModelService } from '../services/model.service';
import { MouseService } from '../services/mouse.service';
import { Subject } from 'rxjs';
var Menu = /** @class */ (function () {
    function Menu(name, items, parent, type, state, menuEl, top, left, innerContent, width, height, menuStyleName, params, verticalItems, action, itemStyleName, value, sizeStyle) {
        this.name = name;
        this.items = items;
        this.parent = parent;
        this.type = type;
        this.state = state;
        this.menuEl = menuEl;
        this.top = top;
        this.left = left;
        this.innerContent = innerContent;
        this.width = width;
        this.height = height;
        this.menuStyleName = menuStyleName;
        this.params = params;
        this.verticalItems = verticalItems;
        this.action = action;
        this.itemStyleName = itemStyleName;
        this.value = value;
        this.sizeStyle = sizeStyle;
    }
    return Menu;
}());
export { Menu };
var MenuService = /** @class */ (function () {
    function MenuService(helper, model, mouseService) {
        var _this = this;
        this.helper = helper;
        this.model = model;
        this.mouseService = mouseService;
        this.VERTICAL_MENU_NAME = 'verticalMenu';
        this.menuMouseUp = '';
        this._menus = {};
        this.subject = new Subject();
        this.mouseService.getDocumentMouseUp().subscribe(function (event) {
            if (_this.menuMouseUp === '') {
                _this.closeAllMenus();
            }
            else if (_this.menuMouseUp !== 'datePickerMenu' && _this.menuMouseUp !== _this.VERTICAL_MENU_NAME) {
                var datePicker = Object.values(_this._menus).find(function (m) { return m.type === 'datePickerMenu'; });
                if (datePicker != null) {
                    datePicker.state = 'initialDown';
                }
            }
            _this.menuMouseUp = '';
        });
    }
    MenuService.prototype.getVisibility = function () {
        return this.subject.asObservable();
    };
    MenuService.prototype.addMenu = function (menu) {
        this._menus[menu.name] = menu;
    };
    MenuService.prototype.closeAllMenus = function () {
        var _this = this;
        Object.values(this._menus).forEach(function (m) { return m.state = m.type === 'buttonMenu' && _this.model.options.isMobileDevice ? 'initialLeft' : 'initialDown'; });
    };
    MenuService.prototype.isMenuVisible = function () {
        return Object.values(this._menus).find(function (m) { return m.state === 'expanded'; }) != null;
    };
    MenuService.prototype.showMenu = function (menuName) {
        var _this = this;
        var _a, _b;
        var menu = this._menus[menuName];
        if (((_a = menu) === null || _a === void 0 ? void 0 : _a.type) !== 'datePickerMenu' && ((_b = menu) === null || _b === void 0 ? void 0 : _b.type) !== this.VERTICAL_MENU_NAME) {
            this.closeAllMenus();
        }
        if (menu) {
            menu.sizeStyle = 'opacity: 0;';
            if (this.model.options.isMobileDevice && menu.type === 'buttonMenu') {
                setTimeout(function () {
                    var innerContent = menu.innerContent.nativeElement;
                    menu.left = 0;
                    menu.top = 0;
                    menu.width = innerContent.offsetWidth;
                    menu.height = innerContent.offsetHeight;
                    menu.state = 'initialLeft';
                    menu.sizeStyle = null;
                    setTimeout(function () {
                        menu.state = 'expanded';
                    });
                });
            }
            else {
                setTimeout(function () {
                    menu.sizeStyle = null;
                    _this.showMenuInternal(menu);
                });
            }
            this.subject.next(menu);
        }
    };
    MenuService.prototype.showMenuInternal = function (menu) {
        var isVertMenu = true;
        var parentButton = menu.parent.nativeElement;
        var innerContent = menu.innerContent.nativeElement;
        var offsetHeight = menu.menuEl.nativeElement.offsetHeight;
        var style = menu.menuEl.nativeElement.style;
        var coords = this.getMenuCoordinates(parentButton, innerContent, offsetHeight, style, isVertMenu);
        menu.left = coords.left;
        menu.top = coords.top;
        menu.width = menu.width || coords.width;
        menu.height = coords.height;
        menu.state = coords.state;
        setTimeout(function () {
            menu.state = 'expanded';
        });
    };
    MenuService.prototype.getMenuCoordinates = function (parentButton, innerContent, offsetHeight, style, isVertMenu) {
        var menu = {};
        var browserWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var browserHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        var rightAlign = false;
        var mainClassName = 'stiJsViewerMainPanel';
        var animDirect = 'Down';
        var leftOffset = 0;
        var left = (isVertMenu)
            ? (this.model.options.appearance.rightToLeft || rightAlign
                ? (this.helper.findPosX(parentButton, mainClassName) - innerContent.offsetWidth + parentButton.offsetWidth) - (leftOffset || 0)
                : this.helper.findPosX(parentButton, mainClassName) - (leftOffset || 0))
            : ((animDirect === 'Right')
                ? (this.helper.findPosX(parentButton, mainClassName) + parentButton.offsetWidth + 2)
                : (this.helper.findPosX(parentButton, mainClassName) - parentButton.offsetWidth - 2));
        if (left + innerContent.offsetWidth > browserWidth) {
            left = browserWidth - innerContent.offsetWidth - 15;
        }
        if (left < 0) {
            left = 10;
        }
        menu.left = left;
        if (animDirect === 'Down' &&
            this.helper.findPosY(parentButton) + parentButton.offsetHeight + innerContent.offsetHeight > browserHeight &&
            this.helper.findPosY(parentButton) - innerContent.offsetHeight > 0) {
            animDirect = 'Up';
        }
        menu.top = (isVertMenu)
            ? ((animDirect === 'Down')
                ? (this.helper.findPosY(parentButton, mainClassName) + parentButton.offsetHeight + 2)
                : (this.helper.findPosY(parentButton, mainClassName) - offsetHeight))
            : (this.helper.findPosY(parentButton, mainClassName) + parentButton.offsetHeight + innerContent.offsetHeight > browserHeight &&
                (browserHeight - innerContent.offsetHeight - 10) > 0)
                ? (browserHeight - innerContent.offsetHeight - 10)
                : this.helper.findPosY(parentButton, mainClassName);
        menu.width = innerContent.offsetWidth;
        menu.height = innerContent.offsetHeight;
        if (menu.top + innerContent.offsetHeight > browserHeight) {
            menu.top = (browserHeight - innerContent.offsetHeight - 10);
        }
        if (menu.top < 0) {
            menu.top = 10;
        }
        menu.state = animDirect === 'Down' ? 'initialDown' : 'initialUp';
        return menu;
    };
    Object.defineProperty(MenuService.prototype, "menus", {
        get: function () {
            return Object.values(this._menus);
        },
        enumerable: true,
        configurable: true
    });
    MenuService.prototype.getVerticalMenu = function () {
        return this._menus[this.VERTICAL_MENU_NAME];
    };
    MenuService.prototype.getMenu = function (name) {
        return this._menus[name];
    };
    MenuService.ctorParameters = function () { return [
        { type: HelperService },
        { type: ModelService },
        { type: MouseService }
    ]; };
    MenuService = __decorate([
        Injectable()
    ], MenuService);
    return MenuService;
}());
export { MenuService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9tZW51L21lbnUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFckUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzNELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFekQsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUUzQztJQUNFLGNBQW1CLElBQVksRUFBUyxLQUFpQixFQUFTLE1BQWtCLEVBQVMsSUFBWSxFQUFTLEtBQWMsRUFDdkgsTUFBbUIsRUFBUyxHQUFZLEVBQVMsSUFBYSxFQUFTLFlBQXlCLEVBQVMsS0FBYyxFQUFTLE1BQWUsRUFDL0ksYUFBc0IsRUFBUyxNQUFpQixFQUFTLGFBQXNCLEVBQVMsTUFBMEIsRUFDbEgsYUFBc0IsRUFBUyxLQUFXLEVBQVMsU0FBa0I7UUFIM0QsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFTLFVBQUssR0FBTCxLQUFLLENBQVk7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFZO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFTLFVBQUssR0FBTCxLQUFLLENBQVM7UUFDdkgsV0FBTSxHQUFOLE1BQU0sQ0FBYTtRQUFTLFFBQUcsR0FBSCxHQUFHLENBQVM7UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFTO1FBQVMsaUJBQVksR0FBWixZQUFZLENBQWE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFTO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUMvSSxrQkFBYSxHQUFiLGFBQWEsQ0FBUztRQUFTLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBUyxr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QUFDLE1BQU0sR0FBRyxZQUFZLENBQUMsWUFBWSxDQUFDO1FBRXhDLElBQUksSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUMsWUFBWSxHQUFHLGFBQWEsRUFBRTtZQUN4RCxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsYUFBYSxHQUFHLFlBQVksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDLENBQUM7U0FDN0Q7UUFFRCxJQUFJLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1NBQ2Y7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDO1FBRWpFLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHNCQUFJLDhCQUFLO2FBQVQ7WUFDRSxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLENBQUM7OztPQUFBO0lBRUQscUNBQWUsR0FBZjtRQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsNkJBQU8sR0FBUCxVQUFRLElBQVk7UUFDbEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7O2dCQXRKMkIsYUFBYTtnQkFBaUIsWUFBWTtnQkFBd0IsWUFBWTs7SUFSL0YsV0FBVztRQUR2QixVQUFVLEVBQUU7T0FDQSxXQUFXLENBZ0t2QjtJQUFELGtCQUFDO0NBQUEsQUFoS0QsSUFnS0M7U0FoS1ksV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZW51SXRlbSB9IGZyb20gJy4vbWVuaS1pdGVtLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEhlbHBlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9oZWxwZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNb3VzZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9tb3VzZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVmFyaWFibGUsIEl0ZW0gfSBmcm9tICcuLi9zZXJ2aWNlcy9vYmplY3RzJztcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1lbnUge1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsIHB1YmxpYyBpdGVtczogTWVudUl0ZW1bXSwgcHVibGljIHBhcmVudDogRWxlbWVudFJlZiwgcHVibGljIHR5cGU6IHN0cmluZywgcHVibGljIHN0YXRlPzogc3RyaW5nLFxyXG4gICAgcHVibGljIG1lbnVFbD86IEVsZW1lbnRSZWYsIHB1YmxpYyB0b3A/OiBudW1iZXIsIHB1YmxpYyBsZWZ0PzogbnVtYmVyLCBwdWJsaWMgaW5uZXJDb250ZW50PzogRWxlbWVudFJlZiwgcHVibGljIHdpZHRoPzogbnVtYmVyLCBwdWJsaWMgaGVpZ2h0PzogbnVtYmVyLFxyXG4gICAgcHVibGljIG1lbnVTdHlsZU5hbWU/OiBzdHJpbmcsIHB1YmxpYyBwYXJhbXM/OiBWYXJpYWJsZSwgcHVibGljIHZlcnRpY2FsSXRlbXM/OiBJdGVtW10sIHB1YmxpYyBhY3Rpb24/OiBFdmVudEVtaXR0ZXI8YW55PixcclxuICAgIHB1YmxpYyBpdGVtU3R5bGVOYW1lPzogc3RyaW5nLCBwdWJsaWMgdmFsdWU/OiBhbnksIHB1YmxpYyBzaXplU3R5bGU/OiBzdHJpbmcpIHsgfVxyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBNZW51U2VydmljZSB7XHJcbiAgcHVibGljIFZFUlRJQ0FMX01FTlVfTkFNRSA9ICd2ZXJ0aWNhbE1lbnUnO1xyXG5cclxuICBwdWJsaWMgbWVudU1vdXNlVXAgPSAnJztcclxuXHJcbiAgcHJpdmF0ZSBfbWVudXM6IHt9ID0ge307XHJcbiAgcHJpdmF0ZSBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8TWVudT4oKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBoZWxwZXI6IEhlbHBlclNlcnZpY2UsIHByaXZhdGUgbW9kZWw6IE1vZGVsU2VydmljZSwgcHJpdmF0ZSBtb3VzZVNlcnZpY2U6IE1vdXNlU2VydmljZSkge1xyXG4gICAgdGhpcy5tb3VzZVNlcnZpY2UuZ2V0RG9jdW1lbnRNb3VzZVVwKCkuc3Vic2NyaWJlKChldmVudCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5tZW51TW91c2VVcCA9PT0gJycpIHtcclxuICAgICAgICB0aGlzLmNsb3NlQWxsTWVudXMoKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLm1lbnVNb3VzZVVwICE9PSAnZGF0ZVBpY2tlck1lbnUnICYmIHRoaXMubWVudU1vdXNlVXAgIT09IHRoaXMuVkVSVElDQUxfTUVOVV9OQU1FKSB7XHJcbiAgICAgICAgY29uc3QgZGF0ZVBpY2tlciA9IE9iamVjdC52YWx1ZXModGhpcy5fbWVudXMpLmZpbmQobSA9PiAobSBhcyBNZW51KS50eXBlID09PSAnZGF0ZVBpY2tlck1lbnUnKSBhcyBNZW51O1xyXG4gICAgICAgIGlmIChkYXRlUGlja2VyICE9IG51bGwpIHtcclxuICAgICAgICAgIGRhdGVQaWNrZXIuc3RhdGUgPSAnaW5pdGlhbERvd24nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLm1lbnVNb3VzZVVwID0gJyc7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRWaXNpYmlsaXR5KCk6IE9ic2VydmFibGU8TWVudT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRNZW51KG1lbnU6IE1lbnUpOiB2b2lkIHtcclxuICAgIHRoaXMuX21lbnVzW21lbnUubmFtZV0gPSBtZW51O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsb3NlQWxsTWVudXMoKSB7XHJcbiAgICBPYmplY3QudmFsdWVzKHRoaXMuX21lbnVzKS5mb3JFYWNoKChtOiBNZW51KSA9PiBtLnN0YXRlID0gbS50eXBlID09PSAnYnV0dG9uTWVudScgJiYgdGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJ2luaXRpYWxMZWZ0JyA6ICdpbml0aWFsRG93bicpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzTWVudVZpc2libGUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aGlzLl9tZW51cykuZmluZChtID0+IChtIGFzIE1lbnUpLnN0YXRlID09PSAnZXhwYW5kZWQnKSAhPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dNZW51KG1lbnVOYW1lOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IG1lbnU6IE1lbnUgPSB0aGlzLl9tZW51c1ttZW51TmFtZV07XHJcblxyXG4gICAgaWYgKG1lbnU/LnR5cGUgIT09ICdkYXRlUGlja2VyTWVudScgJiYgbWVudT8udHlwZSAhPT0gdGhpcy5WRVJUSUNBTF9NRU5VX05BTUUpIHtcclxuICAgICAgdGhpcy5jbG9zZUFsbE1lbnVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1lbnUpIHtcclxuICAgICAgbWVudS5zaXplU3R5bGUgPSAnb3BhY2l0eTogMDsnO1xyXG4gICAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlICYmIG1lbnUudHlwZSA9PT0gJ2J1dHRvbk1lbnUnKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBpbm5lckNvbnRlbnQgPSBtZW51LmlubmVyQ29udGVudC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgbWVudS5sZWZ0ID0gMDtcclxuICAgICAgICAgIG1lbnUudG9wID0gMDtcclxuICAgICAgICAgIG1lbnUud2lkdGggPSBpbm5lckNvbnRlbnQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgICBtZW51LmhlaWdodCA9IGlubmVyQ29udGVudC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgICBtZW51LnN0YXRlID0gJ2luaXRpYWxMZWZ0JztcclxuICAgICAgICAgIG1lbnUuc2l6ZVN0eWxlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgbWVudS5zdGF0ZSA9ICdleHBhbmRlZCc7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIG1lbnUuc2l6ZVN0eWxlID0gbnVsbDtcclxuICAgICAgICAgIHRoaXMuc2hvd01lbnVJbnRlcm5hbChtZW51KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN1YmplY3QubmV4dChtZW51KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2hvd01lbnVJbnRlcm5hbChtZW51OiBNZW51KSB7XHJcbiAgICBjb25zdCBpc1ZlcnRNZW51ID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBwYXJlbnRCdXR0b24gPSBtZW51LnBhcmVudC5uYXRpdmVFbGVtZW50O1xyXG4gICAgY29uc3QgaW5uZXJDb250ZW50ID0gbWVudS5pbm5lckNvbnRlbnQubmF0aXZlRWxlbWVudDtcclxuICAgIGNvbnN0IG9mZnNldEhlaWdodCA9IG1lbnUubWVudUVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xyXG4gICAgY29uc3Qgc3R5bGUgPSBtZW51Lm1lbnVFbC5uYXRpdmVFbGVtZW50LnN0eWxlO1xyXG5cclxuICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuZ2V0TWVudUNvb3JkaW5hdGVzKHBhcmVudEJ1dHRvbiwgaW5uZXJDb250ZW50LCBvZmZzZXRIZWlnaHQsIHN0eWxlLCBpc1ZlcnRNZW51KTtcclxuXHJcbiAgICBtZW51LmxlZnQgPSBjb29yZHMubGVmdDtcclxuICAgIG1lbnUudG9wID0gY29vcmRzLnRvcDtcclxuICAgIG1lbnUud2lkdGggPSBtZW51LndpZHRoIHx8IGNvb3Jkcy53aWR0aDtcclxuICAgIG1lbnUuaGVpZ2h0ID0gY29vcmRzLmhlaWdodDtcclxuICAgIG1lbnUuc3RhdGUgPSBjb29yZHMuc3RhdGU7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIG1lbnUuc3RhdGUgPSAnZXhwYW5kZWQnO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0TWVudUNvb3JkaW5hdGVzKHBhcmVudEJ1dHRvbjogYW55LCBpbm5lckNvbnRlbnQ6IGFueSwgb2Zmc2V0SGVpZ2h0OiBudW1iZXIsIHN0eWxlOiBhbnksIGlzVmVydE1lbnU6IGJvb2xlYW4pOiBhbnkge1xyXG4gICAgY29uc3QgbWVudTogYW55ID0ge307XHJcbiAgICBjb25zdCBicm93c2VyV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuICAgIGNvbnN0IGJyb3dzZXJIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcclxuICAgIGNvbnN0IHJpZ2h0QWxpZ24gPSBmYWxzZTtcclxuICAgIGNvbnN0IG1haW5DbGFzc05hbWUgPSAnc3RpSnNWaWV3ZXJNYWluUGFuZWwnO1xyXG4gICAgbGV0IGFuaW1EaXJlY3QgPSAnRG93bic7XHJcbiAgICBjb25zdCBsZWZ0T2Zmc2V0ID0gMDtcclxuXHJcbiAgICBsZXQgbGVmdCA9IChpc1ZlcnRNZW51KVxyXG4gICAgICA/ICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5yaWdodFRvTGVmdCB8fCByaWdodEFsaWduXHJcbiAgICAgICAgPyAodGhpcy5oZWxwZXIuZmluZFBvc1gocGFyZW50QnV0dG9uLCBtYWluQ2xhc3NOYW1lKSAtIGlubmVyQ29udGVudC5vZmZzZXRXaWR0aCArIHBhcmVudEJ1dHRvbi5vZmZzZXRXaWR0aCkgLSAobGVmdE9mZnNldCB8fCAwKVxyXG4gICAgICAgIDogdGhpcy5oZWxwZXIuZmluZFBvc1gocGFyZW50QnV0dG9uLCBtYWluQ2xhc3NOYW1lKSAtIChsZWZ0T2Zmc2V0IHx8IDApKVxyXG4gICAgICA6ICgoYW5pbURpcmVjdCA9PT0gJ1JpZ2h0JylcclxuICAgICAgICA/ICh0aGlzLmhlbHBlci5maW5kUG9zWChwYXJlbnRCdXR0b24sIG1haW5DbGFzc05hbWUpICsgcGFyZW50QnV0dG9uLm9mZnNldFdpZHRoICsgMilcclxuICAgICAgICA6ICh0aGlzLmhlbHBlci5maW5kUG9zWChwYXJlbnRCdXR0b24sIG1haW5DbGFzc05hbWUpIC0gcGFyZW50QnV0dG9uLm9mZnNldFdpZHRoIC0gMikpO1xyXG5cclxuICAgIGlmIChsZWZ0ICsgaW5uZXJDb250ZW50Lm9mZnNldFdpZHRoID4gYnJvd3NlcldpZHRoKSB7XHJcbiAgICAgIGxlZnQgPSBicm93c2VyV2lkdGggLSBpbm5lckNvbnRlbnQub2Zmc2V0V2lkdGggLSAxNTtcclxuICAgIH1cclxuICAgIGlmIChsZWZ0IDwgMCkge1xyXG4gICAgICBsZWZ0ID0gMTA7XHJcbiAgICB9XHJcbiAgICBtZW51LmxlZnQgPSBsZWZ0O1xyXG5cclxuICAgIGlmIChhbmltRGlyZWN0ID09PSAnRG93bicgJiZcclxuICAgICAgdGhpcy5oZWxwZXIuZmluZFBvc1kocGFyZW50QnV0dG9uKSArIHBhcmVudEJ1dHRvbi5vZmZzZXRIZWlnaHQgKyBpbm5lckNvbnRlbnQub2Zmc2V0SGVpZ2h0ID4gYnJvd3NlckhlaWdodCAmJlxyXG4gICAgICB0aGlzLmhlbHBlci5maW5kUG9zWShwYXJlbnRCdXR0b24pIC0gaW5uZXJDb250ZW50Lm9mZnNldEhlaWdodCA+IDApIHtcclxuICAgICAgYW5pbURpcmVjdCA9ICdVcCc7XHJcbiAgICB9XHJcblxyXG4gICAgbWVudS50b3AgPSAoaXNWZXJ0TWVudSlcclxuICAgICAgPyAoKGFuaW1EaXJlY3QgPT09ICdEb3duJylcclxuICAgICAgICA/ICh0aGlzLmhlbHBlci5maW5kUG9zWShwYXJlbnRCdXR0b24sIG1haW5DbGFzc05hbWUpICsgcGFyZW50QnV0dG9uLm9mZnNldEhlaWdodCArIDIpXHJcbiAgICAgICAgOiAodGhpcy5oZWxwZXIuZmluZFBvc1kocGFyZW50QnV0dG9uLCBtYWluQ2xhc3NOYW1lKSAtIG9mZnNldEhlaWdodCkpXHJcbiAgICAgIDogKHRoaXMuaGVscGVyLmZpbmRQb3NZKHBhcmVudEJ1dHRvbiwgbWFpbkNsYXNzTmFtZSkgKyBwYXJlbnRCdXR0b24ub2Zmc2V0SGVpZ2h0ICsgaW5uZXJDb250ZW50Lm9mZnNldEhlaWdodCA+IGJyb3dzZXJIZWlnaHQgJiZcclxuICAgICAgICAoYnJvd3NlckhlaWdodCAtIGlubmVyQ29udGVudC5vZmZzZXRIZWlnaHQgLSAxMCkgPiAwKVxyXG4gICAgICAgID8gKGJyb3dzZXJIZWlnaHQgLSBpbm5lckNvbnRlbnQub2Zmc2V0SGVpZ2h0IC0gMTApXHJcbiAgICAgICAgOiB0aGlzLmhlbHBlci5maW5kUG9zWShwYXJlbnRCdXR0b24sIG1haW5DbGFzc05hbWUpO1xyXG5cclxuICAgIG1lbnUud2lkdGggPSBpbm5lckNvbnRlbnQub2Zmc2V0V2lkdGg7XHJcbiAgICBtZW51LmhlaWdodCA9IGlubmVyQ29udGVudC5vZmZzZXRIZWlnaHQ7XHJcblxyXG4gICAgaWYgKG1lbnUudG9wICsgaW5uZXJDb250ZW50Lm9mZnNldEhlaWdodCA+IGJyb3dzZXJIZWlnaHQpIHtcclxuICAgICAgbWVudS50b3AgPSAoYnJvd3NlckhlaWdodCAtIGlubmVyQ29udGVudC5vZmZzZXRIZWlnaHQgLSAxMCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1lbnUudG9wIDwgMCkge1xyXG4gICAgICBtZW51LnRvcCA9IDEwO1xyXG4gICAgfVxyXG5cclxuICAgIG1lbnUuc3RhdGUgPSBhbmltRGlyZWN0ID09PSAnRG93bicgPyAnaW5pdGlhbERvd24nIDogJ2luaXRpYWxVcCc7XHJcblxyXG4gICAgcmV0dXJuIG1lbnU7XHJcbiAgfVxyXG5cclxuICBnZXQgbWVudXMoKTogTWVudVtdIHtcclxuICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRoaXMuX21lbnVzKTtcclxuICB9XHJcblxyXG4gIGdldFZlcnRpY2FsTWVudSgpOiBNZW51IHtcclxuICAgIHJldHVybiB0aGlzLl9tZW51c1t0aGlzLlZFUlRJQ0FMX01FTlVfTkFNRV07XHJcbiAgfVxyXG5cclxuICBnZXRNZW51KG5hbWU6IHN0cmluZyk6IE1lbnUge1xyXG4gICAgcmV0dXJuIHRoaXMuX21lbnVzW25hbWVdO1xyXG4gIH1cclxuXHJcbn1cclxuIl19