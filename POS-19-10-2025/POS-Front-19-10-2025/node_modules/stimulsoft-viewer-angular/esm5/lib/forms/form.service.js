import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { MouseService } from '../services/mouse.service';
import { MenuService } from '../menu/menu.service';
import { HelperService } from '../services/helper.service';
import { ModelService } from '../services/model.service';
var FormService = /** @class */ (function () {
    function FormService(mouseService, menuService, helper, model) {
        var _this = this;
        this.mouseService = mouseService;
        this.menuService = menuService;
        this.helper = helper;
        this.model = model;
        this.mouseX = 0;
        this.mouseY = 0;
        this.formX = 0;
        this.formY = 0;
        mouseService.getDocumentMouseMove().subscribe(function (event) {
            _this.move(event);
        });
        mouseService.getDocumentMouseUp().subscribe(function (event) {
            _this.stopMove();
        });
    }
    Object.defineProperty(FormService.prototype, "form", {
        get: function () {
            return this.model.form;
        },
        set: function (form) {
            this.model.form = form;
        },
        enumerable: true,
        configurable: true
    });
    FormService.prototype.showForm = function (name, formData) {
        this.form = { name: name, left: 0, top: 0, isMooving: false, formData: formData };
    };
    FormService.prototype.closeForm = function (name) {
        var _a, _b;
        if (((_a = this.form) === null || _a === void 0 ? void 0 : _a.name) === 'notificationForm' && ((_b = this.model.notificationFormOptions) === null || _b === void 0 ? void 0 : _b.action)) {
            this.model.notificationFormOptions.action();
        }
        this.form = null;
    };
    FormService.prototype.centerForm = function (baseForm, defaultTop) {
        var _this = this;
        if (this.form != null) {
            setTimeout(function () {
                var position = _this.helper.setObjectToCenter(baseForm.element.nativeElement, defaultTop);
                _this.form.left = position.left;
                _this.form.top = position.top;
                _this.form.level = baseForm.level;
            });
        }
    };
    FormService.prototype.startMove = function (name, event, touchEvent) {
        var _a, _b;
        if (event || touchEvent && touchEvent.changedTouches.length > 0) {
            this.formX = this.form.left;
            this.formY = this.form.top;
            this.mouseX = ((_a = event) === null || _a === void 0 ? void 0 : _a.screenX) || touchEvent.changedTouches[0].screenX;
            this.mouseY = ((_b = event) === null || _b === void 0 ? void 0 : _b.screenY) || touchEvent.changedTouches[0].screenY;
            this.form.isMooving = true;
        }
    };
    FormService.prototype.move = function (event) {
        var _a;
        if ((_a = this.form) === null || _a === void 0 ? void 0 : _a.isMooving) {
            var screenX_1 = event.screenX || (event.changedTouches.length > 0 ? event.changedTouches[0].screenX : -1);
            var screenY_1 = event.screenY || (event.changedTouches.length > 0 ? event.changedTouches[0].screenY : -1);
            this.form.left = this.formX + (screenX_1 - this.mouseX);
            this.form.top = this.formY + (screenY_1 - this.mouseY);
            this.menuService.closeAllMenus();
        }
    };
    FormService.prototype.stopMove = function () {
        var _a;
        if ((_a = this.form) === null || _a === void 0 ? void 0 : _a.isMooving) {
            this.form.isMooving = false;
        }
    };
    FormService.ctorParameters = function () { return [
        { type: MouseService },
        { type: MenuService },
        { type: HelperService },
        { type: ModelService }
    ]; };
    FormService = __decorate([
        Injectable()
    ], FormService);
    return FormService;
}());
export { FormService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9mb3JtLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFM0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBR3pEO0lBT0UscUJBQW1CLFlBQTBCLEVBQVMsV0FBd0IsRUFBUyxNQUFxQixFQUFTLEtBQW1CO1FBQXhJLGlCQVFDO1FBUmtCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQVMsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQVMsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUxoSSxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ1gsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLFVBQUssR0FBRyxDQUFDLENBQUM7UUFDVixVQUFLLEdBQUcsQ0FBQyxDQUFDO1FBR2hCLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFDLEtBQWlCO1lBQzlELEtBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsQ0FBQyxDQUFDLENBQUM7UUFFSCxZQUFZLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBQyxLQUFpQjtZQUM1RCxLQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsc0JBQVcsNkJBQUk7YUFBZjtZQUNFLE9BQU8sSUFB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QyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsU0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsU0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyRCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUVNLDhCQUFRLEdBQWY7O1FBQ0UsVUFBSSxJQUFJLENBQUMsSUFBSSwwQ0FBRSxTQUFTLEVBQUU7WUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1NBQzdCO0lBQ0gsQ0FBQzs7Z0JBaEVnQyxZQUFZO2dCQUFzQixXQUFXO2dCQUFpQixhQUFhO2dCQUFnQixZQUFZOztJQVA3SCxXQUFXO1FBRHZCLFVBQVUsRUFBRTtPQUNBLFdBQVcsQ0F5RXZCO0lBQUQsa0JBQUM7Q0FBQSxBQXpFRCxJQXlFQztTQXpFWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnLi4vc2VydmljZXMvb2JqZWN0cyc7XHJcbmltcG9ydCB7IE1vdXNlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vdXNlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZW51U2VydmljZSB9IGZyb20gJy4uL21lbnUvbWVudS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2hlbHBlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQmFzZUZvcm1Db21wb25lbnQgfSBmcm9tICcuL2Jhc2UtZm9ybS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9tb2RlbC5zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZvcm1TZXJ2aWNlIHtcclxuXHJcbiAgcHJpdmF0ZSBtb3VzZVggPSAwO1xyXG4gIHByaXZhdGUgbW91c2VZID0gMDtcclxuICBwcml2YXRlIGZvcm1YID0gMDtcclxuICBwcml2YXRlIGZvcm1ZID0gMDtcclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIG1vdXNlU2VydmljZTogTW91c2VTZXJ2aWNlLCBwdWJsaWMgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlLCBwdWJsaWMgaGVscGVyOiBIZWxwZXJTZXJ2aWNlLCBwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSkge1xyXG4gICAgbW91c2VTZXJ2aWNlLmdldERvY3VtZW50TW91c2VNb3ZlKCkuc3Vic2NyaWJlKChldmVudDogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICB0aGlzLm1vdmUoZXZlbnQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbW91c2VTZXJ2aWNlLmdldERvY3VtZW50TW91c2VVcCgpLnN1YnNjcmliZSgoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5zdG9wTW92ZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGZvcm0oKTogRm9ybSB7XHJcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5mb3JtO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBmb3JtKGZvcm06IEZvcm0pIHtcclxuICAgIHRoaXMubW9kZWwuZm9ybSA9IGZvcm07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2hvd0Zvcm0obmFtZTogc3RyaW5nLCBmb3JtRGF0YT86IGFueSkge1xyXG4gICAgdGhpcy5mb3JtID0geyBuYW1lLCBsZWZ0OiAwLCB0b3A6IDAsIGlzTW9vdmluZzogZmFsc2UsIGZvcm1EYXRhIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2xvc2VGb3JtKG5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuZm9ybT8ubmFtZSA9PT0gJ25vdGlmaWNhdGlvbkZvcm0nICYmIHRoaXMubW9kZWwubm90aWZpY2F0aW9uRm9ybU9wdGlvbnM/LmFjdGlvbikge1xyXG4gICAgICB0aGlzLm1vZGVsLm5vdGlmaWNhdGlvbkZvcm1PcHRpb25zLmFjdGlvbigpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mb3JtID0gbnVsbDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjZW50ZXJGb3JtKGJhc2VGb3JtOiBCYXNlRm9ybUNvbXBvbmVudCwgZGVmYXVsdFRvcDogbnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5mb3JtICE9IG51bGwpIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmhlbHBlci5zZXRPYmplY3RUb0NlbnRlcihiYXNlRm9ybS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsIGRlZmF1bHRUb3ApO1xyXG4gICAgICAgIHRoaXMuZm9ybS5sZWZ0ID0gcG9zaXRpb24ubGVmdDtcclxuICAgICAgICB0aGlzLmZvcm0udG9wID0gcG9zaXRpb24udG9wO1xyXG4gICAgICAgIHRoaXMuZm9ybS5sZXZlbCA9IGJhc2VGb3JtLmxldmVsO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGFydE1vdmUobmFtZTogc3RyaW5nLCBldmVudDogTW91c2VFdmVudCwgdG91Y2hFdmVudD86IFRvdWNoRXZlbnQpIHtcclxuICAgIGlmIChldmVudCB8fCB0b3VjaEV2ZW50ICYmIHRvdWNoRXZlbnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmZvcm1YID0gdGhpcy5mb3JtLmxlZnQ7XHJcbiAgICAgIHRoaXMuZm9ybVkgPSB0aGlzLmZvcm0udG9wO1xyXG4gICAgICB0aGlzLm1vdXNlWCA9IGV2ZW50Py5zY3JlZW5YIHx8IHRvdWNoRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDtcclxuICAgICAgdGhpcy5tb3VzZVkgPSBldmVudD8uc2NyZWVuWSB8fCB0b3VjaEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnNjcmVlblk7XHJcbiAgICAgIHRoaXMuZm9ybS5pc01vb3ZpbmcgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmUoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKHRoaXMuZm9ybT8uaXNNb292aW5nKSB7XHJcbiAgICAgIGNvbnN0IHNjcmVlblggPSBldmVudC5zY3JlZW5YIHx8IChldmVudC5jaGFuZ2VkVG91Y2hlcy5sZW5ndGggPiAwID8gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWCA6IC0xKTtcclxuICAgICAgY29uc3Qgc2NyZWVuWSA9IGV2ZW50LnNjcmVlblkgfHwgKGV2ZW50LmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA+IDAgPyBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5ZIDogLTEpO1xyXG4gICAgICB0aGlzLmZvcm0ubGVmdCA9IHRoaXMuZm9ybVggKyAoc2NyZWVuWCAtIHRoaXMubW91c2VYKTtcclxuICAgICAgdGhpcy5mb3JtLnRvcCA9IHRoaXMuZm9ybVkgKyAoc2NyZWVuWSAtIHRoaXMubW91c2VZKTtcclxuICAgICAgdGhpcy5tZW51U2VydmljZS5jbG9zZUFsbE1lbnVzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RvcE1vdmUoKSB7XHJcbiAgICBpZiAodGhpcy5mb3JtPy5pc01vb3ZpbmcpIHtcclxuICAgICAgdGhpcy5mb3JtLmlzTW9vdmluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuIl19