import { __decorate } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { ModelService } from '../services/model.service';
import { ControllerService } from '../services/controller.service';
import { HelperService } from '../services/helper.service';
import { PageService } from '../services/page.service';
var NavigatePanelComponent = /** @class */ (function () {
    function NavigatePanelComponent(model, controller, helper, pageService) {
        this.model = model;
        this.controller = controller;
        this.helper = helper;
        this.pageService = pageService;
        this.comps = [];
    }
    NavigatePanelComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (this.model.options.toolbar.displayMode === 'Separated') {
            this.initButtons();
        }
        this.controller.getMessage().subscribe(function (message) {
            if (message.action !== 'viewer_loaded') {
                _this.updateButtons();
            }
        });
        this.model.controls.navigatePanel.visible = this.model.options.toolbar.displayMode === 'Separated';
    };
    NavigatePanelComponent.prototype.ngAfterViewInit = function () {
        this.model.controls.navigatePanel.el = this.element;
    };
    NavigatePanelComponent.prototype.updateButtons = function () {
        var _this = this;
        this.comps.filter(function (i) { return i.action === 'ViewMode'; }).forEach(function (m) { return m.caption = _this.model.loc(_this.model.reportParams.viewMode); });
        this.comps.filter(function (i) { return i.action === 'Zoom'; }).forEach(function (m) {
            m.menuItems.forEach(function (n) { return n.selected = n.name === ('Zoom' + _this.model.reportParams.zoom); });
            m.caption = Math.round(_this.model.reportParams.zoom) + '%';
        });
        this.comps.filter(function (i) { return i.action === 'ShowFind'; }).forEach(function (m) {
            m.selected = _this.model.controls.findPanel.visible;
        });
    };
    NavigatePanelComponent.prototype.initButtons = function () {
        var comps = [];
        if (this.model.options.toolbar.showFirstPageButton) {
            comps.push({ type: 'button', action: 'FirstPage', img: 'PageFirst20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showPreviousPageButton) {
            comps.push({ type: 'button', action: 'PrevPage', img: 'PagePrevious20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showCurrentPageControl) {
            comps.push({ type: 'separator' });
            comps.push({ type: 'pageControl' });
            comps.push({ type: 'separator' });
        }
        if (this.model.options.toolbar.showNextPageButton) {
            comps.push({ type: 'button', action: 'NextPage', img: 'PageNext20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showLastPageButton) {
            comps.push({ type: 'button', action: 'LastPage', img: 'PageLast20.png', tooltip: true });
        }
        comps.push({ type: 'space' });
        comps.push({ type: 'button', action: 'ZoomPageWidth', img: 'ZoomPageWidth20.png', tooltip: true });
        comps.push({ type: 'button', action: 'ZoomOnePage', img: 'ZoomOnePage20.png', tooltip: true });
        if (this.model.options.toolbar.showZoomButton) {
            comps.push({ type: 'separator' });
            comps.push({
                type: 'button', action: 'Zoom', caption: '100%', tooltip: true, arrow: 'Arrows.SmallArrowUpWhite.png',
                menuItems: this.helper.getZoomMenuItems()
            });
        }
        this.comps = comps;
    };
    NavigatePanelComponent.prototype.enabled = function (desc) {
        var disableNaviButtons = this.disableNaviButtons();
        switch (desc.action) {
            case 'FirstPage':
            case 'PrevPage':
                return this.model.reportParams.pageNumber > 0 && !disableNaviButtons;
            case 'NextPage':
            case 'LastPage':
                return this.model.reportParams.pageNumber < this.model.reportParams.pagesCount - 1 && !disableNaviButtons;
        }
        return true;
    };
    NavigatePanelComponent.prototype.selected = function (desc) {
        switch (desc.action) {
            case 'ZoomPageWidth':
                return Math.round(this.model.reportParams.zoom) === Math.round(this.pageService.getZoomByPageWidth());
            case 'ZoomOnePage':
                return Math.round(this.model.reportParams.zoom) === Math.round(this.pageService.getZoomByPageHeight());
        }
        return false;
    };
    NavigatePanelComponent.prototype.disableNaviButtons = function () {
        return this.model.reportParams.viewMode === 'MultiplePages' || this.model.reportParams.viewMode === 'WholeReport' ||
            (this.model.reportParams.viewMode === 'Continuous' && !this.model.options.appearance.scrollbarsMode && !this.model.options.appearance.fullScreenMode);
    };
    NavigatePanelComponent.ctorParameters = function () { return [
        { type: ModelService },
        { type: ControllerService },
        { type: HelperService },
        { type: PageService }
    ]; };
    __decorate([
        ViewChild('element')
    ], NavigatePanelComponent.prototype, "element", void 0);
    NavigatePanelComponent = __decorate([
        Component({
            selector: 'sti-navigate-panel',
            template: "\n  <div #element class=\"stiJsViewerNavigatePanel\" style=\"display: block;\"\n    [style.display]=\"!model.options.isMobileDevice ? (this.model.controls.navigatePanel.visible ? '' : 'none') : ''\"\n    [style.transition]=\"model.options.isMobileDevice ? 'margin 300ms ease, opacity 300ms ease' : null\"\n    [style.zIndex]=\"model.options.isMobileDevice ? (model.options.toolbar.autoHide ? 5 : 2) : null\"\n    [style.opacity]=\"model.options.isMobileDevice ? (model.controls.navigatePanel.visible ? (model.options.toolbar.autoHide ? 0.9 : 1) : 0) : 1\"\n    [style.marginBottom]=\"model.options.isMobileDevice && !model.controls.navigatePanel.visible ? '-0.55in' : 0\">\n    <table class=\"stiJsViewerClearAllStyles\" cellpadding=\"0\" cellspacing=\"0\">\n      <tbody>\n        <tr class=\"stiJsViewerClearAllStyles\">\n          <td *ngFor=\"let comp of comps\" class=\"stiJsViewerClearAllStyles\" [style.width]=\"comp.type == 'space' ? '100%' : null\">\n            <sti-button *ngIf=\"comp.type=='button'\"\n              [caption]=\"comp.caption\"\n              [imageName]=\"comp.img\"\n              [arrow]=\"comp.arrow\"\n              [menuItems]=\"comp.menuItems\"\n              [actionName]=\"comp.action\"\n              [tooltip]=\"comp.tooltip\"\n              [styleName]=\"'stiJsViewerNavigateButton'\"\n              [height]=\"model.options.isMobileDevice ? '0.5in' : '35px'\"\n              [width]=\"model.options.isMobileDevice ? '0.4in' : '35px'\"\n              [boxSizing]=\"'border-box'\"\n              [arrowMarginTop]=\"'1px'\"\n              [enabled]=\"enabled(comp)\"\n              [imageCellTextAlign]=\"'center'\"\n              [innerTableWidth]=\"'100%'\"\n              [navagationPanelTooltip]=\"true\"\n              [margin]=\"comp.action == 'FirstPage' ? '0 1px 0 3px' : (comp.action == 'Zoom' ? '0 3px 0 1px' : '0px 1px 0 1px')\"\n              [selected]=\"selected(comp)\"\n              (action)=\"controller.action({ name: comp.action })\">\n            </sti-button>\n\n            <div *ngIf=\"comp.type=='separator'\"\n              [style.height]=\"model.options.isMobileDevice ? '0.5in' : '35px'\"\n              [style.margin]=\"'0px 1px 0 1px'\"\n              class=\"stiJsViewerNavigatePanelSeparator\"></div>\n\n            <sti-page-control *ngIf=\"comp.type=='pageControl'\"\n              [enabled]=\"!(model.reportParams.pagesCount <= 1 || disableNaviButtons())\"\n              [count]=\"model.reportParams.pagesCount\"\n              [margin]=\"'0px 1px 0 1px'\"\n              [textBoxBorder]=\"'0px'\"></sti-page-control>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"stiJsViewerNavigatePanelDisabledPanel\" [style.display]=\"this.model.controls.navigatePanel.enabled ? 'none' : 'block'\"></div>\n  </div>\n  "
        })
    ], NavigatePanelComponent);
    return NavigatePanelComponent;
}());
export { NavigatePanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdGUtcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25hdmlnYXRlLXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBeUIsU0FBUyxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBQ3hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBdUR2RDtJQU1FLGdDQUFtQixLQUFtQixFQUFTLFVBQTZCLEVBQVMsTUFBcUIsRUFDakcsV0FBd0I7UUFEZCxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBQVMsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ2pHLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBSDFCLFVBQUssR0FBMkIsRUFBRSxDQUFDO0lBR0wsQ0FBQztJQUV0Qyx5Q0FBUSxHQUFSO1FBQUEsaUJBVUM7UUFUQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEtBQUssV0FBVyxFQUFFO1lBQzFELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNwQjtRQUNELElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQUMsT0FBZ0I7WUFDdEQsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLGVBQWUsRUFBRTtnQkFDdEMsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQ3RCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFD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QUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO1NBQzFHO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsbURBQWtCLEdBQWxCO1FBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxRQUFRLEtBQUssZUFBZSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLFFBQVEsS0FBSyxhQUFhO1lBQy9HLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsUUFBUSxLQUFLLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDMUosQ0FBQzs7Z0JBL0Z5QixZQUFZO2dCQUFxQixpQkFBaUI7Z0JBQWlCLGFBQWE7Z0JBQ3BGLFdBQVc7O0lBTFg7UUFBckIsU0FBUyxDQUFDLFNBQVMsQ0FBQzsyREFBcUI7SUFGL0Isc0JBQXNCO1FBckRsQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsb0JBQW9CO1lBQzlCLFFBQVEsRUFBRSwrdkZBZ0RUO1NBQ0YsQ0FBQztPQUVXLHNCQUFzQixDQXNHbEM7SUFBRCw2QkFBQztDQUFBLEFBdEdELElBc0dDO1NBdEdZLHNCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbW9kZWwuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29udHJvbGxlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50RGVzY3JpcHRpb24sIE1lc3NhZ2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9vYmplY3RzJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2hlbHBlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUGFnZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9wYWdlLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzdGktbmF2aWdhdGUtcGFuZWwnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgPGRpdiAjZWxlbWVudCBjbGFzcz1cInN0aUpzVmlld2VyTmF2aWdhdGVQYW5lbFwiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCJcclxuICAgIFtzdHlsZS5kaXNwbGF5XT1cIiFtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gKHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC52aXNpYmxlID8gJycgOiAnbm9uZScpIDogJydcIlxyXG4gICAgW3N0eWxlLnRyYW5zaXRpb25dPVwibW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSA/ICdtYXJnaW4gMzAwbXMgZWFzZSwgb3BhY2l0eSAzMDBtcyBlYXNlJyA6IG51bGxcIlxyXG4gICAgW3N0eWxlLnpJbmRleF09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gKG1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSA/IDUgOiAyKSA6IG51bGxcIlxyXG4gICAgW3N0eWxlLm9wYWNpdHldPVwibW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSA/IChtb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLnZpc2libGUgPyAobW9kZWwub3B0aW9ucy50b29sYmFyLmF1dG9IaWRlID8gMC45IDogMSkgOiAwKSA6IDFcIlxyXG4gICAgW3N0eWxlLm1hcmdpbkJvdHRvbV09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlICYmICFtb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLnZpc2libGUgPyAnLTAuNTVpbicgOiAwXCI+XHJcbiAgICA8dGFibGUgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCI+XHJcbiAgICAgIDx0Ym9keT5cclxuICAgICAgICA8dHIgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGNvbXAgb2YgY29tcHNcIiBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIiBbc3R5bGUud2lkdGhdPVwiY29tcC50eXBlID09ICdzcGFjZScgPyAnMTAwJScgOiBudWxsXCI+XHJcbiAgICAgICAgICAgIDxzdGktYnV0dG9uICpuZ0lmPVwiY29tcC50eXBlPT0nYnV0dG9uJ1wiXHJcbiAgICAgICAgICAgICAgW2NhcHRpb25dPVwiY29tcC5jYXB0aW9uXCJcclxuICAgICAgICAgICAgICBbaW1hZ2VOYW1lXT1cImNvbXAuaW1nXCJcclxuICAgICAgICAgICAgICBbYXJyb3ddPVwiY29tcC5hcnJvd1wiXHJcbiAgICAgICAgICAgICAgW21lbnVJdGVtc109XCJjb21wLm1lbnVJdGVtc1wiXHJcbiAgICAgICAgICAgICAgW2FjdGlvbk5hbWVdPVwiY29tcC5hY3Rpb25cIlxyXG4gICAgICAgICAgICAgIFt0b29sdGlwXT1cImNvbXAudG9vbHRpcFwiXHJcbiAgICAgICAgICAgICAgW3N0eWxlTmFtZV09XCInc3RpSnNWaWV3ZXJOYXZpZ2F0ZUJ1dHRvbidcIlxyXG4gICAgICAgICAgICAgIFtoZWlnaHRdPVwibW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSA/ICcwLjVpbicgOiAnMzVweCdcIlxyXG4gICAgICAgICAgICAgIFt3aWR0aF09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJzAuNGluJyA6ICczNXB4J1wiXHJcbiAgICAgICAgICAgICAgW2JveFNpemluZ109XCInYm9yZGVyLWJveCdcIlxyXG4gICAgICAgICAgICAgIFthcnJvd01hcmdpblRvcF09XCInMXB4J1wiXHJcbiAgICAgICAgICAgICAgW2VuYWJsZWRdPVwiZW5hYmxlZChjb21wKVwiXHJcbiAgICAgICAgICAgICAgW2ltYWdlQ2VsbFRleHRBbGlnbl09XCInY2VudGVyJ1wiXHJcbiAgICAgICAgICAgICAgW2lubmVyVGFibGVXaWR0aF09XCInMTAwJSdcIlxyXG4gICAgICAgICAgICAgIFtuYXZhZ2F0aW9uUGFuZWxUb29sdGlwXT1cInRydWVcIlxyXG4gICAgICAgICAgICAgIFttYXJnaW5dPVwiY29tcC5hY3Rpb24gPT0gJ0ZpcnN0UGFnZScgPyAnMCAxcHggMCAzcHgnIDogKGNvbXAuYWN0aW9uID09ICdab29tJyA/ICcwIDNweCAwIDFweCcgOiAnMHB4IDFweCAwIDFweCcpXCJcclxuICAgICAgICAgICAgICBbc2VsZWN0ZWRdPVwic2VsZWN0ZWQoY29tcClcIlxyXG4gICAgICAgICAgICAgIChhY3Rpb24pPVwiY29udHJvbGxlci5hY3Rpb24oeyBuYW1lOiBjb21wLmFjdGlvbiB9KVwiPlxyXG4gICAgICAgICAgICA8L3N0aS1idXR0b24+XHJcblxyXG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiY29tcC50eXBlPT0nc2VwYXJhdG9yJ1wiXHJcbiAgICAgICAgICAgICAgW3N0eWxlLmhlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJzAuNWluJyA6ICczNXB4J1wiXHJcbiAgICAgICAgICAgICAgW3N0eWxlLm1hcmdpbl09XCInMHB4IDFweCAwIDFweCdcIlxyXG4gICAgICAgICAgICAgIGNsYXNzPVwic3RpSnNWaWV3ZXJOYXZpZ2F0ZVBhbmVsU2VwYXJhdG9yXCI+PC9kaXY+XHJcblxyXG4gICAgICAgICAgICA8c3RpLXBhZ2UtY29udHJvbCAqbmdJZj1cImNvbXAudHlwZT09J3BhZ2VDb250cm9sJ1wiXHJcbiAgICAgICAgICAgICAgW2VuYWJsZWRdPVwiIShtb2RlbC5yZXBvcnRQYXJhbXMucGFnZXNDb3VudCA8PSAxIHx8IGRpc2FibGVOYXZpQnV0dG9ucygpKVwiXHJcbiAgICAgICAgICAgICAgW2NvdW50XT1cIm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0NvdW50XCJcclxuICAgICAgICAgICAgICBbbWFyZ2luXT1cIicwcHggMXB4IDAgMXB4J1wiXHJcbiAgICAgICAgICAgICAgW3RleHRCb3hCb3JkZXJdPVwiJzBweCdcIj48L3N0aS1wYWdlLWNvbnRyb2w+XHJcbiAgICAgICAgICA8L3RkPlxyXG4gICAgICAgIDwvdHI+XHJcbiAgICAgIDwvdGJvZHk+XHJcbiAgICA8L3RhYmxlPlxyXG4gICAgPGRpdiBjbGFzcz1cInN0aUpzVmlld2VyTmF2aWdhdGVQYW5lbERpc2FibGVkUGFuZWxcIiBbc3R5bGUuZGlzcGxheV09XCJ0aGlzLm1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwuZW5hYmxlZCA/ICdub25lJyA6ICdibG9jaydcIj48L2Rpdj5cclxuICA8L2Rpdj5cclxuICBgXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTmF2aWdhdGVQYW5lbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2VsZW1lbnQnKSBlbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICBwdWJsaWMgY29tcHM6IENvbXBvbmVudERlc2NyaXB0aW9uW10gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIG1vZGVsOiBNb2RlbFNlcnZpY2UsIHB1YmxpYyBjb250cm9sbGVyOiBDb250cm9sbGVyU2VydmljZSwgcHVibGljIGhlbHBlcjogSGVscGVyU2VydmljZSxcclxuICAgIHB1YmxpYyBwYWdlU2VydmljZTogUGFnZVNlcnZpY2UpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5kaXNwbGF5TW9kZSA9PT0gJ1NlcGFyYXRlZCcpIHtcclxuICAgICAgdGhpcy5pbml0QnV0dG9ucygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jb250cm9sbGVyLmdldE1lc3NhZ2UoKS5zdWJzY3JpYmUoKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcclxuICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uICE9PSAndmlld2VyX2xvYWRlZCcpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJ1dHRvbnMoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwudmlzaWJsZSA9IHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLmRpc3BsYXlNb2RlID09PSAnU2VwYXJhdGVkJztcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC5lbCA9IHRoaXMuZWxlbWVudDtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUJ1dHRvbnMoKSB7XHJcbiAgICB0aGlzLmNvbXBzLmZpbHRlcihpID0+IGkuYWN0aW9uID09PSAnVmlld01vZGUnKS5mb3JFYWNoKG0gPT4gbS5jYXB0aW9uID0gdGhpcy5tb2RlbC5sb2ModGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudmlld01vZGUpKTtcclxuICAgIHRoaXMuY29tcHMuZmlsdGVyKGkgPT4gaS5hY3Rpb24gPT09ICdab29tJykuZm9yRWFjaCgobSkgPT4ge1xyXG4gICAgICBtLm1lbnVJdGVtcy5mb3JFYWNoKG4gPT4gbi5zZWxlY3RlZCA9IG4ubmFtZSA9PT0gKCdab29tJyArIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20pKTtcclxuICAgICAgbS5jYXB0aW9uID0gTWF0aC5yb3VuZCh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tKSArICclJztcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuY29tcHMuZmlsdGVyKGkgPT4gaS5hY3Rpb24gPT09ICdTaG93RmluZCcpLmZvckVhY2goKG0pID0+IHtcclxuICAgICAgbS5zZWxlY3RlZCA9IHRoaXMubW9kZWwuY29udHJvbHMuZmluZFBhbmVsLnZpc2libGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGluaXRCdXR0b25zKCkge1xyXG4gICAgY29uc3QgY29tcHM6IENvbXBvbmVudERlc2NyaXB0aW9uW10gPSBbXTtcclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5zaG93Rmlyc3RQYWdlQnV0dG9uKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnRmlyc3RQYWdlJywgaW1nOiAnUGFnZUZpcnN0MjAucG5nJywgdG9vbHRpcDogdHJ1ZSB9KTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5zaG93UHJldmlvdXNQYWdlQnV0dG9uKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnUHJldlBhZ2UnLCBpbWc6ICdQYWdlUHJldmlvdXMyMC5wbmcnLCB0b29sdGlwOiB0cnVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5zaG93Q3VycmVudFBhZ2VDb250cm9sKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnc2VwYXJhdG9yJyB9KTtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdwYWdlQ29udHJvbCcgfSk7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnc2VwYXJhdG9yJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuc2hvd05leHRQYWdlQnV0dG9uKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnTmV4dFBhZ2UnLCBpbWc6ICdQYWdlTmV4dDIwLnBuZycsIHRvb2x0aXA6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dMYXN0UGFnZUJ1dHRvbikge1xyXG4gICAgICBjb21wcy5wdXNoKHsgdHlwZTogJ2J1dHRvbicsIGFjdGlvbjogJ0xhc3RQYWdlJywgaW1nOiAnUGFnZUxhc3QyMC5wbmcnLCB0b29sdGlwOiB0cnVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnc3BhY2UnIH0pO1xyXG4gICAgY29tcHMucHVzaCh7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdab29tUGFnZVdpZHRoJywgaW1nOiAnWm9vbVBhZ2VXaWR0aDIwLnBuZycsIHRvb2x0aXA6IHRydWUgfSk7XHJcbiAgICBjb21wcy5wdXNoKHsgdHlwZTogJ2J1dHRvbicsIGFjdGlvbjogJ1pvb21PbmVQYWdlJywgaW1nOiAnWm9vbU9uZVBhZ2UyMC5wbmcnLCB0b29sdGlwOiB0cnVlIH0pO1xyXG5cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5zaG93Wm9vbUJ1dHRvbikge1xyXG4gICAgICBjb21wcy5wdXNoKHsgdHlwZTogJ3NlcGFyYXRvcicgfSk7XHJcbiAgICAgIGNvbXBzLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdab29tJywgY2FwdGlvbjogJzEwMCUnLCB0b29sdGlwOiB0cnVlLCBhcnJvdzogJ0Fycm93cy5TbWFsbEFycm93VXBXaGl0ZS5wbmcnLFxyXG4gICAgICAgIG1lbnVJdGVtczogdGhpcy5oZWxwZXIuZ2V0Wm9vbU1lbnVJdGVtcygpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcHMgPSBjb21wcztcclxuICB9XHJcblxyXG4gIGVuYWJsZWQoZGVzYzogQ29tcG9uZW50RGVzY3JpcHRpb24pOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGRpc2FibGVOYXZpQnV0dG9ucyA9IHRoaXMuZGlzYWJsZU5hdmlCdXR0b25zKCk7XHJcbiAgICBzd2l0Y2ggKGRlc2MuYWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ0ZpcnN0UGFnZSc6XHJcbiAgICAgIGNhc2UgJ1ByZXZQYWdlJzpcclxuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA+IDAgJiYgIWRpc2FibGVOYXZpQnV0dG9ucztcclxuICAgICAgY2FzZSAnTmV4dFBhZ2UnOlxyXG4gICAgICBjYXNlICdMYXN0UGFnZSc6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPCB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0NvdW50IC0gMSAmJiAhZGlzYWJsZU5hdmlCdXR0b25zO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RlZChkZXNjOiBDb21wb25lbnREZXNjcmlwdGlvbik6IGJvb2xlYW4ge1xyXG4gICAgc3dpdGNoIChkZXNjLmFjdGlvbikge1xyXG4gICAgICBjYXNlICdab29tUGFnZVdpZHRoJzpcclxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tKSA9PT0gTWF0aC5yb3VuZCh0aGlzLnBhZ2VTZXJ2aWNlLmdldFpvb21CeVBhZ2VXaWR0aCgpKTtcclxuICAgICAgY2FzZSAnWm9vbU9uZVBhZ2UnOlxyXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20pID09PSBNYXRoLnJvdW5kKHRoaXMucGFnZVNlcnZpY2UuZ2V0Wm9vbUJ5UGFnZUhlaWdodCgpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGRpc2FibGVOYXZpQnV0dG9ucygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSA9PT0gJ011bHRpcGxlUGFnZXMnIHx8IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnZpZXdNb2RlID09PSAnV2hvbGVSZXBvcnQnIHx8XHJcbiAgICAgICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSA9PT0gJ0NvbnRpbnVvdXMnICYmICF0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5zY3JvbGxiYXJzTW9kZSAmJiAhdGhpcy5tb2RlbC5vcHRpb25zLmFwcGVhcmFuY2UuZnVsbFNjcmVlbk1vZGUpO1xyXG4gIH1cclxufVxyXG4iXX0=