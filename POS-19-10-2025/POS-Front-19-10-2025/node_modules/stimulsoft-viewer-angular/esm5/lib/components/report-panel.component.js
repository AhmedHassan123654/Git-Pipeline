import { __decorate } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { ControllerService } from '../services/controller.service';
import { ModelService } from '../services/model.service';
import { StylesService } from '../services/styles.service';
import { InteractionsService } from '../services/interactions.service';
var ReportPanelComponent = /** @class */ (function () {
    function ReportPanelComponent(controller, model, stylesService, interactionService) {
        var _this = this;
        this.controller = controller;
        this.model = model;
        this.stylesService = stylesService;
        this.interactionService = interactionService;
        this.touchZoomFirstDistance = 0;
        this.touchZoomSecondDistance = 0;
        this.touchZoomValue = 0;
        this.maxHeights = {};
        controller.getMessage().subscribe(function (message) {
            if (message.action !== 'viewer_loaded' && _this.model.reportParams.pagesArray) {
                if (_this.model.reportParams.repaintOnlyDashboardContent) {
                    // jsObject.controls.reportPanel.repaintDashboardContent(parameters);
                }
                else {
                    _this.loadPages();
                }
            }
            if (message.action === 'GetReport' || message.action === 'OpenReport') {
                setTimeout(function () {
                    if (!_this.model.options.isParametersReceived && ((_this.model.reportParams.type === 'Report' && _this.model.options.toolbar.showParametersButton) || _this.model.reportParams.type === 'Dashboard')) {
                        interactionService.postInteraction({ action: 'InitVars' });
                    }
                    if (_this.model.reportParams.autoZoom) {
                        _this.controller.action({ name: _this.model.reportParams.autoZoom === -1 ? 'ZoomPageWidth' : 'ZoomOnePage' });
                        _this.model.reportParams.autoZoom = null;
                    }
                });
            }
        });
    }
    ReportPanelComponent.prototype.ngOnInit = function () { };
    ReportPanelComponent.prototype.ngAfterViewInit = function () {
        this.model.controls.reportPanel.el = this.element;
    };
    ReportPanelComponent.prototype.loadPages = function () {
        var _this = this;
        this.maxHeights = {};
        var pagesArray = this.model.reportParams.pagesArray;
        this.stylesService.setupStyle(pagesArray[pagesArray.length - 2], 'page');
        var chartScript = pagesArray[pagesArray.length - 1];
        this.model.pages = pagesArray.slice(0, pagesArray.length - 2);
        setTimeout(function () {
            _this.model.pages.forEach(function (page) { return _this.interactionService.initializeInteractions(page.page); });
            _this.interactionService.updateAllHyperLinks();
            _this.stylesService.addChartScript(chartScript);
        });
    };
    Object.defineProperty(ReportPanelComponent.prototype, "position", {
        get: function () {
            return this.model.options.heightType !== 'Percentage' || this.model.options.appearance.scrollbarsMode ? 'absolute' : 'relative';
        },
        enumerable: true,
        configurable: true
    });
    ReportPanelComponent.prototype.scroll = function () {
        var _this = this;
        if (this.model.pagesNavigationIsActive()) {
            clearTimeout(this.scrollTimeout);
            // update current page number
            this.scrollTimeout = setTimeout(function () {
                var commonPagesHeight = 0;
                var index = 0;
                for (index = 0; index < _this.model.pages.length; index++) {
                    commonPagesHeight += _this.model.pages[index].page.offsetHeight + 10;
                    if (commonPagesHeight > _this.element.nativeElement.scrollTop) {
                        break;
                    }
                }
                if (index < _this.model.reportParams.pagesCount && index >= 0 && index !== _this.model.reportParams.pageNumber) {
                    _this.model.reportParams.pageNumber = index;
                }
            }, 300);
        }
    };
    ReportPanelComponent.prototype.eventTouchStart = function (e) {
        this.touchesLength++;
        this.touchStartX = parseInt(e.changedTouches[0].clientX, 10);
        if (this.model.options.appearance.allowTouchZoom && this.touchesLength === 1) {
            this.touchZoomFirstDistance = 0;
            this.touchZoomSecondDistance = 0;
            this.touchZoomValue = 0;
        }
    };
    ReportPanelComponent.prototype.eventTouchMove = function (e) {
        if (this.model.options.appearance.allowTouchZoom && e.touches.length > 1) {
            if ('preventDefault' in e) {
                e.preventDefault();
            }
            this.touchZoomSecondDistance = Math.sqrt(Math.pow(e.touches[0].pageX - e.touches[1].pageX, 2) + Math.pow(e.touches[0].pageY - e.touches[1].pageY, 2));
            if (this.touchZoomFirstDistance === 0) {
                this.touchZoomFirstDistance = Math.sqrt(Math.pow(e.touches[0].pageX - e.touches[1].pageX, 2) + Math.pow(e.touches[0].pageY - e.touches[1].pageY, 2));
            }
            var touchZoomOffset = Math.trunc((this.touchZoomSecondDistance - this.touchZoomFirstDistance) / 2.5);
            if (Math.abs(touchZoomOffset) >= 5) {
                this.touchZoomValue = Math.trunc((this.model.reportParams.zoom + touchZoomOffset) / 5) * 5;
                this.touchZoomValue = Math.min(Math.max(this.touchZoomValue, 20), 200);
                this.controller.actionSubject.next({ action: 'centerText', data: this.touchZoomValue.toString() });
            }
        }
    };
    ReportPanelComponent.prototype.eventTouchEnd = function (e) {
        if (this.touchesLength > 0) {
            this.touchesLength--;
        }
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            if (Math.trunc(this.touchStartX - e.changedTouches[0].clientX) !== 0) {
                this.controller.keepToolbar();
            }
            else {
                if (!this.model.controls.toolbar.visible) {
                    this.controller.showToolbar();
                }
                else {
                    this.controller.hideToolbar();
                }
            }
        }
        if (this.model.options.appearance.allowTouchZoom && this.touchZoomValue !== 0 && this.touchesLength === 0) {
            this.controller.actionSubject.next({ action: 'hideCenterText' });
            this.model.reportParams.zoom = this.touchZoomValue;
            this.controller.post('GetPages');
        }
    };
    ReportPanelComponent.ctorParameters = function () { return [
        { type: ControllerService },
        { type: ModelService },
        { type: StylesService },
        { type: InteractionsService }
    ]; };
    __decorate([
        ViewChild('element')
    ], ReportPanelComponent.prototype, "element", void 0);
    ReportPanelComponent = __decorate([
        Component({
            selector: 'sti-report-panel',
            template: "\n    <div #element\n         [style.textAlign]=\"model.options.appearance.pageAlignment == 'default' ? 'center' : model.options.appearance.pageAlignment\"\n         [style.top]=\"0\"\n         [style.bottom]=\"0\"\n         [style.position]=\"position\"\n         [style.height]=\"model.options.heightType != 'Percentage' || model.options.appearance.scrollbarsMode ? 'auto' : 'calc(100% - 35px)'\"\n         [style.overflow] = \"model.reportParams.type == 'Report' && model.options.appearance.scrollbarsMode ? 'auto' : 'hidden'\"\n         [style.marginTop.px]=\"model.controls.reportPanel.layout.top\"\n         [style.marginLeft.px]=\"model.controls.reportPanel.layout.left\"\n         [style.marginBottom.px]=\"position == 'absolute' ? model.controls.reportPanel.layout.bottom : 0\"\n         [style.paddingBottom.px]=\"position == 'relative' ? model.controls.reportPanel.layout.bottom : 0\"\n         [style.transition]=\"model.options.isMobileDevice ? 'margin 200ms ease' : null\"\n         (scroll)=\"scroll()\"\n         class=\"stiJsViewerReportPanel\"\n         (touchstart)=\"eventTouchStart($event)\"\n         (touchmove)=\"eventTouchMove($event)\"\n         (touchend)=\"eventTouchEnd($event)\">\n      <sti-page *ngFor=\"let page of model.pages\" [pageAttributes]=\"page\" [reportPanel]=\"this\"></sti-page>\n    </div>\n  "
        })
    ], ReportPanelComponent);
    return ReportPanelComponent;
}());
export { ReportPanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0LXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3N0aW11bHNvZnQtdmlld2VyLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9yZXBvcnQtcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBNkIsTUFBTSxlQUFlLENBQUM7QUFDeEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDbkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQTRCdkU7SUFhRSw4QkFBb0IsVUFBNkIsRUFBUyxLQUFtQixFQUFVLGFBQTRCLEVBQVUsa0JBQXVDO1FBQXBLLGlCQTBCQztRQTFCbUIsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBQVUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQXFCO1FBUDVKLDJCQUFzQixHQUFHLENBQUMsQ0FBQztRQUMzQiw0QkFBdUIsR0FBRyxDQUFDLENBQUM7UUFDNUIsbUJBQWMsR0FBRyxDQUFDLENBQUM7UUFHcEIsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUlyQixVQUFVLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQUMsT0FBZ0I7WUFFakQsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLGVBQWUsSUFBSSxLQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUU7Z0JBQzVFLElBQUksS0FBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsMkJBQTJCLEVBQUU7b0JBQ3ZELHFFQUFxRTtpQkFDdEU7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QTJJQztTQTNJWSxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29udHJvbGxlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbW9kZWwuc2VydmljZSc7XHJcbmltcG9ydCB7IFN0eWxlc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9zdHlsZXMuc2VydmljZSc7XHJcbmltcG9ydCB7IEludGVyYWN0aW9uc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9pbnRlcmFjdGlvbnMuc2VydmljZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9vYmplY3RzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc3RpLXJlcG9ydC1wYW5lbCcsXHJcbiAgdGVtcGxhdGU6IGBcclxuICAgIDxkaXYgI2VsZW1lbnRcclxuICAgICAgICAgW3N0eWxlLnRleHRBbGlnbl09XCJtb2RlbC5vcHRpb25zLmFwcGVhcmFuY2UucGFnZUFsaWdubWVudCA9PSAnZGVmYXVsdCcgPyAnY2VudGVyJyA6IG1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5wYWdlQWxpZ25tZW50XCJcclxuICAgICAgICAgW3N0eWxlLnRvcF09XCIwXCJcclxuICAgICAgICAgW3N0eWxlLmJvdHRvbV09XCIwXCJcclxuICAgICAgICAgW3N0eWxlLnBvc2l0aW9uXT1cInBvc2l0aW9uXCJcclxuICAgICAgICAgW3N0eWxlLmhlaWdodF09XCJtb2RlbC5vcHRpb25zLmhlaWdodFR5cGUgIT0gJ1BlcmNlbnRhZ2UnIHx8IG1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5zY3JvbGxiYXJzTW9kZSA/ICdhdXRvJyA6ICdjYWxjKDEwMCUgLSAzNXB4KSdcIlxyXG4gICAgICAgICBbc3R5bGUub3ZlcmZsb3ddID0gXCJtb2RlbC5yZXBvcnRQYXJhbXMudHlwZSA9PSAnUmVwb3J0JyAmJiBtb2RlbC5vcHRpb25zLmFwcGVhcmFuY2Uuc2Nyb2xsYmFyc01vZGUgPyAnYXV0bycgOiAnaGlkZGVuJ1wiXHJcbiAgICAgICAgIFtzdHlsZS5tYXJnaW5Ub3AucHhdPVwibW9kZWwuY29udHJvbHMucmVwb3J0UGFuZWwubGF5b3V0LnRvcFwiXHJcbiAgICAgICAgIFtzdHlsZS5tYXJnaW5MZWZ0LnB4XT1cIm1vZGVsLmNvbnRyb2xzLnJlcG9ydFBhbmVsLmxheW91dC5sZWZ0XCJcclxuICAgICAgICAgW3N0eWxlLm1hcmdpbkJvdHRvbS5weF09XCJwb3NpdGlvbiA9PSAnYWJzb2x1dGUnID8gbW9kZWwuY29udHJvbHMucmVwb3J0UGFuZWwubGF5b3V0LmJvdHRvbSA6IDBcIlxyXG4gICAgICAgICBbc3R5bGUucGFkZGluZ0JvdHRvbS5weF09XCJwb3NpdGlvbiA9PSAncmVsYXRpdmUnID8gbW9kZWwuY29udHJvbHMucmVwb3J0UGFuZWwubGF5b3V0LmJvdHRvbSA6IDBcIlxyXG4gICAgICAgICBbc3R5bGUudHJhbnNpdGlvbl09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJ21hcmdpbiAyMDBtcyBlYXNlJyA6IG51bGxcIlxyXG4gICAgICAgICAoc2Nyb2xsKT1cInNjcm9sbCgpXCJcclxuICAgICAgICAgY2xhc3M9XCJzdGlKc1ZpZXdlclJlcG9ydFBhbmVsXCJcclxuICAgICAgICAgKHRvdWNoc3RhcnQpPVwiZXZlbnRUb3VjaFN0YXJ0KCRldmVudClcIlxyXG4gICAgICAgICAodG91Y2htb3ZlKT1cImV2ZW50VG91Y2hNb3ZlKCRldmVudClcIlxyXG4gICAgICAgICAodG91Y2hlbmQpPVwiZXZlbnRUb3VjaEVuZCgkZXZlbnQpXCI+XHJcbiAgICAgIDxzdGktcGFnZSAqbmdGb3I9XCJsZXQgcGFnZSBvZiBtb2RlbC5wYWdlc1wiIFtwYWdlQXR0cmlidXRlc109XCJwYWdlXCIgW3JlcG9ydFBhbmVsXT1cInRoaXNcIj48L3N0aS1wYWdlPlxyXG4gICAgPC9kaXY+XHJcbiAgYFxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIFJlcG9ydFBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZWxlbWVudCcpIGVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIHByaXZhdGUgc2Nyb2xsVGltZW91dDogYW55O1xyXG4gIHByaXZhdGUgdG91Y2hlc0xlbmd0aDogbnVtYmVyO1xyXG4gIHByaXZhdGUgdG91Y2hab29tRmlyc3REaXN0YW5jZSA9IDA7XHJcbiAgcHJpdmF0ZSB0b3VjaFpvb21TZWNvbmREaXN0YW5jZSA9IDA7XHJcbiAgcHJpdmF0ZSB0b3VjaFpvb21WYWx1ZSA9IDA7XHJcbiAgcHJpdmF0ZSB0b3VjaFN0YXJ0WDogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgbWF4SGVpZ2h0cyA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlLCBwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHJpdmF0ZSBzdHlsZXNTZXJ2aWNlOiBTdHlsZXNTZXJ2aWNlLCBwcml2YXRlIGludGVyYWN0aW9uU2VydmljZTogSW50ZXJhY3Rpb25zU2VydmljZSkge1xyXG5cclxuICAgIGNvbnRyb2xsZXIuZ2V0TWVzc2FnZSgpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xyXG5cclxuICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uICE9PSAndmlld2VyX2xvYWRlZCcgJiYgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZXNBcnJheSkge1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5yZXBhaW50T25seURhc2hib2FyZENvbnRlbnQpIHtcclxuICAgICAgICAgIC8vIGpzT2JqZWN0LmNvbnRyb2xzLnJlcG9ydFBhbmVsLnJlcGFpbnREYXNoYm9hcmRDb250ZW50KHBhcmFtZXRlcnMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRQYWdlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnR2V0UmVwb3J0JyB8fCBtZXNzYWdlLmFjdGlvbiA9PT0gJ09wZW5SZXBvcnQnKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXRoaXMubW9kZWwub3B0aW9ucy5pc1BhcmFtZXRlcnNSZWNlaXZlZCAmJiAoKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnR5cGUgPT09ICdSZXBvcnQnICYmIHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dQYXJhbWV0ZXJzQnV0dG9uKSB8fCB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy50eXBlID09PSAnRGFzaGJvYXJkJykpIHtcclxuICAgICAgICAgICAgaW50ZXJhY3Rpb25TZXJ2aWNlLnBvc3RJbnRlcmFjdGlvbih7IGFjdGlvbjogJ0luaXRWYXJzJyB9KTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuYXV0b1pvb20pIHtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmFjdGlvbih7IG5hbWU6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLmF1dG9ab29tID09PSAtMSA/ICdab29tUGFnZVdpZHRoJyA6ICdab29tT25lUGFnZScgfSk7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLmF1dG9ab29tID0gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7IH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy5yZXBvcnRQYW5lbC5lbCA9IHRoaXMuZWxlbWVudDtcclxuICB9XHJcblxyXG4gIGxvYWRQYWdlcygpIHtcclxuICAgIHRoaXMubWF4SGVpZ2h0cyA9IHt9O1xyXG4gICAgY29uc3QgcGFnZXNBcnJheTogW10gPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0FycmF5O1xyXG4gICAgdGhpcy5zdHlsZXNTZXJ2aWNlLnNldHVwU3R5bGUocGFnZXNBcnJheVtwYWdlc0FycmF5Lmxlbmd0aCAtIDJdLCAncGFnZScpO1xyXG4gICAgY29uc3QgY2hhcnRTY3JpcHQgPSBwYWdlc0FycmF5W3BhZ2VzQXJyYXkubGVuZ3RoIC0gMV07XHJcbiAgICB0aGlzLm1vZGVsLnBhZ2VzID0gcGFnZXNBcnJheS5zbGljZSgwLCBwYWdlc0FycmF5Lmxlbmd0aCAtIDIpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLm1vZGVsLnBhZ2VzLmZvckVhY2gocGFnZSA9PiB0aGlzLmludGVyYWN0aW9uU2VydmljZS5pbml0aWFsaXplSW50ZXJhY3Rpb25zKHBhZ2UucGFnZSkpO1xyXG4gICAgICB0aGlzLmludGVyYWN0aW9uU2VydmljZS51cGRhdGVBbGxIeXBlckxpbmtzKCk7XHJcbiAgICAgIHRoaXMuc3R5bGVzU2VydmljZS5hZGRDaGFydFNjcmlwdChjaGFydFNjcmlwdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBnZXQgcG9zaXRpb24oKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLm1vZGVsLm9wdGlvbnMuaGVpZ2h0VHlwZSAhPT0gJ1BlcmNlbnRhZ2UnIHx8IHRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLnNjcm9sbGJhcnNNb2RlID8gJ2Fic29sdXRlJyA6ICdyZWxhdGl2ZSc7XHJcbiAgfVxyXG5cclxuICBzY3JvbGwoKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlbC5wYWdlc05hdmlnYXRpb25Jc0FjdGl2ZSgpKSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNjcm9sbFRpbWVvdXQpO1xyXG5cclxuICAgICAgLy8gdXBkYXRlIGN1cnJlbnQgcGFnZSBudW1iZXJcclxuICAgICAgdGhpcy5zY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgbGV0IGNvbW1vblBhZ2VzSGVpZ2h0ID0gMDtcclxuICAgICAgICBsZXQgaW5kZXggPSAwO1xyXG5cclxuICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm1vZGVsLnBhZ2VzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgY29tbW9uUGFnZXNIZWlnaHQgKz0gdGhpcy5tb2RlbC5wYWdlc1tpbmRleF0ucGFnZS5vZmZzZXRIZWlnaHQgKyAxMDtcclxuICAgICAgICAgIGlmIChjb21tb25QYWdlc0hlaWdodCA+IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCkge1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChpbmRleCA8IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VzQ291bnQgJiYgaW5kZXggPj0gMCAmJiBpbmRleCAhPT0gdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlcikge1xyXG4gICAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA9IGluZGV4O1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgMzAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBldmVudFRvdWNoU3RhcnQoZTogYW55KSB7XHJcbiAgICB0aGlzLnRvdWNoZXNMZW5ndGgrKztcclxuICAgIHRoaXMudG91Y2hTdGFydFggPSBwYXJzZUludChlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFgsIDEwKTtcclxuXHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmFwcGVhcmFuY2UuYWxsb3dUb3VjaFpvb20gJiYgdGhpcy50b3VjaGVzTGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIHRoaXMudG91Y2hab29tRmlyc3REaXN0YW5jZSA9IDA7XHJcbiAgICAgIHRoaXMudG91Y2hab29tU2Vjb25kRGlzdGFuY2UgPSAwO1xyXG4gICAgICB0aGlzLnRvdWNoWm9vbVZhbHVlID0gMDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBldmVudFRvdWNoTW92ZShlOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5hbGxvd1RvdWNoWm9vbSAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICBpZiAoJ3ByZXZlbnREZWZhdWx0JyBpbiBlKSB7IGUucHJldmVudERlZmF1bHQoKTsgfVxyXG5cclxuICAgICAgdGhpcy50b3VjaFpvb21TZWNvbmREaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdyhlLnRvdWNoZXNbMF0ucGFnZVggLSBlLnRvdWNoZXNbMV0ucGFnZVgsIDIpICsgTWF0aC5wb3coZS50b3VjaGVzWzBdLnBhZ2VZIC0gZS50b3VjaGVzWzFdLnBhZ2VZLCAyKSk7XHJcbiAgICAgIGlmICh0aGlzLnRvdWNoWm9vbUZpcnN0RGlzdGFuY2UgPT09IDApIHtcclxuICAgICAgICB0aGlzLnRvdWNoWm9vbUZpcnN0RGlzdGFuY2UgPSBNYXRoLnNxcnQoTWF0aC5wb3coZS50b3VjaGVzWzBdLnBhZ2VYIC0gZS50b3VjaGVzWzFdLnBhZ2VYLCAyKSArIE1hdGgucG93KGUudG91Y2hlc1swXS5wYWdlWSAtIGUudG91Y2hlc1sxXS5wYWdlWSwgMikpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0b3VjaFpvb21PZmZzZXQgPSBNYXRoLnRydW5jKCh0aGlzLnRvdWNoWm9vbVNlY29uZERpc3RhbmNlIC0gdGhpcy50b3VjaFpvb21GaXJzdERpc3RhbmNlKSAvIDIuNSk7XHJcbiAgICAgIGlmIChNYXRoLmFicyh0b3VjaFpvb21PZmZzZXQpID49IDUpIHtcclxuICAgICAgICB0aGlzLnRvdWNoWm9vbVZhbHVlID0gTWF0aC50cnVuYygodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSArIHRvdWNoWm9vbU9mZnNldCkgLyA1KSAqIDU7XHJcbiAgICAgICAgdGhpcy50b3VjaFpvb21WYWx1ZSA9IE1hdGgubWluKE1hdGgubWF4KHRoaXMudG91Y2hab29tVmFsdWUsIDIwKSwgMjAwKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnY2VudGVyVGV4dCcsIGRhdGE6IHRoaXMudG91Y2hab29tVmFsdWUudG9TdHJpbmcoKSB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGV2ZW50VG91Y2hFbmQoZTogYW55KSB7XHJcbiAgICBpZiAodGhpcy50b3VjaGVzTGVuZ3RoID4gMCkgeyB0aGlzLnRvdWNoZXNMZW5ndGgtLTsgfVxyXG5cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgJiYgdGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuYXV0b0hpZGUpIHtcclxuICAgICAgaWYgKE1hdGgudHJ1bmModGhpcy50b3VjaFN0YXJ0WCAtIGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCkgIT09IDApIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIua2VlcFRvb2xiYXIoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoIXRoaXMubW9kZWwuY29udHJvbHMudG9vbGJhci52aXNpYmxlKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuc2hvd1Rvb2xiYXIoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jb250cm9sbGVyLmhpZGVUb29sYmFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLmFsbG93VG91Y2hab29tICYmIHRoaXMudG91Y2hab29tVmFsdWUgIT09IDAgJiYgdGhpcy50b3VjaGVzTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRoaXMuY29udHJvbGxlci5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdoaWRlQ2VudGVyVGV4dCcgfSk7XHJcbiAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSB0aGlzLnRvdWNoWm9vbVZhbHVlO1xyXG4gICAgICB0aGlzLmNvbnRyb2xsZXIucG9zdCgnR2V0UGFnZXMnKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19