import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ControllerService } from './controller.service';
import { ModelService } from './model.service';
import { HelperService } from './helper.service';
let DrillDownService = class DrillDownService {
    constructor(controller, model, helper) {
        this.controller = controller;
        this.model = model;
        this.helper = helper;
        controller.getMessage().subscribe((message) => {
            if (message.action !== 'InitVars' && message.action !== 'viewer_loaded') {
                this.model.options.drillDownInProgress = false;
                const parameters = message.data;
                if (this.model.drillDownButtons.length === 0) {
                    this.addButton(parameters.reportFileName, {});
                }
                if (message.action === 'DrillDown') {
                    const useDbsDrillDownPanel = false; // jsObject.controls.dashboardsPanel && jsObject.controls.dashboardsPanel.visible && jsObject.controls.dashboardsPanel.selectedButton;
                    if (useDbsDrillDownPanel) {
                        // jsObject.controls.dashboardsPanel.addDrillDownButton(null, parameters.drillDownGuid, parameters.drillDownParameters, parameters.previewSettings, parameters.reportFileName);
                    }
                    this.showDrillDownPage(parameters.reportFileName, parameters.drillDownGuid, parameters.drillDownParameters, useDbsDrillDownPanel);
                }
            }
        });
    }
    showDrillDownPage(reportFileName, drillDownGuid, drillDownParameters, useDbsDrillDownPanel) {
        if (useDbsDrillDownPanel) {
            return;
        }
        let buttonExist = false;
        this.model.drillDownButtons.forEach((b) => {
            if (b.reportParams.drillDownGuid === drillDownGuid) {
                this.model.drillDownButtons.forEach(bt => bt.selected = false);
                buttonExist = b.selected = b.visible = true;
            }
        });
        if (!buttonExist) {
            this.addButton(reportFileName);
            this.model.reportParams.drillDownParameters = drillDownParameters;
            this.model.reportParams.pageNumber = 0;
            this.model.reportParams.pagesWidth = 0;
            this.model.reportParams.pagesHeight = 0;
        }
    }
    addButton(caption, reportParams = {}) {
        this.model.drillDownButtons.forEach(b => b.selected = false);
        this.model.drillDownButtons.push({ caption, selected: true, reportParams, visible: true });
        this.updateVisibility();
    }
    updateVisibility() {
        this.model.controls.drillDownPanel.visible = this.model.drillDownButtons.length > 1;
    }
    saveState() {
        const sButton = this.model.drillDownButtons.find(b => b.selected);
        if (sButton) {
            sButton.reportParams = this.model.getReportParams();
        }
    }
};
DrillDownService.ctorParameters = () => [
    { type: ControllerService },
    { type: ModelService },
    { type: HelperService }
];
DrillDownService = __decorate([
    Injectable()
], DrillDownService);
export { DrillDownService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJpbGwtZG93bi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9kcmlsbC1kb3duLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUdqRCxJQUFhLGdCQUFnQixHQUE3QixNQUFhLGdCQUFnQjtJQUUzQixZQUFtQixVQUE2QixFQUFTLEtBQW1CLEVBQVMsTUFBcUI7UUFBdkYsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUN4RyxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBZ0IsRUFBRSxFQUFFO1lBQ3JELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxVQUFVLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxlQUFlLEVBQUU7Z0JBQ3ZFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztnQkFDL0MsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFFaEMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7b0JBQzVDLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDL0M7Z0JBRUQsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLFdBQVcsRUFBRTtvQkFDbEMsTUFBTSxvQkFBb0IsR0FBRyxLQUFLLENBQUMsQ0FBQyxzSUFBc0k7b0JBQzFLLElBQUksb0JBQW9CLEVBQUU7d0JBQ3hCLCtLQUErSztxQkFDaEw7b0JBQ0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsbUJBQW1CLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztpQkFDbkk7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBRUwsQ0FBQztJQUVPLGlCQUFpQixDQUFDLGNBQXNCLEVBQUUsYUFBcUIsRUFBRSxtQkFBd0IsRUFBRSxvQkFBNkI7UUFDOUgsSUFBSSxvQkFBb0IsRUFBRTtZQUFFLE9BQU87U0FBRTtRQUVyQyxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFZLEVBQUUsRUFBRTtZQUNuRCxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsYUFBYSxLQUFLLGFBQWEsRUFBRTtnQkFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDO2dCQUMvRCxXQUFXLEdBQUcsQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQzthQUM3QztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO1lBQ2xFLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7WUFDdkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztZQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO1NBQ3pDO0lBQ0gsQ0FBQztJQUVNLFNBQVMsQ0FBQyxPQUFlLEVBQUUsZUFBb0IsRUFBRTtRQUN0RCxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDM0YsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVNLGdCQUFnQjtRQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBRU0sU0FBUztRQUNkLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xFLElBQUksT0FBTyxFQUFFO1lBQ1gsT0FBTyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3JEO0lBQ0gsQ0FBQztDQUVGLENBQUE7O1lBM0RnQyxpQkFBaUI7WUFBZ0IsWUFBWTtZQUFpQixhQUFhOztBQUYvRixnQkFBZ0I7SUFENUIsVUFBVSxFQUFFO0dBQ0EsZ0JBQWdCLENBNkQ1QjtTQTdEWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERyaWxsRG93biwgTWVzc2FnZSB9IGZyb20gJy4vb2JqZWN0cyc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb250cm9sbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnLi9oZWxwZXIuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEcmlsbERvd25TZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlLCBwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIGhlbHBlcjogSGVscGVyU2VydmljZSkge1xyXG4gICAgY29udHJvbGxlci5nZXRNZXNzYWdlKCkuc3Vic2NyaWJlKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XHJcbiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiAhPT0gJ0luaXRWYXJzJyAmJiBtZXNzYWdlLmFjdGlvbiAhPT0gJ3ZpZXdlcl9sb2FkZWQnKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5vcHRpb25zLmRyaWxsRG93bkluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gbWVzc2FnZS5kYXRhO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2RlbC5kcmlsbERvd25CdXR0b25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgdGhpcy5hZGRCdXR0b24ocGFyYW1ldGVycy5yZXBvcnRGaWxlTmFtZSwge30pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnRHJpbGxEb3duJykge1xyXG4gICAgICAgICAgY29uc3QgdXNlRGJzRHJpbGxEb3duUGFuZWwgPSBmYWxzZTsgLy8ganNPYmplY3QuY29udHJvbHMuZGFzaGJvYXJkc1BhbmVsICYmIGpzT2JqZWN0LmNvbnRyb2xzLmRhc2hib2FyZHNQYW5lbC52aXNpYmxlICYmIGpzT2JqZWN0LmNvbnRyb2xzLmRhc2hib2FyZHNQYW5lbC5zZWxlY3RlZEJ1dHRvbjtcclxuICAgICAgICAgIGlmICh1c2VEYnNEcmlsbERvd25QYW5lbCkge1xyXG4gICAgICAgICAgICAvLyBqc09iamVjdC5jb250cm9scy5kYXNoYm9hcmRzUGFuZWwuYWRkRHJpbGxEb3duQnV0dG9uKG51bGwsIHBhcmFtZXRlcnMuZHJpbGxEb3duR3VpZCwgcGFyYW1ldGVycy5kcmlsbERvd25QYXJhbWV0ZXJzLCBwYXJhbWV0ZXJzLnByZXZpZXdTZXR0aW5ncywgcGFyYW1ldGVycy5yZXBvcnRGaWxlTmFtZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLnNob3dEcmlsbERvd25QYWdlKHBhcmFtZXRlcnMucmVwb3J0RmlsZU5hbWUsIHBhcmFtZXRlcnMuZHJpbGxEb3duR3VpZCwgcGFyYW1ldGVycy5kcmlsbERvd25QYXJhbWV0ZXJzLCB1c2VEYnNEcmlsbERvd25QYW5lbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3dEcmlsbERvd25QYWdlKHJlcG9ydEZpbGVOYW1lOiBzdHJpbmcsIGRyaWxsRG93bkd1aWQ6IHN0cmluZywgZHJpbGxEb3duUGFyYW1ldGVyczogYW55LCB1c2VEYnNEcmlsbERvd25QYW5lbDogYm9vbGVhbikge1xyXG4gICAgaWYgKHVzZURic0RyaWxsRG93blBhbmVsKSB7IHJldHVybjsgfVxyXG5cclxuICAgIGxldCBidXR0b25FeGlzdCA9IGZhbHNlO1xyXG4gICAgdGhpcy5tb2RlbC5kcmlsbERvd25CdXR0b25zLmZvckVhY2goKGI6IERyaWxsRG93bikgPT4ge1xyXG4gICAgICBpZiAoYi5yZXBvcnRQYXJhbXMuZHJpbGxEb3duR3VpZCA9PT0gZHJpbGxEb3duR3VpZCkge1xyXG4gICAgICAgIHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5mb3JFYWNoKGJ0ID0+IGJ0LnNlbGVjdGVkID0gZmFsc2UpO1xyXG4gICAgICAgIGJ1dHRvbkV4aXN0ID0gYi5zZWxlY3RlZCA9IGIudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmICghYnV0dG9uRXhpc3QpIHtcclxuICAgICAgdGhpcy5hZGRCdXR0b24ocmVwb3J0RmlsZU5hbWUpO1xyXG4gICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5kcmlsbERvd25QYXJhbWV0ZXJzID0gZHJpbGxEb3duUGFyYW1ldGVycztcclxuICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA9IDA7XHJcbiAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VzV2lkdGggPSAwO1xyXG4gICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0hlaWdodCA9IDA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYWRkQnV0dG9uKGNhcHRpb246IHN0cmluZywgcmVwb3J0UGFyYW1zOiBhbnkgPSB7fSkge1xyXG4gICAgdGhpcy5tb2RlbC5kcmlsbERvd25CdXR0b25zLmZvckVhY2goYiA9PiBiLnNlbGVjdGVkID0gZmFsc2UpO1xyXG4gICAgdGhpcy5tb2RlbC5kcmlsbERvd25CdXR0b25zLnB1c2goeyBjYXB0aW9uLCBzZWxlY3RlZDogdHJ1ZSwgcmVwb3J0UGFyYW1zLCB2aXNpYmxlOiB0cnVlIH0pO1xyXG4gICAgdGhpcy51cGRhdGVWaXNpYmlsaXR5KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlVmlzaWJpbGl0eSgpIHtcclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMuZHJpbGxEb3duUGFuZWwudmlzaWJsZSA9IHRoaXMubW9kZWwuZHJpbGxEb3duQnV0dG9ucy5sZW5ndGggPiAxO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNhdmVTdGF0ZSgpIHtcclxuICAgIGNvbnN0IHNCdXR0b24gPSB0aGlzLm1vZGVsLmRyaWxsRG93bkJ1dHRvbnMuZmluZChiID0+IGIuc2VsZWN0ZWQpO1xyXG4gICAgaWYgKHNCdXR0b24pIHtcclxuICAgICAgc0J1dHRvbi5yZXBvcnRQYXJhbXMgPSB0aGlzLm1vZGVsLmdldFJlcG9ydFBhcmFtcygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuIl19