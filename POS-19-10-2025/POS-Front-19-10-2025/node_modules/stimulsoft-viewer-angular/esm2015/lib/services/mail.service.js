import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ModelService } from './model.service';
import { ExportService } from './export.service';
import { FormService } from '../forms/form.service';
import { ControllerService } from './controller.service';
let MailService = class MailService {
    constructor(model, exportService, formService, controller) {
        this.model = model;
        this.exportService = exportService;
        this.formService = formService;
        this.controller = controller;
        exportService.getMessage().subscribe(event => {
            if (event === 'postMail') {
                this.postMail();
            }
        });
    }
    postMail() {
        this.fillDefaults();
        if (this.model.options.email.showEmailDialog) {
            this.formService.showForm('sendEmailForm');
        }
        else {
            this.sendMail();
        }
    }
    sendMail() {
        const data = {
            exportFormat: this.exportService.format,
            exportSettings: this.exportService.exportSettings
        };
        this.formService.closeForm('sendEmailForm');
        this.controller.post('EmailReport', this.model.options.actions.emailReport, data);
        this.controller.actionSubject.next({ action: 'Email', data });
    }
    fillDefaults() {
        this.exportService.exportSettings.Email = this.model.options.email.defaultEmailAddress;
        this.exportService.exportSettings.Message = this.model.options.email.defaultEmailMessage;
        this.exportService.exportSettings.Subject = this.model.options.email.defaultEmailSubject;
        let ext = this.exportService.format.toLowerCase().replace('image', '');
        switch (ext) {
            case 'excel':
                ext = 'xls';
                break;
            case 'excel2007':
                ext = 'xlsx';
                break;
            case 'excelxml':
                ext = 'xls';
                break;
            case 'html5':
                ext = 'html';
                break;
            case 'jpeg':
                ext = 'jpg';
                break;
            case 'ppt2007':
                ext = 'ppt';
                break;
            case 'text':
                ext = 'txt';
                break;
            case 'word2007':
                ext = 'docx';
                break;
        }
        this.exportService.exportSettings.Attachment = this.model.reportParams.reportFileName + '.' + ext;
    }
};
MailService.ctorParameters = () => [
    { type: ModelService },
    { type: ExportService },
    { type: FormService },
    { type: ControllerService }
];
MailService = __decorate([
    Injectable()
], MailService);
export { MailService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9tYWlsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHekQsSUFBYSxXQUFXLEdBQXhCLE1BQWEsV0FBVztJQUV0QixZQUFtQixLQUFtQixFQUFTLGFBQTRCLEVBQVMsV0FBd0IsRUFBUyxVQUE2QjtRQUEvSCxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBQVMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBUyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFTLGVBQVUsR0FBVixVQUFVLENBQW1CO1FBQ2hKLGFBQWEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0MsSUFBSSxLQUFLLEtBQUssVUFBVSxFQUFFO2dCQUN4QixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDakI7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTSxRQUFRO1FBQ2IsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRXBCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRTtZQUM1QyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQztTQUM1QzthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2pCO0lBQ0gsQ0FBQztJQUVNLFFBQVE7UUFDYixNQUFNLElBQUksR0FBRztZQUNYLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU07WUFDdkMsY0FBYyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYztTQUNsRCxDQUFDO1FBRUYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbEYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFTSxZQUFZO1FBQ2pCLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7UUFDdkYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQztRQUN6RixJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDO1FBRXpGLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdkUsUUFBUSxHQUFHLEVBQUU7WUFDWCxLQUFLLE9BQU87Z0JBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQztnQkFBQyxNQUFNO1lBQ2pDLEtBQUssV0FBVztnQkFBRSxHQUFHLEdBQUcsTUFBTSxDQUFDO2dCQUFDLE1BQU07WUFDdEMsS0FBSyxVQUFVO2dCQUFFLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQUMsTUFBTTtZQUNwQyxLQUFLLE9BQU87Z0JBQUUsR0FBRyxHQUFHLE1BQU0sQ0FBQztnQkFBQyxNQUFNO1lBQ2xDLEtBQUssTUFBTTtnQkFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDO2dCQUFDLE1BQU07WUFDaEMsS0FBSyxTQUFTO2dCQUFFLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQUMsTUFBTTtZQUNuQyxLQUFLLE1BQU07Z0JBQUUsR0FBRyxHQUFHLEtBQUssQ0FBQztnQkFBQyxNQUFNO1lBQ2hDLEtBQUssVUFBVTtnQkFBRSxHQUFHLEdBQUcsTUFBTSxDQUFDO2dCQUFDLE1BQU07U0FDdEM7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDcEcsQ0FBQztDQUVGLENBQUE7O1lBakQyQixZQUFZO1lBQXdCLGFBQWE7WUFBc0IsV0FBVztZQUFxQixpQkFBaUI7O0FBRnZJLFdBQVc7SUFEdkIsVUFBVSxFQUFFO0dBQ0EsV0FBVyxDQW1EdkI7U0FuRFksV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi9tb2RlbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRXhwb3J0U2VydmljZSB9IGZyb20gJy4vZXhwb3J0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtU2VydmljZSB9IGZyb20gJy4uL2Zvcm1zL2Zvcm0uc2VydmljZSc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb250cm9sbGVyLnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWFpbFNlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIGV4cG9ydFNlcnZpY2U6IEV4cG9ydFNlcnZpY2UsIHB1YmxpYyBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UsIHB1YmxpYyBjb250cm9sbGVyOiBDb250cm9sbGVyU2VydmljZSkge1xyXG4gICAgZXhwb3J0U2VydmljZS5nZXRNZXNzYWdlKCkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcclxuICAgICAgaWYgKGV2ZW50ID09PSAncG9zdE1haWwnKSB7XHJcbiAgICAgICAgdGhpcy5wb3N0TWFpbCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwb3N0TWFpbCgpIHtcclxuICAgIHRoaXMuZmlsbERlZmF1bHRzKCk7XHJcblxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5lbWFpbC5zaG93RW1haWxEaWFsb2cpIHtcclxuICAgICAgdGhpcy5mb3JtU2VydmljZS5zaG93Rm9ybSgnc2VuZEVtYWlsRm9ybScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZW5kTWFpbCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHNlbmRNYWlsKCkge1xyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgZXhwb3J0Rm9ybWF0OiB0aGlzLmV4cG9ydFNlcnZpY2UuZm9ybWF0LFxyXG4gICAgICBleHBvcnRTZXR0aW5nczogdGhpcy5leHBvcnRTZXJ2aWNlLmV4cG9ydFNldHRpbmdzXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZm9ybVNlcnZpY2UuY2xvc2VGb3JtKCdzZW5kRW1haWxGb3JtJyk7XHJcbiAgICB0aGlzLmNvbnRyb2xsZXIucG9zdCgnRW1haWxSZXBvcnQnLCB0aGlzLm1vZGVsLm9wdGlvbnMuYWN0aW9ucy5lbWFpbFJlcG9ydCwgZGF0YSk7XHJcbiAgICB0aGlzLmNvbnRyb2xsZXIuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnRW1haWwnLCBkYXRhIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpbGxEZWZhdWx0cygpIHtcclxuICAgIHRoaXMuZXhwb3J0U2VydmljZS5leHBvcnRTZXR0aW5ncy5FbWFpbCA9IHRoaXMubW9kZWwub3B0aW9ucy5lbWFpbC5kZWZhdWx0RW1haWxBZGRyZXNzO1xyXG4gICAgdGhpcy5leHBvcnRTZXJ2aWNlLmV4cG9ydFNldHRpbmdzLk1lc3NhZ2UgPSB0aGlzLm1vZGVsLm9wdGlvbnMuZW1haWwuZGVmYXVsdEVtYWlsTWVzc2FnZTtcclxuICAgIHRoaXMuZXhwb3J0U2VydmljZS5leHBvcnRTZXR0aW5ncy5TdWJqZWN0ID0gdGhpcy5tb2RlbC5vcHRpb25zLmVtYWlsLmRlZmF1bHRFbWFpbFN1YmplY3Q7XHJcblxyXG4gICAgbGV0IGV4dCA9IHRoaXMuZXhwb3J0U2VydmljZS5mb3JtYXQudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdpbWFnZScsICcnKTtcclxuICAgIHN3aXRjaCAoZXh0KSB7XHJcbiAgICAgIGNhc2UgJ2V4Y2VsJzogZXh0ID0gJ3hscyc7IGJyZWFrO1xyXG4gICAgICBjYXNlICdleGNlbDIwMDcnOiBleHQgPSAneGxzeCc7IGJyZWFrO1xyXG4gICAgICBjYXNlICdleGNlbHhtbCc6IGV4dCA9ICd4bHMnOyBicmVhaztcclxuICAgICAgY2FzZSAnaHRtbDUnOiBleHQgPSAnaHRtbCc7IGJyZWFrO1xyXG4gICAgICBjYXNlICdqcGVnJzogZXh0ID0gJ2pwZyc7IGJyZWFrO1xyXG4gICAgICBjYXNlICdwcHQyMDA3JzogZXh0ID0gJ3BwdCc7IGJyZWFrO1xyXG4gICAgICBjYXNlICd0ZXh0JzogZXh0ID0gJ3R4dCc7IGJyZWFrO1xyXG4gICAgICBjYXNlICd3b3JkMjAwNyc6IGV4dCA9ICdkb2N4JzsgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5leHBvcnRTZXJ2aWNlLmV4cG9ydFNldHRpbmdzLkF0dGFjaG1lbnQgPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5yZXBvcnRGaWxlTmFtZSArICcuJyArIGV4dDtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==