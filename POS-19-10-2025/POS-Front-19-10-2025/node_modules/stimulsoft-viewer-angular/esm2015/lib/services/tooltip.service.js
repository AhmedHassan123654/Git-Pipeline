import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ModelService } from './model.service';
import { MenuService } from '../menu/menu.service';
let TooltipService = class TooltipService {
    constructor(model, menuService) {
        this.model = model;
        this.menuService = menuService;
        this.state = 'initial';
        this.caption = '';
        this.helpLink = '';
        this.top = 0;
        this.left = 0;
        this.innerState = 'initial';
    }
    show(left, top, caption, below = true, helpLink) {
        if (this.menuService.isMenuVisible() || !this.model.options.appearance.showTooltips) {
            this.hideImmediately();
            return;
        }
        if (this.caption === caption && this.helpLink === helpLink && this.state !== 'initial') {
            this.showInternal();
            return;
        }
        this.caption = caption;
        this.helpLink = helpLink;
        this.state = this.innerState = this.state !== 'expanded' ? 'preInitial' : 'preInitial2';
        setTimeout(() => {
            const tooltip = this.model.controls.tooltip.el.nativeElement;
            const browserWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
            if (!below) {
                top -= tooltip.offsetHeight;
            }
            if (left + tooltip.offsetWidth > browserWidth) {
                left = browserWidth - tooltip.offsetWidth;
            }
            this.left = left;
            this.top = top;
            if (this.innerState !== 'initial') {
                this.showInternal();
            }
        });
    }
    showInternal() {
        this.state = 'expanded';
        this.innerState = 'expanded';
    }
    showFromTooltip() {
        if (this.state !== 'preInitial') {
            this.state = 'expanded';
            this.innerState = 'expanded';
        }
    }
    hideImmediately() {
        this.innerState = 'initial';
        this.state = 'initial';
    }
    hide() {
        this.innerState = 'initial';
        if (this.timeout) {
            clearTimeout(this.timeout);
        }
        this.timeout = setTimeout(() => {
            if (this.innerState === 'initial') {
                this.state = 'initial';
            }
            this.timeout = null;
        }, 1000);
    }
};
TooltipService.ctorParameters = () => [
    { type: ModelService },
    { type: MenuService }
];
TooltipService = __decorate([
    Injectable()
], TooltipService);
export { TooltipService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy90b29sdGlwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUduRCxJQUFhLGNBQWMsR0FBM0IsTUFBYSxjQUFjO0lBV3pCLFlBQW1CLEtBQW1CLEVBQVMsV0FBd0I7UUFBcEQsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBVGhFLFVBQUssR0FBRyxTQUFTLENBQUM7UUFDbEIsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDZCxRQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ1IsU0FBSSxHQUFHLENBQUMsQ0FBQztRQUVSLGVBQVUsR0FBRyxTQUFTLENBQUM7SUFHNEMsQ0FBQztJQUVyRSxJQUFJLENBQUMsSUFBWSxFQUFFLEdBQVcsRUFBRSxPQUFlLEVBQUUsUUFBaUIsSUFBSSxFQUFFLFFBQWlCO1FBQzlGLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUU7WUFDbkYsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3ZCLE9BQU87U0FDUjtRQUVELElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxPQUFPLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDdEYsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUM7UUFFeEYsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDO1lBQzdELE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxVQUFVLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDNUcsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDVixHQUFHLElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQzthQUM3QjtZQUNELElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxXQUFXLEdBQUcsWUFBWSxFQUFFO2dCQUM3QyxJQUFJLEdBQUcsWUFBWSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7YUFDM0M7WUFFRCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNqQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUNmLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUU7Z0JBQ2pDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUNyQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLFlBQVk7UUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUM7UUFDeEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7SUFDL0IsQ0FBQztJQUVNLGVBQWU7UUFDcEIsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFlBQVksRUFBRTtZQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztZQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztTQUM5QjtJQUNILENBQUM7SUFFTSxlQUFlO1FBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO0lBQ3pCLENBQUM7SUFFTSxJQUFJO1FBQ1QsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7UUFDNUIsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDNUI7UUFDRCxJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDN0IsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLFNBQVMsRUFBRTtnQkFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7YUFDeEI7WUFDRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUN0QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDWCxDQUFDO0NBRUYsQ0FBQTs7WUFqRTJCLFlBQVk7WUFBc0IsV0FBVzs7QUFYNUQsY0FBYztJQUQxQixVQUFVLEVBQUU7R0FDQSxjQUFjLENBNEUxQjtTQTVFWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZW51U2VydmljZSB9IGZyb20gJy4uL21lbnUvbWVudS5zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRvb2x0aXBTZXJ2aWNlIHtcclxuXHJcbiAgcHVibGljIHN0YXRlID0gJ2luaXRpYWwnO1xyXG4gIHB1YmxpYyBjYXB0aW9uID0gJyc7XHJcbiAgcHVibGljIGhlbHBMaW5rID0gJyc7XHJcbiAgcHVibGljIHRvcCA9IDA7XHJcbiAgcHVibGljIGxlZnQgPSAwO1xyXG5cclxuICBwcml2YXRlIGlubmVyU3RhdGUgPSAnaW5pdGlhbCc7XHJcbiAgcHJpdmF0ZSB0aW1lb3V0OiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBtb2RlbDogTW9kZWxTZXJ2aWNlLCBwdWJsaWMgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgcHVibGljIHNob3cobGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgY2FwdGlvbjogc3RyaW5nLCBiZWxvdzogYm9vbGVhbiA9IHRydWUsIGhlbHBMaW5rPzogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy5tZW51U2VydmljZS5pc01lbnVWaXNpYmxlKCkgfHwgIXRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLnNob3dUb29sdGlwcykge1xyXG4gICAgICB0aGlzLmhpZGVJbW1lZGlhdGVseSgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY2FwdGlvbiA9PT0gY2FwdGlvbiAmJiB0aGlzLmhlbHBMaW5rID09PSBoZWxwTGluayAmJiB0aGlzLnN0YXRlICE9PSAnaW5pdGlhbCcpIHtcclxuICAgICAgdGhpcy5zaG93SW50ZXJuYWwoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FwdGlvbiA9IGNhcHRpb247XHJcbiAgICB0aGlzLmhlbHBMaW5rID0gaGVscExpbms7XHJcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5pbm5lclN0YXRlID0gdGhpcy5zdGF0ZSAhPT0gJ2V4cGFuZGVkJyA/ICdwcmVJbml0aWFsJyA6ICdwcmVJbml0aWFsMic7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLm1vZGVsLmNvbnRyb2xzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgY29uc3QgYnJvd3NlcldpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XHJcbiAgICAgIGlmICghYmVsb3cpIHtcclxuICAgICAgICB0b3AgLT0gdG9vbHRpcC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGxlZnQgKyB0b29sdGlwLm9mZnNldFdpZHRoID4gYnJvd3NlcldpZHRoKSB7XHJcbiAgICAgICAgbGVmdCA9IGJyb3dzZXJXaWR0aCAtIHRvb2x0aXAub2Zmc2V0V2lkdGg7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubGVmdCA9IGxlZnQ7XHJcbiAgICAgIHRoaXMudG9wID0gdG9wO1xyXG4gICAgICBpZiAodGhpcy5pbm5lclN0YXRlICE9PSAnaW5pdGlhbCcpIHtcclxuICAgICAgICB0aGlzLnNob3dJbnRlcm5hbCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2hvd0ludGVybmFsKCkge1xyXG4gICAgdGhpcy5zdGF0ZSA9ICdleHBhbmRlZCc7XHJcbiAgICB0aGlzLmlubmVyU3RhdGUgPSAnZXhwYW5kZWQnO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNob3dGcm9tVG9vbHRpcCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlICE9PSAncHJlSW5pdGlhbCcpIHtcclxuICAgICAgdGhpcy5zdGF0ZSA9ICdleHBhbmRlZCc7XHJcbiAgICAgIHRoaXMuaW5uZXJTdGF0ZSA9ICdleHBhbmRlZCc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGlkZUltbWVkaWF0ZWx5KCkge1xyXG4gICAgdGhpcy5pbm5lclN0YXRlID0gJ2luaXRpYWwnO1xyXG4gICAgdGhpcy5zdGF0ZSA9ICdpbml0aWFsJztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBoaWRlKCkge1xyXG4gICAgdGhpcy5pbm5lclN0YXRlID0gJ2luaXRpYWwnO1xyXG4gICAgaWYgKHRoaXMudGltZW91dCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcclxuICAgIH1cclxuICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5pbm5lclN0YXRlID09PSAnaW5pdGlhbCcpIHtcclxuICAgICAgICB0aGlzLnN0YXRlID0gJ2luaXRpYWwnO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudGltZW91dCA9IG51bGw7XHJcbiAgICB9LCAxMDAwKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==