import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { StiHttpClientService } from './http-client.service';
import { Subject } from 'rxjs';
import { ModelService } from './model.service';
import { StylesService } from './styles.service';
import { PageService } from './page.service';
import { HelperService } from './helper.service';
import { FormService } from '../forms/form.service';
import { FullScreenService } from './full-screen.service';
import { MenuService, Menu } from '../menu/menu.service';
let ControllerService = class ControllerService {
    constructor(httpClient, model, stylesService, pageService, helper, formService, fullScreenService, menuService, styleService) {
        this.httpClient = httpClient;
        this.model = model;
        this.stylesService = stylesService;
        this.pageService = pageService;
        this.helper = helper;
        this.formService = formService;
        this.fullScreenService = fullScreenService;
        this.menuService = menuService;
        this.styleService = styleService;
        this.subject = new Subject();
        this.actionSubject = new Subject();
        setInterval(() => {
            var _a, _b;
            if (this.model.httpError) {
                if ((_a = this.model.httpError.error) === null || _a === void 0 ? void 0 : _a.text) {
                    this.showError((_b = this.model.httpError.error) === null || _b === void 0 ? void 0 : _b.text);
                }
                else if (this.model.httpError.message) {
                    this.showError(null, this.model.httpError.message);
                }
                else if (this.model.httpError.error instanceof ErrorEvent) {
                    this.showError(this.model.httpError.error.message);
                }
                this.model.httpError = null;
            }
            if (this.model.navigateNode) {
                this.postBookmarkNodeAction(this.model.navigateNode);
                this.model.navigateNode = null;
            }
        }, 250);
        this.setupHandlers();
    }
    setupHandlers() {
        this.getMessage().subscribe((message) => {
            switch (message.action) {
                case 'GetReport':
                case 'OpenReport':
                    setTimeout(() => {
                        var _a, _b;
                        this.styleService.addCustomFontStyles((_a = message.data) === null || _a === void 0 ? void 0 : _a.customFonts);
                        if (this.model.options.appearance.fullScreenMode) {
                            this.fullScreenService.changeFullScreenMode(true);
                        }
                        if (((_b = message.data) === null || _b === void 0 ? void 0 : _b.stimulsoftFontContent) && !this.model.options.stimulsoftFontContent) {
                            this.model.options.stimulsoftFontContent = message.data.stimulsoftFontContent;
                            this.styleService.addCustomFontStyles([{
                                    contentForCss: message.data.stimulsoftFontContent,
                                    originalFontFamily: 'Stimulsoft'
                                }]);
                        }
                    });
                    break;
            }
        });
        this.model.controls.bookmarksPanel.getVisibility().subscribe((value) => {
            if (value && this.model.options.isMobileDevice) {
                this.model.controls.parametersPanel.visible = false;
            }
            if (value) {
                this.hideToolbar();
            }
            else {
                this.showToolbar();
            }
        });
        this.model.controls.parametersPanel.getVisibility().subscribe((value) => {
            if (value && this.model.options.isMobileDevice) {
                this.model.controls.bookmarksPanel.visible = false;
            }
            if (value) {
                this.hideToolbar();
            }
            else {
                this.showToolbar();
            }
        });
        this.menuService.getVisibility().subscribe((menu) => {
            this.hideToolbar();
        });
    }
    hideToolbar() {
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            this.model.controls.toolbar.visible = false;
            this.model.controls.navigatePanel.visible = false;
        }
    }
    showToolbar() {
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            this.model.controls.toolbar.visible = true;
            this.model.controls.navigatePanel.visible = true;
            setTimeout(() => {
                this.keepToolbar();
            }, 300);
        }
    }
    keepToolbar() {
        if (this.model.options.isMobileDevice && this.model.options.toolbar.autoHide) {
            clearTimeout(this.model.toolbarHideTimer);
            this.model.toolbarHideTimer = setTimeout(() => {
                this.hideToolbar();
            }, 4000);
        }
    }
    getMessage() {
        return this.subject.asObservable();
    }
    getActionMessage() {
        return this.actionSubject.asObservable();
    }
    post(action, cAction, postData, responseType = 'json', subAction) {
        this.model.controls.navigatePanel.enabled = false;
        this.model.controls.toolbar.enabled = false;
        let url;
        if (!cAction) {
            url = this.model.requestUrl.replace('{action}', action === 'GetReport' || this.model.options.server.cacheMode === 'None' ? this.model.options.actions.getReport : this.model.options.actions.viewerEvent);
        }
        else {
            url = this.model.requestUrl.replace('{action}', cAction);
        }
        if (postData) {
            postData.action = action;
        }
        else {
            postData = { action };
        }
        this.httpClient.post(url, this.model.createPostParameters(postData), responseType).subscribe(data => {
            var _a;
            this.model.showProgress = false;
            this.model.controls.navigatePanel.enabled = true;
            this.model.controls.toolbar.enabled = true;
            if (data === 'ServerError:The report is not specified.' && ((_a = this.model.options) === null || _a === void 0 ? void 0 : _a.isReportRecieved)) {
                this.model.options.isReportRecieved = false;
                this.model.reportParams.prevPageNumber = this.model.reportParams.pageNumber;
                this.post('GetReport');
                return;
            }
            if (data) {
                this.model.reportParams = data;
                this.startRefreshReportTimer(data.refreshTime);
            }
            this.subject.next({ action, data, subAction });
        });
    }
    loadViewer() {
        const url = this.model.requestUrl.replace('{action}', this.model.action);
        this.httpClient.post(url, this.model.createPostParameters({ action: 'AngularViewerData' }, true, false), 'json').subscribe(data => {
            this.model.clear();
            this.stylesService.setupStyle(atob(data['styles']), 'viewer');
            this.model.options = data;
            this.checkTrExp();
            this.initAutoUpdateCache();
            this.subject.next({ action: 'viewer_loaded' });
            this.getReport();
        });
    }
    getReport() {
        this.model.options.paramsVariablesStartValues = null;
        this.post('GetReport');
    }
    getPages() {
        this.post('GetPages');
    }
    postExport(format, settings, elementName, isDashboardExport = false) {
        const data = {
            action: isDashboardExport ? 'ExportDashboard' : 'ExportReport',
            exportFormat: format,
            exportSettings: settings,
            elementName
        };
        const doc = settings && settings.OpenAfterExport && this.model.options.appearance.openExportedReportWindow === '_blank' ? this.helper.openNewWindow('about:blank', '_blank').document : null;
        const url = this.model.requestUrl;
        this.httpClient.postForm(url.replace('{action}', this.model.options.actions.exportReport), data, doc);
        this.actionSubject.next({ action: 'ExportReport', data });
    }
    loadFile(fileName, content) {
        if (typeof content !== 'string' || content === '') {
            return;
        }
        if (content.indexOf('<?xml') === 0 || content.indexOf('{') === 0) {
            content = btoa(content);
        }
        const data = {
            action: 'OpenReport',
            openingFileName: fileName || 'Report.mdc',
            base64Data: content.indexOf('base64,') > 0 ? content.substr(content.indexOf('base64,') + 7) : content
        };
        if (fileName && (fileName.toLowerCase().indexOf('.mdx') >= 0 || fileName.toLowerCase().indexOf('.mrx') >= 0)) {
            this.formService.showForm('passwordForm', data);
        }
        else {
            this.postOpen(data);
        }
    }
    postOpen(data) {
        this.model.clearViewerState();
        this.model.reportParams.reportFileName = data.openingFileName;
        this.post('OpenReport', this.model.options.actions.openReport, data);
    }
    action(event) {
        switch (event.name) {
            case 'Find':
                this.model.controls.findPanel.visible = !this.model.controls.findPanel.visible;
                return;
            case 'Bookmarks':
                this.model.controls.bookmarksPanel.visible = !this.model.controls.bookmarksPanel.visible;
                return;
            case 'Parameters':
                this.model.controls.parametersPanel.visible = !this.model.controls.parametersPanel.visible;
                return;
            case 'BookmarkAction':
                if (this.model.reportParams.pageNumber === event.bookmarkPage || this.model.reportParams.viewMode !== 'SinglePage') {
                    this.helper.scrollToAnchor(event.bookmarkAnchor, event.componentGuid);
                    return;
                }
                else {
                    this.model.reportParams.pageNumber = event.bookmarkPage;
                    this.model.options.bookmarkAnchor = event.bookmarkAnchor;
                    this.model.options.componentGuid = event.componentGuid;
                }
                break;
            case 'GoToPage':
                this.model.reportParams.pageNumber = event.value;
                break;
            case 'FirstPage':
                this.model.reportParams.pageNumber = 0;
                break;
            case 'PrevPage':
                this.model.reportParams.pageNumber = Math.max(0, this.model.reportParams.pageNumber - 1);
                break;
            case 'NextPage':
                this.model.reportParams.pageNumber = Math.min(this.model.reportParams.pagesCount - 1, this.model.reportParams.pageNumber + 1);
                break;
            case 'LastPage':
                this.model.reportParams.pageNumber = this.model.reportParams.pagesCount - 1;
                break;
            case 'ViewModeSinglePage':
                this.model.reportParams.viewMode = 'SinglePage';
                break;
            case 'ViewModeContinuous':
                this.model.reportParams.viewMode = 'Continuous';
                break;
            case 'ViewModeMultiplePages':
                this.model.reportParams.viewMode = 'MultiplePages';
                break;
            case 'Zoom25':
                this.model.reportParams.zoom = 25;
                break;
            case 'Zoom50':
                this.model.reportParams.zoom = 50;
                break;
            case 'Zoom75':
                this.model.reportParams.zoom = 75;
                break;
            case 'Zoom100':
                this.model.reportParams.zoom = 100;
                break;
            case 'Zoom150':
                this.model.reportParams.zoom = 150;
                break;
            case 'Zoom200':
                this.model.reportParams.zoom = 200;
                break;
            case 'ZoomOnePage':
            case 'ZoomPageWidth':
                this.model.reportParams.zoom = event.name === 'ZoomPageWidth' ? this.pageService.getZoomByPageWidth() : this.pageService.getZoomByPageHeight();
                break;
            case 'Submit':
                this.model.reportParams.editableParameters = null;
                if (this.model.reportParams.type === 'Report') {
                    this.model.reportParams.pageNumber = 0;
                }
                if (this.model.options.isMobileDevice) {
                    this.model.controls.parametersPanel.visible = false;
                }
                this.actionSubject.next({ action: 'Variables' });
                return;
            case 'Reset':
                if (this.model.options.paramsVariablesStartValues) {
                    this.model.options.paramsVariables = this.model.options.paramsVariablesStartValues;
                }
                this.actionSubject.next({ action: 'Reset' });
                return;
            case 'Editor':
                this.actionSubject.next({ action: 'Editor', data: {} });
                return;
            case 'Resources':
                this.model.controls.resourcesPanel.visible = !this.model.controls.resourcesPanel.visible;
                return;
            case 'PrintPdf':
            case 'PrintWithPreview':
            case 'PrintWithoutPreview':
                this.actionSubject.next({ action: 'Print', data: { format: event.name } });
                return;
            case 'Print':
                let format = 'PrintPdf';
                switch (this.model.options.toolbar.printDestination) {
                    case 'Pdf':
                        format = 'PrintPdf';
                        break;
                    case 'Direct':
                        format = 'PrintWithoutPreview';
                        break;
                    case 'WithPreview':
                        format = 'PrintWithPreview';
                        break;
                }
                this.actionSubject.next({ action: 'Print', data: { format } });
                return;
            case 'Open':
                this.model.openDialogFileMask = null;
                setTimeout(() => {
                    this.model.openDialogFileMask = '.mdc,.mdz,.mdx,.mrt,.mrz,.mrx';
                });
                return;
            case 'ResourceView':
                this.postReportResource(event.value.name, 'View');
                return;
            case 'ResourceSaveFile':
                this.postReportResource(event.value.name, 'SaveFile');
                return;
            case 'FullScreen':
                this.fullScreenService.changeFullScreenMode(!this.model.options.appearance.fullScreenMode);
                return;
            case 'About':
                this.actionSubject.next({ action: 'About' });
                return;
            case 'Pin':
                this.model.options.toolbar.autoHide = !this.model.options.toolbar.autoHide;
                this.pageService.calculateLayout();
                if (this.model.options.toolbar.autoHide) {
                    setTimeout(() => {
                        this.hideToolbar();
                    }, 200);
                }
                return;
            case 'Design':
                this.actionSubject.next({ action: 'Design' });
                break;
            default:
                if (event.name.indexOf('saveMenu') === 0) {
                    this.actionSubject.next({ action: 'Export', data: { format: event.name.substr(8) } });
                    return;
                }
                else if (event.name.indexOf('sendEmailMenu') === 0) {
                    this.actionSubject.next({ action: 'SendEmail', data: { format: event.name.substr(13) } });
                    return;
                }
        }
        this.getPages();
    }
    showError(message, messageText) {
        let type = 'Error';
        // Check for error in 'ServerError:' string format
        if (message != null && typeof (message) === 'string' && message.substr(0, 12) === 'ServerError:') {
            if (message.length <= 13) {
                messageText = 'An unknown error occurred (the server returned an empty value).';
            }
            else {
                messageText = message.substr(12);
            }
        }
        // Check for error in JSON format
        if (message != null && message.success === false && message.type && message.text) {
            type = message.type;
            messageText = message.text;
        }
        this.model.errorMessage = { error: 'Unknown error', type };
        if (messageText != null) {
            if (messageText === 'The report is not specified.' && !this.model.options.appearance.showReportIsNotSpecifiedMessage) {
                return true;
            }
            this.model.errorMessage = { error: messageText.replace('\n', '<br>'), type };
            if (this.model.images) {
                this.formService.showForm('errorMessageForm');
            }
            else {
                alert(messageText);
            }
            this.actionSubject.next({ action: 'Error' });
            return true;
        }
        return false;
    }
    postReportResource(resourceName, viewType) {
        const data = {
            action: 'ReportResource',
            reportResourceParams: {
                resourceName,
                viewType
            }
        };
        const doc = viewType === 'View' ? this.helper.openNewWindow('about:blank', '_blank').document : null;
        const url = this.model.requestUrl;
        this.httpClient.postForm(url.replace('{action}', this.model.options.actions.viewerEvent), data, doc);
    }
    postBookmarkNodeAction(node) {
        node.selected = true;
        this.action({ name: 'BookmarkAction', bookmarkPage: node.page, bookmarkAnchor: node.url.replace(/\\\'/g, '\'').substr(1), componentGuid: node.compunentGuid });
    }
    viewerResized() {
        this.menuService.closeAllMenus();
    }
    initAutoUpdateCache() {
        if (this.model.options.server.allowAutoUpdateCache) {
            if (this.model.timerAutoUpdateCache) {
                clearInterval(this.model.timerAutoUpdateCache);
            }
            this.model.timerAutoUpdateCache = setInterval(() => this.post('UpdateCache'), this.model.options.server.timeoutAutoUpdateCache);
        }
    }
    startRefreshReportTimer(timeout) {
        if (this.model.refreshReportTimer != null) {
            clearInterval(this.model.refreshReportTimer);
            this.model.refreshReportTimer = null;
        }
        if (timeout && timeout > 0) {
            this.model.refreshReportTimer = setInterval(() => {
                if (!this.model.showProgress) {
                    this.post('Refresh');
                }
            }, timeout * 1000);
        }
    }
    checkTrExp() {
        if (!this.model.options.cloudMode && !this.model.options.serverMode && !this.model.options.standaloneJsMode && !this.model.options.reportDesignerMode && !this.model.options.alternateValid) {
            let buildDate = new Date();
            try {
                /*if (this.model.options.jsMode && typeof Stimulsoft != 'undefined') {
                  let innerDate = Stimulsoft.StiVersion.created.innerDate;
                  if (innerDate['getFullYear'] && innerDate.getFullYear() > 2017)
                    buildDate = Stimulsoft.StiVersion.created.innerDate;
                }
                else*/ if (this.model.options.buildDate) {
                    buildDate = new Date(this.model.options.buildDate);
                }
            }
            catch (e) {
                buildDate = new Date();
            }
            const trDays = Math.floor(((new Date()).getTime() - buildDate.getTime()) / 1000 / 60 / 60 / 24);
            if (trDays > 60) {
                setTimeout(() => {
                    const message = trDays > 120 ? this.model.loc('NoticesYourTrialHasExpired') : this.model.loc('NoticesYouUsingTrialVersion');
                    const image = 'Notifications.Warning.png';
                    const buttonCaption = this.model.loc('ButtonOk');
                    let cancelAction;
                    let action;
                    if (trDays > 120) {
                        action = cancelAction = () => { window.location.href = 'https://www.stimulsoft.com/en/online-store'; };
                    }
                    this.model.notificationFormOptions = { message, image, buttonCaption, cancelAction, action };
                    this.formService.showForm('notificationForm');
                }, 3000);
            }
        }
    }
};
ControllerService.ctorParameters = () => [
    { type: StiHttpClientService },
    { type: ModelService },
    { type: StylesService },
    { type: PageService },
    { type: HelperService },
    { type: FormService },
    { type: FullScreenService },
    { type: MenuService },
    { type: StylesService }
];
ControllerService = __decorate([
    Injectable()
], ControllerService);
export { ControllerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9jb250cm9sbGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0QsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWpELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHekQsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUFLNUIsWUFBb0IsVUFBZ0MsRUFBVSxLQUFtQixFQUN2RSxhQUE0QixFQUFVLFdBQXdCLEVBQVUsTUFBcUIsRUFDN0YsV0FBd0IsRUFBVSxpQkFBb0MsRUFBVSxXQUF3QixFQUN4RyxZQUEyQjtRQUhqQixlQUFVLEdBQVYsVUFBVSxDQUFzQjtRQUFVLFVBQUssR0FBTCxLQUFLLENBQWM7UUFDdkUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDN0YsZ0JBQVcsR0FBWCxXQUFX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QVksR0FBRyxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyw0Q0FBNEMsQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDeEc7b0JBRUQsSUFBSSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsQ0FBQztvQkFDN0YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDaEQsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQ1Y7U0FDRjtJQUNILENBQUM7Q0FDRixDQUFBOztZQXZlaUMsb0JBQW9CO1lBQWlCLFlBQVk7WUFDeEQsYUFBYTtZQUF1QixXQUFXO1lBQWtCLGFBQWE7WUFDaEYsV0FBVztZQUE2QixpQkFBaUI7WUFBdUIsV0FBVztZQUMxRixhQUFhOztBQVIxQixpQkFBaUI7SUFEN0IsVUFBVSxFQUFFO0dBQ0EsaUJBQWlCLENBNGU3QjtTQTVlWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN0aUh0dHBDbGllbnRTZXJ2aWNlIH0gZnJvbSAnLi9odHRwLWNsaWVudC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTdHlsZXNTZXJ2aWNlIH0gZnJvbSAnLi9zdHlsZXMuc2VydmljZSc7XHJcbmltcG9ydCB7IFZpZXdlckV2ZW50LCBCb29rbWFya05vZGUsIE1lc3NhZ2UgfSBmcm9tICcuL29iamVjdHMnO1xyXG5pbXBvcnQgeyBQYWdlU2VydmljZSB9IGZyb20gJy4vcGFnZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSGVscGVyU2VydmljZSB9IGZyb20gJy4vaGVscGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtU2VydmljZSB9IGZyb20gJy4uL2Zvcm1zL2Zvcm0uc2VydmljZSc7XHJcbmltcG9ydCB7IEZ1bGxTY3JlZW5TZXJ2aWNlIH0gZnJvbSAnLi9mdWxsLXNjcmVlbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTWVudVNlcnZpY2UsIE1lbnUgfSBmcm9tICcuLi9tZW51L21lbnUuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDb250cm9sbGVyU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgc3ViamVjdCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwdWJsaWMgYWN0aW9uU3ViamVjdCA9IG5ldyBTdWJqZWN0PE1lc3NhZ2U+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cENsaWVudDogU3RpSHR0cENsaWVudFNlcnZpY2UsIHByaXZhdGUgbW9kZWw6IE1vZGVsU2VydmljZSxcclxuICAgIHByaXZhdGUgc3R5bGVzU2VydmljZTogU3R5bGVzU2VydmljZSwgcHJpdmF0ZSBwYWdlU2VydmljZTogUGFnZVNlcnZpY2UsIHByaXZhdGUgaGVscGVyOiBIZWxwZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UsIHByaXZhdGUgZnVsbFNjcmVlblNlcnZpY2U6IEZ1bGxTY3JlZW5TZXJ2aWNlLCBwcml2YXRlIG1lbnVTZXJ2aWNlOiBNZW51U2VydmljZSxcclxuICAgIHByaXZhdGUgc3R5bGVTZXJ2aWNlOiBTdHlsZXNTZXJ2aWNlKSB7XHJcblxyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5tb2RlbC5odHRwRXJyb3IpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RlbC5odHRwRXJyb3IuZXJyb3I/LnRleHQpIHtcclxuICAgICAgICAgIHRoaXMuc2hvd0Vycm9yKHRoaXMubW9kZWwuaHR0cEVycm9yLmVycm9yPy50ZXh0KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubW9kZWwuaHR0cEVycm9yLm1lc3NhZ2UpIHtcclxuICAgICAgICAgIHRoaXMuc2hvd0Vycm9yKG51bGwsIHRoaXMubW9kZWwuaHR0cEVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlbC5odHRwRXJyb3IuZXJyb3IgaW5zdGFuY2VvZiBFcnJvckV2ZW50KSB7XHJcbiAgICAgICAgICB0aGlzLnNob3dFcnJvcih0aGlzLm1vZGVsLmh0dHBFcnJvci5lcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tb2RlbC5odHRwRXJyb3IgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLm1vZGVsLm5hdmlnYXRlTm9kZSkge1xyXG4gICAgICAgIHRoaXMucG9zdEJvb2ttYXJrTm9kZUFjdGlvbih0aGlzLm1vZGVsLm5hdmlnYXRlTm9kZSk7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5uYXZpZ2F0ZU5vZGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9LCAyNTApO1xyXG5cclxuICAgIHRoaXMuc2V0dXBIYW5kbGVycygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldHVwSGFuZGxlcnMoKSB7XHJcbiAgICB0aGlzLmdldE1lc3NhZ2UoKS5zdWJzY3JpYmUoKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcclxuICAgICAgc3dpdGNoIChtZXNzYWdlLmFjdGlvbikge1xyXG4gICAgICAgIGNhc2UgJ0dldFJlcG9ydCc6XHJcbiAgICAgICAgY2FzZSAnT3BlblJlcG9ydCc6XHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZVNlcnZpY2UuYWRkQ3VzdG9tRm9udFN0eWxlcyhtZXNzYWdlLmRhdGE/LmN1c3RvbUZvbnRzKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5mdWxsU2NyZWVuTW9kZSkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZnVsbFNjcmVlblNlcnZpY2UuY2hhbmdlRnVsbFNjcmVlbk1vZGUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmRhdGE/LnN0aW11bHNvZnRGb250Q29udGVudCAmJiAhdGhpcy5tb2RlbC5vcHRpb25zLnN0aW11bHNvZnRGb250Q29udGVudCkge1xyXG4gICAgICAgICAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5zdGltdWxzb2Z0Rm9udENvbnRlbnQgPSBtZXNzYWdlLmRhdGEuc3RpbXVsc29mdEZvbnRDb250ZW50O1xyXG4gICAgICAgICAgICAgIHRoaXMuc3R5bGVTZXJ2aWNlLmFkZEN1c3RvbUZvbnRTdHlsZXMoW3tcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRGb3JDc3M6IG1lc3NhZ2UuZGF0YS5zdGltdWxzb2Z0Rm9udENvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEZvbnRGYW1pbHk6ICdTdGltdWxzb2Z0J1xyXG4gICAgICAgICAgICAgIH1dKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy5ib29rbWFya3NQYW5lbC5nZXRWaXNpYmlsaXR5KCkuc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICBpZiAodmFsdWUgJiYgdGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5wYXJhbWV0ZXJzUGFuZWwudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuaGlkZVRvb2xiYXIoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnNob3dUb29sYmFyKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMucGFyYW1ldGVyc1BhbmVsLmdldFZpc2liaWxpdHkoKS5zdWJzY3JpYmUoKHZhbHVlKSA9PiB7XHJcbiAgICAgIGlmICh2YWx1ZSAmJiB0aGlzLm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLmJvb2ttYXJrc1BhbmVsLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLmhpZGVUb29sYmFyKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zaG93VG9vbGJhcigpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLm1lbnVTZXJ2aWNlLmdldFZpc2liaWxpdHkoKS5zdWJzY3JpYmUoKG1lbnU6IE1lbnUpID0+IHtcclxuICAgICAgdGhpcy5oaWRlVG9vbGJhcigpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGlkZVRvb2xiYXIoKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlICYmIHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLmF1dG9IaWRlKSB7XHJcbiAgICAgIHRoaXMubW9kZWwuY29udHJvbHMudG9vbGJhci52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2hvd1Rvb2xiYXIoKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlICYmIHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLmF1dG9IaWRlKSB7XHJcbiAgICAgIHRoaXMubW9kZWwuY29udHJvbHMudG9vbGJhci52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmtlZXBUb29sYmFyKCk7XHJcbiAgICAgIH0sIDMwMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMga2VlcFRvb2xiYXIoKSB7XHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlICYmIHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLmF1dG9IaWRlKSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLm1vZGVsLnRvb2xiYXJIaWRlVGltZXIpO1xyXG4gICAgICB0aGlzLm1vZGVsLnRvb2xiYXJIaWRlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmhpZGVUb29sYmFyKCk7XHJcbiAgICAgIH0sIDQwMDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE1lc3NhZ2UoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0QWN0aW9uTWVzc2FnZSgpOiBPYnNlcnZhYmxlPE1lc3NhZ2U+IHtcclxuICAgIHJldHVybiB0aGlzLmFjdGlvblN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcG9zdChhY3Rpb246IHN0cmluZywgY0FjdGlvbj86IHN0cmluZywgcG9zdERhdGE/OiBhbnksIHJlc3BvbnNlVHlwZTogc3RyaW5nID0gJ2pzb24nLCBzdWJBY3Rpb24/OiBzdHJpbmcpIHtcclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC5lbmFibGVkID0gZmFsc2U7XHJcbiAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnRvb2xiYXIuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgbGV0IHVybDogc3RyaW5nO1xyXG4gICAgaWYgKCFjQWN0aW9uKSB7XHJcbiAgICAgIHVybCA9IHRoaXMubW9kZWwucmVxdWVzdFVybC5yZXBsYWNlKCd7YWN0aW9ufScsIGFjdGlvbiA9PT0gJ0dldFJlcG9ydCcgfHwgdGhpcy5tb2RlbC5vcHRpb25zLnNlcnZlci5jYWNoZU1vZGUgPT09ICdOb25lJyA/IHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLmdldFJlcG9ydCA6IHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLnZpZXdlckV2ZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHVybCA9IHRoaXMubW9kZWwucmVxdWVzdFVybC5yZXBsYWNlKCd7YWN0aW9ufScsIGNBY3Rpb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHBvc3REYXRhKSB7XHJcbiAgICAgIHBvc3REYXRhLmFjdGlvbiA9IGFjdGlvbjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBvc3REYXRhID0geyBhY3Rpb24gfTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIHRoaXMubW9kZWwuY3JlYXRlUG9zdFBhcmFtZXRlcnMocG9zdERhdGEpLCByZXNwb25zZVR5cGUpLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgdGhpcy5tb2RlbC5zaG93UHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgdGhpcy5tb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLnRvb2xiYXIuZW5hYmxlZCA9IHRydWU7XHJcblxyXG4gICAgICBpZiAoZGF0YSA9PT0gJ1NlcnZlckVycm9yOlRoZSByZXBvcnQgaXMgbm90IHNwZWNpZmllZC4nICYmIHRoaXMubW9kZWwub3B0aW9ucz8uaXNSZXBvcnRSZWNpZXZlZCkge1xyXG4gICAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5pc1JlcG9ydFJlY2lldmVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucHJldlBhZ2VOdW1iZXIgPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyO1xyXG4gICAgICAgIHRoaXMucG9zdCgnR2V0UmVwb3J0Jyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zID0gZGF0YTtcclxuICAgICAgICB0aGlzLnN0YXJ0UmVmcmVzaFJlcG9ydFRpbWVyKGRhdGEucmVmcmVzaFRpbWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc3ViamVjdC5uZXh0KHsgYWN0aW9uLCBkYXRhLCBzdWJBY3Rpb24gfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb2FkVmlld2VyKCk6IHZvaWQge1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5tb2RlbC5yZXF1ZXN0VXJsLnJlcGxhY2UoJ3thY3Rpb259JywgdGhpcy5tb2RlbC5hY3Rpb24pO1xyXG4gICAgdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCB0aGlzLm1vZGVsLmNyZWF0ZVBvc3RQYXJhbWV0ZXJzKHsgYWN0aW9uOiAnQW5ndWxhclZpZXdlckRhdGEnIH0sIHRydWUsIGZhbHNlKSwgJ2pzb24nLCkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICB0aGlzLm1vZGVsLmNsZWFyKCk7XHJcbiAgICAgIHRoaXMuc3R5bGVzU2VydmljZS5zZXR1cFN0eWxlKGF0b2IoZGF0YVsnc3R5bGVzJ10pLCAndmlld2VyJyk7XHJcbiAgICAgIHRoaXMubW9kZWwub3B0aW9ucyA9IGRhdGE7XHJcbiAgICAgIHRoaXMuY2hlY2tUckV4cCgpO1xyXG4gICAgICB0aGlzLmluaXRBdXRvVXBkYXRlQ2FjaGUoKTtcclxuICAgICAgdGhpcy5zdWJqZWN0Lm5leHQoeyBhY3Rpb246ICd2aWV3ZXJfbG9hZGVkJyB9KTtcclxuICAgICAgdGhpcy5nZXRSZXBvcnQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFJlcG9ydCgpOiB2b2lkIHtcclxuICAgIHRoaXMubW9kZWwub3B0aW9ucy5wYXJhbXNWYXJpYWJsZXNTdGFydFZhbHVlcyA9IG51bGw7XHJcbiAgICB0aGlzLnBvc3QoJ0dldFJlcG9ydCcpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFBhZ2VzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0KCdHZXRQYWdlcycpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RFeHBvcnQoZm9ybWF0OiBzdHJpbmcsIHNldHRpbmdzOiBhbnksIGVsZW1lbnROYW1lPzogc3RyaW5nLCBpc0Rhc2hib2FyZEV4cG9ydDogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICBhY3Rpb246IGlzRGFzaGJvYXJkRXhwb3J0ID8gJ0V4cG9ydERhc2hib2FyZCcgOiAnRXhwb3J0UmVwb3J0JyxcclxuICAgICAgZXhwb3J0Rm9ybWF0OiBmb3JtYXQsXHJcbiAgICAgIGV4cG9ydFNldHRpbmdzOiBzZXR0aW5ncyxcclxuICAgICAgZWxlbWVudE5hbWVcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZG9jID0gc2V0dGluZ3MgJiYgc2V0dGluZ3MuT3BlbkFmdGVyRXhwb3J0ICYmIHRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLm9wZW5FeHBvcnRlZFJlcG9ydFdpbmRvdyA9PT0gJ19ibGFuaycgPyB0aGlzLmhlbHBlci5vcGVuTmV3V2luZG93KCdhYm91dDpibGFuaycsICdfYmxhbmsnKS5kb2N1bWVudCA6IG51bGw7XHJcbiAgICBjb25zdCB1cmwgPSB0aGlzLm1vZGVsLnJlcXVlc3RVcmw7XHJcbiAgICB0aGlzLmh0dHBDbGllbnQucG9zdEZvcm0odXJsLnJlcGxhY2UoJ3thY3Rpb259JywgdGhpcy5tb2RlbC5vcHRpb25zLmFjdGlvbnMuZXhwb3J0UmVwb3J0KSwgZGF0YSwgZG9jKTtcclxuICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnRXhwb3J0UmVwb3J0JywgZGF0YSB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb2FkRmlsZShmaWxlTmFtZTogc3RyaW5nLCBjb250ZW50OiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgY29udGVudCAhPT0gJ3N0cmluZycgfHwgY29udGVudCA9PT0gJycpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgaWYgKGNvbnRlbnQuaW5kZXhPZignPD94bWwnKSA9PT0gMCB8fCBjb250ZW50LmluZGV4T2YoJ3snKSA9PT0gMCkgeyBjb250ZW50ID0gYnRvYShjb250ZW50KTsgfVxyXG5cclxuICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgIGFjdGlvbjogJ09wZW5SZXBvcnQnLFxyXG4gICAgICBvcGVuaW5nRmlsZU5hbWU6IGZpbGVOYW1lIHx8ICdSZXBvcnQubWRjJyxcclxuICAgICAgYmFzZTY0RGF0YTogY29udGVudC5pbmRleE9mKCdiYXNlNjQsJykgPiAwID8gY29udGVudC5zdWJzdHIoY29udGVudC5pbmRleE9mKCdiYXNlNjQsJykgKyA3KSA6IGNvbnRlbnRcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGZpbGVOYW1lICYmIChmaWxlTmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJy5tZHgnKSA+PSAwIHx8IGZpbGVOYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignLm1yeCcpID49IDApKSB7XHJcbiAgICAgIHRoaXMuZm9ybVNlcnZpY2Uuc2hvd0Zvcm0oJ3Bhc3N3b3JkRm9ybScsIGRhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wb3N0T3BlbihkYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBwb3N0T3BlbihkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMubW9kZWwuY2xlYXJWaWV3ZXJTdGF0ZSgpO1xyXG4gICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucmVwb3J0RmlsZU5hbWUgPSBkYXRhLm9wZW5pbmdGaWxlTmFtZTtcclxuICAgIHRoaXMucG9zdCgnT3BlblJlcG9ydCcsIHRoaXMubW9kZWwub3B0aW9ucy5hY3Rpb25zLm9wZW5SZXBvcnQsIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFjdGlvbihldmVudDogVmlld2VyRXZlbnQpOiB2b2lkIHtcclxuICAgIHN3aXRjaCAoZXZlbnQubmFtZSkge1xyXG4gICAgICBjYXNlICdGaW5kJzpcclxuICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLmZpbmRQYW5lbC52aXNpYmxlID0gIXRoaXMubW9kZWwuY29udHJvbHMuZmluZFBhbmVsLnZpc2libGU7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnQm9va21hcmtzJzpcclxuICAgICAgICB0aGlzLm1vZGVsLmNvbnRyb2xzLmJvb2ttYXJrc1BhbmVsLnZpc2libGUgPSAhdGhpcy5tb2RlbC5jb250cm9scy5ib29rbWFya3NQYW5lbC52aXNpYmxlO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1BhcmFtZXRlcnMnOlxyXG4gICAgICAgIHRoaXMubW9kZWwuY29udHJvbHMucGFyYW1ldGVyc1BhbmVsLnZpc2libGUgPSAhdGhpcy5tb2RlbC5jb250cm9scy5wYXJhbWV0ZXJzUGFuZWwudmlzaWJsZTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdCb29rbWFya0FjdGlvbic6XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPT09IGV2ZW50LmJvb2ttYXJrUGFnZSB8fCB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSAhPT0gJ1NpbmdsZVBhZ2UnKSB7XHJcbiAgICAgICAgICB0aGlzLmhlbHBlci5zY3JvbGxUb0FuY2hvcihldmVudC5ib29rbWFya0FuY2hvciwgZXZlbnQuY29tcG9uZW50R3VpZCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSBldmVudC5ib29rbWFya1BhZ2U7XHJcbiAgICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMuYm9va21hcmtBbmNob3IgPSBldmVudC5ib29rbWFya0FuY2hvcjtcclxuICAgICAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5jb21wb25lbnRHdWlkID0gZXZlbnQuY29tcG9uZW50R3VpZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdHb1RvUGFnZSc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA9IGV2ZW50LnZhbHVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnRmlyc3RQYWdlJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gMDtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ1ByZXZQYWdlJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID0gTWF0aC5tYXgoMCwgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciAtIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnTmV4dFBhZ2UnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSBNYXRoLm1pbih0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0NvdW50IC0gMSwgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciArIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnTGFzdFBhZ2UnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0NvdW50IC0gMTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ1ZpZXdNb2RlU2luZ2xlUGFnZSc6XHJcbiAgICAgICAgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudmlld01vZGUgPSAnU2luZ2xlUGFnZSc7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdWaWV3TW9kZUNvbnRpbnVvdXMnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnZpZXdNb2RlID0gJ0NvbnRpbnVvdXMnO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAnVmlld01vZGVNdWx0aXBsZVBhZ2VzJzpcclxuICAgICAgICB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSA9ICdNdWx0aXBsZVBhZ2VzJztcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgJ1pvb20yNSc6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSAyNTsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1pvb201MCc6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSA1MDsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1pvb203NSc6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSA3NTsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1pvb20xMDAnOiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy56b29tID0gMTAwOyBicmVhaztcclxuICAgICAgY2FzZSAnWm9vbTE1MCc6IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSAxNTA7IGJyZWFrO1xyXG4gICAgICBjYXNlICdab29tMjAwJzogdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSA9IDIwMDsgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdab29tT25lUGFnZSc6XHJcbiAgICAgIGNhc2UgJ1pvb21QYWdlV2lkdGgnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20gPSBldmVudC5uYW1lID09PSAnWm9vbVBhZ2VXaWR0aCcgPyB0aGlzLnBhZ2VTZXJ2aWNlLmdldFpvb21CeVBhZ2VXaWR0aCgpIDogdGhpcy5wYWdlU2VydmljZS5nZXRab29tQnlQYWdlSGVpZ2h0KCk7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlICdTdWJtaXQnOlxyXG4gICAgICAgIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLmVkaXRhYmxlUGFyYW1ldGVycyA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnR5cGUgPT09ICdSZXBvcnQnKSB7IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VOdW1iZXIgPSAwOyB9XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy5pc01vYmlsZURldmljZSkgeyB0aGlzLm1vZGVsLmNvbnRyb2xzLnBhcmFtZXRlcnNQYW5lbC52aXNpYmxlID0gZmFsc2U7IH1cclxuICAgICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ1ZhcmlhYmxlcycgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUmVzZXQnOlxyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzU3RhcnRWYWx1ZXMpIHtcclxuICAgICAgICAgIHRoaXMubW9kZWwub3B0aW9ucy5wYXJhbXNWYXJpYWJsZXMgPSB0aGlzLm1vZGVsLm9wdGlvbnMucGFyYW1zVmFyaWFibGVzU3RhcnRWYWx1ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnUmVzZXQnIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ0VkaXRvcic6XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdFZGl0b3InLCBkYXRhOiB7fSB9KTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdSZXNvdXJjZXMnOlxyXG4gICAgICAgIHRoaXMubW9kZWwuY29udHJvbHMucmVzb3VyY2VzUGFuZWwudmlzaWJsZSA9ICF0aGlzLm1vZGVsLmNvbnRyb2xzLnJlc291cmNlc1BhbmVsLnZpc2libGU7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUHJpbnRQZGYnOlxyXG4gICAgICBjYXNlICdQcmludFdpdGhQcmV2aWV3JzpcclxuICAgICAgY2FzZSAnUHJpbnRXaXRob3V0UHJldmlldyc6XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdQcmludCcsIGRhdGE6IHsgZm9ybWF0OiBldmVudC5uYW1lIH0gfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUHJpbnQnOlxyXG4gICAgICAgIGxldCBmb3JtYXQgPSAnUHJpbnRQZGYnO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIucHJpbnREZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgY2FzZSAnUGRmJzpcclxuICAgICAgICAgICAgZm9ybWF0ID0gJ1ByaW50UGRmJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdEaXJlY3QnOlxyXG4gICAgICAgICAgICBmb3JtYXQgPSAnUHJpbnRXaXRob3V0UHJldmlldyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnV2l0aFByZXZpZXcnOlxyXG4gICAgICAgICAgICBmb3JtYXQgPSAnUHJpbnRXaXRoUHJldmlldyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ1ByaW50JywgZGF0YTogeyBmb3JtYXQgfSB9KTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdPcGVuJzpcclxuICAgICAgICB0aGlzLm1vZGVsLm9wZW5EaWFsb2dGaWxlTWFzayA9IG51bGw7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm1vZGVsLm9wZW5EaWFsb2dGaWxlTWFzayA9ICcubWRjLC5tZHosLm1keCwubXJ0LC5tcnosLm1yeCc7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUmVzb3VyY2VWaWV3JzpcclxuICAgICAgICB0aGlzLnBvc3RSZXBvcnRSZXNvdXJjZShldmVudC52YWx1ZS5uYW1lLCAnVmlldycpO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ1Jlc291cmNlU2F2ZUZpbGUnOlxyXG4gICAgICAgIHRoaXMucG9zdFJlcG9ydFJlc291cmNlKGV2ZW50LnZhbHVlLm5hbWUsICdTYXZlRmlsZScpO1xyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ0Z1bGxTY3JlZW4nOlxyXG4gICAgICAgIHRoaXMuZnVsbFNjcmVlblNlcnZpY2UuY2hhbmdlRnVsbFNjcmVlbk1vZGUoIXRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLmZ1bGxTY3JlZW5Nb2RlKTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICBjYXNlICdBYm91dCc6XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdBYm91dCcgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgY2FzZSAnUGluJzpcclxuICAgICAgICB0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSA9ICF0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZTtcclxuICAgICAgICB0aGlzLnBhZ2VTZXJ2aWNlLmNhbGN1bGF0ZUxheW91dCgpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5hdXRvSGlkZSkge1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGlkZVRvb2xiYXIoKTtcclxuICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgIGNhc2UgJ0Rlc2lnbic6XHJcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoeyBhY3Rpb246ICdEZXNpZ24nIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBpZiAoZXZlbnQubmFtZS5pbmRleE9mKCdzYXZlTWVudScpID09PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ0V4cG9ydCcsIGRhdGE6IHsgZm9ybWF0OiBldmVudC5uYW1lLnN1YnN0cig4KSB9IH0pO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQubmFtZS5pbmRleE9mKCdzZW5kRW1haWxNZW51JykgPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KHsgYWN0aW9uOiAnU2VuZEVtYWlsJywgZGF0YTogeyBmb3JtYXQ6IGV2ZW50Lm5hbWUuc3Vic3RyKDEzKSB9IH0pO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmdldFBhZ2VzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2hvd0Vycm9yKG1lc3NhZ2U6IGFueSwgbWVzc2FnZVRleHQ/OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGxldCB0eXBlID0gJ0Vycm9yJztcclxuXHJcbiAgICAvLyBDaGVjayBmb3IgZXJyb3IgaW4gJ1NlcnZlckVycm9yOicgc3RyaW5nIGZvcm1hdFxyXG4gICAgaWYgKG1lc3NhZ2UgIT0gbnVsbCAmJiB0eXBlb2YgKG1lc3NhZ2UpID09PSAnc3RyaW5nJyAmJiBtZXNzYWdlLnN1YnN0cigwLCAxMikgPT09ICdTZXJ2ZXJFcnJvcjonKSB7XHJcbiAgICAgIGlmIChtZXNzYWdlLmxlbmd0aCA8PSAxMykge1xyXG4gICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0FuIHVua25vd24gZXJyb3Igb2NjdXJyZWQgKHRoZSBzZXJ2ZXIgcmV0dXJuZWQgYW4gZW1wdHkgdmFsdWUpLic7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWVzc2FnZVRleHQgPSBtZXNzYWdlLnN1YnN0cigxMik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBmb3IgZXJyb3IgaW4gSlNPTiBmb3JtYXRcclxuICAgIGlmIChtZXNzYWdlICE9IG51bGwgJiYgbWVzc2FnZS5zdWNjZXNzID09PSBmYWxzZSAmJiBtZXNzYWdlLnR5cGUgJiYgbWVzc2FnZS50ZXh0KSB7XHJcbiAgICAgIHR5cGUgPSBtZXNzYWdlLnR5cGU7XHJcbiAgICAgIG1lc3NhZ2VUZXh0ID0gbWVzc2FnZS50ZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubW9kZWwuZXJyb3JNZXNzYWdlID0geyBlcnJvcjogJ1Vua25vd24gZXJyb3InLCB0eXBlIH07XHJcblxyXG4gICAgaWYgKG1lc3NhZ2VUZXh0ICE9IG51bGwpIHtcclxuICAgICAgaWYgKG1lc3NhZ2VUZXh0ID09PSAnVGhlIHJlcG9ydCBpcyBub3Qgc3BlY2lmaWVkLicgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLnNob3dSZXBvcnRJc05vdFNwZWNpZmllZE1lc3NhZ2UpIHsgcmV0dXJuIHRydWU7IH1cclxuXHJcbiAgICAgIHRoaXMubW9kZWwuZXJyb3JNZXNzYWdlID0geyBlcnJvcjogbWVzc2FnZVRleHQucmVwbGFjZSgnXFxuJywgJzxicj4nKSwgdHlwZSB9O1xyXG5cclxuICAgICAgaWYgKHRoaXMubW9kZWwuaW1hZ2VzKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtU2VydmljZS5zaG93Rm9ybSgnZXJyb3JNZXNzYWdlRm9ybScpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFsZXJ0KG1lc3NhZ2VUZXh0KTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmFjdGlvblN1YmplY3QubmV4dCh7IGFjdGlvbjogJ0Vycm9yJyB9KTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RSZXBvcnRSZXNvdXJjZShyZXNvdXJjZU5hbWU6IHN0cmluZywgdmlld1R5cGU6IHN0cmluZykge1xyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgYWN0aW9uOiAnUmVwb3J0UmVzb3VyY2UnLFxyXG4gICAgICByZXBvcnRSZXNvdXJjZVBhcmFtczoge1xyXG4gICAgICAgIHJlc291cmNlTmFtZSxcclxuICAgICAgICB2aWV3VHlwZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGRvYyA9IHZpZXdUeXBlID09PSAnVmlldycgPyB0aGlzLmhlbHBlci5vcGVuTmV3V2luZG93KCdhYm91dDpibGFuaycsICdfYmxhbmsnKS5kb2N1bWVudCA6IG51bGw7XHJcbiAgICBjb25zdCB1cmwgPSB0aGlzLm1vZGVsLnJlcXVlc3RVcmw7XHJcbiAgICB0aGlzLmh0dHBDbGllbnQucG9zdEZvcm0odXJsLnJlcGxhY2UoJ3thY3Rpb259JywgdGhpcy5tb2RlbC5vcHRpb25zLmFjdGlvbnMudmlld2VyRXZlbnQpLCBkYXRhLCBkb2MpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBvc3RCb29rbWFya05vZGVBY3Rpb24obm9kZTogQm9va21hcmtOb2RlKSB7XHJcbiAgICBub2RlLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgIHRoaXMuYWN0aW9uKHsgbmFtZTogJ0Jvb2ttYXJrQWN0aW9uJywgYm9va21hcmtQYWdlOiBub2RlLnBhZ2UsIGJvb2ttYXJrQW5jaG9yOiBub2RlLnVybC5yZXBsYWNlKC9cXFxcXFwnL2csICdcXCcnKS5zdWJzdHIoMSksIGNvbXBvbmVudEd1aWQ6IG5vZGUuY29tcHVuZW50R3VpZCB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB2aWV3ZXJSZXNpemVkKCkge1xyXG4gICAgdGhpcy5tZW51U2VydmljZS5jbG9zZUFsbE1lbnVzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaW5pdEF1dG9VcGRhdGVDYWNoZSgpIHtcclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuc2VydmVyLmFsbG93QXV0b1VwZGF0ZUNhY2hlKSB7XHJcbiAgICAgIGlmICh0aGlzLm1vZGVsLnRpbWVyQXV0b1VwZGF0ZUNhY2hlKSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vZGVsLnRpbWVyQXV0b1VwZGF0ZUNhY2hlKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLm1vZGVsLnRpbWVyQXV0b1VwZGF0ZUNhY2hlID0gc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5wb3N0KCdVcGRhdGVDYWNoZScpLCB0aGlzLm1vZGVsLm9wdGlvbnMuc2VydmVyLnRpbWVvdXRBdXRvVXBkYXRlQ2FjaGUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXJ0UmVmcmVzaFJlcG9ydFRpbWVyKHRpbWVvdXQ6IG51bWJlcikge1xyXG4gICAgaWYgKHRoaXMubW9kZWwucmVmcmVzaFJlcG9ydFRpbWVyICE9IG51bGwpIHtcclxuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vZGVsLnJlZnJlc2hSZXBvcnRUaW1lcik7XHJcbiAgICAgIHRoaXMubW9kZWwucmVmcmVzaFJlcG9ydFRpbWVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGltZW91dCAmJiB0aW1lb3V0ID4gMCkge1xyXG4gICAgICB0aGlzLm1vZGVsLnJlZnJlc2hSZXBvcnRUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMubW9kZWwuc2hvd1Byb2dyZXNzKSB7XHJcbiAgICAgICAgICB0aGlzLnBvc3QoJ1JlZnJlc2gnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIHRpbWVvdXQgKiAxMDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBjaGVja1RyRXhwKCkge1xyXG4gICAgaWYgKCF0aGlzLm1vZGVsLm9wdGlvbnMuY2xvdWRNb2RlICYmICF0aGlzLm1vZGVsLm9wdGlvbnMuc2VydmVyTW9kZSAmJiAhdGhpcy5tb2RlbC5vcHRpb25zLnN0YW5kYWxvbmVKc01vZGUgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5yZXBvcnREZXNpZ25lck1vZGUgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5hbHRlcm5hdGVWYWxpZCkge1xyXG4gICAgICBsZXQgYnVpbGREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvKmlmICh0aGlzLm1vZGVsLm9wdGlvbnMuanNNb2RlICYmIHR5cGVvZiBTdGltdWxzb2Z0ICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICBsZXQgaW5uZXJEYXRlID0gU3RpbXVsc29mdC5TdGlWZXJzaW9uLmNyZWF0ZWQuaW5uZXJEYXRlO1xyXG4gICAgICAgICAgaWYgKGlubmVyRGF0ZVsnZ2V0RnVsbFllYXInXSAmJiBpbm5lckRhdGUuZ2V0RnVsbFllYXIoKSA+IDIwMTcpXHJcbiAgICAgICAgICAgIGJ1aWxkRGF0ZSA9IFN0aW11bHNvZnQuU3RpVmVyc2lvbi5jcmVhdGVkLmlubmVyRGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSovIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMuYnVpbGREYXRlKSB7XHJcbiAgICAgICAgICBidWlsZERhdGUgPSBuZXcgRGF0ZSh0aGlzLm1vZGVsLm9wdGlvbnMuYnVpbGREYXRlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBidWlsZERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0ckRheXMgPSBNYXRoLmZsb29yKCgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gYnVpbGREYXRlLmdldFRpbWUoKSkgLyAxMDAwIC8gNjAgLyA2MCAvIDI0KTtcclxuICAgICAgaWYgKHRyRGF5cyA+IDYwKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdHJEYXlzID4gMTIwID8gdGhpcy5tb2RlbC5sb2MoJ05vdGljZXNZb3VyVHJpYWxIYXNFeHBpcmVkJykgOiB0aGlzLm1vZGVsLmxvYygnTm90aWNlc1lvdVVzaW5nVHJpYWxWZXJzaW9uJyk7XHJcbiAgICAgICAgICBjb25zdCBpbWFnZSA9ICdOb3RpZmljYXRpb25zLldhcm5pbmcucG5nJztcclxuICAgICAgICAgIGNvbnN0IGJ1dHRvbkNhcHRpb24gPSB0aGlzLm1vZGVsLmxvYygnQnV0dG9uT2snKTtcclxuICAgICAgICAgIGxldCBjYW5jZWxBY3Rpb246IGFueTtcclxuICAgICAgICAgIGxldCBhY3Rpb246IGFueTtcclxuXHJcbiAgICAgICAgICBpZiAodHJEYXlzID4gMTIwKSB7XHJcbiAgICAgICAgICAgIGFjdGlvbiA9IGNhbmNlbEFjdGlvbiA9ICgpID0+IHsgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cHM6Ly93d3cuc3RpbXVsc29mdC5jb20vZW4vb25saW5lLXN0b3JlJzsgfTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLm1vZGVsLm5vdGlmaWNhdGlvbkZvcm1PcHRpb25zID0geyBtZXNzYWdlLCBpbWFnZSwgYnV0dG9uQ2FwdGlvbiwgY2FuY2VsQWN0aW9uLCBhY3Rpb24gfTtcclxuICAgICAgICAgIHRoaXMuZm9ybVNlcnZpY2Uuc2hvd0Zvcm0oJ25vdGlmaWNhdGlvbkZvcm0nKTtcclxuICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=