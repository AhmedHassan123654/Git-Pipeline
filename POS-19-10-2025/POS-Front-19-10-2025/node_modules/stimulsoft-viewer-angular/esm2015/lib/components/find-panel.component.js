import { __decorate } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { ModelService } from '../services/model.service';
import { FindService } from '../services/find.service';
import { ControllerService } from '../services/controller.service';
let FindPanelComponent = class FindPanelComponent {
    constructor(model, findService, controller) {
        this.model = model;
        this.findService = findService;
        this.controller = controller;
        this.changeFind = false;
        this.initItems();
        controller.getMessage().subscribe((message) => {
            switch (message.action) {
                case 'GetReport':
                case 'GetPages':
                case 'OpenReport':
                case 'Variables':
                    if (model.controls.findPanel.visible) {
                        setTimeout(() => {
                            this.findService.hideFindLabels();
                            this.find('Next');
                        });
                    }
                    break;
            }
        });
    }
    ngAfterViewInit() {
        this.model.controls.findPanel.el = this.element;
        this.model.controls.findPanel.getVisibility().subscribe(() => {
            if (this.model.controls.findPanel.visible) {
                this.findService.text = '';
                setTimeout(() => {
                    this.textBox.element.nativeElement.focus();
                });
            }
        });
    }
    ngOnInit() { }
    selected(item) {
        switch (item.action) {
            case 'MatchCase':
                return this.findService.matchCase;
            case 'MatchWholeWord':
                return this.findService.matchWholeWord;
        }
        return false;
    }
    textBoxAction(target) {
        this.findService.text = target.value;
        this.find('Next');
    }
    find(direction) {
        if (this.findService.text === '') {
            this.findService.hideFindLabels();
            return;
        }
        if (this.findService.lastFindText !== this.findService.text || this.changeFind) {
            this.changeFind = false;
            this.findService.showFindLabels();
        }
        else {
            this.findService.selectFindLabel(direction);
        }
    }
    initItems() {
        this.items = [
            { type: 'button', action: 'close', img: 'CloseForm.png', margin: '2px' },
            { type: 'textBlock', action: 'text', caption: this.model.loc('FindWhat').replace(":", ""), margin: '2px' },
            { type: 'textBox', action: 'findTextBox', margin: '2px' },
            { type: 'button', action: 'FindPreviows', caption: this.model.loc('FindPrevious'), img: 'Arrows.ArrowUpBlue.png', margin: '2px' },
            { type: 'button', action: 'FindNext', caption: this.model.loc('FindNext'), img: 'Arrows.ArrowDownBlue.png', margin: '2px' },
            { type: 'button', action: 'MatchCase', caption: this.model.loc('MatchCase').replace('&', ''), margin: '2px' },
            { type: 'button', action: 'MatchWholeWord', caption: this.model.loc('MatchWholeWord').replace('&', ''), margin: '2px' }
        ];
    }
    action(action) {
        switch (action) {
            case 'close':
                this.model.controls.findPanel.visible = false;
                break;
            case 'MatchCase':
                this.findService.matchCase = !this.findService.matchCase;
                this.changeFind = true;
                break;
            case 'MatchWholeWord':
                this.findService.matchWholeWord = !this.findService.matchWholeWord;
                this.changeFind = true;
                break;
            case 'FindPreviows':
                this.findService.text = this.textBox.element.nativeElement.value;
                this.find('Previous');
                break;
            case 'FindNext':
                this.findService.text = this.textBox.element.nativeElement.value;
                this.find('Next');
                break;
        }
    }
};
FindPanelComponent.ctorParameters = () => [
    { type: ModelService },
    { type: FindService },
    { type: ControllerService }
];
__decorate([
    ViewChild('element')
], FindPanelComponent.prototype, "element", void 0);
__decorate([
    ViewChild('textBox')
], FindPanelComponent.prototype, "textBox", void 0);
FindPanelComponent = __decorate([
    Component({
        selector: 'sti-find-panel',
        template: `
    <div #element [style.display]="model.controls.findPanel.visible ? '' : 'none'"
    [class]="'stiJsViewerToolBar' + (model.options.toolbar.displayMode == 'Separated' ? ' stiJsViewerToolBarSeparated' : '')">
      <div [style.paddingTop]="model.options.toolbar.displayMode == 'Simple' ? '2px' : ''">
        <div class="stiJsViewerToolBarTable" [style.border]="model.options.toolbar.displayMode == 'Separated' ? '0px' : ''" style="box-sizing: border-box">
          <table class="stiJsViewerClearAllStyles" cellpadding="0" cellspacing="0" style="margin: 0">
            <tbody>
                <tr class="stiJsViewerClearAllStyles">
                   <td *ngFor="let item of items"  class="stiJsViewerClearAllStyles">
                      <sti-button *ngIf="item.type=='button'"
                        [actionName]="item.action"
                        [imageName]="item.img"
                        [caption]="item.caption"
                        [margin]="item.margin"
                        [height]="model.options.toolbar.displayMode == 'Separated' ? '28px' : ''"
                        (action)="action(item.action)"
                        [selected]="selected(item)"
                        ></sti-button>
                      <sti-text-box #textBox *ngIf="item.type=='textBox'" [width]="170"
                        [margin]="item.margin"
                        [focusOnCreate]="true"
                        (action)="textBoxAction($event)"
                        [value]="findService.text"></sti-text-box>
                      <sti-text-block *ngIf="item.type=='textBlock'" [margin]="item.margin" [text]="item.caption"></sti-text-block>
                  </td>
                </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `
    })
], FindPanelComponent);
export { FindPanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zdGltdWxzb2Z0LXZpZXdlci1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmluZC1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXlCLFNBQVMsRUFBYyxNQUFNLGVBQWUsQ0FBQztBQUN4RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFekQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXZELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBc0NuRSxJQUFhLGtCQUFrQixHQUEvQixNQUFhLGtCQUFrQjtJQVE3QixZQUFtQixLQUFtQixFQUFTLFdBQXdCLEVBQVMsVUFBNkI7UUFBMUYsVUFBSyxHQUFMLEtBQUssQ0FBYztRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVMsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFGckcsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUd6QixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFakIsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQWdCLEVBQUUsRUFBRTtZQUNyRCxRQUFRLE9BQU8sQ0FBQyxNQUFNLEVBQUU7Z0JBQ3RCLEtBQUssV0FBVyxDQUFDO2dCQUNqQixLQUFLLFVBQVUsQ0FBQztnQkFDaEIsS0FBSyxZQUFZLENBQUM7Z0JBQ2xCLEtBQUssV0FBVztvQkFDZCxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRTt3QkFDcEMsVUFBVSxDQUFDLEdBQUcsRUFBRTs0QkFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRSxDQUFDOzRCQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFD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QUFPLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQztnQkFDakUsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDdEIsTUFBTTtZQUNSLEtBQUssVUFBVTtnQkFDYixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO2dCQUNqRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNsQixNQUFNO1NBQ1Q7SUFDSCxDQUFDO0NBQ0YsQ0FBQTs7WUFsRzJCLFlBQVk7WUFBc0IsV0FBVztZQUFxQixpQkFBaUI7O0FBTnZGO0lBQXJCLFNBQVMsQ0FBQyxTQUFTLENBQUM7bURBQXFCO0FBQ3BCO0lBQXJCLFNBQVMsQ0FBQyxTQUFTLENBQUM7bURBQTJCO0FBSHJDLGtCQUFrQjtJQXBDOUIsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0ErQlQ7S0FDRixDQUFDO0dBRVcsa0JBQWtCLENBMEc5QjtTQTFHWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgVmlld0NoaWxkLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDb21wb25lbnREZXNjcmlwdGlvbiwgTWVzc2FnZSB9IGZyb20gJy4uL3NlcnZpY2VzL29iamVjdHMnO1xyXG5pbXBvcnQgeyBGaW5kU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2ZpbmQuc2VydmljZSc7XHJcbmltcG9ydCB7IFRleHRCb3hDb21wb25lbnQgfSBmcm9tICcuLi9jb250cm9scy90ZXh0LWJveC5jb21wb25ldCc7XHJcbmltcG9ydCB7IENvbnRyb2xsZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29udHJvbGxlci5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc3RpLWZpbmQtcGFuZWwnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2ICNlbGVtZW50IFtzdHlsZS5kaXNwbGF5XT1cIm1vZGVsLmNvbnRyb2xzLmZpbmRQYW5lbC52aXNpYmxlID8gJycgOiAnbm9uZSdcIlxyXG4gICAgW2NsYXNzXT1cIidzdGlKc1ZpZXdlclRvb2xCYXInICsgKG1vZGVsLm9wdGlvbnMudG9vbGJhci5kaXNwbGF5TW9kZSA9PSAnU2VwYXJhdGVkJyA/ICcgc3RpSnNWaWV3ZXJUb29sQmFyU2VwYXJhdGVkJyA6ICcnKVwiPlxyXG4gICAgICA8ZGl2IFtzdHlsZS5wYWRkaW5nVG9wXT1cIm1vZGVsLm9wdGlvbnMudG9vbGJhci5kaXNwbGF5TW9kZSA9PSAnU2ltcGxlJyA/ICcycHgnIDogJydcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RpSnNWaWV3ZXJUb29sQmFyVGFibGVcIiBbc3R5bGUuYm9yZGVyXT1cIm1vZGVsLm9wdGlvbnMudG9vbGJhci5kaXNwbGF5TW9kZSA9PSAnU2VwYXJhdGVkJyA/ICcwcHgnIDogJydcIiBzdHlsZT1cImJveC1zaXppbmc6IGJvcmRlci1ib3hcIj5cclxuICAgICAgICAgIDx0YWJsZSBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIiBjZWxscGFkZGluZz1cIjBcIiBjZWxsc3BhY2luZz1cIjBcIiBzdHlsZT1cIm1hcmdpbjogMFwiPlxyXG4gICAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgICAgICA8dHIgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGl0ZW0gb2YgaXRlbXNcIiAgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3RpLWJ1dHRvbiAqbmdJZj1cIml0ZW0udHlwZT09J2J1dHRvbidcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbYWN0aW9uTmFtZV09XCJpdGVtLmFjdGlvblwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtpbWFnZU5hbWVdPVwiaXRlbS5pbWdcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbY2FwdGlvbl09XCJpdGVtLmNhcHRpb25cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbbWFyZ2luXT1cIml0ZW0ubWFyZ2luXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgW2hlaWdodF09XCJtb2RlbC5vcHRpb25zLnRvb2xiYXIuZGlzcGxheU1vZGUgPT0gJ1NlcGFyYXRlZCcgPyAnMjhweCcgOiAnJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChhY3Rpb24pPVwiYWN0aW9uKGl0ZW0uYWN0aW9uKVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtzZWxlY3RlZF09XCJzZWxlY3RlZChpdGVtKVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID48L3N0aS1idXR0b24+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3RpLXRleHQtYm94ICN0ZXh0Qm94ICpuZ0lmPVwiaXRlbS50eXBlPT0ndGV4dEJveCdcIiBbd2lkdGhdPVwiMTcwXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgW21hcmdpbl09XCJpdGVtLm1hcmdpblwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtmb2N1c09uQ3JlYXRlXT1cInRydWVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYWN0aW9uKT1cInRleHRCb3hBY3Rpb24oJGV2ZW50KVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJmaW5kU2VydmljZS50ZXh0XCI+PC9zdGktdGV4dC1ib3g+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3RpLXRleHQtYmxvY2sgKm5nSWY9XCJpdGVtLnR5cGU9PSd0ZXh0QmxvY2snXCIgW21hcmdpbl09XCJpdGVtLm1hcmdpblwiIFt0ZXh0XT1cIml0ZW0uY2FwdGlvblwiPjwvc3RpLXRleHQtYmxvY2s+XHJcbiAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgICAgPC90YWJsZT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICBgXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRmluZFBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZWxlbWVudCcpIGVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZCgndGV4dEJveCcpIHRleHRCb3g6IFRleHRCb3hDb21wb25lbnQ7XHJcblxyXG4gIGl0ZW1zOiBDb21wb25lbnREZXNjcmlwdGlvbltdO1xyXG4gIHByaXZhdGUgY2hhbmdlRmluZCA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIGZpbmRTZXJ2aWNlOiBGaW5kU2VydmljZSwgcHVibGljIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLmluaXRJdGVtcygpO1xyXG5cclxuICAgIGNvbnRyb2xsZXIuZ2V0TWVzc2FnZSgpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xyXG4gICAgICBzd2l0Y2ggKG1lc3NhZ2UuYWN0aW9uKSB7XHJcbiAgICAgICAgY2FzZSAnR2V0UmVwb3J0JzpcclxuICAgICAgICBjYXNlICdHZXRQYWdlcyc6XHJcbiAgICAgICAgY2FzZSAnT3BlblJlcG9ydCc6XHJcbiAgICAgICAgY2FzZSAnVmFyaWFibGVzJzpcclxuICAgICAgICAgIGlmIChtb2RlbC5jb250cm9scy5maW5kUGFuZWwudmlzaWJsZSkge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmZpbmRTZXJ2aWNlLmhpZGVGaW5kTGFiZWxzKCk7XHJcbiAgICAgICAgICAgICAgdGhpcy5maW5kKCdOZXh0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy5maW5kUGFuZWwuZWwgPSB0aGlzLmVsZW1lbnQ7XHJcblxyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy5maW5kUGFuZWwuZ2V0VmlzaWJpbGl0eSgpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLm1vZGVsLmNvbnRyb2xzLmZpbmRQYW5lbC52aXNpYmxlKSB7XHJcbiAgICAgICAgdGhpcy5maW5kU2VydmljZS50ZXh0ID0gJyc7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnRleHRCb3guZWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7IH1cclxuXHJcbiAgc2VsZWN0ZWQoaXRlbTogQ29tcG9uZW50RGVzY3JpcHRpb24pOiBib29sZWFuIHtcclxuICAgIHN3aXRjaCAoaXRlbS5hY3Rpb24pIHtcclxuICAgICAgY2FzZSAnTWF0Y2hDYXNlJzpcclxuICAgICAgICByZXR1cm4gdGhpcy5maW5kU2VydmljZS5tYXRjaENhc2U7XHJcbiAgICAgIGNhc2UgJ01hdGNoV2hvbGVXb3JkJzpcclxuICAgICAgICByZXR1cm4gdGhpcy5maW5kU2VydmljZS5tYXRjaFdob2xlV29yZDtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHRleHRCb3hBY3Rpb24odGFyZ2V0OiBhbnkpIHtcclxuICAgIHRoaXMuZmluZFNlcnZpY2UudGV4dCA9IHRhcmdldC52YWx1ZTtcclxuICAgIHRoaXMuZmluZCgnTmV4dCcpO1xyXG4gIH1cclxuXHJcbiAgZmluZChkaXJlY3Rpb246IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuZmluZFNlcnZpY2UudGV4dCA9PT0gJycpIHtcclxuICAgICAgdGhpcy5maW5kU2VydmljZS5oaWRlRmluZExhYmVscygpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5maW5kU2VydmljZS5sYXN0RmluZFRleHQgIT09IHRoaXMuZmluZFNlcnZpY2UudGV4dCB8fCB0aGlzLmNoYW5nZUZpbmQpIHtcclxuICAgICAgdGhpcy5jaGFuZ2VGaW5kID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuZmluZFNlcnZpY2Uuc2hvd0ZpbmRMYWJlbHMoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZmluZFNlcnZpY2Uuc2VsZWN0RmluZExhYmVsKGRpcmVjdGlvbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbml0SXRlbXMoKSB7XHJcbiAgICB0aGlzLml0ZW1zID0gW1xyXG4gICAgICB7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdjbG9zZScsIGltZzogJ0Nsb3NlRm9ybS5wbmcnLCBtYXJnaW46ICcycHgnIH0sXHJcbiAgICAgIHsgdHlwZTogJ3RleHRCbG9jaycsIGFjdGlvbjogJ3RleHQnLCBjYXB0aW9uOiB0aGlzLm1vZGVsLmxvYygnRmluZFdoYXQnKS5yZXBsYWNlKFwiOlwiLCBcIlwiKSwgbWFyZ2luOiAnMnB4JyB9LFxyXG4gICAgICB7IHR5cGU6ICd0ZXh0Qm94JywgYWN0aW9uOiAnZmluZFRleHRCb3gnLCBtYXJnaW46ICcycHgnIH0sXHJcbiAgICAgIHsgdHlwZTogJ2J1dHRvbicsIGFjdGlvbjogJ0ZpbmRQcmV2aW93cycsIGNhcHRpb246IHRoaXMubW9kZWwubG9jKCdGaW5kUHJldmlvdXMnKSwgaW1nOiAnQXJyb3dzLkFycm93VXBCbHVlLnBuZycsIG1hcmdpbjogJzJweCcgfSxcclxuICAgICAgeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnRmluZE5leHQnLCBjYXB0aW9uOiB0aGlzLm1vZGVsLmxvYygnRmluZE5leHQnKSwgaW1nOiAnQXJyb3dzLkFycm93RG93bkJsdWUucG5nJywgbWFyZ2luOiAnMnB4JyB9LFxyXG4gICAgICB7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdNYXRjaENhc2UnLCBjYXB0aW9uOiB0aGlzLm1vZGVsLmxvYygnTWF0Y2hDYXNlJykucmVwbGFjZSgnJicsICcnKSwgbWFyZ2luOiAnMnB4JyB9LFxyXG4gICAgICB7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdNYXRjaFdob2xlV29yZCcsIGNhcHRpb246IHRoaXMubW9kZWwubG9jKCdNYXRjaFdob2xlV29yZCcpLnJlcGxhY2UoJyYnLCAnJyksIG1hcmdpbjogJzJweCcgfVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIGFjdGlvbihhY3Rpb246IHN0cmluZykge1xyXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgY2FzZSAnY2xvc2UnOlxyXG4gICAgICAgIHRoaXMubW9kZWwuY29udHJvbHMuZmluZFBhbmVsLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnTWF0Y2hDYXNlJzpcclxuICAgICAgICB0aGlzLmZpbmRTZXJ2aWNlLm1hdGNoQ2FzZSA9ICF0aGlzLmZpbmRTZXJ2aWNlLm1hdGNoQ2FzZTtcclxuICAgICAgICB0aGlzLmNoYW5nZUZpbmQgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdNYXRjaFdob2xlV29yZCc6XHJcbiAgICAgICAgdGhpcy5maW5kU2VydmljZS5tYXRjaFdob2xlV29yZCA9ICF0aGlzLmZpbmRTZXJ2aWNlLm1hdGNoV2hvbGVXb3JkO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlRmluZCA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0ZpbmRQcmV2aW93cyc6XHJcbiAgICAgICAgdGhpcy5maW5kU2VydmljZS50ZXh0ID0gdGhpcy50ZXh0Qm94LmVsZW1lbnQubmF0aXZlRWxlbWVudC52YWx1ZTtcclxuICAgICAgICB0aGlzLmZpbmQoJ1ByZXZpb3VzJyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0ZpbmROZXh0JzpcclxuICAgICAgICB0aGlzLmZpbmRTZXJ2aWNlLnRleHQgPSB0aGlzLnRleHRCb3guZWxlbWVudC5uYXRpdmVFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgIHRoaXMuZmluZCgnTmV4dCcpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=