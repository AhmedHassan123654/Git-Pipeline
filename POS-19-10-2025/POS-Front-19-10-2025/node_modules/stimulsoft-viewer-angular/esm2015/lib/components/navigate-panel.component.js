import { __decorate } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { ModelService } from '../services/model.service';
import { ControllerService } from '../services/controller.service';
import { HelperService } from '../services/helper.service';
import { PageService } from '../services/page.service';
let NavigatePanelComponent = class NavigatePanelComponent {
    constructor(model, controller, helper, pageService) {
        this.model = model;
        this.controller = controller;
        this.helper = helper;
        this.pageService = pageService;
        this.comps = [];
    }
    ngOnInit() {
        if (this.model.options.toolbar.displayMode === 'Separated') {
            this.initButtons();
        }
        this.controller.getMessage().subscribe((message) => {
            if (message.action !== 'viewer_loaded') {
                this.updateButtons();
            }
        });
        this.model.controls.navigatePanel.visible = this.model.options.toolbar.displayMode === 'Separated';
    }
    ngAfterViewInit() {
        this.model.controls.navigatePanel.el = this.element;
    }
    updateButtons() {
        this.comps.filter(i => i.action === 'ViewMode').forEach(m => m.caption = this.model.loc(this.model.reportParams.viewMode));
        this.comps.filter(i => i.action === 'Zoom').forEach((m) => {
            m.menuItems.forEach(n => n.selected = n.name === ('Zoom' + this.model.reportParams.zoom));
            m.caption = Math.round(this.model.reportParams.zoom) + '%';
        });
        this.comps.filter(i => i.action === 'ShowFind').forEach((m) => {
            m.selected = this.model.controls.findPanel.visible;
        });
    }
    initButtons() {
        const comps = [];
        if (this.model.options.toolbar.showFirstPageButton) {
            comps.push({ type: 'button', action: 'FirstPage', img: 'PageFirst20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showPreviousPageButton) {
            comps.push({ type: 'button', action: 'PrevPage', img: 'PagePrevious20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showCurrentPageControl) {
            comps.push({ type: 'separator' });
            comps.push({ type: 'pageControl' });
            comps.push({ type: 'separator' });
        }
        if (this.model.options.toolbar.showNextPageButton) {
            comps.push({ type: 'button', action: 'NextPage', img: 'PageNext20.png', tooltip: true });
        }
        if (this.model.options.toolbar.showLastPageButton) {
            comps.push({ type: 'button', action: 'LastPage', img: 'PageLast20.png', tooltip: true });
        }
        comps.push({ type: 'space' });
        comps.push({ type: 'button', action: 'ZoomPageWidth', img: 'ZoomPageWidth20.png', tooltip: true });
        comps.push({ type: 'button', action: 'ZoomOnePage', img: 'ZoomOnePage20.png', tooltip: true });
        if (this.model.options.toolbar.showZoomButton) {
            comps.push({ type: 'separator' });
            comps.push({
                type: 'button', action: 'Zoom', caption: '100%', tooltip: true, arrow: 'Arrows.SmallArrowUpWhite.png',
                menuItems: this.helper.getZoomMenuItems()
            });
        }
        this.comps = comps;
    }
    enabled(desc) {
        const disableNaviButtons = this.disableNaviButtons();
        switch (desc.action) {
            case 'FirstPage':
            case 'PrevPage':
                return this.model.reportParams.pageNumber > 0 && !disableNaviButtons;
            case 'NextPage':
            case 'LastPage':
                return this.model.reportParams.pageNumber < this.model.reportParams.pagesCount - 1 && !disableNaviButtons;
        }
        return true;
    }
    selected(desc) {
        switch (desc.action) {
            case 'ZoomPageWidth':
                return Math.round(this.model.reportParams.zoom) === Math.round(this.pageService.getZoomByPageWidth());
            case 'ZoomOnePage':
                return Math.round(this.model.reportParams.zoom) === Math.round(this.pageService.getZoomByPageHeight());
        }
        return false;
    }
    disableNaviButtons() {
        return this.model.reportParams.viewMode === 'MultiplePages' || this.model.reportParams.viewMode === 'WholeReport' ||
            (this.model.reportParams.viewMode === 'Continuous' && !this.model.options.appearance.scrollbarsMode && !this.model.options.appearance.fullScreenMode);
    }
};
NavigatePanelComponent.ctorParameters = () => [
    { type: ModelService },
    { type: ControllerService },
    { type: HelperService },
    { type: PageService }
];
__decorate([
    ViewChild('element')
], NavigatePanelComponent.prototype, "element", void 0);
NavigatePanelComponent = __decorate([
    Component({
        selector: 'sti-navigate-panel',
        template: `
  <div #element class="stiJsViewerNavigatePanel" style="display: block;"
    [style.display]="!model.options.isMobileDevice ? (this.model.controls.navigatePanel.visible ? '' : 'none') : ''"
    [style.transition]="model.options.isMobileDevice ? 'margin 300ms ease, opacity 300ms ease' : null"
    [style.zIndex]="model.options.isMobileDevice ? (model.options.toolbar.autoHide ? 5 : 2) : null"
    [style.opacity]="model.options.isMobileDevice ? (model.controls.navigatePanel.visible ? (model.options.toolbar.autoHide ? 0.9 : 1) : 0) : 1"
    [style.marginBottom]="model.options.isMobileDevice && !model.controls.navigatePanel.visible ? '-0.55in' : 0">
    <table class="stiJsViewerClearAllStyles" cellpadding="0" cellspacing="0">
      <tbody>
        <tr class="stiJsViewerClearAllStyles">
          <td *ngFor="let comp of comps" class="stiJsViewerClearAllStyles" [style.width]="comp.type == 'space' ? '100%' : null">
            <sti-button *ngIf="comp.type=='button'"
              [caption]="comp.caption"
              [imageName]="comp.img"
              [arrow]="comp.arrow"
              [menuItems]="comp.menuItems"
              [actionName]="comp.action"
              [tooltip]="comp.tooltip"
              [styleName]="'stiJsViewerNavigateButton'"
              [height]="model.options.isMobileDevice ? '0.5in' : '35px'"
              [width]="model.options.isMobileDevice ? '0.4in' : '35px'"
              [boxSizing]="'border-box'"
              [arrowMarginTop]="'1px'"
              [enabled]="enabled(comp)"
              [imageCellTextAlign]="'center'"
              [innerTableWidth]="'100%'"
              [navagationPanelTooltip]="true"
              [margin]="comp.action == 'FirstPage' ? '0 1px 0 3px' : (comp.action == 'Zoom' ? '0 3px 0 1px' : '0px 1px 0 1px')"
              [selected]="selected(comp)"
              (action)="controller.action({ name: comp.action })">
            </sti-button>

            <div *ngIf="comp.type=='separator'"
              [style.height]="model.options.isMobileDevice ? '0.5in' : '35px'"
              [style.margin]="'0px 1px 0 1px'"
              class="stiJsViewerNavigatePanelSeparator"></div>

            <sti-page-control *ngIf="comp.type=='pageControl'"
              [enabled]="!(model.reportParams.pagesCount <= 1 || disableNaviButtons())"
              [count]="model.reportParams.pagesCount"
              [margin]="'0px 1px 0 1px'"
              [textBoxBorder]="'0px'"></sti-page-control>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="stiJsViewerNavigatePanelDisabledPanel" [style.display]="this.model.controls.navigatePanel.enabled ? 'none' : 'block'"></div>
  </div>
  `
    })
], NavigatePanelComponent);
export { NavigatePanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdGUtcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25hdmlnYXRlLXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBeUIsU0FBUyxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBQ3hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVuRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBdUR2RCxJQUFhLHNCQUFzQixHQUFuQyxNQUFhLHNCQUFzQjtJQU1qQyxZQUFtQixLQUFtQixFQUFTLFVBQTZCLEVBQVMsTUFBcUIsRUFDakcsV0FBd0I7UUFEZCxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBQVMsZUFBVSxHQUFWLFVBQVUsQ0FBbUI7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ2pHLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBSDFCLFVBQUssR0FBMkIsRUFBRSxDQUFDO0lBR0wsQ0FBQztJQUV0QyxRQUFRO1FBQ04sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxLQUFLLFdBQVcsRUFBRTtZQUMxRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDcEI7UUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQWdCLEVBQUUsRUFBRTtZQUMxRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssZUFBZSxFQUFFO2dCQUN0QyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7YUFDdEI7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QUM7U0FDMUc7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxRQUFRLEtBQUssZUFBZSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLFFBQVEsS0FBSyxhQUFhO1lBQy9HLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsUUFBUSxLQUFLLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDMUosQ0FBQztDQUNGLENBQUE7O1lBaEcyQixZQUFZO1lBQXFCLGlCQUFpQjtZQUFpQixhQUFhO1lBQ3BGLFdBQVc7O0FBTFg7SUFBckIsU0FBUyxDQUFDLFNBQVMsQ0FBQzt1REFBcUI7QUFGL0Isc0JBQXNCO0lBckRsQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsb0JBQW9CO1FBQzlCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0RUO0tBQ0YsQ0FBQztHQUVXLHNCQUFzQixDQXNHbEM7U0F0R1ksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RlbFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9tb2RlbC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29udHJvbGxlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jb250cm9sbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDb21wb25lbnREZXNjcmlwdGlvbiwgTWVzc2FnZSB9IGZyb20gJy4uL3NlcnZpY2VzL29iamVjdHMnO1xyXG5pbXBvcnQgeyBIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaGVscGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQYWdlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BhZ2Uuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3N0aS1uYXZpZ2F0ZS1wYW5lbCcsXHJcbiAgdGVtcGxhdGU6IGBcclxuICA8ZGl2ICNlbGVtZW50IGNsYXNzPVwic3RpSnNWaWV3ZXJOYXZpZ2F0ZVBhbmVsXCIgc3R5bGU9XCJkaXNwbGF5OiBibG9jaztcIlxyXG4gICAgW3N0eWxlLmRpc3BsYXldPVwiIW1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgPyAodGhpcy5tb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLnZpc2libGUgPyAnJyA6ICdub25lJykgOiAnJ1wiXHJcbiAgICBbc3R5bGUudHJhbnNpdGlvbl09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJ21hcmdpbiAzMDBtcyBlYXNlLCBvcGFjaXR5IDMwMG1zIGVhc2UnIDogbnVsbFwiXHJcbiAgICBbc3R5bGUuekluZGV4XT1cIm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgPyAobW9kZWwub3B0aW9ucy50b29sYmFyLmF1dG9IaWRlID8gNSA6IDIpIDogbnVsbFwiXHJcbiAgICBbc3R5bGUub3BhY2l0eV09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gKG1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwudmlzaWJsZSA/IChtb2RlbC5vcHRpb25zLnRvb2xiYXIuYXV0b0hpZGUgPyAwLjkgOiAxKSA6IDApIDogMVwiXHJcbiAgICBbc3R5bGUubWFyZ2luQm90dG9tXT1cIm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgJiYgIW1vZGVsLmNvbnRyb2xzLm5hdmlnYXRlUGFuZWwudmlzaWJsZSA/ICctMC41NWluJyA6IDBcIj5cclxuICAgIDx0YWJsZSBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIiBjZWxscGFkZGluZz1cIjBcIiBjZWxsc3BhY2luZz1cIjBcIj5cclxuICAgICAgPHRib2R5PlxyXG4gICAgICAgIDx0ciBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIj5cclxuICAgICAgICAgIDx0ZCAqbmdGb3I9XCJsZXQgY29tcCBvZiBjb21wc1wiIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiIFtzdHlsZS53aWR0aF09XCJjb21wLnR5cGUgPT0gJ3NwYWNlJyA/ICcxMDAlJyA6IG51bGxcIj5cclxuICAgICAgICAgICAgPHN0aS1idXR0b24gKm5nSWY9XCJjb21wLnR5cGU9PSdidXR0b24nXCJcclxuICAgICAgICAgICAgICBbY2FwdGlvbl09XCJjb21wLmNhcHRpb25cIlxyXG4gICAgICAgICAgICAgIFtpbWFnZU5hbWVdPVwiY29tcC5pbWdcIlxyXG4gICAgICAgICAgICAgIFthcnJvd109XCJjb21wLmFycm93XCJcclxuICAgICAgICAgICAgICBbbWVudUl0ZW1zXT1cImNvbXAubWVudUl0ZW1zXCJcclxuICAgICAgICAgICAgICBbYWN0aW9uTmFtZV09XCJjb21wLmFjdGlvblwiXHJcbiAgICAgICAgICAgICAgW3Rvb2x0aXBdPVwiY29tcC50b29sdGlwXCJcclxuICAgICAgICAgICAgICBbc3R5bGVOYW1lXT1cIidzdGlKc1ZpZXdlck5hdmlnYXRlQnV0dG9uJ1wiXHJcbiAgICAgICAgICAgICAgW2hlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzTW9iaWxlRGV2aWNlID8gJzAuNWluJyA6ICczNXB4J1wiXHJcbiAgICAgICAgICAgICAgW3dpZHRoXT1cIm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgPyAnMC40aW4nIDogJzM1cHgnXCJcclxuICAgICAgICAgICAgICBbYm94U2l6aW5nXT1cIidib3JkZXItYm94J1wiXHJcbiAgICAgICAgICAgICAgW2Fycm93TWFyZ2luVG9wXT1cIicxcHgnXCJcclxuICAgICAgICAgICAgICBbZW5hYmxlZF09XCJlbmFibGVkKGNvbXApXCJcclxuICAgICAgICAgICAgICBbaW1hZ2VDZWxsVGV4dEFsaWduXT1cIidjZW50ZXInXCJcclxuICAgICAgICAgICAgICBbaW5uZXJUYWJsZVdpZHRoXT1cIicxMDAlJ1wiXHJcbiAgICAgICAgICAgICAgW25hdmFnYXRpb25QYW5lbFRvb2x0aXBdPVwidHJ1ZVwiXHJcbiAgICAgICAgICAgICAgW21hcmdpbl09XCJjb21wLmFjdGlvbiA9PSAnRmlyc3RQYWdlJyA/ICcwIDFweCAwIDNweCcgOiAoY29tcC5hY3Rpb24gPT0gJ1pvb20nID8gJzAgM3B4IDAgMXB4JyA6ICcwcHggMXB4IDAgMXB4JylcIlxyXG4gICAgICAgICAgICAgIFtzZWxlY3RlZF09XCJzZWxlY3RlZChjb21wKVwiXHJcbiAgICAgICAgICAgICAgKGFjdGlvbik9XCJjb250cm9sbGVyLmFjdGlvbih7IG5hbWU6IGNvbXAuYWN0aW9uIH0pXCI+XHJcbiAgICAgICAgICAgIDwvc3RpLWJ1dHRvbj5cclxuXHJcbiAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJjb21wLnR5cGU9PSdzZXBhcmF0b3InXCJcclxuICAgICAgICAgICAgICBbc3R5bGUuaGVpZ2h0XT1cIm1vZGVsLm9wdGlvbnMuaXNNb2JpbGVEZXZpY2UgPyAnMC41aW4nIDogJzM1cHgnXCJcclxuICAgICAgICAgICAgICBbc3R5bGUubWFyZ2luXT1cIicwcHggMXB4IDAgMXB4J1wiXHJcbiAgICAgICAgICAgICAgY2xhc3M9XCJzdGlKc1ZpZXdlck5hdmlnYXRlUGFuZWxTZXBhcmF0b3JcIj48L2Rpdj5cclxuXHJcbiAgICAgICAgICAgIDxzdGktcGFnZS1jb250cm9sICpuZ0lmPVwiY29tcC50eXBlPT0ncGFnZUNvbnRyb2wnXCJcclxuICAgICAgICAgICAgICBbZW5hYmxlZF09XCIhKG1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlc0NvdW50IDw9IDEgfHwgZGlzYWJsZU5hdmlCdXR0b25zKCkpXCJcclxuICAgICAgICAgICAgICBbY291bnRdPVwibW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VzQ291bnRcIlxyXG4gICAgICAgICAgICAgIFttYXJnaW5dPVwiJzBweCAxcHggMCAxcHgnXCJcclxuICAgICAgICAgICAgICBbdGV4dEJveEJvcmRlcl09XCInMHB4J1wiPjwvc3RpLXBhZ2UtY29udHJvbD5cclxuICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgPC90cj5cclxuICAgICAgPC90Ym9keT5cclxuICAgIDwvdGFibGU+XHJcbiAgICA8ZGl2IGNsYXNzPVwic3RpSnNWaWV3ZXJOYXZpZ2F0ZVBhbmVsRGlzYWJsZWRQYW5lbFwiIFtzdHlsZS5kaXNwbGF5XT1cInRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC5lbmFibGVkID8gJ25vbmUnIDogJ2Jsb2NrJ1wiPjwvZGl2PlxyXG4gIDwvZGl2PlxyXG4gIGBcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBOYXZpZ2F0ZVBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZWxlbWVudCcpIGVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIHB1YmxpYyBjb21wczogQ29tcG9uZW50RGVzY3JpcHRpb25bXSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIGNvbnRyb2xsZXI6IENvbnRyb2xsZXJTZXJ2aWNlLCBwdWJsaWMgaGVscGVyOiBIZWxwZXJTZXJ2aWNlLFxyXG4gICAgcHVibGljIHBhZ2VTZXJ2aWNlOiBQYWdlU2VydmljZSkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLmRpc3BsYXlNb2RlID09PSAnU2VwYXJhdGVkJykge1xyXG4gICAgICB0aGlzLmluaXRCdXR0b25zKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNvbnRyb2xsZXIuZ2V0TWVzc2FnZSgpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZS5hY3Rpb24gIT09ICd2aWV3ZXJfbG9hZGVkJykge1xyXG4gICAgICAgIHRoaXMudXBkYXRlQnV0dG9ucygpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMubW9kZWwuY29udHJvbHMubmF2aWdhdGVQYW5lbC52aXNpYmxlID0gdGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuZGlzcGxheU1vZGUgPT09ICdTZXBhcmF0ZWQnO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb2RlbC5jb250cm9scy5uYXZpZ2F0ZVBhbmVsLmVsID0gdGhpcy5lbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlQnV0dG9ucygpIHtcclxuICAgIHRoaXMuY29tcHMuZmlsdGVyKGkgPT4gaS5hY3Rpb24gPT09ICdWaWV3TW9kZScpLmZvckVhY2gobSA9PiBtLmNhcHRpb24gPSB0aGlzLm1vZGVsLmxvYyh0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy52aWV3TW9kZSkpO1xyXG4gICAgdGhpcy5jb21wcy5maWx0ZXIoaSA9PiBpLmFjdGlvbiA9PT0gJ1pvb20nKS5mb3JFYWNoKChtKSA9PiB7XHJcbiAgICAgIG0ubWVudUl0ZW1zLmZvckVhY2gobiA9PiBuLnNlbGVjdGVkID0gbi5uYW1lID09PSAoJ1pvb20nICsgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSkpO1xyXG4gICAgICBtLmNhcHRpb24gPSBNYXRoLnJvdW5kKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20pICsgJyUnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5jb21wcy5maWx0ZXIoaSA9PiBpLmFjdGlvbiA9PT0gJ1Nob3dGaW5kJykuZm9yRWFjaCgobSkgPT4ge1xyXG4gICAgICBtLnNlbGVjdGVkID0gdGhpcy5tb2RlbC5jb250cm9scy5maW5kUGFuZWwudmlzaWJsZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaW5pdEJ1dHRvbnMoKSB7XHJcbiAgICBjb25zdCBjb21wczogQ29tcG9uZW50RGVzY3JpcHRpb25bXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dGaXJzdFBhZ2VCdXR0b24pIHtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdGaXJzdFBhZ2UnLCBpbWc6ICdQYWdlRmlyc3QyMC5wbmcnLCB0b29sdGlwOiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dQcmV2aW91c1BhZ2VCdXR0b24pIHtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdQcmV2UGFnZScsIGltZzogJ1BhZ2VQcmV2aW91czIwLnBuZycsIHRvb2x0aXA6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dDdXJyZW50UGFnZUNvbnRyb2wpIHtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdzZXBhcmF0b3InIH0pO1xyXG4gICAgICBjb21wcy5wdXNoKHsgdHlwZTogJ3BhZ2VDb250cm9sJyB9KTtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdzZXBhcmF0b3InIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLm1vZGVsLm9wdGlvbnMudG9vbGJhci5zaG93TmV4dFBhZ2VCdXR0b24pIHtcclxuICAgICAgY29tcHMucHVzaCh7IHR5cGU6ICdidXR0b24nLCBhY3Rpb246ICdOZXh0UGFnZScsIGltZzogJ1BhZ2VOZXh0MjAucG5nJywgdG9vbHRpcDogdHJ1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5tb2RlbC5vcHRpb25zLnRvb2xiYXIuc2hvd0xhc3RQYWdlQnV0dG9uKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnTGFzdFBhZ2UnLCBpbWc6ICdQYWdlTGFzdDIwLnBuZycsIHRvb2x0aXA6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcHMucHVzaCh7IHR5cGU6ICdzcGFjZScgfSk7XHJcbiAgICBjb21wcy5wdXNoKHsgdHlwZTogJ2J1dHRvbicsIGFjdGlvbjogJ1pvb21QYWdlV2lkdGgnLCBpbWc6ICdab29tUGFnZVdpZHRoMjAucG5nJywgdG9vbHRpcDogdHJ1ZSB9KTtcclxuICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnYnV0dG9uJywgYWN0aW9uOiAnWm9vbU9uZVBhZ2UnLCBpbWc6ICdab29tT25lUGFnZTIwLnBuZycsIHRvb2x0aXA6IHRydWUgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMubW9kZWwub3B0aW9ucy50b29sYmFyLnNob3dab29tQnV0dG9uKSB7XHJcbiAgICAgIGNvbXBzLnB1c2goeyB0eXBlOiAnc2VwYXJhdG9yJyB9KTtcclxuICAgICAgY29tcHMucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ2J1dHRvbicsIGFjdGlvbjogJ1pvb20nLCBjYXB0aW9uOiAnMTAwJScsIHRvb2x0aXA6IHRydWUsIGFycm93OiAnQXJyb3dzLlNtYWxsQXJyb3dVcFdoaXRlLnBuZycsXHJcbiAgICAgICAgbWVudUl0ZW1zOiB0aGlzLmhlbHBlci5nZXRab29tTWVudUl0ZW1zKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb21wcyA9IGNvbXBzO1xyXG4gIH1cclxuXHJcbiAgZW5hYmxlZChkZXNjOiBDb21wb25lbnREZXNjcmlwdGlvbik6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZGlzYWJsZU5hdmlCdXR0b25zID0gdGhpcy5kaXNhYmxlTmF2aUJ1dHRvbnMoKTtcclxuICAgIHN3aXRjaCAoZGVzYy5hY3Rpb24pIHtcclxuICAgICAgY2FzZSAnRmlyc3RQYWdlJzpcclxuICAgICAgY2FzZSAnUHJldlBhZ2UnOlxyXG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLnJlcG9ydFBhcmFtcy5wYWdlTnVtYmVyID4gMCAmJiAhZGlzYWJsZU5hdmlCdXR0b25zO1xyXG4gICAgICBjYXNlICdOZXh0UGFnZSc6XHJcbiAgICAgIGNhc2UgJ0xhc3RQYWdlJzpcclxuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMucGFnZU51bWJlciA8IHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnBhZ2VzQ291bnQgLSAxICYmICFkaXNhYmxlTmF2aUJ1dHRvbnM7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHNlbGVjdGVkKGRlc2M6IENvbXBvbmVudERlc2NyaXB0aW9uKTogYm9vbGVhbiB7XHJcbiAgICBzd2l0Y2ggKGRlc2MuYWN0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ1pvb21QYWdlV2lkdGgnOlxyXG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnpvb20pID09PSBNYXRoLnJvdW5kKHRoaXMucGFnZVNlcnZpY2UuZ2V0Wm9vbUJ5UGFnZVdpZHRoKCkpO1xyXG4gICAgICBjYXNlICdab29tT25lUGFnZSc6XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMuem9vbSkgPT09IE1hdGgucm91bmQodGhpcy5wYWdlU2VydmljZS5nZXRab29tQnlQYWdlSGVpZ2h0KCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZGlzYWJsZU5hdmlCdXR0b25zKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnZpZXdNb2RlID09PSAnTXVsdGlwbGVQYWdlcycgfHwgdGhpcy5tb2RlbC5yZXBvcnRQYXJhbXMudmlld01vZGUgPT09ICdXaG9sZVJlcG9ydCcgfHxcclxuICAgICAgKHRoaXMubW9kZWwucmVwb3J0UGFyYW1zLnZpZXdNb2RlID09PSAnQ29udGludW91cycgJiYgIXRoaXMubW9kZWwub3B0aW9ucy5hcHBlYXJhbmNlLnNjcm9sbGJhcnNNb2RlICYmICF0aGlzLm1vZGVsLm9wdGlvbnMuYXBwZWFyYW5jZS5mdWxsU2NyZWVuTW9kZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==