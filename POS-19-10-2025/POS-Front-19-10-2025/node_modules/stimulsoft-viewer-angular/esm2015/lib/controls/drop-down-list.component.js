import { __decorate } from "tslib";
import { Component, Input, ViewChild, Output, EventEmitter } from '@angular/core';
import { ModelService } from '../services/model.service';
import { MouseService } from '../services/mouse.service';
import { MenuService } from '../menu/menu.service';
let DropDownListComponent = class DropDownListComponent {
    constructor(model, mouseService, menuService) {
        this.model = model;
        this.mouseService = mouseService;
        this.menuService = menuService;
        this.showImage = false;
        this.action = new EventEmitter();
        this.over = false;
        this._readOnly = false;
        this._enabled = true;
        this.mouseService.getDocumentMouseUp().subscribe(() => {
            this.hideListMenu();
        });
    }
    ngOnInit() { }
    set readOnly(value) {
        this._readOnly = value;
        setTimeout(() => {
            try {
                this.input.nativeElement.setAttribute('unselectable', value ? 'on' : 'off');
                this.input.nativeElement.setAttribute('onselectstart', value ? 'return false' : '');
                this.input.nativeElement.readOnly = value;
            }
            catch (e) { }
        });
    }
    get readOnly() {
        return this._readOnly;
    }
    get enabled() {
        return this._enabled;
    }
    set enabled(value) {
        if (!value) {
            this.over = false;
        }
        this._enabled = value;
    }
    get key() {
        return this._key;
    }
    set key(key) {
        if (this.items != null) {
            this.items.forEach(i => i.selected = i.key === key);
        }
        this._key = key;
    }
    get inputValue() {
        var _a;
        if (this.items != null) {
            return ((_a = this.items.find(i => i.key === this._key)) === null || _a === void 0 ? void 0 : _a.caption) || '';
        }
        return '';
    }
    get selected() {
        var _a, _b;
        const vm = this.menuService.getVerticalMenu();
        return ((_a = vm) === null || _a === void 0 ? void 0 : _a.state) === 'expanded' && ((_b = vm) === null || _b === void 0 ? void 0 : _b.parent) === this.element;
    }
    get className() {
        return this.selected ? 'stiJsViewerDropDownListOver' : (this.enabled ? (this.over ? 'stiJsViewerDropDownListOver' : 'stiJsViewerDropDownList') : 'stiJsViewerDropDownListDisabled');
    }
    mouseover() {
        if (!this.enabled) {
            return;
        }
        this.over = true;
    }
    mouseout() {
        if (!this.enabled) {
            return;
        }
        this.over = false;
    }
    inputClick() {
        if (this.readOnly) {
            this.showListMenu();
        }
    }
    showListMenu() {
        this.menuService.addMenu({
            type: this.menuService.VERTICAL_MENU_NAME, name: this.menuService.VERTICAL_MENU_NAME, items: [], parent: this.element,
            verticalItems: this.items, itemStyleName: 'stiJsViewerMenuStandartItem', menuStyleName: 'stiJsViewerDropdownMenu',
            action: this.action, width: this.element.nativeElement.offsetWidth
        });
        setTimeout(() => {
            this.menuService.showMenu(this.menuService.VERTICAL_MENU_NAME);
        });
    }
    hideListMenu() {
        if (this.menuService.getVerticalMenu()) {
            this.menuService.getVerticalMenu().state = 'initialDown';
        }
    }
};
DropDownListComponent.ctorParameters = () => [
    { type: ModelService },
    { type: MouseService },
    { type: MenuService }
];
__decorate([
    ViewChild('input')
], DropDownListComponent.prototype, "input", void 0);
__decorate([
    ViewChild('element')
], DropDownListComponent.prototype, "element", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "toolTip", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "showImage", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "width", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "margin", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "items", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "styleDisplay", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "verticalAlign", void 0);
__decorate([
    Output()
], DropDownListComponent.prototype, "action", void 0);
__decorate([
    Input()
], DropDownListComponent.prototype, "readOnly", null);
__decorate([
    Input()
], DropDownListComponent.prototype, "enabled", null);
__decorate([
    Input()
], DropDownListComponent.prototype, "key", null);
DropDownListComponent = __decorate([
    Component({
        selector: 'sti-drop-down-list',
        template: `
        <table #element [class]="className" cellpadding="0" cellspacing="0"
              [style.fontFamily]="model.options.toolbar.fontFamily"
              [style.color]="model.options.toolbar.fontColor"
              [style.margin]="margin"
              [style.verticalAlign]="verticalAlign"
              [style.display]="styleDisplay"
              [attr.title]="toolTip"
              (mouseover)="mouseover()"
              (mouseout)="mouseout()">
          <tbody>
            <tr class="stiJsViewerClearAllStyles">
              <td class="stiJsViewerClearAllStyles">
                <input #input
                [style.width.px]="width - (model.options.isTouchDevice ? 23 : 15) - (showImage ? 38 : 0)"
                [style.border]="0"
                [style.cursor]="readOnly ? 'default' : 'text'"
                [style.fontFamily]="model.options.toolbar.fontFamily"
                [style.color]="model.options.toolbar.fontColor"
                [style.height]="model.options.isTouchDevice ? '23px' : '18px'"
                [style.lineHeight]="model.options.isTouchDevice ? '23px' : '18px'"
                [style.visibility]="enabled ? 'visible' : 'hidden'"
                [value]="inputValue"
                (click)="inputClick()"
                class="stiJsViewerDropDownList_TextBox">
              </td>

              <td class="stiJsViewerClearAllStyles">
                  <sti-button [imageName]="'Arrows.' + (model.options.isTouchDevice ? 'Big' : 'Small') + 'ArrowDown.png'"
                     [styleName]="'stiJsViewerDropDownListButton'"
                     [imageSizesWidth]="model.options.isTouchDevice ? 16 : 8"
                     [imageSizesHeight]="model.options.isTouchDevice ? 16 : 8"
                     [height]="model.options.isTouchDevice ? '26px' : '21px'"
                     [enabled]="enabled"
                     [selected]="selected"
                     [margin]="'0'"
                     (action)="showListMenu()">
                  </sti-button>
              </td>
            </tr>
          </tbody>
        </table>

  `
    })
], DropDownListComponent);
export { DropDownListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcC1kb3duLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3RpbXVsc29mdC12aWV3ZXItYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb250cm9scy9kcm9wLWRvd24tbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBYyxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBa0RuRCxJQUFhLHFCQUFxQixHQUFsQyxNQUFhLHFCQUFxQjtJQW9CaEMsWUFBbUIsS0FBbUIsRUFBUyxZQUEwQixFQUFTLFdBQXdCO1FBQXZGLFVBQUssR0FBTCxLQUFLLENBQWM7UUFBUyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFTLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBZGpHLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFPakIsV0FBTSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXpELFNBQUksR0FBRyxLQUFLLENBQUM7UUFDTCxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFJdEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDcEQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFFBQVEsS0FBSyxDQUFDO0lBRWQsSUFBSSxRQUFRLENBQUMsS0FBYztRQUN6QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixVQUFVLENB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Q2Q7SUFBUixLQUFLLEVBQUU7MkRBQXNCO0FBQ3JCO0lBQVIsS0FBSyxFQUFFOzREQUF1QjtBQUVyQjtJQUFULE1BQU0sRUFBRTtxREFBZ0Q7QUEwQmhEO0lBQVIsS0FBSyxFQUFFO3FEQUVQO0FBRVE7SUFBUixLQUFLLEVBQUU7b0RBRVA7QUFTUTtJQUFSLEtBQUssRUFBRTtnREFFUDtBQXhEVSxxQkFBcUI7SUFoRGpDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxvQkFBb0I7UUFDOUIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMkNUO0tBQ0YsQ0FBQztHQUVXLHFCQUFxQixDQXVIakM7U0F2SFkscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1vZGVsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vZGVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJdGVtIH0gZnJvbSAnLi4vc2VydmljZXMvb2JqZWN0cyc7XHJcbmltcG9ydCB7IE1vdXNlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL21vdXNlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNZW51U2VydmljZSB9IGZyb20gJy4uL21lbnUvbWVudS5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc3RpLWRyb3AtZG93bi1saXN0JyxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDx0YWJsZSAjZWxlbWVudCBbY2xhc3NdPVwiY2xhc3NOYW1lXCIgY2VsbHBhZGRpbmc9XCIwXCIgY2VsbHNwYWNpbmc9XCIwXCJcclxuICAgICAgICAgICAgICBbc3R5bGUuZm9udEZhbWlseV09XCJtb2RlbC5vcHRpb25zLnRvb2xiYXIuZm9udEZhbWlseVwiXHJcbiAgICAgICAgICAgICAgW3N0eWxlLmNvbG9yXT1cIm1vZGVsLm9wdGlvbnMudG9vbGJhci5mb250Q29sb3JcIlxyXG4gICAgICAgICAgICAgIFtzdHlsZS5tYXJnaW5dPVwibWFyZ2luXCJcclxuICAgICAgICAgICAgICBbc3R5bGUudmVydGljYWxBbGlnbl09XCJ2ZXJ0aWNhbEFsaWduXCJcclxuICAgICAgICAgICAgICBbc3R5bGUuZGlzcGxheV09XCJzdHlsZURpc3BsYXlcIlxyXG4gICAgICAgICAgICAgIFthdHRyLnRpdGxlXT1cInRvb2xUaXBcIlxyXG4gICAgICAgICAgICAgIChtb3VzZW92ZXIpPVwibW91c2VvdmVyKClcIlxyXG4gICAgICAgICAgICAgIChtb3VzZW91dCk9XCJtb3VzZW91dCgpXCI+XHJcbiAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgIDx0ciBjbGFzcz1cInN0aUpzVmlld2VyQ2xlYXJBbGxTdHlsZXNcIj5cclxuICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGlKc1ZpZXdlckNsZWFyQWxsU3R5bGVzXCI+XHJcbiAgICAgICAgICAgICAgICA8aW5wdXQgI2lucHV0XHJcbiAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGgucHhdPVwid2lkdGggLSAobW9kZWwub3B0aW9ucy5pc1RvdWNoRGV2aWNlID8gMjMgOiAxNSkgLSAoc2hvd0ltYWdlID8gMzggOiAwKVwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuYm9yZGVyXT1cIjBcIlxyXG4gICAgICAgICAgICAgICAgW3N0eWxlLmN1cnNvcl09XCJyZWFkT25seSA/ICdkZWZhdWx0JyA6ICd0ZXh0J1wiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuZm9udEZhbWlseV09XCJtb2RlbC5vcHRpb25zLnRvb2xiYXIuZm9udEZhbWlseVwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuY29sb3JdPVwibW9kZWwub3B0aW9ucy50b29sYmFyLmZvbnRDb2xvclwiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUuaGVpZ2h0XT1cIm1vZGVsLm9wdGlvbnMuaXNUb3VjaERldmljZSA/ICcyM3B4JyA6ICcxOHB4J1wiXHJcbiAgICAgICAgICAgICAgICBbc3R5bGUubGluZUhlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAnMjNweCcgOiAnMThweCdcIlxyXG4gICAgICAgICAgICAgICAgW3N0eWxlLnZpc2liaWxpdHldPVwiZW5hYmxlZCA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZV09XCJpbnB1dFZhbHVlXCJcclxuICAgICAgICAgICAgICAgIChjbGljayk9XCJpbnB1dENsaWNrKClcIlxyXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJzdGlKc1ZpZXdlckRyb3BEb3duTGlzdF9UZXh0Qm94XCI+XHJcbiAgICAgICAgICAgICAgPC90ZD5cclxuXHJcbiAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RpSnNWaWV3ZXJDbGVhckFsbFN0eWxlc1wiPlxyXG4gICAgICAgICAgICAgICAgICA8c3RpLWJ1dHRvbiBbaW1hZ2VOYW1lXT1cIidBcnJvd3MuJyArIChtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAnQmlnJyA6ICdTbWFsbCcpICsgJ0Fycm93RG93bi5wbmcnXCJcclxuICAgICAgICAgICAgICAgICAgICAgW3N0eWxlTmFtZV09XCInc3RpSnNWaWV3ZXJEcm9wRG93bkxpc3RCdXR0b24nXCJcclxuICAgICAgICAgICAgICAgICAgICAgW2ltYWdlU2l6ZXNXaWR0aF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAxNiA6IDhcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbaW1hZ2VTaXplc0hlaWdodF09XCJtb2RlbC5vcHRpb25zLmlzVG91Y2hEZXZpY2UgPyAxNiA6IDhcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbaGVpZ2h0XT1cIm1vZGVsLm9wdGlvbnMuaXNUb3VjaERldmljZSA/ICcyNnB4JyA6ICcyMXB4J1wiXHJcbiAgICAgICAgICAgICAgICAgICAgIFtlbmFibGVkXT1cImVuYWJsZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbc2VsZWN0ZWRdPVwic2VsZWN0ZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICBbbWFyZ2luXT1cIicwJ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgIChhY3Rpb24pPVwic2hvd0xpc3RNZW51KClcIj5cclxuICAgICAgICAgICAgICAgICAgPC9zdGktYnV0dG9uPlxyXG4gICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgIDwvdGFibGU+XHJcblxyXG4gIGBcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBEcm9wRG93bkxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcpIGlucHV0OiBFbGVtZW50UmVmO1xyXG4gIEBWaWV3Q2hpbGQoJ2VsZW1lbnQnKSBlbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICBASW5wdXQoKSB0b29sVGlwOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgc2hvd0ltYWdlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgd2lkdGg6IG51bWJlcjtcclxuICBASW5wdXQoKSBtYXJnaW46IHN0cmluZztcclxuICBASW5wdXQoKSBpdGVtczogSXRlbVtdO1xyXG4gIEBJbnB1dCgpIHN0eWxlRGlzcGxheTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHZlcnRpY2FsQWxpZ246IHN0cmluZztcclxuXHJcbiAgQE91dHB1dCgpIGFjdGlvbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIG92ZXIgPSBmYWxzZTtcclxuICBwcml2YXRlIF9yZWFkT25seSA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2VuYWJsZWQgPSB0cnVlO1xyXG4gIHByaXZhdGUgX2tleTogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbW9kZWw6IE1vZGVsU2VydmljZSwgcHVibGljIG1vdXNlU2VydmljZTogTW91c2VTZXJ2aWNlLCBwdWJsaWMgbWVudVNlcnZpY2U6IE1lbnVTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLm1vdXNlU2VydmljZS5nZXREb2N1bWVudE1vdXNlVXAoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmhpZGVMaXN0TWVudSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHsgfVxyXG5cclxuICBzZXQgcmVhZE9ubHkodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX3JlYWRPbmx5ID0gdmFsdWU7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICB0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCd1bnNlbGVjdGFibGUnLCB2YWx1ZSA/ICdvbicgOiAnb2ZmJyk7XHJcbiAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnNldEF0dHJpYnV0ZSgnb25zZWxlY3RzdGFydCcsIHZhbHVlID8gJ3JldHVybiBmYWxzZScgOiAnJyk7XHJcbiAgICAgICAgdGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50LnJlYWRPbmx5ID0gdmFsdWU7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQgcmVhZE9ubHkoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVhZE9ubHk7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQgZW5hYmxlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9lbmFibGVkO1xyXG4gIH1cclxuXHJcbiAgc2V0IGVuYWJsZWQodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgdGhpcy5vdmVyID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9lbmFibGVkID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBnZXQga2V5KCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5fa2V5O1xyXG4gIH1cclxuXHJcbiAgc2V0IGtleShrZXk6IGFueSkge1xyXG4gICAgaWYgKHRoaXMuaXRlbXMgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaSA9PiBpLnNlbGVjdGVkID0gaS5rZXkgPT09IGtleSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9rZXkgPSBrZXk7XHJcbiAgfVxyXG5cclxuICBnZXQgaW5wdXRWYWx1ZSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuaXRlbXMgIT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5pdGVtcy5maW5kKGkgPT4gaS5rZXkgPT09IHRoaXMuX2tleSk/LmNhcHRpb24gfHwgJyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG5cclxuICBnZXQgc2VsZWN0ZWQoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB2bSA9IHRoaXMubWVudVNlcnZpY2UuZ2V0VmVydGljYWxNZW51KCk7XHJcbiAgICByZXR1cm4gdm0/LnN0YXRlID09PSAnZXhwYW5kZWQnICYmIHZtPy5wYXJlbnQgPT09IHRoaXMuZWxlbWVudDtcclxuICB9XHJcblxyXG4gIGdldCBjbGFzc05hbWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkID8gJ3N0aUpzVmlld2VyRHJvcERvd25MaXN0T3ZlcicgOiAodGhpcy5lbmFibGVkID8gKHRoaXMub3ZlciA/ICdzdGlKc1ZpZXdlckRyb3BEb3duTGlzdE92ZXInIDogJ3N0aUpzVmlld2VyRHJvcERvd25MaXN0JykgOiAnc3RpSnNWaWV3ZXJEcm9wRG93bkxpc3REaXNhYmxlZCcpO1xyXG4gIH1cclxuXHJcbiAgbW91c2VvdmVyKCkge1xyXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vdmVyID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG1vdXNlb3V0KCkge1xyXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vdmVyID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpbnB1dENsaWNrKCkge1xyXG4gICAgaWYgKHRoaXMucmVhZE9ubHkpIHtcclxuICAgICAgdGhpcy5zaG93TGlzdE1lbnUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNob3dMaXN0TWVudSgpIHtcclxuICAgIHRoaXMubWVudVNlcnZpY2UuYWRkTWVudSh7XHJcbiAgICAgIHR5cGU6IHRoaXMubWVudVNlcnZpY2UuVkVSVElDQUxfTUVOVV9OQU1FLCBuYW1lOiB0aGlzLm1lbnVTZXJ2aWNlLlZFUlRJQ0FMX01FTlVfTkFNRSwgaXRlbXM6IFtdLCBwYXJlbnQ6IHRoaXMuZWxlbWVudCxcclxuICAgICAgdmVydGljYWxJdGVtczogdGhpcy5pdGVtcywgaXRlbVN0eWxlTmFtZTogJ3N0aUpzVmlld2VyTWVudVN0YW5kYXJ0SXRlbScsIG1lbnVTdHlsZU5hbWU6ICdzdGlKc1ZpZXdlckRyb3Bkb3duTWVudScsXHJcbiAgICAgIGFjdGlvbjogdGhpcy5hY3Rpb24sIHdpZHRoOiB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aFxyXG4gICAgfSk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMubWVudVNlcnZpY2Uuc2hvd01lbnUodGhpcy5tZW51U2VydmljZS5WRVJUSUNBTF9NRU5VX05BTUUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBoaWRlTGlzdE1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5tZW51U2VydmljZS5nZXRWZXJ0aWNhbE1lbnUoKSkge1xyXG4gICAgICB0aGlzLm1lbnVTZXJ2aWNlLmdldFZlcnRpY2FsTWVudSgpLnN0YXRlID0gJ2luaXRpYWxEb3duJztcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==